const Mm=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}};Mm();var oc={exports:{}},Se={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Sf=Object.getOwnPropertySymbols,Rm=Object.prototype.hasOwnProperty,Fm=Object.prototype.propertyIsEnumerable;function zm(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function Lm(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var a={},i=0;i<10;i++)a["_"+String.fromCharCode(i)]=i;var r=Object.getOwnPropertyNames(a).map(function(n){return a[n]});if(r.join("")!=="0123456789")return!1;var e={};return"abcdefghijklmnopqrst".split("").forEach(function(n){e[n]=n}),Object.keys(Object.assign({},e)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var jp=Lm()?Object.assign:function(t,a){for(var i,r=zm(t),e,n=1;n<arguments.length;n++){i=Object(arguments[n]);for(var o in i)Rm.call(i,o)&&(r[o]=i[o]);if(Sf){e=Sf(i);for(var s=0;s<e.length;s++)Fm.call(i,e[s])&&(r[e[s]]=i[e[s]])}}return r};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sc=jp,pa=60103,Xp=60106;Se.Fragment=60107;Se.StrictMode=60108;Se.Profiler=60114;var $p=60109,qp=60110,Yp=60112;Se.Suspense=60113;var Qp=60115,Jp=60116;if(typeof Symbol=="function"&&Symbol.for){var dr=Symbol.for;pa=dr("react.element"),Xp=dr("react.portal"),Se.Fragment=dr("react.fragment"),Se.StrictMode=dr("react.strict_mode"),Se.Profiler=dr("react.profiler"),$p=dr("react.provider"),qp=dr("react.context"),Yp=dr("react.forward_ref"),Se.Suspense=dr("react.suspense"),Qp=dr("react.memo"),Jp=dr("react.lazy")}var Cf=typeof Symbol=="function"&&Symbol.iterator;function Bm(t){return t===null||typeof t!="object"?null:(t=Cf&&t[Cf]||t["@@iterator"],typeof t=="function"?t:null)}function zo(t){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)a+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Kp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Zp={};function ga(t,a,i){this.props=t,this.context=a,this.refs=Zp,this.updater=i||Kp}ga.prototype.isReactComponent={};ga.prototype.setState=function(t,a){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error(zo(85));this.updater.enqueueSetState(this,t,a,"setState")};ga.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function eg(){}eg.prototype=ga.prototype;function lc(t,a,i){this.props=t,this.context=a,this.refs=Zp,this.updater=i||Kp}var uc=lc.prototype=new eg;uc.constructor=lc;sc(uc,ga.prototype);uc.isPureReactComponent=!0;var cc={current:null},tg=Object.prototype.hasOwnProperty,rg={key:!0,ref:!0,__self:!0,__source:!0};function ng(t,a,i){var r,e={},n=null,o=null;if(a!=null)for(r in a.ref!==void 0&&(o=a.ref),a.key!==void 0&&(n=""+a.key),a)tg.call(a,r)&&!rg.hasOwnProperty(r)&&(e[r]=a[r]);var s=arguments.length-2;if(s===1)e.children=i;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];e.children=l}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)e[r]===void 0&&(e[r]=s[r]);return{$$typeof:pa,type:t,key:n,ref:o,props:e,_owner:cc.current}}function Dm(t,a){return{$$typeof:pa,type:t.type,key:a,ref:t.ref,props:t.props,_owner:t._owner}}function fc(t){return typeof t=="object"&&t!==null&&t.$$typeof===pa}function Om(t){var a={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return a[i]})}var Pf=/\/+/g;function bl(t,a){return typeof t=="object"&&t!==null&&t.key!=null?Om(""+t.key):a.toString(36)}function us(t,a,i,r,e){var n=typeof t;(n==="undefined"||n==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(n){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case pa:case Xp:o=!0}}if(o)return o=t,e=e(o),t=r===""?"."+bl(o,0):r,Array.isArray(e)?(i="",t!=null&&(i=t.replace(Pf,"$&/")+"/"),us(e,a,i,"",function(u){return u})):e!=null&&(fc(e)&&(e=Dm(e,i+(!e.key||o&&o.key===e.key?"":(""+e.key).replace(Pf,"$&/")+"/")+t)),a.push(e)),1;if(o=0,r=r===""?".":r+":",Array.isArray(t))for(var s=0;s<t.length;s++){n=t[s];var l=r+bl(n,s);o+=us(n,a,i,l,e)}else if(l=Bm(t),typeof l=="function")for(t=l.call(t),s=0;!(n=t.next()).done;)n=n.value,l=r+bl(n,s++),o+=us(n,a,i,l,e);else if(n==="object")throw a=""+t,Error(zo(31,a==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":a));return o}function jo(t,a,i){if(t==null)return t;var r=[],e=0;return us(t,r,"","",function(n){return a.call(i,n,e++)}),r}function Im(t){if(t._status===-1){var a=t._result;a=a(),t._status=0,t._result=a,a.then(function(i){t._status===0&&(i=i.default,t._status=1,t._result=i)},function(i){t._status===0&&(t._status=2,t._result=i)})}if(t._status===1)return t._result;throw t._result}var ig={current:null};function sn(){var t=ig.current;if(t===null)throw Error(zo(321));return t}var Nm={ReactCurrentDispatcher:ig,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:cc,IsSomeRendererActing:{current:!1},assign:sc};Se.Children={map:jo,forEach:function(t,a,i){jo(t,function(){a.apply(this,arguments)},i)},count:function(t){var a=0;return jo(t,function(){a++}),a},toArray:function(t){return jo(t,function(a){return a})||[]},only:function(t){if(!fc(t))throw Error(zo(143));return t}};Se.Component=ga;Se.PureComponent=lc;Se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Nm;Se.cloneElement=function(t,a,i){if(t==null)throw Error(zo(267,t));var r=sc({},t.props),e=t.key,n=t.ref,o=t._owner;if(a!=null){if(a.ref!==void 0&&(n=a.ref,o=cc.current),a.key!==void 0&&(e=""+a.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(l in a)tg.call(a,l)&&!rg.hasOwnProperty(l)&&(r[l]=a[l]===void 0&&s!==void 0?s[l]:a[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){s=Array(l);for(var u=0;u<l;u++)s[u]=arguments[u+2];r.children=s}return{$$typeof:pa,type:t.type,key:e,ref:n,props:r,_owner:o}};Se.createContext=function(t,a){return a===void 0&&(a=null),t={$$typeof:qp,_calculateChangedBits:a,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider={$$typeof:$p,_context:t},t.Consumer=t};Se.createElement=ng;Se.createFactory=function(t){var a=ng.bind(null,t);return a.type=t,a};Se.createRef=function(){return{current:null}};Se.forwardRef=function(t){return{$$typeof:Yp,render:t}};Se.isValidElement=fc;Se.lazy=function(t){return{$$typeof:Jp,_payload:{_status:-1,_result:t},_init:Im}};Se.memo=function(t,a){return{$$typeof:Qp,type:t,compare:a===void 0?null:a}};Se.useCallback=function(t,a){return sn().useCallback(t,a)};Se.useContext=function(t,a){return sn().useContext(t,a)};Se.useDebugValue=function(){};Se.useEffect=function(t,a){return sn().useEffect(t,a)};Se.useImperativeHandle=function(t,a,i){return sn().useImperativeHandle(t,a,i)};Se.useLayoutEffect=function(t,a){return sn().useLayoutEffect(t,a)};Se.useMemo=function(t,a){return sn().useMemo(t,a)};Se.useReducer=function(t,a,i){return sn().useReducer(t,a,i)};Se.useRef=function(t){return sn().useRef(t)};Se.useState=function(t){return sn().useState(t)};Se.version="17.0.2";oc.exports=Se;var $a=oc.exports,ag={exports:{}},fr={},og={exports:{}},sg={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){var a,i,r,e;if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;t.unstable_now=function(){return n.now()}}else{var o=Date,s=o.now();t.unstable_now=function(){return o.now()-s}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var l=null,u=null,c=function(){if(l!==null)try{var I=t.unstable_now();l(!0,I),l=null}catch(H){throw setTimeout(c,0),H}};a=function(I){l!==null?setTimeout(a,0,I):(l=I,setTimeout(c,0))},i=function(I,H){u=setTimeout(I,H)},r=function(){clearTimeout(u)},t.unstable_shouldYield=function(){return!1},e=t.unstable_forceFrameRate=function(){}}else{var f=window.setTimeout,h=window.clearTimeout;if(typeof console!="undefined"){var d=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof d!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var _=!1,m=null,p=-1,v=5,g=0;t.unstable_shouldYield=function(){return t.unstable_now()>=g},e=function(){},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):v=0<I?Math.floor(1e3/I):5};var y=new MessageChannel,x=y.port2;y.port1.onmessage=function(){if(m!==null){var I=t.unstable_now();g=I+v;try{m(!0,I)?x.postMessage(null):(_=!1,m=null)}catch(H){throw x.postMessage(null),H}}else _=!1},a=function(I){m=I,_||(_=!0,x.postMessage(null))},i=function(I,H){p=f(function(){I(t.unstable_now())},H)},r=function(){h(p),p=-1}}function P(I,H){var G=I.length;I.push(H);e:for(;;){var te=G-1>>>1,ie=I[te];if(ie!==void 0&&0<b(ie,H))I[te]=H,I[G]=ie,G=te;else break e}}function S(I){return I=I[0],I===void 0?null:I}function w(I){var H=I[0];if(H!==void 0){var G=I.pop();if(G!==H){I[0]=G;e:for(var te=0,ie=I.length;te<ie;){var fe=2*(te+1)-1,ce=I[fe],me=fe+1,Me=I[me];if(ce!==void 0&&0>b(ce,G))Me!==void 0&&0>b(Me,ce)?(I[te]=Me,I[me]=G,te=me):(I[te]=ce,I[fe]=G,te=fe);else if(Me!==void 0&&0>b(Me,G))I[te]=Me,I[me]=G,te=me;else break e}}return H}return null}function b(I,H){var G=I.sortIndex-H.sortIndex;return G!==0?G:I.id-H.id}var E=[],M=[],F=1,A=null,T=3,R=!1,z=!1,L=!1;function N(I){for(var H=S(M);H!==null;){if(H.callback===null)w(M);else if(H.startTime<=I)w(M),H.sortIndex=H.expirationTime,P(E,H);else break;H=S(M)}}function V(I){if(L=!1,N(I),!z)if(S(E)!==null)z=!0,a(D);else{var H=S(M);H!==null&&i(V,H.startTime-I)}}function D(I,H){z=!1,L&&(L=!1,r()),R=!0;var G=T;try{for(N(H),A=S(E);A!==null&&(!(A.expirationTime>H)||I&&!t.unstable_shouldYield());){var te=A.callback;if(typeof te=="function"){A.callback=null,T=A.priorityLevel;var ie=te(A.expirationTime<=H);H=t.unstable_now(),typeof ie=="function"?A.callback=ie:A===S(E)&&w(E),N(H)}else w(E);A=S(E)}if(A!==null)var fe=!0;else{var ce=S(M);ce!==null&&i(V,ce.startTime-H),fe=!1}return fe}finally{A=null,T=G,R=!1}}var j=e;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){z||R||(z=!0,a(D))},t.unstable_getCurrentPriorityLevel=function(){return T},t.unstable_getFirstCallbackNode=function(){return S(E)},t.unstable_next=function(I){switch(T){case 1:case 2:case 3:var H=3;break;default:H=T}var G=T;T=H;try{return I()}finally{T=G}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=j,t.unstable_runWithPriority=function(I,H){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var G=T;T=I;try{return H()}finally{T=G}},t.unstable_scheduleCallback=function(I,H,G){var te=t.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?te+G:te):G=te,I){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=G+ie,I={id:F++,callback:H,priorityLevel:I,startTime:G,expirationTime:ie,sortIndex:-1},G>te?(I.sortIndex=G,P(M,I),S(E)===null&&I===S(M)&&(L?r():L=!0,i(V,G-te))):(I.sortIndex=ie,P(E,I),z||R||(z=!0,a(D))),I},t.unstable_wrapCallback=function(I){var H=T;return function(){var G=T;T=H;try{return I.apply(this,arguments)}finally{T=G}}}})(sg);og.exports=sg;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var el=oc.exports,Ne=jp,ft=og.exports;function X(t){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)a+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!el)throw Error(X(227));var lg=new Set,lo={};function Si(t,a){sa(t,a),sa(t+"Capture",a)}function sa(t,a){for(lo[t]=a,t=0;t<a.length;t++)lg.add(a[t])}var rn=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),km=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Af=Object.prototype.hasOwnProperty,Tf={},bf={};function Um(t){return Af.call(bf,t)?!0:Af.call(Tf,t)?!1:km.test(t)?bf[t]=!0:(Tf[t]=!0,!1)}function Vm(t,a,i,r){if(i!==null&&i.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Gm(t,a,i,r){if(a===null||typeof a=="undefined"||Vm(t,a,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function Ot(t,a,i,r,e,n,o){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=r,this.attributeNamespace=e,this.mustUseProperty=i,this.propertyName=t,this.type=a,this.sanitizeURL=n,this.removeEmptyString=o}var mt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){mt[t]=new Ot(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var a=t[0];mt[a]=new Ot(a,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){mt[t]=new Ot(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){mt[t]=new Ot(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){mt[t]=new Ot(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){mt[t]=new Ot(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){mt[t]=new Ot(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){mt[t]=new Ot(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){mt[t]=new Ot(t,5,!1,t.toLowerCase(),null,!1,!1)});var hc=/[\-:]([a-z])/g;function dc(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var a=t.replace(hc,dc);mt[a]=new Ot(a,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var a=t.replace(hc,dc);mt[a]=new Ot(a,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var a=t.replace(hc,dc);mt[a]=new Ot(a,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){mt[t]=new Ot(t,1,!1,t.toLowerCase(),null,!1,!1)});mt.xlinkHref=new Ot("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){mt[t]=new Ot(t,1,!1,t.toLowerCase(),null,!0,!0)});function _c(t,a,i,r){var e=mt.hasOwnProperty(a)?mt[a]:null,n=e!==null?e.type===0:r?!1:!(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N");n||(Gm(a,i,e,r)&&(i=null),r||e===null?Um(a)&&(i===null?t.removeAttribute(a):t.setAttribute(a,""+i)):e.mustUseProperty?t[e.propertyName]=i===null?e.type===3?!1:"":i:(a=e.attributeName,r=e.attributeNamespace,i===null?t.removeAttribute(a):(e=e.type,i=e===3||e===4&&i===!0?"":""+i,r?t.setAttributeNS(r,a,i):t.setAttribute(a,i))))}var Ci=el.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ua=60103,ni=60106,yn=60107,vc=60108,qa=60114,pc=60109,gc=60110,tl=60112,Ya=60113,Cs=60120,rl=60115,mc=60116,yc=60121,xc=60128,ug=60129,wc=60130,su=60131;if(typeof Symbol=="function"&&Symbol.for){var ot=Symbol.for;Ua=ot("react.element"),ni=ot("react.portal"),yn=ot("react.fragment"),vc=ot("react.strict_mode"),qa=ot("react.profiler"),pc=ot("react.provider"),gc=ot("react.context"),tl=ot("react.forward_ref"),Ya=ot("react.suspense"),Cs=ot("react.suspense_list"),rl=ot("react.memo"),mc=ot("react.lazy"),yc=ot("react.block"),ot("react.scope"),xc=ot("react.opaque.id"),ug=ot("react.debug_trace_mode"),wc=ot("react.offscreen"),su=ot("react.legacy_hidden")}var Ef=typeof Symbol=="function"&&Symbol.iterator;function Ta(t){return t===null||typeof t!="object"?null:(t=Ef&&t[Ef]||t["@@iterator"],typeof t=="function"?t:null)}var El;function Va(t){if(El===void 0)try{throw Error()}catch(i){var a=i.stack.trim().match(/\n( *(at )?)/);El=a&&a[1]||""}return`
`+El+t}var Ml=!1;function Xo(t,a){if(!t||Ml)return"";Ml=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(l){var r=l}Reflect.construct(t,[],a)}else{try{a.call()}catch(l){r=l}t.call(a.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var e=l.stack.split(`
`),n=r.stack.split(`
`),o=e.length-1,s=n.length-1;1<=o&&0<=s&&e[o]!==n[s];)s--;for(;1<=o&&0<=s;o--,s--)if(e[o]!==n[s]){if(o!==1||s!==1)do if(o--,s--,0>s||e[o]!==n[s])return`
`+e[o].replace(" at new "," at ");while(1<=o&&0<=s);break}}}finally{Ml=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?Va(t):""}function Hm(t){switch(t.tag){case 5:return Va(t.type);case 16:return Va("Lazy");case 13:return Va("Suspense");case 19:return Va("SuspenseList");case 0:case 2:case 15:return t=Xo(t.type,!1),t;case 11:return t=Xo(t.type.render,!1),t;case 22:return t=Xo(t.type._render,!1),t;case 1:return t=Xo(t.type,!0),t;default:return""}}function qi(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case yn:return"Fragment";case ni:return"Portal";case qa:return"Profiler";case vc:return"StrictMode";case Ya:return"Suspense";case Cs:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case gc:return(t.displayName||"Context")+".Consumer";case pc:return(t._context.displayName||"Context")+".Provider";case tl:var a=t.render;return a=a.displayName||a.name||"",t.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case rl:return qi(t.type);case yc:return qi(t._render);case mc:a=t._payload,t=t._init;try{return qi(t(a))}catch{}}return null}function On(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function cg(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Wm(t){var a=cg(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,a),r=""+t[a];if(!t.hasOwnProperty(a)&&typeof i!="undefined"&&typeof i.get=="function"&&typeof i.set=="function"){var e=i.get,n=i.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return e.call(this)},set:function(o){r=""+o,n.call(this,o)}}),Object.defineProperty(t,a,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function $o(t){t._valueTracker||(t._valueTracker=Wm(t))}function fg(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var i=a.getValue(),r="";return t&&(r=cg(t)?t.checked?"true":"false":t.value),t=r,t!==i?(a.setValue(t),!0):!1}function Ps(t){if(t=t||(typeof document!="undefined"?document:void 0),typeof t=="undefined")return null;try{return t.activeElement||t.body}catch{return t.body}}function lu(t,a){var i=a.checked;return Ne({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i!=null?i:t._wrapperState.initialChecked})}function Mf(t,a){var i=a.defaultValue==null?"":a.defaultValue,r=a.checked!=null?a.checked:a.defaultChecked;i=On(a.value!=null?a.value:i),t._wrapperState={initialChecked:r,initialValue:i,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function hg(t,a){a=a.checked,a!=null&&_c(t,"checked",a,!1)}function uu(t,a){hg(t,a);var i=On(a.value),r=a.type;if(i!=null)r==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}a.hasOwnProperty("value")?cu(t,a.type,i):a.hasOwnProperty("defaultValue")&&cu(t,a.type,On(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(t.defaultChecked=!!a.defaultChecked)}function Rf(t,a,i){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var r=a.type;if(!(r!=="submit"&&r!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+t._wrapperState.initialValue,i||a===t.value||(t.value=a),t.defaultValue=a}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function cu(t,a,i){(a!=="number"||Ps(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}function jm(t){var a="";return el.Children.forEach(t,function(i){i!=null&&(a+=i)}),a}function fu(t,a){return t=Ne({children:void 0},a),(a=jm(a.children))&&(t.children=a),t}function Yi(t,a,i,r){if(t=t.options,a){a={};for(var e=0;e<i.length;e++)a["$"+i[e]]=!0;for(i=0;i<t.length;i++)e=a.hasOwnProperty("$"+t[i].value),t[i].selected!==e&&(t[i].selected=e),e&&r&&(t[i].defaultSelected=!0)}else{for(i=""+On(i),a=null,e=0;e<t.length;e++){if(t[e].value===i){t[e].selected=!0,r&&(t[e].defaultSelected=!0);return}a!==null||t[e].disabled||(a=t[e])}a!==null&&(a.selected=!0)}}function hu(t,a){if(a.dangerouslySetInnerHTML!=null)throw Error(X(91));return Ne({},a,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ff(t,a){var i=a.value;if(i==null){if(i=a.children,a=a.defaultValue,i!=null){if(a!=null)throw Error(X(92));if(Array.isArray(i)){if(!(1>=i.length))throw Error(X(93));i=i[0]}a=i}a==null&&(a=""),i=a}t._wrapperState={initialValue:On(i)}}function dg(t,a){var i=On(a.value),r=On(a.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),a.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),r!=null&&(t.defaultValue=""+r)}function zf(t){var a=t.textContent;a===t._wrapperState.initialValue&&a!==""&&a!==null&&(t.value=a)}var du={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function _g(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _u(t,a){return t==null||t==="http://www.w3.org/1999/xhtml"?_g(a):t==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var qo,vg=function(t){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(a,i,r,e){MSApp.execUnsafeLocalFunction(function(){return t(a,i,r,e)})}:t}(function(t,a){if(t.namespaceURI!==du.svg||"innerHTML"in t)t.innerHTML=a;else{for(qo=qo||document.createElement("div"),qo.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=qo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;a.firstChild;)t.appendChild(a.firstChild)}});function uo(t,a){if(a){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=a;return}}t.textContent=a}var Qa={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xm=["Webkit","ms","Moz","O"];Object.keys(Qa).forEach(function(t){Xm.forEach(function(a){a=a+t.charAt(0).toUpperCase()+t.substring(1),Qa[a]=Qa[t]})});function pg(t,a,i){return a==null||typeof a=="boolean"||a===""?"":i||typeof a!="number"||a===0||Qa.hasOwnProperty(t)&&Qa[t]?(""+a).trim():a+"px"}function gg(t,a){t=t.style;for(var i in a)if(a.hasOwnProperty(i)){var r=i.indexOf("--")===0,e=pg(i,a[i],r);i==="float"&&(i="cssFloat"),r?t.setProperty(i,e):t[i]=e}}var $m=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vu(t,a){if(a){if($m[t]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(X(137,t));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(X(60));if(!(typeof a.dangerouslySetInnerHTML=="object"&&"__html"in a.dangerouslySetInnerHTML))throw Error(X(61))}if(a.style!=null&&typeof a.style!="object")throw Error(X(62))}}function pu(t,a){if(t.indexOf("-")===-1)return typeof a.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Sc(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var gu=null,Qi=null,Ji=null;function Lf(t){if(t=Bo(t)){if(typeof gu!="function")throw Error(X(280));var a=t.stateNode;a&&(a=ll(a),gu(t.stateNode,t.type,a))}}function mg(t){Qi?Ji?Ji.push(t):Ji=[t]:Qi=t}function yg(){if(Qi){var t=Qi,a=Ji;if(Ji=Qi=null,Lf(t),a)for(t=0;t<a.length;t++)Lf(a[t])}}function Cc(t,a){return t(a)}function xg(t,a,i,r,e){return t(a,i,r,e)}function Pc(){}var wg=Cc,ii=!1,Rl=!1;function Ac(){(Qi!==null||Ji!==null)&&(Pc(),yg())}function qm(t,a,i){if(Rl)return t(a,i);Rl=!0;try{return wg(t,a,i)}finally{Rl=!1,Ac()}}function co(t,a){var i=t.stateNode;if(i===null)return null;var r=ll(i);if(r===null)return null;i=r[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(X(231,a,typeof i));return i}var mu=!1;if(rn)try{var ba={};Object.defineProperty(ba,"passive",{get:function(){mu=!0}}),window.addEventListener("test",ba,ba),window.removeEventListener("test",ba,ba)}catch{mu=!1}function Ym(t,a,i,r,e,n,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{a.apply(i,u)}catch(c){this.onError(c)}}var Ja=!1,As=null,Ts=!1,yu=null,Qm={onError:function(t){Ja=!0,As=t}};function Jm(t,a,i,r,e,n,o,s,l){Ja=!1,As=null,Ym.apply(Qm,arguments)}function Km(t,a,i,r,e,n,o,s,l){if(Jm.apply(this,arguments),Ja){if(Ja){var u=As;Ja=!1,As=null}else throw Error(X(198));Ts||(Ts=!0,yu=u)}}function Pi(t){var a=t,i=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&1026)!==0&&(i=a.return),t=a.return;while(t)}return a.tag===3?i:null}function Sg(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function Bf(t){if(Pi(t)!==t)throw Error(X(188))}function Zm(t){var a=t.alternate;if(!a){if(a=Pi(t),a===null)throw Error(X(188));return a!==t?null:t}for(var i=t,r=a;;){var e=i.return;if(e===null)break;var n=e.alternate;if(n===null){if(r=e.return,r!==null){i=r;continue}break}if(e.child===n.child){for(n=e.child;n;){if(n===i)return Bf(e),t;if(n===r)return Bf(e),a;n=n.sibling}throw Error(X(188))}if(i.return!==r.return)i=e,r=n;else{for(var o=!1,s=e.child;s;){if(s===i){o=!0,i=e,r=n;break}if(s===r){o=!0,r=e,i=n;break}s=s.sibling}if(!o){for(s=n.child;s;){if(s===i){o=!0,i=n,r=e;break}if(s===r){o=!0,r=n,i=e;break}s=s.sibling}if(!o)throw Error(X(189))}}if(i.alternate!==r)throw Error(X(190))}if(i.tag!==3)throw Error(X(188));return i.stateNode.current===i?t:a}function Cg(t){if(t=Zm(t),!t)return null;for(var a=t;;){if(a.tag===5||a.tag===6)return a;if(a.child)a.child.return=a,a=a.child;else{if(a===t)break;for(;!a.sibling;){if(!a.return||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}}return null}function Df(t,a){for(var i=t.alternate;a!==null;){if(a===t||a===i)return!0;a=a.return}return!1}var Pg,Tc,Ag,Tg,xu=!1,Br=[],Tn=null,bn=null,En=null,fo=new Map,ho=new Map,Ea=[],Of="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wu(t,a,i,r,e){return{blockedOn:t,domEventName:a,eventSystemFlags:i|16,nativeEvent:e,targetContainers:[r]}}function If(t,a){switch(t){case"focusin":case"focusout":Tn=null;break;case"dragenter":case"dragleave":bn=null;break;case"mouseover":case"mouseout":En=null;break;case"pointerover":case"pointerout":fo.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":ho.delete(a.pointerId)}}function Ma(t,a,i,r,e,n){return t===null||t.nativeEvent!==n?(t=wu(a,i,r,e,n),a!==null&&(a=Bo(a),a!==null&&Tc(a)),t):(t.eventSystemFlags|=r,a=t.targetContainers,e!==null&&a.indexOf(e)===-1&&a.push(e),t)}function ey(t,a,i,r,e){switch(a){case"focusin":return Tn=Ma(Tn,t,a,i,r,e),!0;case"dragenter":return bn=Ma(bn,t,a,i,r,e),!0;case"mouseover":return En=Ma(En,t,a,i,r,e),!0;case"pointerover":var n=e.pointerId;return fo.set(n,Ma(fo.get(n)||null,t,a,i,r,e)),!0;case"gotpointercapture":return n=e.pointerId,ho.set(n,Ma(ho.get(n)||null,t,a,i,r,e)),!0}return!1}function ty(t){var a=ai(t.target);if(a!==null){var i=Pi(a);if(i!==null){if(a=i.tag,a===13){if(a=Sg(i),a!==null){t.blockedOn=a,Tg(t.lanePriority,function(){ft.unstable_runWithPriority(t.priority,function(){Ag(i)})});return}}else if(a===3&&i.stateNode.hydrate){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function cs(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var i=Rc(t.domEventName,t.eventSystemFlags,a[0],t.nativeEvent);if(i!==null)return a=Bo(i),a!==null&&Tc(a),t.blockedOn=i,!1;a.shift()}return!0}function Nf(t,a,i){cs(t)&&i.delete(a)}function ry(){for(xu=!1;0<Br.length;){var t=Br[0];if(t.blockedOn!==null){t=Bo(t.blockedOn),t!==null&&Pg(t);break}for(var a=t.targetContainers;0<a.length;){var i=Rc(t.domEventName,t.eventSystemFlags,a[0],t.nativeEvent);if(i!==null){t.blockedOn=i;break}a.shift()}t.blockedOn===null&&Br.shift()}Tn!==null&&cs(Tn)&&(Tn=null),bn!==null&&cs(bn)&&(bn=null),En!==null&&cs(En)&&(En=null),fo.forEach(Nf),ho.forEach(Nf)}function Ra(t,a){t.blockedOn===a&&(t.blockedOn=null,xu||(xu=!0,ft.unstable_scheduleCallback(ft.unstable_NormalPriority,ry)))}function bg(t){function a(e){return Ra(e,t)}if(0<Br.length){Ra(Br[0],t);for(var i=1;i<Br.length;i++){var r=Br[i];r.blockedOn===t&&(r.blockedOn=null)}}for(Tn!==null&&Ra(Tn,t),bn!==null&&Ra(bn,t),En!==null&&Ra(En,t),fo.forEach(a),ho.forEach(a),i=0;i<Ea.length;i++)r=Ea[i],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ea.length&&(i=Ea[0],i.blockedOn===null);)ty(i),i.blockedOn===null&&Ea.shift()}function Yo(t,a){var i={};return i[t.toLowerCase()]=a.toLowerCase(),i["Webkit"+t]="webkit"+a,i["Moz"+t]="moz"+a,i}var Ui={animationend:Yo("Animation","AnimationEnd"),animationiteration:Yo("Animation","AnimationIteration"),animationstart:Yo("Animation","AnimationStart"),transitionend:Yo("Transition","TransitionEnd")},Fl={},Eg={};rn&&(Eg=document.createElement("div").style,"AnimationEvent"in window||(delete Ui.animationend.animation,delete Ui.animationiteration.animation,delete Ui.animationstart.animation),"TransitionEvent"in window||delete Ui.transitionend.transition);function nl(t){if(Fl[t])return Fl[t];if(!Ui[t])return t;var a=Ui[t],i;for(i in a)if(a.hasOwnProperty(i)&&i in Eg)return Fl[t]=a[i];return t}var Mg=nl("animationend"),Rg=nl("animationiteration"),Fg=nl("animationstart"),zg=nl("transitionend"),Lg=new Map,bc=new Map,ny=["abort","abort",Mg,"animationEnd",Rg,"animationIteration",Fg,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",zg,"transitionEnd","waiting","waiting"];function Ec(t,a){for(var i=0;i<t.length;i+=2){var r=t[i],e=t[i+1];e="on"+(e[0].toUpperCase()+e.slice(1)),bc.set(r,a),Lg.set(r,e),Si(e,[r])}}var iy=ft.unstable_now;iy();var Fe=8;function Ii(t){if((1&t)!==0)return Fe=15,1;if((2&t)!==0)return Fe=14,2;if((4&t)!==0)return Fe=13,4;var a=24&t;return a!==0?(Fe=12,a):(t&32)!==0?(Fe=11,32):(a=192&t,a!==0?(Fe=10,a):(t&256)!==0?(Fe=9,256):(a=3584&t,a!==0?(Fe=8,a):(t&4096)!==0?(Fe=7,4096):(a=4186112&t,a!==0?(Fe=6,a):(a=62914560&t,a!==0?(Fe=5,a):t&67108864?(Fe=4,67108864):(t&134217728)!==0?(Fe=3,134217728):(a=805306368&t,a!==0?(Fe=2,a):(1073741824&t)!==0?(Fe=1,1073741824):(Fe=8,t))))))}function ay(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function oy(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(X(358,t))}}function _o(t,a){var i=t.pendingLanes;if(i===0)return Fe=0;var r=0,e=0,n=t.expiredLanes,o=t.suspendedLanes,s=t.pingedLanes;if(n!==0)r=n,e=Fe=15;else if(n=i&134217727,n!==0){var l=n&~o;l!==0?(r=Ii(l),e=Fe):(s&=n,s!==0&&(r=Ii(s),e=Fe))}else n=i&~o,n!==0?(r=Ii(n),e=Fe):s!==0&&(r=Ii(s),e=Fe);if(r===0)return 0;if(r=31-In(r),r=i&((0>r?0:1<<r)<<1)-1,a!==0&&a!==r&&(a&o)===0){if(Ii(a),e<=Fe)return a;Fe=e}if(a=t.entangledLanes,a!==0)for(t=t.entanglements,a&=r;0<a;)i=31-In(a),e=1<<i,r|=t[i],a&=~e;return r}function Bg(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function bs(t,a){switch(t){case 15:return 1;case 14:return 2;case 12:return t=Ni(24&~a),t===0?bs(10,a):t;case 10:return t=Ni(192&~a),t===0?bs(8,a):t;case 8:return t=Ni(3584&~a),t===0&&(t=Ni(4186112&~a),t===0&&(t=512)),t;case 2:return a=Ni(805306368&~a),a===0&&(a=268435456),a}throw Error(X(358,t))}function Ni(t){return t&-t}function zl(t){for(var a=[],i=0;31>i;i++)a.push(t);return a}function il(t,a,i){t.pendingLanes|=a;var r=a-1;t.suspendedLanes&=r,t.pingedLanes&=r,t=t.eventTimes,a=31-In(a),t[a]=i}var In=Math.clz32?Math.clz32:uy,sy=Math.log,ly=Math.LN2;function uy(t){return t===0?32:31-(sy(t)/ly|0)|0}var cy=ft.unstable_UserBlockingPriority,fy=ft.unstable_runWithPriority,fs=!0;function hy(t,a,i,r){ii||Pc();var e=Mc,n=ii;ii=!0;try{xg(e,t,a,i,r)}finally{(ii=n)||Ac()}}function dy(t,a,i,r){fy(cy,Mc.bind(null,t,a,i,r))}function Mc(t,a,i,r){if(fs){var e;if((e=(a&4)===0)&&0<Br.length&&-1<Of.indexOf(t))t=wu(null,t,a,i,r),Br.push(t);else{var n=Rc(t,a,i,r);if(n===null)e&&If(t,r);else{if(e){if(-1<Of.indexOf(t)){t=wu(n,t,a,i,r),Br.push(t);return}if(ey(n,t,a,i,r))return;If(t,r)}$g(t,a,r,null,i)}}}}function Rc(t,a,i,r){var e=Sc(r);if(e=ai(e),e!==null){var n=Pi(e);if(n===null)e=null;else{var o=n.tag;if(o===13){if(e=Sg(n),e!==null)return e;e=null}else if(o===3){if(n.stateNode.hydrate)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return $g(t,a,r,e,i),null}var wn=null,Fc=null,hs=null;function Dg(){if(hs)return hs;var t,a=Fc,i=a.length,r,e="value"in wn?wn.value:wn.textContent,n=e.length;for(t=0;t<i&&a[t]===e[t];t++);var o=i-t;for(r=1;r<=o&&a[i-r]===e[n-r];r++);return hs=e.slice(t,1<r?1-r:void 0)}function ds(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function Qo(){return!0}function kf(){return!1}function Zt(t){function a(i,r,e,n,o){this._reactName=i,this._targetInst=e,this.type=r,this.nativeEvent=n,this.target=o,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(i=t[s],this[s]=i?i(n):n[s]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?Qo:kf,this.isPropagationStopped=kf,this}return Ne(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Qo)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Qo)},persist:function(){},isPersistent:Qo}),a}var ma={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zc=Zt(ma),Lo=Ne({},ma,{view:0,detail:0}),_y=Zt(Lo),Ll,Bl,Fa,al=Ne({},Lo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Fa&&(Fa&&t.type==="mousemove"?(Ll=t.screenX-Fa.screenX,Bl=t.screenY-Fa.screenY):Bl=Ll=0,Fa=t),Ll)},movementY:function(t){return"movementY"in t?t.movementY:Bl}}),Uf=Zt(al),vy=Ne({},al,{dataTransfer:0}),py=Zt(vy),gy=Ne({},Lo,{relatedTarget:0}),Dl=Zt(gy),my=Ne({},ma,{animationName:0,elapsedTime:0,pseudoElement:0}),yy=Zt(my),xy=Ne({},ma,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),wy=Zt(xy),Sy=Ne({},ma,{data:0}),Vf=Zt(Sy),Cy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Py={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ay={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ty(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=Ay[t])?!!a[t]:!1}function Lc(){return Ty}var by=Ne({},Lo,{key:function(t){if(t.key){var a=Cy[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=ds(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Py[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lc,charCode:function(t){return t.type==="keypress"?ds(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ds(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Ey=Zt(by),My=Ne({},al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gf=Zt(My),Ry=Ne({},Lo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lc}),Fy=Zt(Ry),zy=Ne({},ma,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ly=Zt(zy),By=Ne({},al,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Dy=Zt(By),Oy=[9,13,27,32],Bc=rn&&"CompositionEvent"in window,Ka=null;rn&&"documentMode"in document&&(Ka=document.documentMode);var Iy=rn&&"TextEvent"in window&&!Ka,Og=rn&&(!Bc||Ka&&8<Ka&&11>=Ka),Hf=String.fromCharCode(32),Wf=!1;function Ig(t,a){switch(t){case"keyup":return Oy.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ng(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Vi=!1;function Ny(t,a){switch(t){case"compositionend":return Ng(a);case"keypress":return a.which!==32?null:(Wf=!0,Hf);case"textInput":return t=a.data,t===Hf&&Wf?null:t;default:return null}}function ky(t,a){if(Vi)return t==="compositionend"||!Bc&&Ig(t,a)?(t=Dg(),hs=Fc=wn=null,Vi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Og&&a.locale!=="ko"?null:a.data;default:return null}}var Uy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jf(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!Uy[t.type]:a==="textarea"}function kg(t,a,i,r){mg(r),a=Es(a,"onChange"),0<a.length&&(i=new zc("onChange","change",null,i,r),t.push({event:i,listeners:a}))}var Za=null,vo=null;function Vy(t){Wg(t,0)}function ol(t){var a=Hi(t);if(fg(a))return t}function Gy(t,a){if(t==="change")return a}var Ug=!1;if(rn){var Ol;if(rn){var Il="oninput"in document;if(!Il){var Xf=document.createElement("div");Xf.setAttribute("oninput","return;"),Il=typeof Xf.oninput=="function"}Ol=Il}else Ol=!1;Ug=Ol&&(!document.documentMode||9<document.documentMode)}function $f(){Za&&(Za.detachEvent("onpropertychange",Vg),vo=Za=null)}function Vg(t){if(t.propertyName==="value"&&ol(vo)){var a=[];if(kg(a,vo,t,Sc(t)),t=Vy,ii)t(a);else{ii=!0;try{Cc(t,a)}finally{ii=!1,Ac()}}}}function Hy(t,a,i){t==="focusin"?($f(),Za=a,vo=i,Za.attachEvent("onpropertychange",Vg)):t==="focusout"&&$f()}function Wy(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ol(vo)}function jy(t,a){if(t==="click")return ol(a)}function Xy(t,a){if(t==="input"||t==="change")return ol(a)}function $y(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var rr=typeof Object.is=="function"?Object.is:$y,qy=Object.prototype.hasOwnProperty;function po(t,a){if(rr(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var i=Object.keys(t),r=Object.keys(a);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++)if(!qy.call(a,i[r])||!rr(t[i[r]],a[i[r]]))return!1;return!0}function qf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Yf(t,a){var i=qf(t);t=0;for(var r;i;){if(i.nodeType===3){if(r=t+i.textContent.length,t<=a&&r>=a)return{node:i,offset:a-t};t=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=qf(i)}}function Gg(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?Gg(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function Qf(){for(var t=window,a=Ps();a instanceof t.HTMLIFrameElement;){try{var i=typeof a.contentWindow.location.href=="string"}catch{i=!1}if(i)t=a.contentWindow;else break;a=Ps(t.document)}return a}function Su(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}var Yy=rn&&"documentMode"in document&&11>=document.documentMode,Gi=null,Cu=null,eo=null,Pu=!1;function Jf(t,a,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Pu||Gi==null||Gi!==Ps(r)||(r=Gi,"selectionStart"in r&&Su(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),eo&&po(eo,r)||(eo=r,r=Es(Cu,"onSelect"),0<r.length&&(a=new zc("onSelect","select",null,a,i),t.push({event:a,listeners:r}),a.target=Gi)))}Ec("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);Ec("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Ec(ny,2);for(var Kf="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Nl=0;Nl<Kf.length;Nl++)bc.set(Kf[Nl],0);sa("onMouseEnter",["mouseout","mouseover"]);sa("onMouseLeave",["mouseout","mouseover"]);sa("onPointerEnter",["pointerout","pointerover"]);sa("onPointerLeave",["pointerout","pointerover"]);Si("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Si("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Si("onBeforeInput",["compositionend","keypress","textInput","paste"]);Si("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Si("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Si("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ga="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hg=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ga));function Zf(t,a,i){var r=t.type||"unknown-event";t.currentTarget=i,Km(r,a,void 0,t),t.currentTarget=null}function Wg(t,a){a=(a&4)!==0;for(var i=0;i<t.length;i++){var r=t[i],e=r.event;r=r.listeners;e:{var n=void 0;if(a)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==n&&e.isPropagationStopped())break e;Zf(e,s,u),n=l}else for(o=0;o<r.length;o++){if(s=r[o],l=s.instance,u=s.currentTarget,s=s.listener,l!==n&&e.isPropagationStopped())break e;Zf(e,s,u),n=l}}}if(Ts)throw t=yu,Ts=!1,yu=null,t}function Le(t,a){var i=Yg(a),r=t+"__bubble";i.has(r)||(Xg(a,t,2,!1),i.add(r))}var eh="_reactListening"+Math.random().toString(36).slice(2);function jg(t){t[eh]||(t[eh]=!0,lg.forEach(function(a){Hg.has(a)||th(a,!1,t,null),th(a,!0,t,null)}))}function th(t,a,i,r){var e=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,n=i;if(t==="selectionchange"&&i.nodeType!==9&&(n=i.ownerDocument),r!==null&&!a&&Hg.has(t)){if(t!=="scroll")return;e|=2,n=r}var o=Yg(n),s=t+"__"+(a?"capture":"bubble");o.has(s)||(a&&(e|=4),Xg(n,t,e,a),o.add(s))}function Xg(t,a,i,r){var e=bc.get(a);switch(e===void 0?2:e){case 0:e=hy;break;case 1:e=dy;break;default:e=Mc}i=e.bind(null,a,i,t),e=void 0,!mu||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(e=!0),r?e!==void 0?t.addEventListener(a,i,{capture:!0,passive:e}):t.addEventListener(a,i,!0):e!==void 0?t.addEventListener(a,i,{passive:e}):t.addEventListener(a,i,!1)}function $g(t,a,i,r,e){var n=r;if((a&1)===0&&(a&2)===0&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var s=r.stateNode.containerInfo;if(s===e||s.nodeType===8&&s.parentNode===e)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===e||l.nodeType===8&&l.parentNode===e))return;o=o.return}for(;s!==null;){if(o=ai(s),o===null)return;if(l=o.tag,l===5||l===6){r=n=o;continue e}s=s.parentNode}}r=r.return}qm(function(){var u=n,c=Sc(i),f=[];e:{var h=Lg.get(t);if(h!==void 0){var d=zc,_=t;switch(t){case"keypress":if(ds(i)===0)break e;case"keydown":case"keyup":d=Ey;break;case"focusin":_="focus",d=Dl;break;case"focusout":_="blur",d=Dl;break;case"beforeblur":case"afterblur":d=Dl;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Uf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=py;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=Fy;break;case Mg:case Rg:case Fg:d=yy;break;case zg:d=Ly;break;case"scroll":d=_y;break;case"wheel":d=Dy;break;case"copy":case"cut":case"paste":d=wy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=Gf}var m=(a&4)!==0,p=!m&&t==="scroll",v=m?h!==null?h+"Capture":null:h;m=[];for(var g=u,y;g!==null;){y=g;var x=y.stateNode;if(y.tag===5&&x!==null&&(y=x,v!==null&&(x=co(g,v),x!=null&&m.push(go(g,x,y)))),p)break;g=g.return}0<m.length&&(h=new d(h,_,null,i,c),f.push({event:h,listeners:m}))}}if((a&7)===0){e:{if(h=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",h&&(a&16)===0&&(_=i.relatedTarget||i.fromElement)&&(ai(_)||_[ya]))break e;if((d||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,d?(_=i.relatedTarget||i.toElement,d=u,_=_?ai(_):null,_!==null&&(p=Pi(_),_!==p||_.tag!==5&&_.tag!==6)&&(_=null)):(d=null,_=u),d!==_)){if(m=Uf,x="onMouseLeave",v="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(m=Gf,x="onPointerLeave",v="onPointerEnter",g="pointer"),p=d==null?h:Hi(d),y=_==null?h:Hi(_),h=new m(x,g+"leave",d,i,c),h.target=p,h.relatedTarget=y,x=null,ai(c)===u&&(m=new m(v,g+"enter",_,i,c),m.target=y,m.relatedTarget=p,x=m),p=x,d&&_)t:{for(m=d,v=_,g=0,y=m;y;y=Li(y))g++;for(y=0,x=v;x;x=Li(x))y++;for(;0<g-y;)m=Li(m),g--;for(;0<y-g;)v=Li(v),y--;for(;g--;){if(m===v||v!==null&&m===v.alternate)break t;m=Li(m),v=Li(v)}m=null}else m=null;d!==null&&rh(f,h,d,m,!1),_!==null&&p!==null&&rh(f,p,_,m,!0)}}e:{if(h=u?Hi(u):window,d=h.nodeName&&h.nodeName.toLowerCase(),d==="select"||d==="input"&&h.type==="file")var P=Gy;else if(jf(h))if(Ug)P=Xy;else{P=Wy;var S=Hy}else(d=h.nodeName)&&d.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(P=jy);if(P&&(P=P(t,u))){kg(f,P,i,c);break e}S&&S(t,h,u),t==="focusout"&&(S=h._wrapperState)&&S.controlled&&h.type==="number"&&cu(h,"number",h.value)}switch(S=u?Hi(u):window,t){case"focusin":(jf(S)||S.contentEditable==="true")&&(Gi=S,Cu=u,eo=null);break;case"focusout":eo=Cu=Gi=null;break;case"mousedown":Pu=!0;break;case"contextmenu":case"mouseup":case"dragend":Pu=!1,Jf(f,i,c);break;case"selectionchange":if(Yy)break;case"keydown":case"keyup":Jf(f,i,c)}var w;if(Bc)e:{switch(t){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vi?Ig(t,i)&&(b="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(b="onCompositionStart");b&&(Og&&i.locale!=="ko"&&(Vi||b!=="onCompositionStart"?b==="onCompositionEnd"&&Vi&&(w=Dg()):(wn=c,Fc="value"in wn?wn.value:wn.textContent,Vi=!0)),S=Es(u,b),0<S.length&&(b=new Vf(b,t,null,i,c),f.push({event:b,listeners:S}),w?b.data=w:(w=Ng(i),w!==null&&(b.data=w)))),(w=Iy?Ny(t,i):ky(t,i))&&(u=Es(u,"onBeforeInput"),0<u.length&&(c=new Vf("onBeforeInput","beforeinput",null,i,c),f.push({event:c,listeners:u}),c.data=w))}Wg(f,a)})}function go(t,a,i){return{instance:t,listener:a,currentTarget:i}}function Es(t,a){for(var i=a+"Capture",r=[];t!==null;){var e=t,n=e.stateNode;e.tag===5&&n!==null&&(e=n,n=co(t,i),n!=null&&r.unshift(go(t,n,e)),n=co(t,a),n!=null&&r.push(go(t,n,e))),t=t.return}return r}function Li(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function rh(t,a,i,r,e){for(var n=a._reactName,o=[];i!==null&&i!==r;){var s=i,l=s.alternate,u=s.stateNode;if(l!==null&&l===r)break;s.tag===5&&u!==null&&(s=u,e?(l=co(i,n),l!=null&&o.unshift(go(i,l,s))):e||(l=co(i,n),l!=null&&o.push(go(i,l,s)))),i=i.return}o.length!==0&&t.push({event:a,listeners:o})}function Ms(){}var kl=null,Ul=null;function qg(t,a){switch(t){case"button":case"input":case"select":case"textarea":return!!a.autoFocus}return!1}function Au(t,a){return t==="textarea"||t==="option"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var nh=typeof setTimeout=="function"?setTimeout:void 0,Qy=typeof clearTimeout=="function"?clearTimeout:void 0;function Dc(t){t.nodeType===1?t.textContent="":t.nodeType===9&&(t=t.body,t!=null&&(t.textContent=""))}function Ki(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break}return t}function ih(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(a===0)return t;a--}else i==="/$"&&a++}t=t.previousSibling}return null}var Vl=0;function Jy(t){return{$$typeof:xc,toString:t,valueOf:t}}var sl=Math.random().toString(36).slice(2),Sn="__reactFiber$"+sl,Rs="__reactProps$"+sl,ya="__reactContainer$"+sl,ah="__reactEvents$"+sl;function ai(t){var a=t[Sn];if(a)return a;for(var i=t.parentNode;i;){if(a=i[ya]||i[Sn]){if(i=a.alternate,a.child!==null||i!==null&&i.child!==null)for(t=ih(t);t!==null;){if(i=t[Sn])return i;t=ih(t)}return a}t=i,i=t.parentNode}return null}function Bo(t){return t=t[Sn]||t[ya],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Hi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(X(33))}function ll(t){return t[Rs]||null}function Yg(t){var a=t[ah];return a===void 0&&(a=t[ah]=new Set),a}var Tu=[],Wi=-1;function Vn(t){return{current:t}}function De(t){0>Wi||(t.current=Tu[Wi],Tu[Wi]=null,Wi--)}function We(t,a){Wi++,Tu[Wi]=t.current,t.current=a}var Nn={},At=Vn(Nn),Ht=Vn(!1),pi=Nn;function la(t,a){var i=t.type.contextTypes;if(!i)return Nn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===a)return r.__reactInternalMemoizedMaskedChildContext;var e={},n;for(n in i)e[n]=a[n];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=a,t.__reactInternalMemoizedMaskedChildContext=e),e}function Wt(t){return t=t.childContextTypes,t!=null}function Fs(){De(Ht),De(At)}function oh(t,a,i){if(At.current!==Nn)throw Error(X(168));We(At,a),We(Ht,i)}function Qg(t,a,i){var r=t.stateNode;if(t=a.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var e in r)if(!(e in t))throw Error(X(108,qi(a)||"Unknown",e));return Ne({},i,r)}function _s(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Nn,pi=At.current,We(At,t),We(Ht,Ht.current),!0}function sh(t,a,i){var r=t.stateNode;if(!r)throw Error(X(169));i?(t=Qg(t,a,pi),r.__reactInternalMemoizedMergedChildContext=t,De(Ht),De(At),We(At,t)):De(Ht),We(Ht,i)}var Oc=null,_i=null,Ky=ft.unstable_runWithPriority,Ic=ft.unstable_scheduleCallback,bu=ft.unstable_cancelCallback,Zy=ft.unstable_shouldYield,lh=ft.unstable_requestPaint,Eu=ft.unstable_now,e1=ft.unstable_getCurrentPriorityLevel,ul=ft.unstable_ImmediatePriority,Jg=ft.unstable_UserBlockingPriority,Kg=ft.unstable_NormalPriority,Zg=ft.unstable_LowPriority,e0=ft.unstable_IdlePriority,Gl={},t1=lh!==void 0?lh:function(){},jr=null,vs=null,Hl=!1,uh=Eu(),St=1e4>uh?Eu:function(){return Eu()-uh};function ua(){switch(e1()){case ul:return 99;case Jg:return 98;case Kg:return 97;case Zg:return 96;case e0:return 95;default:throw Error(X(332))}}function t0(t){switch(t){case 99:return ul;case 98:return Jg;case 97:return Kg;case 96:return Zg;case 95:return e0;default:throw Error(X(332))}}function gi(t,a){return t=t0(t),Ky(t,a)}function mo(t,a,i){return t=t0(t),Ic(t,a,i)}function Hr(){if(vs!==null){var t=vs;vs=null,bu(t)}r0()}function r0(){if(!Hl&&jr!==null){Hl=!0;var t=0;try{var a=jr;gi(99,function(){for(;t<a.length;t++){var i=a[t];do i=i(!0);while(i!==null)}}),jr=null}catch(i){throw jr!==null&&(jr=jr.slice(t+1)),Ic(ul,Hr),i}finally{Hl=!1}}}var r1=Ci.ReactCurrentBatchConfig;function yr(t,a){if(t&&t.defaultProps){a=Ne({},a),t=t.defaultProps;for(var i in t)a[i]===void 0&&(a[i]=t[i]);return a}return a}var zs=Vn(null),Ls=null,ji=null,Bs=null;function Nc(){Bs=ji=Ls=null}function kc(t){var a=zs.current;De(zs),t.type._context._currentValue=a}function n0(t,a){for(;t!==null;){var i=t.alternate;if((t.childLanes&a)===a){if(i===null||(i.childLanes&a)===a)break;i.childLanes|=a}else t.childLanes|=a,i!==null&&(i.childLanes|=a);t=t.return}}function Zi(t,a){Ls=t,Bs=ji=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&a)!==0&&(Sr=!0),t.firstContext=null)}function sr(t,a){if(Bs!==t&&a!==!1&&a!==0)if((typeof a!="number"||a===1073741823)&&(Bs=t,a=1073741823),a={context:t,observedBits:a,next:null},ji===null){if(Ls===null)throw Error(X(308));ji=a,Ls.dependencies={lanes:0,firstContext:a,responders:null}}else ji=ji.next=a;return t._currentValue}var gn=!1;function Uc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function i0(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Mn(t,a){return{eventTime:t,lane:a,tag:0,payload:null,callback:null,next:null}}function Rn(t,a){if(t=t.updateQueue,t!==null){t=t.shared;var i=t.pending;i===null?a.next=a:(a.next=i.next,i.next=a),t.pending=a}}function ch(t,a){var i=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var e=null,n=null;if(i=i.firstBaseUpdate,i!==null){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};n===null?e=n=o:n=n.next=o,i=i.next}while(i!==null);n===null?e=n=a:n=n.next=a}else e=n=a;i={baseState:r.baseState,firstBaseUpdate:e,lastBaseUpdate:n,shared:r.shared,effects:r.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=a:t.next=a,i.lastBaseUpdate=a}function yo(t,a,i,r){var e=t.updateQueue;gn=!1;var n=e.firstBaseUpdate,o=e.lastBaseUpdate,s=e.shared.pending;if(s!==null){e.shared.pending=null;var l=s,u=l.next;l.next=null,o===null?n=u:o.next=u,o=l;var c=t.alternate;if(c!==null){c=c.updateQueue;var f=c.lastBaseUpdate;f!==o&&(f===null?c.firstBaseUpdate=u:f.next=u,c.lastBaseUpdate=l)}}if(n!==null){f=e.baseState,o=0,c=u=l=null;do{s=n.lane;var h=n.eventTime;if((r&s)===s){c!==null&&(c=c.next={eventTime:h,lane:0,tag:n.tag,payload:n.payload,callback:n.callback,next:null});e:{var d=t,_=n;switch(s=a,h=i,_.tag){case 1:if(d=_.payload,typeof d=="function"){f=d.call(h,f,s);break e}f=d;break e;case 3:d.flags=d.flags&-4097|64;case 0:if(d=_.payload,s=typeof d=="function"?d.call(h,f,s):d,s==null)break e;f=Ne({},f,s);break e;case 2:gn=!0}}n.callback!==null&&(t.flags|=32,s=e.effects,s===null?e.effects=[n]:s.push(n))}else h={eventTime:h,lane:s,tag:n.tag,payload:n.payload,callback:n.callback,next:null},c===null?(u=c=h,l=f):c=c.next=h,o|=s;if(n=n.next,n===null){if(s=e.shared.pending,s===null)break;n=s.next,s.next=null,e.lastBaseUpdate=s,e.shared.pending=null}}while(1);c===null&&(l=f),e.baseState=l,e.firstBaseUpdate=u,e.lastBaseUpdate=c,Oo|=o,t.lanes=o,t.memoizedState=f}}function fh(t,a,i){if(t=a.effects,a.effects=null,t!==null)for(a=0;a<t.length;a++){var r=t[a],e=r.callback;if(e!==null){if(r.callback=null,r=i,typeof e!="function")throw Error(X(191,e));e.call(r)}}}var a0=new el.Component().refs;function Ds(t,a,i,r){a=t.memoizedState,i=i(r,a),i=i==null?a:Ne({},a,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var cl={isMounted:function(t){return(t=t._reactInternals)?Pi(t)===t:!1},enqueueSetState:function(t,a,i){t=t._reactInternals;var r=qt(),e=Fn(t),n=Mn(r,e);n.payload=a,i!=null&&(n.callback=i),Rn(t,n),zn(t,e,r)},enqueueReplaceState:function(t,a,i){t=t._reactInternals;var r=qt(),e=Fn(t),n=Mn(r,e);n.tag=1,n.payload=a,i!=null&&(n.callback=i),Rn(t,n),zn(t,e,r)},enqueueForceUpdate:function(t,a){t=t._reactInternals;var i=qt(),r=Fn(t),e=Mn(i,r);e.tag=2,a!=null&&(e.callback=a),Rn(t,e),zn(t,r,i)}};function hh(t,a,i,r,e,n,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,n,o):a.prototype&&a.prototype.isPureReactComponent?!po(i,r)||!po(e,n):!0}function o0(t,a,i){var r=!1,e=Nn,n=a.contextType;return typeof n=="object"&&n!==null?n=sr(n):(e=Wt(a)?pi:At.current,r=a.contextTypes,n=(r=r!=null)?la(t,e):Nn),a=new a(i,n),t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=cl,t.stateNode=a,a._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),a}function dh(t,a,i,r){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(i,r),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(i,r),a.state!==t&&cl.enqueueReplaceState(a,a.state,null)}function Mu(t,a,i,r){var e=t.stateNode;e.props=i,e.state=t.memoizedState,e.refs=a0,Uc(t);var n=a.contextType;typeof n=="object"&&n!==null?e.context=sr(n):(n=Wt(a)?pi:At.current,e.context=la(t,n)),yo(t,i,e,r),e.state=t.memoizedState,n=a.getDerivedStateFromProps,typeof n=="function"&&(Ds(t,a,n,i),e.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof e.getSnapshotBeforeUpdate=="function"||typeof e.UNSAFE_componentWillMount!="function"&&typeof e.componentWillMount!="function"||(a=e.state,typeof e.componentWillMount=="function"&&e.componentWillMount(),typeof e.UNSAFE_componentWillMount=="function"&&e.UNSAFE_componentWillMount(),a!==e.state&&cl.enqueueReplaceState(e,e.state,null),yo(t,i,e,r),e.state=t.memoizedState),typeof e.componentDidMount=="function"&&(t.flags|=4)}var Jo=Array.isArray;function za(t,a,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(X(309));var r=i.stateNode}if(!r)throw Error(X(147,t));var e=""+t;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===e?a.ref:(a=function(n){var o=r.refs;o===a0&&(o=r.refs={}),n===null?delete o[e]:o[e]=n},a._stringRef=e,a)}if(typeof t!="string")throw Error(X(284));if(!i._owner)throw Error(X(290,t))}return t}function Ko(t,a){if(t.type!=="textarea")throw Error(X(31,Object.prototype.toString.call(a)==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":a))}function s0(t){function a(p,v){if(t){var g=p.lastEffect;g!==null?(g.nextEffect=v,p.lastEffect=v):p.firstEffect=p.lastEffect=v,v.nextEffect=null,v.flags=8}}function i(p,v){if(!t)return null;for(;v!==null;)a(p,v),v=v.sibling;return null}function r(p,v){for(p=new Map;v!==null;)v.key!==null?p.set(v.key,v):p.set(v.index,v),v=v.sibling;return p}function e(p,v){return p=Un(p,v),p.index=0,p.sibling=null,p}function n(p,v,g){return p.index=g,t?(g=p.alternate,g!==null?(g=g.index,g<v?(p.flags=2,v):g):(p.flags=2,v)):v}function o(p){return t&&p.alternate===null&&(p.flags=2),p}function s(p,v,g,y){return v===null||v.tag!==6?(v=ql(g,p.mode,y),v.return=p,v):(v=e(v,g),v.return=p,v)}function l(p,v,g,y){return v!==null&&v.elementType===g.type?(y=e(v,g.props),y.ref=za(p,v,g),y.return=p,y):(y=ys(g.type,g.key,g.props,null,p.mode,y),y.ref=za(p,v,g),y.return=p,y)}function u(p,v,g,y){return v===null||v.tag!==4||v.stateNode.containerInfo!==g.containerInfo||v.stateNode.implementation!==g.implementation?(v=Yl(g,p.mode,y),v.return=p,v):(v=e(v,g.children||[]),v.return=p,v)}function c(p,v,g,y,x){return v===null||v.tag!==7?(v=na(g,p.mode,y,x),v.return=p,v):(v=e(v,g),v.return=p,v)}function f(p,v,g){if(typeof v=="string"||typeof v=="number")return v=ql(""+v,p.mode,g),v.return=p,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ua:return g=ys(v.type,v.key,v.props,null,p.mode,g),g.ref=za(p,null,v),g.return=p,g;case ni:return v=Yl(v,p.mode,g),v.return=p,v}if(Jo(v)||Ta(v))return v=na(v,p.mode,g,null),v.return=p,v;Ko(p,v)}return null}function h(p,v,g,y){var x=v!==null?v.key:null;if(typeof g=="string"||typeof g=="number")return x!==null?null:s(p,v,""+g,y);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Ua:return g.key===x?g.type===yn?c(p,v,g.props.children,y,x):l(p,v,g,y):null;case ni:return g.key===x?u(p,v,g,y):null}if(Jo(g)||Ta(g))return x!==null?null:c(p,v,g,y,null);Ko(p,g)}return null}function d(p,v,g,y,x){if(typeof y=="string"||typeof y=="number")return p=p.get(g)||null,s(v,p,""+y,x);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Ua:return p=p.get(y.key===null?g:y.key)||null,y.type===yn?c(v,p,y.props.children,x,y.key):l(v,p,y,x);case ni:return p=p.get(y.key===null?g:y.key)||null,u(v,p,y,x)}if(Jo(y)||Ta(y))return p=p.get(g)||null,c(v,p,y,x,null);Ko(v,y)}return null}function _(p,v,g,y){for(var x=null,P=null,S=v,w=v=0,b=null;S!==null&&w<g.length;w++){S.index>w?(b=S,S=null):b=S.sibling;var E=h(p,S,g[w],y);if(E===null){S===null&&(S=b);break}t&&S&&E.alternate===null&&a(p,S),v=n(E,v,w),P===null?x=E:P.sibling=E,P=E,S=b}if(w===g.length)return i(p,S),x;if(S===null){for(;w<g.length;w++)S=f(p,g[w],y),S!==null&&(v=n(S,v,w),P===null?x=S:P.sibling=S,P=S);return x}for(S=r(p,S);w<g.length;w++)b=d(S,p,w,g[w],y),b!==null&&(t&&b.alternate!==null&&S.delete(b.key===null?w:b.key),v=n(b,v,w),P===null?x=b:P.sibling=b,P=b);return t&&S.forEach(function(M){return a(p,M)}),x}function m(p,v,g,y){var x=Ta(g);if(typeof x!="function")throw Error(X(150));if(g=x.call(g),g==null)throw Error(X(151));for(var P=x=null,S=v,w=v=0,b=null,E=g.next();S!==null&&!E.done;w++,E=g.next()){S.index>w?(b=S,S=null):b=S.sibling;var M=h(p,S,E.value,y);if(M===null){S===null&&(S=b);break}t&&S&&M.alternate===null&&a(p,S),v=n(M,v,w),P===null?x=M:P.sibling=M,P=M,S=b}if(E.done)return i(p,S),x;if(S===null){for(;!E.done;w++,E=g.next())E=f(p,E.value,y),E!==null&&(v=n(E,v,w),P===null?x=E:P.sibling=E,P=E);return x}for(S=r(p,S);!E.done;w++,E=g.next())E=d(S,p,w,E.value,y),E!==null&&(t&&E.alternate!==null&&S.delete(E.key===null?w:E.key),v=n(E,v,w),P===null?x=E:P.sibling=E,P=E);return t&&S.forEach(function(F){return a(p,F)}),x}return function(p,v,g,y){var x=typeof g=="object"&&g!==null&&g.type===yn&&g.key===null;x&&(g=g.props.children);var P=typeof g=="object"&&g!==null;if(P)switch(g.$$typeof){case Ua:e:{for(P=g.key,x=v;x!==null;){if(x.key===P){switch(x.tag){case 7:if(g.type===yn){i(p,x.sibling),v=e(x,g.props.children),v.return=p,p=v;break e}break;default:if(x.elementType===g.type){i(p,x.sibling),v=e(x,g.props),v.ref=za(p,x,g),v.return=p,p=v;break e}}i(p,x);break}else a(p,x);x=x.sibling}g.type===yn?(v=na(g.props.children,p.mode,y,g.key),v.return=p,p=v):(y=ys(g.type,g.key,g.props,null,p.mode,y),y.ref=za(p,v,g),y.return=p,p=y)}return o(p);case ni:e:{for(x=g.key;v!==null;){if(v.key===x)if(v.tag===4&&v.stateNode.containerInfo===g.containerInfo&&v.stateNode.implementation===g.implementation){i(p,v.sibling),v=e(v,g.children||[]),v.return=p,p=v;break e}else{i(p,v);break}else a(p,v);v=v.sibling}v=Yl(g,p.mode,y),v.return=p,p=v}return o(p)}if(typeof g=="string"||typeof g=="number")return g=""+g,v!==null&&v.tag===6?(i(p,v.sibling),v=e(v,g),v.return=p,p=v):(i(p,v),v=ql(g,p.mode,y),v.return=p,p=v),o(p);if(Jo(g))return _(p,v,g,y);if(Ta(g))return m(p,v,g,y);if(P&&Ko(p,g),typeof g=="undefined"&&!x)switch(p.tag){case 1:case 22:case 0:case 11:case 15:throw Error(X(152,qi(p.type)||"Component"))}return i(p,v)}}var Os=s0(!0),l0=s0(!1),Do={},Nr=Vn(Do),xo=Vn(Do),wo=Vn(Do);function oi(t){if(t===Do)throw Error(X(174));return t}function Ru(t,a){switch(We(wo,a),We(xo,t),We(Nr,Do),t=a.nodeType,t){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:_u(null,"");break;default:t=t===8?a.parentNode:a,a=t.namespaceURI||null,t=t.tagName,a=_u(a,t)}De(Nr),We(Nr,a)}function ca(){De(Nr),De(xo),De(wo)}function _h(t){oi(wo.current);var a=oi(Nr.current),i=_u(a,t.type);a!==i&&(We(xo,t),We(Nr,i))}function Vc(t){xo.current===t&&(De(Nr),De(xo))}var Ge=Vn(0);function Is(t){for(var a=t;a!==null;){if(a.tag===13){var i=a.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&64)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var qr=null,Cn=null,kr=!1;function u0(t,a){var i=nr(5,null,null,0);i.elementType="DELETED",i.type="DELETED",i.stateNode=a,i.return=t,i.flags=8,t.lastEffect!==null?(t.lastEffect.nextEffect=i,t.lastEffect=i):t.firstEffect=t.lastEffect=i}function vh(t,a){switch(t.tag){case 5:var i=t.type;return a=a.nodeType!==1||i.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(t.stateNode=a,!0):!1;case 6:return a=t.pendingProps===""||a.nodeType!==3?null:a,a!==null?(t.stateNode=a,!0):!1;case 13:return!1;default:return!1}}function Fu(t){if(kr){var a=Cn;if(a){var i=a;if(!vh(t,a)){if(a=Ki(i.nextSibling),!a||!vh(t,a)){t.flags=t.flags&-1025|2,kr=!1,qr=t;return}u0(qr,i)}qr=t,Cn=Ki(a.firstChild)}else t.flags=t.flags&-1025|2,kr=!1,qr=t}}function ph(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;qr=t}function Zo(t){if(t!==qr)return!1;if(!kr)return ph(t),kr=!0,!1;var a=t.type;if(t.tag!==5||a!=="head"&&a!=="body"&&!Au(a,t.memoizedProps))for(a=Cn;a;)u0(t,a),a=Ki(a.nextSibling);if(ph(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(X(317));e:{for(t=t.nextSibling,a=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(a===0){Cn=Ki(t.nextSibling);break e}a--}else i!=="$"&&i!=="$!"&&i!=="$?"||a++}t=t.nextSibling}Cn=null}}else Cn=qr?Ki(t.stateNode.nextSibling):null;return!0}function Wl(){Cn=qr=null,kr=!1}var ea=[];function Gc(){for(var t=0;t<ea.length;t++)ea[t]._workInProgressVersionPrimary=null;ea.length=0}var to=Ci.ReactCurrentDispatcher,ir=Ci.ReactCurrentBatchConfig,So=0,Qe=null,wt=null,dt=null,Ns=!1,ro=!1;function It(){throw Error(X(321))}function Hc(t,a){if(a===null)return!1;for(var i=0;i<a.length&&i<t.length;i++)if(!rr(t[i],a[i]))return!1;return!0}function Wc(t,a,i,r,e,n){if(So=n,Qe=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,to.current=t===null||t.memoizedState===null?i1:a1,t=i(r,e),ro){n=0;do{if(ro=!1,!(25>n))throw Error(X(301));n+=1,dt=wt=null,a.updateQueue=null,to.current=o1,t=i(r,e)}while(ro)}if(to.current=Gs,a=wt!==null&&wt.next!==null,So=0,dt=wt=Qe=null,Ns=!1,a)throw Error(X(300));return t}function si(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return dt===null?Qe.memoizedState=dt=t:dt=dt.next=t,dt}function Ai(){if(wt===null){var t=Qe.alternate;t=t!==null?t.memoizedState:null}else t=wt.next;var a=dt===null?Qe.memoizedState:dt.next;if(a!==null)dt=a,wt=t;else{if(t===null)throw Error(X(310));wt=t,t={memoizedState:wt.memoizedState,baseState:wt.baseState,baseQueue:wt.baseQueue,queue:wt.queue,next:null},dt===null?Qe.memoizedState=dt=t:dt=dt.next=t}return dt}function Dr(t,a){return typeof a=="function"?a(t):a}function La(t){var a=Ai(),i=a.queue;if(i===null)throw Error(X(311));i.lastRenderedReducer=t;var r=wt,e=r.baseQueue,n=i.pending;if(n!==null){if(e!==null){var o=e.next;e.next=n.next,n.next=o}r.baseQueue=e=n,i.pending=null}if(e!==null){e=e.next,r=r.baseState;var s=o=n=null,l=e;do{var u=l.lane;if((So&u)===u)s!==null&&(s=s.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),r=l.eagerReducer===t?l.eagerState:t(r,l.action);else{var c={lane:u,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};s===null?(o=s=c,n=r):s=s.next=c,Qe.lanes|=u,Oo|=u}l=l.next}while(l!==null&&l!==e);s===null?n=r:s.next=o,rr(r,a.memoizedState)||(Sr=!0),a.memoizedState=r,a.baseState=n,a.baseQueue=s,i.lastRenderedState=r}return[a.memoizedState,i.dispatch]}function Ba(t){var a=Ai(),i=a.queue;if(i===null)throw Error(X(311));i.lastRenderedReducer=t;var r=i.dispatch,e=i.pending,n=a.memoizedState;if(e!==null){i.pending=null;var o=e=e.next;do n=t(n,o.action),o=o.next;while(o!==e);rr(n,a.memoizedState)||(Sr=!0),a.memoizedState=n,a.baseQueue===null&&(a.baseState=n),i.lastRenderedState=n}return[n,r]}function gh(t,a,i){var r=a._getVersion;r=r(a._source);var e=a._workInProgressVersionPrimary;if(e!==null?t=e===r:(t=t.mutableReadLanes,(t=(So&t)===t)&&(a._workInProgressVersionPrimary=r,ea.push(a))),t)return i(a._source);throw ea.push(a),Error(X(350))}function c0(t,a,i,r){var e=Dt;if(e===null)throw Error(X(349));var n=a._getVersion,o=n(a._source),s=to.current,l=s.useState(function(){return gh(e,a,i)}),u=l[1],c=l[0];l=dt;var f=t.memoizedState,h=f.refs,d=h.getSnapshot,_=f.source;f=f.subscribe;var m=Qe;return t.memoizedState={refs:h,source:a,subscribe:r},s.useEffect(function(){h.getSnapshot=i,h.setSnapshot=u;var p=n(a._source);if(!rr(o,p)){p=i(a._source),rr(c,p)||(u(p),p=Fn(m),e.mutableReadLanes|=p&e.pendingLanes),p=e.mutableReadLanes,e.entangledLanes|=p;for(var v=e.entanglements,g=p;0<g;){var y=31-In(g),x=1<<y;v[y]|=p,g&=~x}}},[i,a,r]),s.useEffect(function(){return r(a._source,function(){var p=h.getSnapshot,v=h.setSnapshot;try{v(p(a._source));var g=Fn(m);e.mutableReadLanes|=g&e.pendingLanes}catch(y){v(function(){throw y})}})},[a,r]),rr(d,i)&&rr(_,a)&&rr(f,r)||(t={pending:null,dispatch:null,lastRenderedReducer:Dr,lastRenderedState:c},t.dispatch=u=$c.bind(null,Qe,t),l.queue=t,l.baseQueue=null,c=gh(e,a,i),l.memoizedState=l.baseState=c),c}function f0(t,a,i){var r=Ai();return c0(r,t,a,i)}function Da(t){var a=si();return typeof t=="function"&&(t=t()),a.memoizedState=a.baseState=t,t=a.queue={pending:null,dispatch:null,lastRenderedReducer:Dr,lastRenderedState:t},t=t.dispatch=$c.bind(null,Qe,t),[a.memoizedState,t]}function ks(t,a,i,r){return t={tag:t,create:a,destroy:i,deps:r,next:null},a=Qe.updateQueue,a===null?(a={lastEffect:null},Qe.updateQueue=a,a.lastEffect=t.next=t):(i=a.lastEffect,i===null?a.lastEffect=t.next=t:(r=i.next,i.next=t,t.next=r,a.lastEffect=t)),t}function mh(t){var a=si();return t={current:t},a.memoizedState=t}function Us(){return Ai().memoizedState}function zu(t,a,i,r){var e=si();Qe.flags|=t,e.memoizedState=ks(1|a,i,void 0,r===void 0?null:r)}function jc(t,a,i,r){var e=Ai();r=r===void 0?null:r;var n=void 0;if(wt!==null){var o=wt.memoizedState;if(n=o.destroy,r!==null&&Hc(r,o.deps)){ks(a,i,n,r);return}}Qe.flags|=t,e.memoizedState=ks(1|a,i,n,r)}function yh(t,a){return zu(516,4,t,a)}function Vs(t,a){return jc(516,4,t,a)}function h0(t,a){return jc(4,2,t,a)}function d0(t,a){if(typeof a=="function")return t=t(),a(t),function(){a(null)};if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function _0(t,a,i){return i=i!=null?i.concat([t]):null,jc(4,2,d0.bind(null,a,t),i)}function Xc(){}function v0(t,a){var i=Ai();a=a===void 0?null:a;var r=i.memoizedState;return r!==null&&a!==null&&Hc(a,r[1])?r[0]:(i.memoizedState=[t,a],t)}function p0(t,a){var i=Ai();a=a===void 0?null:a;var r=i.memoizedState;return r!==null&&a!==null&&Hc(a,r[1])?r[0]:(t=t(),i.memoizedState=[t,a],t)}function n1(t,a){var i=ua();gi(98>i?98:i,function(){t(!0)}),gi(97<i?97:i,function(){var r=ir.transition;ir.transition=1;try{t(!1),a()}finally{ir.transition=r}})}function $c(t,a,i){var r=qt(),e=Fn(t),n={lane:e,action:i,eagerReducer:null,eagerState:null,next:null},o=a.pending;if(o===null?n.next=n:(n.next=o.next,o.next=n),a.pending=n,o=t.alternate,t===Qe||o!==null&&o===Qe)ro=Ns=!0;else{if(t.lanes===0&&(o===null||o.lanes===0)&&(o=a.lastRenderedReducer,o!==null))try{var s=a.lastRenderedState,l=o(s,i);if(n.eagerReducer=o,n.eagerState=l,rr(l,s))return}catch{}finally{}zn(t,e,r)}}var Gs={readContext:sr,useCallback:It,useContext:It,useEffect:It,useImperativeHandle:It,useLayoutEffect:It,useMemo:It,useReducer:It,useRef:It,useState:It,useDebugValue:It,useDeferredValue:It,useTransition:It,useMutableSource:It,useOpaqueIdentifier:It,unstable_isNewReconciler:!1},i1={readContext:sr,useCallback:function(t,a){return si().memoizedState=[t,a===void 0?null:a],t},useContext:sr,useEffect:yh,useImperativeHandle:function(t,a,i){return i=i!=null?i.concat([t]):null,zu(4,2,d0.bind(null,a,t),i)},useLayoutEffect:function(t,a){return zu(4,2,t,a)},useMemo:function(t,a){var i=si();return a=a===void 0?null:a,t=t(),i.memoizedState=[t,a],t},useReducer:function(t,a,i){var r=si();return a=i!==void 0?i(a):a,r.memoizedState=r.baseState=a,t=r.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:a},t=t.dispatch=$c.bind(null,Qe,t),[r.memoizedState,t]},useRef:mh,useState:Da,useDebugValue:Xc,useDeferredValue:function(t){var a=Da(t),i=a[0],r=a[1];return yh(function(){var e=ir.transition;ir.transition=1;try{r(t)}finally{ir.transition=e}},[t]),i},useTransition:function(){var t=Da(!1),a=t[0];return t=n1.bind(null,t[1]),mh(t),[t,a]},useMutableSource:function(t,a,i){var r=si();return r.memoizedState={refs:{getSnapshot:a,setSnapshot:null},source:t,subscribe:i},c0(r,t,a,i)},useOpaqueIdentifier:function(){if(kr){var t=!1,a=Jy(function(){throw t||(t=!0,i("r:"+(Vl++).toString(36))),Error(X(355))}),i=Da(a)[1];return(Qe.mode&2)===0&&(Qe.flags|=516,ks(5,function(){i("r:"+(Vl++).toString(36))},void 0,null)),a}return a="r:"+(Vl++).toString(36),Da(a),a},unstable_isNewReconciler:!1},a1={readContext:sr,useCallback:v0,useContext:sr,useEffect:Vs,useImperativeHandle:_0,useLayoutEffect:h0,useMemo:p0,useReducer:La,useRef:Us,useState:function(){return La(Dr)},useDebugValue:Xc,useDeferredValue:function(t){var a=La(Dr),i=a[0],r=a[1];return Vs(function(){var e=ir.transition;ir.transition=1;try{r(t)}finally{ir.transition=e}},[t]),i},useTransition:function(){var t=La(Dr)[0];return[Us().current,t]},useMutableSource:f0,useOpaqueIdentifier:function(){return La(Dr)[0]},unstable_isNewReconciler:!1},o1={readContext:sr,useCallback:v0,useContext:sr,useEffect:Vs,useImperativeHandle:_0,useLayoutEffect:h0,useMemo:p0,useReducer:Ba,useRef:Us,useState:function(){return Ba(Dr)},useDebugValue:Xc,useDeferredValue:function(t){var a=Ba(Dr),i=a[0],r=a[1];return Vs(function(){var e=ir.transition;ir.transition=1;try{r(t)}finally{ir.transition=e}},[t]),i},useTransition:function(){var t=Ba(Dr)[0];return[Us().current,t]},useMutableSource:f0,useOpaqueIdentifier:function(){return Ba(Dr)[0]},unstable_isNewReconciler:!1},s1=Ci.ReactCurrentOwner,Sr=!1;function kt(t,a,i,r){a.child=t===null?l0(a,null,i,r):Os(a,t.child,i,r)}function xh(t,a,i,r,e){i=i.render;var n=a.ref;return Zi(a,e),r=Wc(t,a,i,r,n,e),t!==null&&!Sr?(a.updateQueue=t.updateQueue,a.flags&=-517,t.lanes&=~e,Yr(t,a,e)):(a.flags|=1,kt(t,a,r,e),a.child)}function wh(t,a,i,r,e,n){if(t===null){var o=i.type;return typeof o=="function"&&!Zc(o)&&o.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(a.tag=15,a.type=o,g0(t,a,o,r,e,n)):(t=ys(i.type,null,r,a,a.mode,n),t.ref=a.ref,t.return=a,a.child=t)}return o=t.child,(e&n)===0&&(e=o.memoizedProps,i=i.compare,i=i!==null?i:po,i(e,r)&&t.ref===a.ref)?Yr(t,a,n):(a.flags|=1,t=Un(o,r),t.ref=a.ref,t.return=a,a.child=t)}function g0(t,a,i,r,e,n){if(t!==null&&po(t.memoizedProps,r)&&t.ref===a.ref)if(Sr=!1,(n&e)!==0)(t.flags&16384)!==0&&(Sr=!0);else return a.lanes=t.lanes,Yr(t,a,n);return Lu(t,a,i,r,n)}function jl(t,a,i){var r=a.pendingProps,e=r.children,n=t!==null?t.memoizedState:null;if(r.mode==="hidden"||r.mode==="unstable-defer-without-hiding")if((a.mode&4)===0)a.memoizedState={baseLanes:0},ts(a,i);else if((i&1073741824)!==0)a.memoizedState={baseLanes:0},ts(a,n!==null?n.baseLanes:i);else return t=n!==null?n.baseLanes|i:i,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:t},ts(a,t),null;else n!==null?(r=n.baseLanes|i,a.memoizedState=null):r=i,ts(a,r);return kt(t,a,e,i),a.child}function m0(t,a){var i=a.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(a.flags|=128)}function Lu(t,a,i,r,e){var n=Wt(i)?pi:At.current;return n=la(a,n),Zi(a,e),i=Wc(t,a,i,r,n,e),t!==null&&!Sr?(a.updateQueue=t.updateQueue,a.flags&=-517,t.lanes&=~e,Yr(t,a,e)):(a.flags|=1,kt(t,a,i,e),a.child)}function Sh(t,a,i,r,e){if(Wt(i)){var n=!0;_s(a)}else n=!1;if(Zi(a,e),a.stateNode===null)t!==null&&(t.alternate=null,a.alternate=null,a.flags|=2),o0(a,i,r),Mu(a,i,r,e),r=!0;else if(t===null){var o=a.stateNode,s=a.memoizedProps;o.props=s;var l=o.context,u=i.contextType;typeof u=="object"&&u!==null?u=sr(u):(u=Wt(i)?pi:At.current,u=la(a,u));var c=i.getDerivedStateFromProps,f=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==r||l!==u)&&dh(a,o,r,u),gn=!1;var h=a.memoizedState;o.state=h,yo(a,r,o,e),l=a.memoizedState,s!==r||h!==l||Ht.current||gn?(typeof c=="function"&&(Ds(a,i,c,r),l=a.memoizedState),(s=gn||hh(a,i,s,r,h,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(a.flags|=4)):(typeof o.componentDidMount=="function"&&(a.flags|=4),a.memoizedProps=r,a.memoizedState=l),o.props=r,o.state=l,o.context=u,r=s):(typeof o.componentDidMount=="function"&&(a.flags|=4),r=!1)}else{o=a.stateNode,i0(t,a),s=a.memoizedProps,u=a.type===a.elementType?s:yr(a.type,s),o.props=u,f=a.pendingProps,h=o.context,l=i.contextType,typeof l=="object"&&l!==null?l=sr(l):(l=Wt(i)?pi:At.current,l=la(a,l));var d=i.getDerivedStateFromProps;(c=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==f||h!==l)&&dh(a,o,r,l),gn=!1,h=a.memoizedState,o.state=h,yo(a,r,o,e);var _=a.memoizedState;s!==f||h!==_||Ht.current||gn?(typeof d=="function"&&(Ds(a,i,d,r),_=a.memoizedState),(u=gn||hh(a,i,u,r,h,_,l))?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,_,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,_,l)),typeof o.componentDidUpdate=="function"&&(a.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(a.flags|=256)):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(a.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(a.flags|=256),a.memoizedProps=r,a.memoizedState=_),o.props=r,o.state=_,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(a.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(a.flags|=256),r=!1)}return Bu(t,a,i,r,n,e)}function Bu(t,a,i,r,e,n){m0(t,a);var o=(a.flags&64)!==0;if(!r&&!o)return e&&sh(a,i,!1),Yr(t,a,n);r=a.stateNode,s1.current=a;var s=o&&typeof i.getDerivedStateFromError!="function"?null:r.render();return a.flags|=1,t!==null&&o?(a.child=Os(a,t.child,null,n),a.child=Os(a,null,s,n)):kt(t,a,s,n),a.memoizedState=r.state,e&&sh(a,i,!0),a.child}function Ch(t){var a=t.stateNode;a.pendingContext?oh(t,a.pendingContext,a.pendingContext!==a.context):a.context&&oh(t,a.context,!1),Ru(t,a.containerInfo)}var es={dehydrated:null,retryLane:0};function Ph(t,a,i){var r=a.pendingProps,e=Ge.current,n=!1,o;return(o=(a.flags&64)!==0)||(o=t!==null&&t.memoizedState===null?!1:(e&2)!==0),o?(n=!0,a.flags&=-65):t!==null&&t.memoizedState===null||r.fallback===void 0||r.unstable_avoidThisFallback===!0||(e|=1),We(Ge,e&1),t===null?(r.fallback!==void 0&&Fu(a),t=r.children,e=r.fallback,n?(t=Ah(a,t,e,i),a.child.memoizedState={baseLanes:i},a.memoizedState=es,t):typeof r.unstable_expectedLoadTime=="number"?(t=Ah(a,t,e,i),a.child.memoizedState={baseLanes:i},a.memoizedState=es,a.lanes=33554432,t):(i=ef({mode:"visible",children:t},a.mode,i,null),i.return=a,a.child=i)):t.memoizedState!==null?n?(r=bh(t,a,r.children,r.fallback,i),n=a.child,e=t.child.memoizedState,n.memoizedState=e===null?{baseLanes:i}:{baseLanes:e.baseLanes|i},n.childLanes=t.childLanes&~i,a.memoizedState=es,r):(i=Th(t,a,r.children,i),a.memoizedState=null,i):n?(r=bh(t,a,r.children,r.fallback,i),n=a.child,e=t.child.memoizedState,n.memoizedState=e===null?{baseLanes:i}:{baseLanes:e.baseLanes|i},n.childLanes=t.childLanes&~i,a.memoizedState=es,r):(i=Th(t,a,r.children,i),a.memoizedState=null,i)}function Ah(t,a,i,r){var e=t.mode,n=t.child;return a={mode:"hidden",children:a},(e&2)===0&&n!==null?(n.childLanes=0,n.pendingProps=a):n=ef(a,e,0,null),i=na(i,e,r,null),n.return=t,i.return=t,n.sibling=i,t.child=n,i}function Th(t,a,i,r){var e=t.child;return t=e.sibling,i=Un(e,{mode:"visible",children:i}),(a.mode&2)===0&&(i.lanes=r),i.return=a,i.sibling=null,t!==null&&(t.nextEffect=null,t.flags=8,a.firstEffect=a.lastEffect=t),a.child=i}function bh(t,a,i,r,e){var n=a.mode,o=t.child;t=o.sibling;var s={mode:"hidden",children:i};return(n&2)===0&&a.child!==o?(i=a.child,i.childLanes=0,i.pendingProps=s,o=i.lastEffect,o!==null?(a.firstEffect=i.firstEffect,a.lastEffect=o,o.nextEffect=null):a.firstEffect=a.lastEffect=null):i=Un(o,s),t!==null?r=Un(t,r):(r=na(r,n,e,null),r.flags|=2),r.return=a,i.return=a,i.sibling=r,a.child=i,r}function Eh(t,a){t.lanes|=a;var i=t.alternate;i!==null&&(i.lanes|=a),n0(t.return,a)}function Xl(t,a,i,r,e,n){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:e,lastEffect:n}:(o.isBackwards=a,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=i,o.tailMode=e,o.lastEffect=n)}function Mh(t,a,i){var r=a.pendingProps,e=r.revealOrder,n=r.tail;if(kt(t,a,r.children,i),r=Ge.current,(r&2)!==0)r=r&1|2,a.flags|=64;else{if(t!==null&&(t.flags&64)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Eh(t,i);else if(t.tag===19)Eh(t,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(We(Ge,r),(a.mode&2)===0)a.memoizedState=null;else switch(e){case"forwards":for(i=a.child,e=null;i!==null;)t=i.alternate,t!==null&&Is(t)===null&&(e=i),i=i.sibling;i=e,i===null?(e=a.child,a.child=null):(e=i.sibling,i.sibling=null),Xl(a,!1,e,i,n,a.lastEffect);break;case"backwards":for(i=null,e=a.child,a.child=null;e!==null;){if(t=e.alternate,t!==null&&Is(t)===null){a.child=e;break}t=e.sibling,e.sibling=i,i=e,e=t}Xl(a,!0,i,null,n,a.lastEffect);break;case"together":Xl(a,!1,null,null,void 0,a.lastEffect);break;default:a.memoizedState=null}return a.child}function Yr(t,a,i){if(t!==null&&(a.dependencies=t.dependencies),Oo|=a.lanes,(i&a.childLanes)!==0){if(t!==null&&a.child!==t.child)throw Error(X(153));if(a.child!==null){for(t=a.child,i=Un(t,t.pendingProps),a.child=i,i.return=a;t.sibling!==null;)t=t.sibling,i=i.sibling=Un(t,t.pendingProps),i.return=a;i.sibling=null}return a.child}return null}var y0,Du,x0,w0;y0=function(t,a){for(var i=a.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break;for(;i.sibling===null;){if(i.return===null||i.return===a)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};Du=function(){};x0=function(t,a,i,r){var e=t.memoizedProps;if(e!==r){t=a.stateNode,oi(Nr.current);var n=null;switch(i){case"input":e=lu(t,e),r=lu(t,r),n=[];break;case"option":e=fu(t,e),r=fu(t,r),n=[];break;case"select":e=Ne({},e,{value:void 0}),r=Ne({},r,{value:void 0}),n=[];break;case"textarea":e=hu(t,e),r=hu(t,r),n=[];break;default:typeof e.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ms)}vu(i,r);var o;i=null;for(u in e)if(!r.hasOwnProperty(u)&&e.hasOwnProperty(u)&&e[u]!=null)if(u==="style"){var s=e[u];for(o in s)s.hasOwnProperty(o)&&(i||(i={}),i[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(lo.hasOwnProperty(u)?n||(n=[]):(n=n||[]).push(u,null));for(u in r){var l=r[u];if(s=e!=null?e[u]:void 0,r.hasOwnProperty(u)&&l!==s&&(l!=null||s!=null))if(u==="style")if(s){for(o in s)!s.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(i||(i={}),i[o]="");for(o in l)l.hasOwnProperty(o)&&s[o]!==l[o]&&(i||(i={}),i[o]=l[o])}else i||(n||(n=[]),n.push(u,i)),i=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(n=n||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(lo.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Le("scroll",t),n||s===l||(n=[])):typeof l=="object"&&l!==null&&l.$$typeof===xc?l.toString():(n=n||[]).push(u,l))}i&&(n=n||[]).push("style",i);var u=n;(a.updateQueue=u)&&(a.flags|=4)}};w0=function(t,a,i,r){i!==r&&(a.flags|=4)};function Oa(t,a){if(!kr)switch(t.tailMode){case"hidden":a=t.tail;for(var i=null;a!==null;)a.alternate!==null&&(i=a),a=a.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function l1(t,a,i){var r=a.pendingProps;switch(a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Wt(a.type)&&Fs(),null;case 3:return ca(),De(Ht),De(At),Gc(),r=a.stateNode,r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Zo(a)?a.flags|=4:r.hydrate||(a.flags|=256)),Du(a),null;case 5:Vc(a);var e=oi(wo.current);if(i=a.type,t!==null&&a.stateNode!=null)x0(t,a,i,r,e),t.ref!==a.ref&&(a.flags|=128);else{if(!r){if(a.stateNode===null)throw Error(X(166));return null}if(t=oi(Nr.current),Zo(a)){r=a.stateNode,i=a.type;var n=a.memoizedProps;switch(r[Sn]=a,r[Rs]=n,i){case"dialog":Le("cancel",r),Le("close",r);break;case"iframe":case"object":case"embed":Le("load",r);break;case"video":case"audio":for(t=0;t<Ga.length;t++)Le(Ga[t],r);break;case"source":Le("error",r);break;case"img":case"image":case"link":Le("error",r),Le("load",r);break;case"details":Le("toggle",r);break;case"input":Mf(r,n),Le("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!n.multiple},Le("invalid",r);break;case"textarea":Ff(r,n),Le("invalid",r)}vu(i,n),t=null;for(var o in n)n.hasOwnProperty(o)&&(e=n[o],o==="children"?typeof e=="string"?r.textContent!==e&&(t=["children",e]):typeof e=="number"&&r.textContent!==""+e&&(t=["children",""+e]):lo.hasOwnProperty(o)&&e!=null&&o==="onScroll"&&Le("scroll",r));switch(i){case"input":$o(r),Rf(r,n,!0);break;case"textarea":$o(r),zf(r);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(r.onclick=Ms)}r=t,a.updateQueue=r,r!==null&&(a.flags|=4)}else{switch(o=e.nodeType===9?e:e.ownerDocument,t===du.html&&(t=_g(i)),t===du.html?i==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(i,{is:r.is}):(t=o.createElement(i),i==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,i),t[Sn]=a,t[Rs]=r,y0(t,a,!1,!1),a.stateNode=t,o=pu(i,r),i){case"dialog":Le("cancel",t),Le("close",t),e=r;break;case"iframe":case"object":case"embed":Le("load",t),e=r;break;case"video":case"audio":for(e=0;e<Ga.length;e++)Le(Ga[e],t);e=r;break;case"source":Le("error",t),e=r;break;case"img":case"image":case"link":Le("error",t),Le("load",t),e=r;break;case"details":Le("toggle",t),e=r;break;case"input":Mf(t,r),e=lu(t,r),Le("invalid",t);break;case"option":e=fu(t,r);break;case"select":t._wrapperState={wasMultiple:!!r.multiple},e=Ne({},r,{value:void 0}),Le("invalid",t);break;case"textarea":Ff(t,r),e=hu(t,r),Le("invalid",t);break;default:e=r}vu(i,e);var s=e;for(n in s)if(s.hasOwnProperty(n)){var l=s[n];n==="style"?gg(t,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&vg(t,l)):n==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&uo(t,l):typeof l=="number"&&uo(t,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(lo.hasOwnProperty(n)?l!=null&&n==="onScroll"&&Le("scroll",t):l!=null&&_c(t,n,l,o))}switch(i){case"input":$o(t),Rf(t,r,!1);break;case"textarea":$o(t),zf(t);break;case"option":r.value!=null&&t.setAttribute("value",""+On(r.value));break;case"select":t.multiple=!!r.multiple,n=r.value,n!=null?Yi(t,!!r.multiple,n,!1):r.defaultValue!=null&&Yi(t,!!r.multiple,r.defaultValue,!0);break;default:typeof e.onClick=="function"&&(t.onclick=Ms)}qg(i,r)&&(a.flags|=4)}a.ref!==null&&(a.flags|=128)}return null;case 6:if(t&&a.stateNode!=null)w0(t,a,t.memoizedProps,r);else{if(typeof r!="string"&&a.stateNode===null)throw Error(X(166));i=oi(wo.current),oi(Nr.current),Zo(a)?(r=a.stateNode,i=a.memoizedProps,r[Sn]=a,r.nodeValue!==i&&(a.flags|=4)):(r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[Sn]=a,a.stateNode=r)}return null;case 13:return De(Ge),r=a.memoizedState,(a.flags&64)!==0?(a.lanes=i,a):(r=r!==null,i=!1,t===null?a.memoizedProps.fallback!==void 0&&Zo(a):i=t.memoizedState!==null,r&&!i&&(a.mode&2)!==0&&(t===null&&a.memoizedProps.unstable_avoidThisFallback!==!0||(Ge.current&1)!==0?vt===0&&(vt=3):((vt===0||vt===3)&&(vt=4),Dt===null||(Oo&134217727)===0&&(wa&134217727)===0||ta(Dt,Ct))),(r||i)&&(a.flags|=4),null);case 4:return ca(),Du(a),t===null&&jg(a.stateNode.containerInfo),null;case 10:return kc(a),null;case 17:return Wt(a.type)&&Fs(),null;case 19:if(De(Ge),r=a.memoizedState,r===null)return null;if(n=(a.flags&64)!==0,o=r.rendering,o===null)if(n)Oa(r,!1);else{if(vt!==0||t!==null&&(t.flags&64)!==0)for(t=a.child;t!==null;){if(o=Is(t),o!==null){for(a.flags|=64,Oa(r,!1),n=o.updateQueue,n!==null&&(a.updateQueue=n,a.flags|=4),r.lastEffect===null&&(a.firstEffect=null),a.lastEffect=r.lastEffect,r=i,i=a.child;i!==null;)n=i,t=r,n.flags&=2,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null,o=n.alternate,o===null?(n.childLanes=0,n.lanes=t,n.child=null,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,t=o.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return We(Ge,Ge.current&1|2),a.child}t=t.sibling}r.tail!==null&&St()>Vu&&(a.flags|=64,n=!0,Oa(r,!1),a.lanes=33554432)}else{if(!n)if(t=Is(o),t!==null){if(a.flags|=64,n=!0,i=t.updateQueue,i!==null&&(a.updateQueue=i,a.flags|=4),Oa(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!kr)return a=a.lastEffect=r.lastEffect,a!==null&&(a.nextEffect=null),null}else 2*St()-r.renderingStartTime>Vu&&i!==1073741824&&(a.flags|=64,n=!0,Oa(r,!1),a.lanes=33554432);r.isBackwards?(o.sibling=a.child,a.child=o):(i=r.last,i!==null?i.sibling=o:a.child=o,r.last=o)}return r.tail!==null?(i=r.tail,r.rendering=i,r.tail=i.sibling,r.lastEffect=a.lastEffect,r.renderingStartTime=St(),i.sibling=null,a=Ge.current,We(Ge,n?a&1|2:a&1),i):null;case 23:case 24:return Kc(),t!==null&&t.memoizedState!==null!=(a.memoizedState!==null)&&r.mode!=="unstable-defer-without-hiding"&&(a.flags|=4),null}throw Error(X(156,a.tag))}function u1(t){switch(t.tag){case 1:Wt(t.type)&&Fs();var a=t.flags;return a&4096?(t.flags=a&-4097|64,t):null;case 3:if(ca(),De(Ht),De(At),Gc(),a=t.flags,(a&64)!==0)throw Error(X(285));return t.flags=a&-4097|64,t;case 5:return Vc(t),null;case 13:return De(Ge),a=t.flags,a&4096?(t.flags=a&-4097|64,t):null;case 19:return De(Ge),null;case 4:return ca(),null;case 10:return kc(t),null;case 23:case 24:return Kc(),null;default:return null}}function qc(t,a){try{var i="",r=a;do i+=Hm(r),r=r.return;while(r);var e=i}catch(n){e=`
Error generating stack: `+n.message+`
`+n.stack}return{value:t,source:a,stack:e}}function Ou(t,a){try{console.error(a.value)}catch(i){setTimeout(function(){throw i})}}var c1=typeof WeakMap=="function"?WeakMap:Map;function S0(t,a,i){i=Mn(-1,i),i.tag=3,i.payload={element:null};var r=a.value;return i.callback=function(){Ws||(Ws=!0,Gu=r),Ou(t,a)},i}function C0(t,a,i){i=Mn(-1,i),i.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var e=a.value;i.payload=function(){return Ou(t,a),r(e)}}var n=t.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(i.callback=function(){typeof r!="function"&&(Or===null?Or=new Set([this]):Or.add(this),Ou(t,a));var o=a.stack;this.componentDidCatch(a.value,{componentStack:o!==null?o:""})}),i}var f1=typeof WeakSet=="function"?WeakSet:Set;function Rh(t){var a=t.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(i){Ln(t,i)}else a.current=null}function h1(t,a){switch(a.tag){case 0:case 11:case 15:case 22:return;case 1:if(a.flags&256&&t!==null){var i=t.memoizedProps,r=t.memoizedState;t=a.stateNode,a=t.getSnapshotBeforeUpdate(a.elementType===a.type?i:yr(a.type,i),r),t.__reactInternalSnapshotBeforeUpdate=a}return;case 3:a.flags&256&&Dc(a.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(X(163))}function d1(t,a,i){switch(i.tag){case 0:case 11:case 15:case 22:if(a=i.updateQueue,a=a!==null?a.lastEffect:null,a!==null){t=a=a.next;do{if((t.tag&3)===3){var r=t.create;t.destroy=r()}t=t.next}while(t!==a)}if(a=i.updateQueue,a=a!==null?a.lastEffect:null,a!==null){t=a=a.next;do{var e=t;r=e.next,e=e.tag,(e&4)!==0&&(e&1)!==0&&(z0(i,t),w1(i,t)),t=r}while(t!==a)}return;case 1:t=i.stateNode,i.flags&4&&(a===null?t.componentDidMount():(r=i.elementType===i.type?a.memoizedProps:yr(i.type,a.memoizedProps),t.componentDidUpdate(r,a.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),a=i.updateQueue,a!==null&&fh(i,a,t);return;case 3:if(a=i.updateQueue,a!==null){if(t=null,i.child!==null)switch(i.child.tag){case 5:t=i.child.stateNode;break;case 1:t=i.child.stateNode}fh(i,a,t)}return;case 5:t=i.stateNode,a===null&&i.flags&4&&qg(i.type,i.memoizedProps)&&t.focus();return;case 6:return;case 4:return;case 12:return;case 13:i.memoizedState===null&&(i=i.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&bg(i))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(X(163))}function Fh(t,a){for(var i=t;;){if(i.tag===5){var r=i.stateNode;if(a)r=r.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none";else{r=i.stateNode;var e=i.memoizedProps.style;e=e!=null&&e.hasOwnProperty("display")?e.display:null,r.style.display=pg("display",e)}}else if(i.tag===6)i.stateNode.nodeValue=a?"":i.memoizedProps;else if((i.tag!==23&&i.tag!==24||i.memoizedState===null||i===t)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function zh(t,a){if(_i&&typeof _i.onCommitFiberUnmount=="function")try{_i.onCommitFiberUnmount(Oc,a)}catch{}switch(a.tag){case 0:case 11:case 14:case 15:case 22:if(t=a.updateQueue,t!==null&&(t=t.lastEffect,t!==null)){var i=t=t.next;do{var r=i,e=r.destroy;if(r=r.tag,e!==void 0)if((r&4)!==0)z0(a,i);else{r=a;try{e()}catch(n){Ln(r,n)}}i=i.next}while(i!==t)}break;case 1:if(Rh(a),t=a.stateNode,typeof t.componentWillUnmount=="function")try{t.props=a.memoizedProps,t.state=a.memoizedState,t.componentWillUnmount()}catch(n){Ln(a,n)}break;case 5:Rh(a);break;case 4:P0(t,a)}}function Lh(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function Bh(t){return t.tag===5||t.tag===3||t.tag===4}function Dh(t){e:{for(var a=t.return;a!==null;){if(Bh(a))break e;a=a.return}throw Error(X(160))}var i=a;switch(a=i.stateNode,i.tag){case 5:var r=!1;break;case 3:a=a.containerInfo,r=!0;break;case 4:a=a.containerInfo,r=!0;break;default:throw Error(X(161))}i.flags&16&&(uo(a,""),i.flags&=-17);e:t:for(i=t;;){for(;i.sibling===null;){if(i.return===null||Bh(i.return)){i=null;break e}i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2)){i=i.stateNode;break e}}r?Iu(t,i,a):Nu(t,i,a)}function Iu(t,a,i){var r=t.tag,e=r===5||r===6;if(e)t=e?t.stateNode:t.stateNode.instance,a?i.nodeType===8?i.parentNode.insertBefore(t,a):i.insertBefore(t,a):(i.nodeType===8?(a=i.parentNode,a.insertBefore(t,i)):(a=i,a.appendChild(t)),i=i._reactRootContainer,i!=null||a.onclick!==null||(a.onclick=Ms));else if(r!==4&&(t=t.child,t!==null))for(Iu(t,a,i),t=t.sibling;t!==null;)Iu(t,a,i),t=t.sibling}function Nu(t,a,i){var r=t.tag,e=r===5||r===6;if(e)t=e?t.stateNode:t.stateNode.instance,a?i.insertBefore(t,a):i.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Nu(t,a,i),t=t.sibling;t!==null;)Nu(t,a,i),t=t.sibling}function P0(t,a){for(var i=a,r=!1,e,n;;){if(!r){r=i.return;e:for(;;){if(r===null)throw Error(X(160));switch(e=r.stateNode,r.tag){case 5:n=!1;break e;case 3:e=e.containerInfo,n=!0;break e;case 4:e=e.containerInfo,n=!0;break e}r=r.return}r=!0}if(i.tag===5||i.tag===6){e:for(var o=t,s=i,l=s;;)if(zh(o,l),l.child!==null&&l.tag!==4)l.child.return=l,l=l.child;else{if(l===s)break e;for(;l.sibling===null;){if(l.return===null||l.return===s)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}n?(o=e,s=i.stateNode,o.nodeType===8?o.parentNode.removeChild(s):o.removeChild(s)):e.removeChild(i.stateNode)}else if(i.tag===4){if(i.child!==null){e=i.stateNode.containerInfo,n=!0,i.child.return=i,i=i.child;continue}}else if(zh(t,i),i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break;for(;i.sibling===null;){if(i.return===null||i.return===a)return;i=i.return,i.tag===4&&(r=!1)}i.sibling.return=i.return,i=i.sibling}}function $l(t,a){switch(a.tag){case 0:case 11:case 14:case 15:case 22:var i=a.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do(r.tag&3)===3&&(t=r.destroy,r.destroy=void 0,t!==void 0&&t()),r=r.next;while(r!==i)}return;case 1:return;case 5:if(i=a.stateNode,i!=null){r=a.memoizedProps;var e=t!==null?t.memoizedProps:r;t=a.type;var n=a.updateQueue;if(a.updateQueue=null,n!==null){for(i[Rs]=r,t==="input"&&r.type==="radio"&&r.name!=null&&hg(i,r),pu(t,e),a=pu(t,r),e=0;e<n.length;e+=2){var o=n[e],s=n[e+1];o==="style"?gg(i,s):o==="dangerouslySetInnerHTML"?vg(i,s):o==="children"?uo(i,s):_c(i,o,s,a)}switch(t){case"input":uu(i,r);break;case"textarea":dg(i,r);break;case"select":t=i._wrapperState.wasMultiple,i._wrapperState.wasMultiple=!!r.multiple,n=r.value,n!=null?Yi(i,!!r.multiple,n,!1):t!==!!r.multiple&&(r.defaultValue!=null?Yi(i,!!r.multiple,r.defaultValue,!0):Yi(i,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(a.stateNode===null)throw Error(X(162));a.stateNode.nodeValue=a.memoizedProps;return;case 3:i=a.stateNode,i.hydrate&&(i.hydrate=!1,bg(i.containerInfo));return;case 12:return;case 13:a.memoizedState!==null&&(Jc=St(),Fh(a.child,!0)),Oh(a);return;case 19:Oh(a);return;case 17:return;case 23:case 24:Fh(a,a.memoizedState!==null);return}throw Error(X(163))}function Oh(t){var a=t.updateQueue;if(a!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new f1),a.forEach(function(r){var e=P1.bind(null,t,r);i.has(r)||(i.add(r),r.then(e,e))})}}function _1(t,a){return t!==null&&(t=t.memoizedState,t===null||t.dehydrated!==null)?(a=a.memoizedState,a!==null&&a.dehydrated===null):!1}var v1=Math.ceil,Hs=Ci.ReactCurrentDispatcher,Yc=Ci.ReactCurrentOwner,se=0,Dt=null,at=null,Ct=0,mi=0,ku=Vn(0),vt=0,fl=null,xa=0,Oo=0,wa=0,Qc=0,Uu=null,Jc=0,Vu=1/0;function Sa(){Vu=St()+500}var ee=null,Ws=!1,Gu=null,Or=null,kn=!1,no=null,Ha=90,Hu=[],Wu=[],Kr=null,io=0,ju=null,ps=-1,$r=0,gs=0,ao=null,ms=!1;function qt(){return(se&48)!==0?St():ps!==-1?ps:ps=St()}function Fn(t){if(t=t.mode,(t&2)===0)return 1;if((t&4)===0)return ua()===99?1:2;if($r===0&&($r=xa),r1.transition!==0){gs!==0&&(gs=Uu!==null?Uu.pendingLanes:0),t=$r;var a=4186112&~gs;return a&=-a,a===0&&(t=4186112&~t,a=t&-t,a===0&&(a=8192)),a}return t=ua(),(se&4)!==0&&t===98?t=bs(12,$r):(t=ay(t),t=bs(t,$r)),t}function zn(t,a,i){if(50<io)throw io=0,ju=null,Error(X(185));if(t=hl(t,a),t===null)return null;il(t,a,i),t===Dt&&(wa|=a,vt===4&&ta(t,Ct));var r=ua();a===1?(se&8)!==0&&(se&48)===0?Xu(t):(lr(t,i),se===0&&(Sa(),Hr())):((se&4)===0||r!==98&&r!==99||(Kr===null?Kr=new Set([t]):Kr.add(t)),lr(t,i)),Uu=t}function hl(t,a){t.lanes|=a;var i=t.alternate;for(i!==null&&(i.lanes|=a),i=t,t=t.return;t!==null;)t.childLanes|=a,i=t.alternate,i!==null&&(i.childLanes|=a),i=t,t=t.return;return i.tag===3?i.stateNode:null}function lr(t,a){for(var i=t.callbackNode,r=t.suspendedLanes,e=t.pingedLanes,n=t.expirationTimes,o=t.pendingLanes;0<o;){var s=31-In(o),l=1<<s,u=n[s];if(u===-1){if((l&r)===0||(l&e)!==0){u=a,Ii(l);var c=Fe;n[s]=10<=c?u+250:6<=c?u+5e3:-1}}else u<=a&&(t.expiredLanes|=l);o&=~l}if(r=_o(t,t===Dt?Ct:0),a=Fe,r===0)i!==null&&(i!==Gl&&bu(i),t.callbackNode=null,t.callbackPriority=0);else{if(i!==null){if(t.callbackPriority===a)return;i!==Gl&&bu(i)}a===15?(i=Xu.bind(null,t),jr===null?(jr=[i],vs=Ic(ul,r0)):jr.push(i),i=Gl):a===14?i=mo(99,Xu.bind(null,t)):(i=oy(a),i=mo(i,A0.bind(null,t))),t.callbackPriority=a,t.callbackNode=i}}function A0(t){if(ps=-1,gs=$r=0,(se&48)!==0)throw Error(X(327));var a=t.callbackNode;if(Gn()&&t.callbackNode!==a)return null;var i=_o(t,t===Dt?Ct:0);if(i===0)return null;var r=i,e=se;se|=16;var n=M0();(Dt!==t||Ct!==r)&&(Sa(),ra(t,r));do try{m1();break}catch(s){E0(t,s)}while(1);if(Nc(),Hs.current=n,se=e,at!==null?r=0:(Dt=null,Ct=0,r=vt),(xa&wa)!==0)ra(t,0);else if(r!==0){if(r===2&&(se|=64,t.hydrate&&(t.hydrate=!1,Dc(t.containerInfo)),i=Bg(t),i!==0&&(r=Wa(t,i))),r===1)throw a=fl,ra(t,0),ta(t,i),lr(t,St()),a;switch(t.finishedWork=t.current.alternate,t.finishedLanes=i,r){case 0:case 1:throw Error(X(345));case 2:Kn(t);break;case 3:if(ta(t,i),(i&62914560)===i&&(r=Jc+500-St(),10<r)){if(_o(t,0)!==0)break;if(e=t.suspendedLanes,(e&i)!==i){qt(),t.pingedLanes|=t.suspendedLanes&e;break}t.timeoutHandle=nh(Kn.bind(null,t),r);break}Kn(t);break;case 4:if(ta(t,i),(i&4186112)===i)break;for(r=t.eventTimes,e=-1;0<i;){var o=31-In(i);n=1<<o,o=r[o],o>e&&(e=o),i&=~n}if(i=e,i=St()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*v1(i/1960))-i,10<i){t.timeoutHandle=nh(Kn.bind(null,t),i);break}Kn(t);break;case 5:Kn(t);break;default:throw Error(X(329))}}return lr(t,St()),t.callbackNode===a?A0.bind(null,t):null}function ta(t,a){for(a&=~Qc,a&=~wa,t.suspendedLanes|=a,t.pingedLanes&=~a,t=t.expirationTimes;0<a;){var i=31-In(a),r=1<<i;t[i]=-1,a&=~r}}function Xu(t){if((se&48)!==0)throw Error(X(327));if(Gn(),t===Dt&&(t.expiredLanes&Ct)!==0){var a=Ct,i=Wa(t,a);(xa&wa)!==0&&(a=_o(t,a),i=Wa(t,a))}else a=_o(t,0),i=Wa(t,a);if(t.tag!==0&&i===2&&(se|=64,t.hydrate&&(t.hydrate=!1,Dc(t.containerInfo)),a=Bg(t),a!==0&&(i=Wa(t,a))),i===1)throw i=fl,ra(t,0),ta(t,a),lr(t,St()),i;return t.finishedWork=t.current.alternate,t.finishedLanes=a,Kn(t),lr(t,St()),null}function p1(){if(Kr!==null){var t=Kr;Kr=null,t.forEach(function(a){a.expiredLanes|=24&a.pendingLanes,lr(a,St())})}Hr()}function T0(t,a){var i=se;se|=1;try{return t(a)}finally{se=i,se===0&&(Sa(),Hr())}}function b0(t,a){var i=se;se&=-2,se|=8;try{return t(a)}finally{se=i,se===0&&(Sa(),Hr())}}function ts(t,a){We(ku,mi),mi|=a,xa|=a}function Kc(){mi=ku.current,De(ku)}function ra(t,a){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,Qy(i)),at!==null)for(i=at.return;i!==null;){var r=i;switch(r.tag){case 1:r=r.type.childContextTypes,r!=null&&Fs();break;case 3:ca(),De(Ht),De(At),Gc();break;case 5:Vc(r);break;case 4:ca();break;case 13:De(Ge);break;case 19:De(Ge);break;case 10:kc(r);break;case 23:case 24:Kc()}i=i.return}Dt=t,at=Un(t.current,null),Ct=mi=xa=a,vt=0,fl=null,Qc=wa=Oo=0}function E0(t,a){do{var i=at;try{if(Nc(),to.current=Gs,Ns){for(var r=Qe.memoizedState;r!==null;){var e=r.queue;e!==null&&(e.pending=null),r=r.next}Ns=!1}if(So=0,dt=wt=Qe=null,ro=!1,Yc.current=null,i===null||i.return===null){vt=1,fl=a,at=null;break}e:{var n=t,o=i.return,s=i,l=a;if(a=Ct,s.flags|=2048,s.firstEffect=s.lastEffect=null,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l;if((s.mode&2)===0){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var f=(Ge.current&1)!==0,h=o;do{var d;if(d=h.tag===13){var _=h.memoizedState;if(_!==null)d=_.dehydrated!==null;else{var m=h.memoizedProps;d=m.fallback===void 0?!1:m.unstable_avoidThisFallback!==!0?!0:!f}}if(d){var p=h.updateQueue;if(p===null){var v=new Set;v.add(u),h.updateQueue=v}else p.add(u);if((h.mode&2)===0){if(h.flags|=64,s.flags|=16384,s.flags&=-2981,s.tag===1)if(s.alternate===null)s.tag=17;else{var g=Mn(-1,1);g.tag=2,Rn(s,g)}s.lanes|=1;break e}l=void 0,s=a;var y=n.pingCache;if(y===null?(y=n.pingCache=new c1,l=new Set,y.set(u,l)):(l=y.get(u),l===void 0&&(l=new Set,y.set(u,l))),!l.has(s)){l.add(s);var x=C1.bind(null,n,u,s);u.then(x,x)}h.flags|=4096,h.lanes=a;break e}h=h.return}while(h!==null);l=Error((qi(s.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}vt!==5&&(vt=2),l=qc(l,s),h=o;do{switch(h.tag){case 3:n=l,h.flags|=4096,a&=-a,h.lanes|=a;var P=S0(h,n,a);ch(h,P);break e;case 1:n=l;var S=h.type,w=h.stateNode;if((h.flags&64)===0&&(typeof S.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Or===null||!Or.has(w)))){h.flags|=4096,a&=-a,h.lanes|=a;var b=C0(h,n,a);ch(h,b);break e}}h=h.return}while(h!==null)}F0(i)}catch(E){a=E,at===i&&i!==null&&(at=i=i.return);continue}break}while(1)}function M0(){var t=Hs.current;return Hs.current=Gs,t===null?Gs:t}function Wa(t,a){var i=se;se|=16;var r=M0();Dt===t&&Ct===a||ra(t,a);do try{g1();break}catch(e){E0(t,e)}while(1);if(Nc(),se=i,Hs.current=r,at!==null)throw Error(X(261));return Dt=null,Ct=0,vt}function g1(){for(;at!==null;)R0(at)}function m1(){for(;at!==null&&!Zy();)R0(at)}function R0(t){var a=L0(t.alternate,t,mi);t.memoizedProps=t.pendingProps,a===null?F0(t):at=a,Yc.current=null}function F0(t){var a=t;do{var i=a.alternate;if(t=a.return,(a.flags&2048)===0){if(i=l1(i,a,mi),i!==null){at=i;return}if(i=a,i.tag!==24&&i.tag!==23||i.memoizedState===null||(mi&1073741824)!==0||(i.mode&4)===0){for(var r=0,e=i.child;e!==null;)r|=e.lanes|e.childLanes,e=e.sibling;i.childLanes=r}t!==null&&(t.flags&2048)===0&&(t.firstEffect===null&&(t.firstEffect=a.firstEffect),a.lastEffect!==null&&(t.lastEffect!==null&&(t.lastEffect.nextEffect=a.firstEffect),t.lastEffect=a.lastEffect),1<a.flags&&(t.lastEffect!==null?t.lastEffect.nextEffect=a:t.firstEffect=a,t.lastEffect=a))}else{if(i=u1(a),i!==null){i.flags&=2047,at=i;return}t!==null&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}if(a=a.sibling,a!==null){at=a;return}at=a=t}while(a!==null);vt===0&&(vt=5)}function Kn(t){var a=ua();return gi(99,y1.bind(null,t,a)),null}function y1(t,a){do Gn();while(no!==null);if((se&48)!==0)throw Error(X(327));var i=t.finishedWork;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(X(177));t.callbackNode=null;var r=i.lanes|i.childLanes,e=r,n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;for(var o=t.eventTimes,s=t.expirationTimes;0<n;){var l=31-In(n),u=1<<l;e[l]=0,o[l]=-1,s[l]=-1,n&=~u}if(Kr!==null&&(r&24)===0&&Kr.has(t)&&Kr.delete(t),t===Dt&&(at=Dt=null,Ct=0),1<i.flags?i.lastEffect!==null?(i.lastEffect.nextEffect=i,r=i.firstEffect):r=i:r=i.firstEffect,r!==null){if(e=se,se|=32,Yc.current=null,kl=fs,o=Qf(),Su(o)){if("selectionStart"in o)s={start:o.selectionStart,end:o.selectionEnd};else e:if(s=(s=o.ownerDocument)&&s.defaultView||window,(u=s.getSelection&&s.getSelection())&&u.rangeCount!==0){s=u.anchorNode,n=u.anchorOffset,l=u.focusNode,u=u.focusOffset;try{s.nodeType,l.nodeType}catch{s=null;break e}var c=0,f=-1,h=-1,d=0,_=0,m=o,p=null;t:for(;;){for(var v;m!==s||n!==0&&m.nodeType!==3||(f=c+n),m!==l||u!==0&&m.nodeType!==3||(h=c+u),m.nodeType===3&&(c+=m.nodeValue.length),(v=m.firstChild)!==null;)p=m,m=v;for(;;){if(m===o)break t;if(p===s&&++d===n&&(f=c),p===l&&++_===u&&(h=c),(v=m.nextSibling)!==null)break;m=p,p=m.parentNode}m=v}s=f===-1||h===-1?null:{start:f,end:h}}else s=null;s=s||{start:0,end:0}}else s=null;Ul={focusedElem:o,selectionRange:s},fs=!1,ao=null,ms=!1,ee=r;do try{x1()}catch(E){if(ee===null)throw Error(X(330));Ln(ee,E),ee=ee.nextEffect}while(ee!==null);ao=null,ee=r;do try{for(o=t;ee!==null;){var g=ee.flags;if(g&16&&uo(ee.stateNode,""),g&128){var y=ee.alternate;if(y!==null){var x=y.ref;x!==null&&(typeof x=="function"?x(null):x.current=null)}}switch(g&1038){case 2:Dh(ee),ee.flags&=-3;break;case 6:Dh(ee),ee.flags&=-3,$l(ee.alternate,ee);break;case 1024:ee.flags&=-1025;break;case 1028:ee.flags&=-1025,$l(ee.alternate,ee);break;case 4:$l(ee.alternate,ee);break;case 8:s=ee,P0(o,s);var P=s.alternate;Lh(s),P!==null&&Lh(P)}ee=ee.nextEffect}}catch(E){if(ee===null)throw Error(X(330));Ln(ee,E),ee=ee.nextEffect}while(ee!==null);if(x=Ul,y=Qf(),g=x.focusedElem,o=x.selectionRange,y!==g&&g&&g.ownerDocument&&Gg(g.ownerDocument.documentElement,g)){for(o!==null&&Su(g)&&(y=o.start,x=o.end,x===void 0&&(x=y),"selectionStart"in g?(g.selectionStart=y,g.selectionEnd=Math.min(x,g.value.length)):(x=(y=g.ownerDocument||document)&&y.defaultView||window,x.getSelection&&(x=x.getSelection(),s=g.textContent.length,P=Math.min(o.start,s),o=o.end===void 0?P:Math.min(o.end,s),!x.extend&&P>o&&(s=o,o=P,P=s),s=Yf(g,P),n=Yf(g,o),s&&n&&(x.rangeCount!==1||x.anchorNode!==s.node||x.anchorOffset!==s.offset||x.focusNode!==n.node||x.focusOffset!==n.offset)&&(y=y.createRange(),y.setStart(s.node,s.offset),x.removeAllRanges(),P>o?(x.addRange(y),x.extend(n.node,n.offset)):(y.setEnd(n.node,n.offset),x.addRange(y)))))),y=[],x=g;x=x.parentNode;)x.nodeType===1&&y.push({element:x,left:x.scrollLeft,top:x.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<y.length;g++)x=y[g],x.element.scrollLeft=x.left,x.element.scrollTop=x.top}fs=!!kl,Ul=kl=null,t.current=i,ee=r;do try{for(g=t;ee!==null;){var S=ee.flags;if(S&36&&d1(g,ee.alternate,ee),S&128){y=void 0;var w=ee.ref;if(w!==null){var b=ee.stateNode;switch(ee.tag){case 5:y=b;break;default:y=b}typeof w=="function"?w(y):w.current=y}}ee=ee.nextEffect}}catch(E){if(ee===null)throw Error(X(330));Ln(ee,E),ee=ee.nextEffect}while(ee!==null);ee=null,t1(),se=e}else t.current=i;if(kn)kn=!1,no=t,Ha=a;else for(ee=r;ee!==null;)a=ee.nextEffect,ee.nextEffect=null,ee.flags&8&&(S=ee,S.sibling=null,S.stateNode=null),ee=a;if(r=t.pendingLanes,r===0&&(Or=null),r===1?t===ju?io++:(io=0,ju=t):io=0,i=i.stateNode,_i&&typeof _i.onCommitFiberRoot=="function")try{_i.onCommitFiberRoot(Oc,i,void 0,(i.current.flags&64)===64)}catch{}if(lr(t,St()),Ws)throw Ws=!1,t=Gu,Gu=null,t;return(se&8)!==0||Hr(),null}function x1(){for(;ee!==null;){var t=ee.alternate;ms||ao===null||((ee.flags&8)!==0?Df(ee,ao)&&(ms=!0):ee.tag===13&&_1(t,ee)&&Df(ee,ao)&&(ms=!0));var a=ee.flags;(a&256)!==0&&h1(t,ee),(a&512)===0||kn||(kn=!0,mo(97,function(){return Gn(),null})),ee=ee.nextEffect}}function Gn(){if(Ha!==90){var t=97<Ha?97:Ha;return Ha=90,gi(t,S1)}return!1}function w1(t,a){Hu.push(a,t),kn||(kn=!0,mo(97,function(){return Gn(),null}))}function z0(t,a){Wu.push(a,t),kn||(kn=!0,mo(97,function(){return Gn(),null}))}function S1(){if(no===null)return!1;var t=no;if(no=null,(se&48)!==0)throw Error(X(331));var a=se;se|=32;var i=Wu;Wu=[];for(var r=0;r<i.length;r+=2){var e=i[r],n=i[r+1],o=e.destroy;if(e.destroy=void 0,typeof o=="function")try{o()}catch(l){if(n===null)throw Error(X(330));Ln(n,l)}}for(i=Hu,Hu=[],r=0;r<i.length;r+=2){e=i[r],n=i[r+1];try{var s=e.create;e.destroy=s()}catch(l){if(n===null)throw Error(X(330));Ln(n,l)}}for(s=t.current.firstEffect;s!==null;)t=s.nextEffect,s.nextEffect=null,s.flags&8&&(s.sibling=null,s.stateNode=null),s=t;return se=a,Hr(),!0}function Ih(t,a,i){a=qc(i,a),a=S0(t,a,1),Rn(t,a),a=qt(),t=hl(t,1),t!==null&&(il(t,1,a),lr(t,a))}function Ln(t,a){if(t.tag===3)Ih(t,t,a);else for(var i=t.return;i!==null;){if(i.tag===3){Ih(i,t,a);break}else if(i.tag===1){var r=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Or===null||!Or.has(r))){t=qc(a,t);var e=C0(i,t,1);if(Rn(i,e),e=qt(),i=hl(i,1),i!==null)il(i,1,e),lr(i,e);else if(typeof r.componentDidCatch=="function"&&(Or===null||!Or.has(r)))try{r.componentDidCatch(a,t)}catch{}break}}i=i.return}}function C1(t,a,i){var r=t.pingCache;r!==null&&r.delete(a),a=qt(),t.pingedLanes|=t.suspendedLanes&i,Dt===t&&(Ct&i)===i&&(vt===4||vt===3&&(Ct&62914560)===Ct&&500>St()-Jc?ra(t,0):Qc|=i),lr(t,a)}function P1(t,a){var i=t.stateNode;i!==null&&i.delete(a),a=0,a===0&&(a=t.mode,(a&2)===0?a=1:(a&4)===0?a=ua()===99?1:2:($r===0&&($r=xa),a=Ni(62914560&~$r),a===0&&(a=4194304))),i=qt(),t=hl(t,a),t!==null&&(il(t,a,i),lr(t,i))}var L0;L0=function(t,a,i){var r=a.lanes;if(t!==null)if(t.memoizedProps!==a.pendingProps||Ht.current)Sr=!0;else if((i&r)!==0)Sr=(t.flags&16384)!==0;else{switch(Sr=!1,a.tag){case 3:Ch(a),Wl();break;case 5:_h(a);break;case 1:Wt(a.type)&&_s(a);break;case 4:Ru(a,a.stateNode.containerInfo);break;case 10:r=a.memoizedProps.value;var e=a.type._context;We(zs,e._currentValue),e._currentValue=r;break;case 13:if(a.memoizedState!==null)return(i&a.child.childLanes)!==0?Ph(t,a,i):(We(Ge,Ge.current&1),a=Yr(t,a,i),a!==null?a.sibling:null);We(Ge,Ge.current&1);break;case 19:if(r=(i&a.childLanes)!==0,(t.flags&64)!==0){if(r)return Mh(t,a,i);a.flags|=64}if(e=a.memoizedState,e!==null&&(e.rendering=null,e.tail=null,e.lastEffect=null),We(Ge,Ge.current),r)break;return null;case 23:case 24:return a.lanes=0,jl(t,a,i)}return Yr(t,a,i)}else Sr=!1;switch(a.lanes=0,a.tag){case 2:if(r=a.type,t!==null&&(t.alternate=null,a.alternate=null,a.flags|=2),t=a.pendingProps,e=la(a,At.current),Zi(a,i),e=Wc(null,a,r,t,e,i),a.flags|=1,typeof e=="object"&&e!==null&&typeof e.render=="function"&&e.$$typeof===void 0){if(a.tag=1,a.memoizedState=null,a.updateQueue=null,Wt(r)){var n=!0;_s(a)}else n=!1;a.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,Uc(a);var o=r.getDerivedStateFromProps;typeof o=="function"&&Ds(a,r,o,t),e.updater=cl,a.stateNode=e,e._reactInternals=a,Mu(a,r,t,i),a=Bu(null,a,r,!0,n,i)}else a.tag=0,kt(null,a,e,i),a=a.child;return a;case 16:e=a.elementType;e:{switch(t!==null&&(t.alternate=null,a.alternate=null,a.flags|=2),t=a.pendingProps,n=e._init,e=n(e._payload),a.type=e,n=a.tag=T1(e),t=yr(e,t),n){case 0:a=Lu(null,a,e,t,i);break e;case 1:a=Sh(null,a,e,t,i);break e;case 11:a=xh(null,a,e,t,i);break e;case 14:a=wh(null,a,e,yr(e.type,t),r,i);break e}throw Error(X(306,e,""))}return a;case 0:return r=a.type,e=a.pendingProps,e=a.elementType===r?e:yr(r,e),Lu(t,a,r,e,i);case 1:return r=a.type,e=a.pendingProps,e=a.elementType===r?e:yr(r,e),Sh(t,a,r,e,i);case 3:if(Ch(a),r=a.updateQueue,t===null||r===null)throw Error(X(282));if(r=a.pendingProps,e=a.memoizedState,e=e!==null?e.element:null,i0(t,a),yo(a,r,null,i),r=a.memoizedState.element,r===e)Wl(),a=Yr(t,a,i);else{if(e=a.stateNode,(n=e.hydrate)&&(Cn=Ki(a.stateNode.containerInfo.firstChild),qr=a,n=kr=!0),n){if(t=e.mutableSourceEagerHydrationData,t!=null)for(e=0;e<t.length;e+=2)n=t[e],n._workInProgressVersionPrimary=t[e+1],ea.push(n);for(i=l0(a,null,r,i),a.child=i;i;)i.flags=i.flags&-3|1024,i=i.sibling}else kt(t,a,r,i),Wl();a=a.child}return a;case 5:return _h(a),t===null&&Fu(a),r=a.type,e=a.pendingProps,n=t!==null?t.memoizedProps:null,o=e.children,Au(r,e)?o=null:n!==null&&Au(r,n)&&(a.flags|=16),m0(t,a),kt(t,a,o,i),a.child;case 6:return t===null&&Fu(a),null;case 13:return Ph(t,a,i);case 4:return Ru(a,a.stateNode.containerInfo),r=a.pendingProps,t===null?a.child=Os(a,null,r,i):kt(t,a,r,i),a.child;case 11:return r=a.type,e=a.pendingProps,e=a.elementType===r?e:yr(r,e),xh(t,a,r,e,i);case 7:return kt(t,a,a.pendingProps,i),a.child;case 8:return kt(t,a,a.pendingProps.children,i),a.child;case 12:return kt(t,a,a.pendingProps.children,i),a.child;case 10:e:{r=a.type._context,e=a.pendingProps,o=a.memoizedProps,n=e.value;var s=a.type._context;if(We(zs,s._currentValue),s._currentValue=n,o!==null)if(s=o.value,n=rr(s,n)?0:(typeof r._calculateChangedBits=="function"?r._calculateChangedBits(s,n):1073741823)|0,n===0){if(o.children===e.children&&!Ht.current){a=Yr(t,a,i);break e}}else for(s=a.child,s!==null&&(s.return=a);s!==null;){var l=s.dependencies;if(l!==null){o=s.child;for(var u=l.firstContext;u!==null;){if(u.context===r&&(u.observedBits&n)!==0){s.tag===1&&(u=Mn(-1,i&-i),u.tag=2,Rn(s,u)),s.lanes|=i,u=s.alternate,u!==null&&(u.lanes|=i),n0(s.return,i),l.lanes|=i;break}u=u.next}}else o=s.tag===10&&s.type===a.type?null:s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===a){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}kt(t,a,e.children,i),a=a.child}return a;case 9:return e=a.type,n=a.pendingProps,r=n.children,Zi(a,i),e=sr(e,n.unstable_observedBits),r=r(e),a.flags|=1,kt(t,a,r,i),a.child;case 14:return e=a.type,n=yr(e,a.pendingProps),n=yr(e.type,n),wh(t,a,e,n,r,i);case 15:return g0(t,a,a.type,a.pendingProps,r,i);case 17:return r=a.type,e=a.pendingProps,e=a.elementType===r?e:yr(r,e),t!==null&&(t.alternate=null,a.alternate=null,a.flags|=2),a.tag=1,Wt(r)?(t=!0,_s(a)):t=!1,Zi(a,i),o0(a,r,e),Mu(a,r,e,i),Bu(null,a,r,!0,t,i);case 19:return Mh(t,a,i);case 23:return jl(t,a,i);case 24:return jl(t,a,i)}throw Error(X(156,a.tag))};function A1(t,a,i,r){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function nr(t,a,i,r){return new A1(t,a,i,r)}function Zc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function T1(t){if(typeof t=="function")return Zc(t)?1:0;if(t!=null){if(t=t.$$typeof,t===tl)return 11;if(t===rl)return 14}return 2}function Un(t,a){var i=t.alternate;return i===null?(i=nr(t.tag,a,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=a,i.type=t.type,i.flags=0,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null),i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,a=t.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function ys(t,a,i,r,e,n){var o=2;if(r=t,typeof t=="function")Zc(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case yn:return na(i.children,e,n,a);case ug:o=8,e|=16;break;case vc:o=8,e|=1;break;case qa:return t=nr(12,i,a,e|8),t.elementType=qa,t.type=qa,t.lanes=n,t;case Ya:return t=nr(13,i,a,e),t.type=Ya,t.elementType=Ya,t.lanes=n,t;case Cs:return t=nr(19,i,a,e),t.elementType=Cs,t.lanes=n,t;case wc:return ef(i,e,n,a);case su:return t=nr(24,i,a,e),t.elementType=su,t.lanes=n,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case pc:o=10;break e;case gc:o=9;break e;case tl:o=11;break e;case rl:o=14;break e;case mc:o=16,r=null;break e;case yc:o=22;break e}throw Error(X(130,t==null?t:typeof t,""))}return a=nr(o,i,a,e),a.elementType=t,a.type=r,a.lanes=n,a}function na(t,a,i,r){return t=nr(7,t,r,a),t.lanes=i,t}function ef(t,a,i,r){return t=nr(23,t,r,a),t.elementType=wc,t.lanes=i,t}function ql(t,a,i){return t=nr(6,t,null,a),t.lanes=i,t}function Yl(t,a,i){return a=nr(4,t.children!==null?t.children:[],t.key,a),a.lanes=i,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}function b1(t,a,i){this.tag=a,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=i,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=zl(0),this.expirationTimes=zl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zl(0),this.mutableSourceEagerHydrationData=null}function E1(t,a,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ni,key:r==null?null:""+r,children:t,containerInfo:a,implementation:i}}function js(t,a,i,r){var e=a.current,n=qt(),o=Fn(e);e:if(i){i=i._reactInternals;t:{if(Pi(i)!==i||i.tag!==1)throw Error(X(170));var s=i;do{switch(s.tag){case 3:s=s.stateNode.context;break t;case 1:if(Wt(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break t}}s=s.return}while(s!==null);throw Error(X(171))}if(i.tag===1){var l=i.type;if(Wt(l)){i=Qg(i,l,s);break e}}i=s}else i=Nn;return a.context===null?a.context=i:a.pendingContext=i,a=Mn(n,o),a.payload={element:t},r=r===void 0?null:r,r!==null&&(a.callback=r),Rn(e,a),zn(e,o,n),o}function Ql(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Nh(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<a?i:a}}function tf(t,a){Nh(t,a),(t=t.alternate)&&Nh(t,a)}function M1(){return null}function rf(t,a,i){var r=i!=null&&i.hydrationOptions!=null&&i.hydrationOptions.mutableSources||null;if(i=new b1(t,a,i!=null&&i.hydrate===!0),a=nr(3,null,null,a===2?7:a===1?3:0),i.current=a,a.stateNode=i,Uc(a),t[ya]=i.current,jg(t.nodeType===8?t.parentNode:t),r)for(t=0;t<r.length;t++){a=r[t];var e=a._getVersion;e=e(a._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[a,e]:i.mutableSourceEagerHydrationData.push(a,e)}this._internalRoot=i}rf.prototype.render=function(t){js(t,this._internalRoot,null,null)};rf.prototype.unmount=function(){var t=this._internalRoot,a=t.containerInfo;js(null,t,null,function(){a[ya]=null})};function Io(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function R1(t,a){if(a||(a=t?t.nodeType===9?t.documentElement:t.firstChild:null,a=!(!a||a.nodeType!==1||!a.hasAttribute("data-reactroot"))),!a)for(var i;i=t.lastChild;)t.removeChild(i);return new rf(t,0,a?{hydrate:!0}:void 0)}function dl(t,a,i,r,e){var n=i._reactRootContainer;if(n){var o=n._internalRoot;if(typeof e=="function"){var s=e;e=function(){var u=Ql(o);s.call(u)}}js(a,o,t,e)}else{if(n=i._reactRootContainer=R1(i,r),o=n._internalRoot,typeof e=="function"){var l=e;e=function(){var u=Ql(o);l.call(u)}}b0(function(){js(a,o,t,e)})}return Ql(o)}Pg=function(t){if(t.tag===13){var a=qt();zn(t,4,a),tf(t,4)}};Tc=function(t){if(t.tag===13){var a=qt();zn(t,67108864,a),tf(t,67108864)}};Ag=function(t){if(t.tag===13){var a=qt(),i=Fn(t);zn(t,i,a),tf(t,i)}};Tg=function(t,a){return a()};gu=function(t,a,i){switch(a){case"input":if(uu(t,i),a=i.name,i.type==="radio"&&a!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<i.length;a++){var r=i[a];if(r!==t&&r.form===t.form){var e=ll(r);if(!e)throw Error(X(90));fg(r),uu(r,e)}}}break;case"textarea":dg(t,i);break;case"select":a=i.value,a!=null&&Yi(t,!!i.multiple,a,!1)}};Cc=T0;xg=function(t,a,i,r,e){var n=se;se|=4;try{return gi(98,t.bind(null,a,i,r,e))}finally{se=n,se===0&&(Sa(),Hr())}};Pc=function(){(se&49)===0&&(p1(),Gn())};wg=function(t,a){var i=se;se|=2;try{return t(a)}finally{se=i,se===0&&(Sa(),Hr())}};function B0(t,a){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Io(a))throw Error(X(200));return E1(t,a,null,i)}var F1={Events:[Bo,Hi,ll,mg,yg,Gn,{current:!1}]},Ia={findFiberByHostInstance:ai,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},z1={bundleType:Ia.bundleType,version:Ia.version,rendererPackageName:Ia.rendererPackageName,rendererConfig:Ia.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ci.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Cg(t),t===null?null:t.stateNode},findFiberByHostInstance:Ia.findFiberByHostInstance||M1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var rs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rs.isDisabled&&rs.supportsFiber)try{Oc=rs.inject(z1),_i=rs}catch{}}fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F1;fr.createPortal=B0;fr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(X(188)):Error(X(268,Object.keys(t)));return t=Cg(a),t=t===null?null:t.stateNode,t};fr.flushSync=function(t,a){var i=se;if((i&48)!==0)return t(a);se|=1;try{if(t)return gi(99,t.bind(null,a))}finally{se=i,Hr()}};fr.hydrate=function(t,a,i){if(!Io(a))throw Error(X(200));return dl(null,t,a,!0,i)};fr.render=function(t,a,i){if(!Io(a))throw Error(X(200));return dl(null,t,a,!1,i)};fr.unmountComponentAtNode=function(t){if(!Io(t))throw Error(X(40));return t._reactRootContainer?(b0(function(){dl(null,null,t,!1,function(){t._reactRootContainer=null,t[ya]=null})}),!0):!1};fr.unstable_batchedUpdates=T0;fr.unstable_createPortal=function(t,a){return B0(t,a,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};fr.unstable_renderSubtreeIntoContainer=function(t,a,i,r){if(!Io(i))throw Error(X(200));if(t==null||t._reactInternals===void 0)throw Error(X(38));return dl(t,a,i,!1,r)};fr.version="17.0.2";function D0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(D0)}catch(t){console.error(t)}}D0(),ag.exports=fr;var L1=ag.exports,Xr;(function(t){t[t.Disjoint=0]="Disjoint",t[t.Contains=1]="Contains",t[t.Intersects=2]="Intersects"})(Xr||(Xr={}));var Rt;(function(t){t[t.Back=0]="Back",t[t.Front=1]="Front",t[t.Intersecting=2]="Intersecting"})(Rt||(Rt={}));function kh(t,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _l(t,a,i){return a&&kh(t.prototype,a),i&&kh(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var W=function(){function t(){}return t.clamp=function(i,r,e){return Math.max(r,Math.min(e,i))},t.equals=function(i,r){return Math.abs(i-r)<=t.zeroTolerance},t.isPowerOf2=function(i){return(i&i-1)===0},t.radianToDegree=function(i){return i*t.radToDegreeFactor},t.degreeToRadian=function(i){return i*t.degreeToRadFactor},t}();W.zeroTolerance=1e-6;W.radToDegreeFactor=180/Math.PI;W.degreeToRadFactor=Math.PI/180;var C=function(){t.add=function(r,e,n){n._x=r._x+e._x,n._y=r._y+e._y,n._z=r._z+e._z,n._onValueChanged&&n._onValueChanged()},t.subtract=function(r,e,n){n._x=r._x-e._x,n._y=r._y-e._y,n._z=r._z-e._z,n._onValueChanged&&n._onValueChanged()},t.multiply=function(r,e,n){n._x=r._x*e._x,n._y=r._y*e._y,n._z=r._z*e._z,n._onValueChanged&&n._onValueChanged()},t.divide=function(r,e,n){n._x=r._x/e._x,n._y=r._y/e._y,n._z=r._z/e._z,n._onValueChanged&&n._onValueChanged()},t.dot=function(r,e){return r._x*e._x+r._y*e._y+r._z*e._z},t.cross=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=e._x,c=e._y,f=e._z;n.set(s*f-l*c,l*u-o*f,o*c-s*u)},t.distance=function(r,e){var n=e._x-r._x,o=e._y-r._y,s=e._z-r._z;return Math.sqrt(n*n+o*o+s*s)},t.distanceSquared=function(r,e){var n=e._x-r._x,o=e._y-r._y,s=e._z-r._z;return n*n+o*o+s*s},t.equals=function(r,e){return W.equals(r._x,e._x)&&W.equals(r._y,e._y)&&W.equals(r._z,e._z)},t.lerp=function(r,e,n,o){var s=r._x,l=r._y,u=r._z;o._x=s+(e._x-s)*n,o._y=l+(e._y-l)*n,o._z=u+(e._z-u)*n,o._onValueChanged&&o._onValueChanged()},t.max=function(r,e,n){n._x=Math.max(r._x,e._x),n._y=Math.max(r._y,e._y),n._z=Math.max(r._z,e._z),n._onValueChanged&&n._onValueChanged()},t.min=function(r,e,n){n._x=Math.min(r._x,e._x),n._y=Math.min(r._y,e._y),n._z=Math.min(r._z,e._z),n._onValueChanged&&n._onValueChanged()},t.negate=function(r,e){e._x=-r._x,e._y=-r._y,e._z=-r._z,e._onValueChanged&&e._onValueChanged()},t.normalize=function(r,e){var n=r._x,o=r._y,s=r._z,l=Math.sqrt(n*n+o*o+s*s);l>W.zeroTolerance&&(l=1/l,e.set(n*l,o*l,s*l))},t.scale=function(r,e,n){n._x=r._x*e,n._y=r._y*e,n._z=r._z*e,n._onValueChanged&&n._onValueChanged()},t.transformNormal=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=e.elements;n._x=o*u[0]+s*u[4]+l*u[8],n._y=o*u[1]+s*u[5]+l*u[9],n._z=o*u[2]+s*u[6]+l*u[10],n._onValueChanged&&n._onValueChanged()},t.transformToVec3=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=e.elements;n._x=o*u[0]+s*u[4]+l*u[8]+u[12],n._y=o*u[1]+s*u[5]+l*u[9]+u[13],n._z=o*u[2]+s*u[6]+l*u[10]+u[14],n._onValueChanged&&n._onValueChanged()},t.transformToVec4=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=e.elements;n._x=o*u[0]+s*u[4]+l*u[8]+u[12],n._y=o*u[1]+s*u[5]+l*u[9]+u[13],n._z=o*u[2]+s*u[6]+l*u[10]+u[14],n._w=o*u[3]+s*u[7]+l*u[11]+u[15],n._onValueChanged&&n._onValueChanged()},t.transformCoordinate=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=e.elements,c=o*u[3]+s*u[7]+l*u[11]+u[15];c=1/c,n._x=(o*u[0]+s*u[4]+l*u[8]+u[12])*c,n._y=(o*u[1]+s*u[5]+l*u[9]+u[13])*c,n._z=(o*u[2]+s*u[6]+l*u[10]+u[14])*c,n._onValueChanged&&n._onValueChanged()},t.transformByQuat=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=e._x,c=e._y,f=e._z,h=e._w,d=h*o+c*l-f*s,_=h*s+f*o-u*l,m=h*l+u*s-c*o,p=-u*o-c*s-f*l;n._x=d*h-p*u-_*f+m*c,n._y=_*h-p*c-m*u+d*f,n._z=m*h-p*f-d*c+_*u,n._onValueChanged&&n._onValueChanged()};function t(i,r,e){i===void 0&&(i=0),r===void 0&&(r=0),e===void 0&&(e=0),this._x=void 0,this._y=void 0,this._z=void 0,this._onValueChanged=null,this._x=i,this._y=r,this._z=e}var a=t.prototype;return a.set=function(r,e,n){return this._x=r,this._y=e,this._z=n,this._onValueChanged&&this._onValueChanged(),this},a.add=function(r){return this._x+=r._x,this._y+=r._y,this._z+=r._z,this._onValueChanged&&this._onValueChanged(),this},a.subtract=function(r){return this._x-=r._x,this._y-=r._y,this._z-=r._z,this._onValueChanged&&this._onValueChanged(),this},a.multiply=function(r){return this._x*=r._x,this._y*=r._y,this._z*=r._z,this._onValueChanged&&this._onValueChanged(),this},a.divide=function(r){return this._x/=r._x,this._y/=r._y,this._z/=r._z,this._onValueChanged&&this._onValueChanged(),this},a.length=function(){var r=this._x,e=this._y,n=this._z;return Math.sqrt(r*r+e*e+n*n)},a.lengthSquared=function(){var r=this._x,e=this._y,n=this._z;return r*r+e*e+n*n},a.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._onValueChanged&&this._onValueChanged(),this},a.normalize=function(){return t.normalize(this,this),this},a.scale=function(r){return this._x*=r,this._y*=r,this._z*=r,this._onValueChanged&&this._onValueChanged(),this},a.transformNormal=function(r){return t.transformNormal(this,r,this),this},a.transformToVec3=function(r){return t.transformToVec3(this,r,this),this},a.transformCoordinate=function(r){return t.transformCoordinate(this,r,this),this},a.transformByQuat=function(r){return t.transformByQuat(this,r,this),this},a.clone=function(){return new t(this._x,this._y,this._z)},a.copyFrom=function(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._onValueChanged&&this._onValueChanged(),this},a.copyFromArray=function(r,e){return e===void 0&&(e=0),this._x=r[e],this._y=r[e+1],this._z=r[e+2],this._onValueChanged&&this._onValueChanged(),this},a.copyToArray=function(r,e){e===void 0&&(e=0),r[e]=this._x,r[e+1]=this._y,r[e+2]=this._z},_l(t,[{key:"x",get:function(){return this._x},set:function(r){this._x=r,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(r){this._y=r,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(r){this._z=r,this._onValueChanged&&this._onValueChanged()}}]),t}();C._zero=new C(0,0,0);C._one=new C(1,1,1);new C;var Gr=function(){t.fromCenterAndExtent=function(r,e,n){C.subtract(r,e,n.min),C.add(r,e,n.max)},t.fromPoints=function(r,e){if(!r||r.length===0)throw new Error("points must be array and length must > 0");var n=e.min,o=e.max;n.x=n.y=n.z=Number.MAX_VALUE,o.x=o.y=o.z=-Number.MAX_VALUE;for(var s=0,l=r.length;s<l;++s){var u=r[s];C.min(n,u,n),C.max(o,u,o)}},t.fromSphere=function(r,e){var n=r.center,o=r.radius,s=e.min,l=e.max;s.x=n.x-o,s.y=n.y-o,s.z=n.z-o,l.x=n.x+o,l.y=n.y+o,l.z=n.z+o},t.transform=function(r,e,n){var o=t._tempVec30,s=t._tempVec31;r.getCenter(o),r.getExtent(s),C.transformCoordinate(o,e,o);var l=s.x,u=s.y,c=s.z,f=e.elements;s.x=Math.abs(l*f[0])+Math.abs(u*f[4])+Math.abs(c*f[8]),s.y=Math.abs(l*f[1])+Math.abs(u*f[5])+Math.abs(c*f[9]),s.z=Math.abs(l*f[2])+Math.abs(u*f[6])+Math.abs(c*f[10]),C.subtract(o,s,n.min),C.add(o,s,n.max)},t.merge=function(r,e,n){return C.min(r.min,e.min,n.min),C.max(r.max,e.max,n.max),n};function t(i,r){i===void 0&&(i=null),r===void 0&&(r=null),this.min=new C,this.max=new C,i&&this.min.copyFrom(i),r&&this.max.copyFrom(r)}var a=t.prototype;return a.getCenter=function(r){return C.add(this.min,this.max,r),C.scale(r,.5,r),r},a.getExtent=function(r){return C.subtract(this.max,this.min,r),C.scale(r,.5,r),r},a.getCorners=function(r){r===void 0&&(r=[]);var e=this.min,n=this.max,o=e.x,s=e.y,l=e.z,u=n.x,c=n.y,f=n.z,h=r.length;if(h<8)for(var d=0,_=8-h;d<_;++d)r[h+d]=new C;return r[0].set(o,c,f),r[1].set(u,c,f),r[2].set(u,s,f),r[3].set(o,s,f),r[4].set(o,c,l),r[5].set(u,c,l),r[6].set(u,s,l),r[7].set(o,s,l),r},a.transform=function(r){return t.transform(this,r,this),this},a.clone=function(){return new t(this.min,this.max)},a.copyFrom=function(r){return this.min.copyFrom(r.min),this.max.copyFrom(r.max),this},t}();Gr._tempVec30=new C;Gr._tempVec31=new C;var vi=function(){function t(){}return t.distancePlaneAndPoint=function(i,r){return C.dot(i.normal,r)+i.distance},t.intersectsPlaneAndPoint=function(i,r){var e=t.distancePlaneAndPoint(i,r);return e>0?Rt.Front:e<0?Rt.Back:Rt.Intersecting},t.intersectsPlaneAndBox=function(i,r){var e=r.min,n=r.max,o=i.normal,s=t._tempVec30,l=t._tempVec31;return o.x>=0?(s.x=n.x,l.x=e.x):(s.x=e.x,l.x=n.x),o.y>=0?(s.y=n.y,l.y=e.y):(s.y=e.y,l.y=n.y),o.z>=0?(s.z=n.z,l.z=e.z):(s.z=e.z,l.z=n.z),t.distancePlaneAndPoint(i,s)<0?Rt.Back:t.distancePlaneAndPoint(i,l)>0?Rt.Front:Rt.Intersecting},t.intersectsPlaneAndSphere=function(i,r){var e=r.center,n=r.radius,o=t.distancePlaneAndPoint(i,e);return o>n?Rt.Front:o<-n?Rt.Back:Rt.Intersecting},t.intersectsRayAndPlane=function(i,r){var e=r.normal,n=W.zeroTolerance,o=C.dot(e,i.direction);if(Math.abs(o)<n)return-1;var s=C.dot(e,i.origin),l=(-r.distance-s)/o;if(l<0){if(l<-n)return-1;l=0}return l},t.intersectsRayAndBox=function(i,r){var e=W.zeroTolerance,n=i.origin,o=i.direction,s=r.min,l=r.max,u=o.x,c=o.y,f=o.z,h=n.x,d=n.y,_=n.z,m=0,p=Number.MAX_VALUE;if(Math.abs(u)<e){if(h<s.x||h>l.x)return-1}else{var v=1/u,g=(s.x-h)*v,y=(l.x-h)*v;if(g>y){var x=g;g=y,y=x}if(m=Math.max(g,m),p=Math.min(y,p),m>p)return-1}if(Math.abs(c)<e){if(d<s.y||d>l.y)return-1}else{var P=1/c,S=(s.y-d)*P,w=(l.y-d)*P;if(S>w){var b=S;S=w,w=b}if(m=Math.max(S,m),p=Math.min(w,p),m>p)return-1}if(Math.abs(f)<e){if(_<s.z||_>l.z)return-1}else{var E=1/f,M=(s.z-_)*E,F=(l.z-_)*E;if(M>F){var A=M;M=F,F=A}if(m=Math.max(M,m),p=Math.min(F,p),m>p)return-1}return m},t.intersectsRayAndSphere=function(i,r){var e=i.origin,n=i.direction,o=r.center,s=r.radius,l=t._tempVec30;C.subtract(e,o,l);var u=C.dot(l,n),c=C.dot(l,l)-s*s;if(u>0&&c>0)return-1;var f=u*u-c;if(f<0)return-1;var h=-u-Math.sqrt(f);return h<0&&(h=0),h},t.intersectsBoxAndBox=function(i,r){return i.min.x>r.max.x||r.min.x>i.max.x||i.min.y>r.max.y||r.min.y>i.max.y?!1:!(i.min.z>r.max.z||r.min.z>i.max.z)},t.intersectsSphereAndSphere=function(i,r){var e=i.radius+r.radius;return C.distanceSquared(i.center,r.center)<e*e},t.intersectsSphereAndBox=function(i,r){var e=i.center,n=r.max,o=r.min,s=t._tempVec30;s.set(Math.max(o.x,Math.min(e.x,n.x)),Math.max(o.y,Math.min(e.y,n.y)),Math.max(o.z,Math.min(e.z,n.z)));var l=C.distanceSquared(e,s);return l<=i.radius*i.radius},t.intersectsFrustumAndBox=function(i,r){for(var e=r.min,n=r.max,o=t._tempVec30,s=0;s<6;++s){var l=i.getPlane(s),u=l.normal;if(o.set(u.x>=0?e.x:n.x,u.y>=0?e.y:n.y,u.z>=0?e.z:n.z),C.dot(u,o)>-l.distance)return!1}return!0},t.frustumContainsBox=function(i,r){for(var e=r.min,n=r.max,o=t._tempVec30,s=t._tempVec31,l=Xr.Contains,u=0;u<6;++u){var c=i.getPlane(u),f=c.normal;if(f.x>=0?(o.x=n.x,s.x=e.x):(o.x=e.x,s.x=n.x),f.y>=0?(o.y=n.y,s.y=e.y):(o.y=e.y,s.y=n.y),f.z>=0?(o.z=n.z,s.z=e.z):(o.z=e.z,s.z=n.z),t.intersectsPlaneAndPoint(c,s)===Rt.Front)return Xr.Disjoint;t.intersectsPlaneAndPoint(c,o)===Rt.Front&&(l=Xr.Intersects)}return l},t.frustumContainsSphere=function(i,r){for(var e=Xr.Contains,n=0;n<6;++n){var o=i.getPlane(n),s=t.intersectsPlaneAndSphere(o,r);if(s===Rt.Front)return Xr.Disjoint;if(s===Rt.Intersecting){e=Xr.Intersects;break}}return e},t}();vi._tempVec30=new C;vi._tempVec31=new C;var Bi=function(){t.normalize=function(r,e){var n=r.normal,o=1/n.length();C.scale(n,o,e.normal),e.distance=r.distance*o},t.fromPoints=function(r,e,n,o){var s=r.x,l=r.y,u=r.z,c=e.x-s,f=e.y-l,h=e.z-u,d=n.x-s,_=n.y-l,m=n.z-u,p=f*m-h*_,v=h*d-c*m,g=c*_-f*d,y=1/Math.sqrt(p*p+v*v+g*g),x=p*y,P=v*y,S=g*y,w=o.normal;w.x=x,w.y=P,w.z=S,o.distance=-(x*s+P*l+S*u)};function t(i,r){i===void 0&&(i=null),r===void 0&&(r=0),this.normal=new C,this.distance=0,i&&this.normal.copyFrom(i),this.distance=r}var a=t.prototype;return a.normalize=function(){return t.normalize(this,this),this},a.clone=function(){var r=new t;return r.copyFrom(this),r},a.copyFrom=function(r){return this.normal.copyFrom(r.normal),this.distance=r.distance,this},t}(),B1=function(){function t(i){i===void 0&&(i=null),this.near=void 0,this.far=void 0,this.left=void 0,this.right=void 0,this.top=void 0,this.bottom=void 0,this.near=new Bi,this.far=new Bi,this.left=new Bi,this.right=new Bi,this.top=new Bi,this.bottom=new Bi,i&&this.calculateFromMatrix(i)}var a=t.prototype;return a.getPlane=function(r){switch(r){case 0:return this.near;case 1:return this.far;case 2:return this.left;case 3:return this.right;case 4:return this.top;case 5:return this.bottom;default:return null}},a.calculateFromMatrix=function(r){var e=r.elements,n=e[0],o=e[1],s=e[2],l=e[3],u=e[4],c=e[5],f=e[6],h=e[7],d=e[8],_=e[9],m=e[10],p=e[11],v=e[12],g=e[13],y=e[14],x=e[15],P=this.near.normal;P.set(-l-s,-h-f,-p-m),this.near.distance=-x-y,this.near.normalize();var S=this.far.normal;S.set(s-l,f-h,m-p),this.far.distance=y-x,this.far.normalize();var w=this.left.normal;w.set(-l-n,-h-u,-p-d),this.left.distance=-x-v,this.left.normalize();var b=this.right.normal;b.set(n-l,u-h,d-p),this.right.distance=v-x,this.right.normalize();var E=this.top.normal;E.set(o-l,c-h,_-p),this.top.distance=g-x,this.top.normalize();var M=this.bottom.normal;M.set(-l-o,-h-c,-p-_),this.bottom.distance=-x-g,this.bottom.normalize()},a.intersectsBox=function(r){return vi.intersectsFrustumAndBox(this,r)},a.intersectsSphere=function(r){return vi.frustumContainsSphere(this,r)!==Xr.Disjoint},a.clone=function(){var r=new t;return r.copyFrom(this),r},a.copyFrom=function(r){return this.near.copyFrom(r.near),this.far.copyFrom(r.far),this.left.copyFrom(r.left),this.right.copyFrom(r.right),this.top.copyFrom(r.top),this.bottom.copyFrom(r.bottom),this},t}(),ki=function(){t.add=function(r,e,n){var o=r.elements,s=e.elements,l=n.elements;l[0]=o[0]+s[0],l[1]=o[1]+s[1],l[2]=o[2]+s[2],l[3]=o[3]+s[3],l[4]=o[4]+s[4],l[5]=o[5]+s[5],l[6]=o[6]+s[6],l[7]=o[7]+s[7],l[8]=o[8]+s[8]},t.subtract=function(r,e,n){var o=r.elements,s=e.elements,l=n.elements;l[0]=o[0]-s[0],l[1]=o[1]-s[1],l[2]=o[2]-s[2],l[3]=o[3]-s[3],l[4]=o[4]-s[4],l[5]=o[5]-s[5],l[6]=o[6]-s[6],l[7]=o[7]-s[7],l[8]=o[8]-s[8]},t.multiply=function(r,e,n){var o=r.elements,s=e.elements,l=n.elements,u=o[0],c=o[1],f=o[2],h=o[3],d=o[4],_=o[5],m=o[6],p=o[7],v=o[8],g=s[0],y=s[1],x=s[2],P=s[3],S=s[4],w=s[5],b=s[6],E=s[7],M=s[8];l[0]=u*g+h*y+m*x,l[1]=c*g+d*y+p*x,l[2]=f*g+_*y+v*x,l[3]=u*P+h*S+m*w,l[4]=c*P+d*S+p*w,l[5]=f*P+_*S+v*w,l[6]=u*b+h*E+m*M,l[7]=c*b+d*E+p*M,l[8]=f*b+_*E+v*M},t.equals=function(r,e){var n=r.elements,o=e.elements;return W.equals(n[0],o[0])&&W.equals(n[1],o[1])&&W.equals(n[2],o[2])&&W.equals(n[3],o[3])&&W.equals(n[4],o[4])&&W.equals(n[5],o[5])&&W.equals(n[6],o[6])&&W.equals(n[7],o[7])&&W.equals(n[8],o[8])},t.lerp=function(r,e,n,o){var s=r.elements,l=e.elements,u=o.elements,c=1-n;u[0]=s[0]*c+l[0]*n,u[1]=s[1]*c+l[1]*n,u[2]=s[2]*c+l[2]*n,u[3]=s[3]*c+l[3]*n,u[4]=s[4]*c+l[4]*n,u[5]=s[5]*c+l[5]*n,u[6]=s[6]*c+l[6]*n,u[7]=s[7]*c+l[7]*n,u[8]=s[8]*c+l[8]*n},t.rotationQuaternion=function(r,e){var n=e.elements,o=r._x,s=r._y,l=r._z,u=r._w,c=o+o,f=s+s,h=l+l,d=o*c,_=s*c,m=s*f,p=l*c,v=l*f,g=l*h,y=u*c,x=u*f,P=u*h;n[0]=1-m-g,n[3]=_-P,n[6]=p+x,n[1]=_+P,n[4]=1-d-g,n[7]=v-y,n[2]=p-x,n[5]=v+y,n[8]=1-d-m},t.scaling=function(r,e){var n=e.elements;n[0]=r._x,n[1]=0,n[2]=0,n[3]=0,n[4]=r._y,n[5]=0,n[6]=0,n[7]=0,n[8]=1},t.translation=function(r,e){var n=e.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=r._x,n[7]=r._y,n[8]=1},t.invert=function(r,e){var n=r.elements,o=e.elements,s=n[0],l=n[1],u=n[2],c=n[3],f=n[4],h=n[5],d=n[6],_=n[7],m=n[8],p=m*f-h*_,v=-m*c+h*d,g=_*c-f*d,y=s*p+l*v+u*g;!y||(y=1/y,o[0]=p*y,o[1]=(-m*l+u*_)*y,o[2]=(h*l-u*f)*y,o[3]=v*y,o[4]=(m*s-u*d)*y,o[5]=(-h*s+u*c)*y,o[6]=g*y,o[7]=(-_*s+l*d)*y,o[8]=(f*s-l*c)*y)},t.normalMatrix=function(r,e){var n=r.elements,o=e.elements,s=n[0],l=n[1],u=n[2],c=n[3],f=n[4],h=n[5],d=n[6],_=n[7],m=n[8],p=n[9],v=n[10],g=n[11],y=n[12],x=n[13],P=n[14],S=n[15],w=s*h-l*f,b=s*d-u*f,E=s*_-c*f,M=l*d-u*h,F=l*_-c*h,A=u*_-c*d,T=m*x-p*y,R=m*P-v*y,z=m*S-g*y,L=p*P-v*x,N=p*S-g*x,V=v*S-g*P,D=w*V-b*N+E*L+M*z-F*R+A*T;if(!D)return null;D=1/D,o[0]=(h*V-d*N+_*L)*D,o[1]=(d*z-f*V-_*R)*D,o[2]=(f*N-h*z+_*T)*D,o[3]=(u*N-l*V-c*L)*D,o[4]=(s*V-u*z+c*R)*D,o[5]=(l*z-s*N-c*T)*D,o[6]=(x*A-P*F+S*M)*D,o[7]=(P*E-y*A-S*b)*D,o[8]=(y*F-x*E+S*w)*D},t.rotate=function(r,e,n){var o=r.elements,s=n.elements,l=Math.sin(e),u=Math.cos(e),c=o[0],f=o[1],h=o[2],d=o[3],_=o[4],m=o[5],p=o[6],v=o[7],g=o[8];s[0]=u*c+l*d,s[1]=u*f+l*_,s[2]=u*h+l*m,s[3]=u*d-l*c,s[4]=u*_-l*f,s[5]=u*m-l*h,s[6]=p,s[7]=v,s[8]=g},t.scale=function(r,e,n){var o=e._x,s=e._y,l=r.elements,u=n.elements;u[0]=o*l[0],u[1]=o*l[1],u[2]=o*l[2],u[3]=s*l[3],u[4]=s*l[4],u[5]=s*l[5],u[6]=l[6],u[7]=l[7],u[8]=l[8]},t.translate=function(r,e,n){var o=e._x,s=e._y,l=r.elements,u=n.elements,c=l[0],f=l[1],h=l[2],d=l[3],_=l[4],m=l[5],p=l[6],v=l[7],g=l[8];u[0]=c,u[1]=f,u[2]=h,u[3]=d,u[4]=_,u[5]=m,u[6]=o*c+s*d+p,u[7]=o*f+s*_+v,u[8]=o*h+s*m+g},t.transpose=function(r,e){var n=r.elements,o=e.elements;if(e===r){var s=n[1],l=n[2],u=n[5];o[1]=n[3],o[2]=n[6],o[3]=s,o[5]=n[7],o[6]=l,o[7]=u}else o[0]=n[0],o[1]=n[3],o[2]=n[6],o[3]=n[1],o[4]=n[4],o[5]=n[7],o[6]=n[2],o[7]=n[5],o[8]=n[8]};function t(i,r,e,n,o,s,l,u,c){i===void 0&&(i=1),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),o===void 0&&(o=1),s===void 0&&(s=0),l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=1),this.elements=new Float32Array(9);var f=this.elements;f[0]=i,f[1]=r,f[2]=e,f[3]=n,f[4]=o,f[5]=s,f[6]=l,f[7]=u,f[8]=c}var a=t.prototype;return a.set=function(r,e,n,o,s,l,u,c,f){var h=this.elements;return h[0]=r,h[1]=e,h[2]=n,h[3]=o,h[4]=s,h[5]=l,h[6]=u,h[7]=c,h[8]=f,this},a.add=function(r){return t.add(this,r,this),this},a.subtract=function(r){return t.subtract(this,r,this),this},a.multiply=function(r){return t.multiply(this,r,this),this},a.determinant=function(){var r=this.elements,e=r[0],n=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],f=r[7],h=r[8],d=h*l-u*f,_=-h*s+u*c,m=f*s-l*c;return e*d+n*_+o*m},a.identity=function(){var r=this.elements;return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,this},a.invert=function(){return t.invert(this,this),this},a.rotate=function(r){return t.rotate(this,r,this),this},a.scale=function(r){return t.scale(this,r,this),this},a.translate=function(r){return t.translate(this,r,this),this},a.transpose=function(){return t.transpose(this,this),this},a.clone=function(){var r=this.elements,e=new t(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8]);return e},a.copyFrom=function(r){var e=this.elements,n=r.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},a.copyFromArray=function(r,e){e===void 0&&(e=0);for(var n=this.elements,o=0;o<12;o++)n[o]=r[o+e];return this},a.copyToArray=function(r,e){e===void 0&&(e=0);var n=this.elements;r[e]=n[0],r[e+1]=n[1],r[e+2]=n[2],r[e+3]=n[3],r[e+4]=n[4],r[e+5]=n[5],r[e+6]=n[6],r[e+7]=n[7],r[e+8]=n[8]},a.copyFromMatrix=function(r){var e=r.elements,n=this.elements;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],this},t}(),we=function(){t.add=function(r,e,n){n._x=r._x+e._x,n._y=r._y+e._y,n._z=r._z+e._z,n._w=r._w+e._w,n._onValueChanged&&n._onValueChanged()},t.multiply=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=r._w,c=e._x,f=e._y,h=e._z,d=e._w;n._x=o*d+u*c+s*h-l*f,n._y=s*d+u*f+l*c-o*h,n._z=l*d+u*h+o*f-s*c,n._w=u*d-o*c-s*f-l*h,n._onValueChanged&&n._onValueChanged()},t.conjugate=function(r,e){e._x=-r._x,e._y=-r._y,e._z=-r._z,e._w=r._w,e._onValueChanged&&e._onValueChanged()},t.dot=function(r,e){return r._x*e._x+r._y*e._y+r._z*e._z+r._w*e._w},t.equals=function(r,e){return W.equals(r._x,e._x)&&W.equals(r._y,e._y)&&W.equals(r._z,e._z)&&W.equals(r._w,e._w)},t.rotationAxisAngle=function(r,e,n){var o=t._tempVector3;C.normalize(r,o),e*=.5;var s=Math.sin(e);n._x=o._x*s,n._y=o._y*s,n._z=o._z*s,n._w=Math.cos(e),n._onValueChanged&&n._onValueChanged()},t.rotationEuler=function(r,e,n,o){t.rotationYawPitchRoll(e,r,n,o)},t.rotationYawPitchRoll=function(r,e,n,o){var s=n*.5,l=e*.5,u=r*.5,c=Math.sin(s),f=Math.cos(s),h=Math.sin(l),d=Math.cos(l),_=Math.sin(u),m=Math.cos(u),p=m*d,v=_*h;o._x=m*h*f+_*d*c,o._y=_*d*f-m*h*c,o._z=p*c-v*f,o._w=p*f+v*c,o._onValueChanged&&o._onValueChanged()},t.rotationMatrix3x3=function(r,e){var n=r.elements,o=n[0],s=n[1],l=n[2],u=n[3],c=n[4],f=n[5],h=n[6],d=n[7],_=n[8],m=o+c+_,p,v;m>0?(p=Math.sqrt(m+1),e._w=p*.5,p=.5/p,e._x=(f-d)*p,e._y=(h-l)*p,e._z=(s-u)*p):o>=c&&o>=_?(p=Math.sqrt(1+o-c-_),v=.5/p,e._x=.5*p,e._y=(s+u)*v,e._z=(l+h)*v,e._w=(f-d)*v):c>_?(p=Math.sqrt(1+c-o-_),v=.5/p,e._x=(u+s)*v,e._y=.5*p,e._z=(d+f)*v,e._w=(h-l)*v):(p=Math.sqrt(1+_-o-c),v=.5/p,e._x=(l+h)*v,e._y=(f+d)*v,e._z=.5*p,e._w=(s-u)*v),e._onValueChanged&&e._onValueChanged()},t.invert=function(r,e){var n=r._x,o=r._y,s=r._z,l=r._w,u=n*n+o*o+s*s+l*l;if(u>W.zeroTolerance){var c=1/u;e._x=-n*c,e._y=-o*c,e._z=-s*c,e._w=l*c,e._onValueChanged&&e._onValueChanged()}},t.lerp=function(r,e,n,o){var s=1-n;t.dot(r,e)>=0?(o._x=r._x*s+e._x*n,o._y=r._y*s+e._y*n,o._z=r._z*s+e._z*n,o._w=r._w*s+e._w*n):(o._x=r._x*s-e._x*n,o._y=r._y*s-e._y*n,o._z=r._z*s-e._z*n,o._w=r._w*s-e._w*n),o.normalize()},t.slerp=function(r,e,n,o){var s=r._x,l=r._y,u=r._z,c=r._w,f=e._x,h=e._y,d=e._z,_=e._w,m,p,v=s*f+l*h+u*d+c*_;if(v<0&&(v=-v,f=-f,h=-h,d=-d,_=-_),1-v>W.zeroTolerance){var g=Math.acos(v),y=Math.sin(g);m=Math.sin((1-n)*g)/y,p=Math.sin(n*g)/y}else m=1-n,p=n;o._x=m*s+p*f,o._y=m*l+p*h,o._z=m*u+p*d,o._w=m*c+p*_,o._onValueChanged&&o._onValueChanged()},t.normalize=function(r,e){var n=r._x,o=r._y,s=r._z,l=r._w,u=Math.sqrt(n*n+o*o+s*s+l*l);u>W.zeroTolerance&&(u=1/u,e._x=n*u,e._y=o*u,e._z=s*u,e._w=l*u,e._onValueChanged&&e._onValueChanged())},t.rotationX=function(r,e){r*=.5;var n=Math.sin(r),o=Math.cos(r);e._x=n,e._y=0,e._z=0,e._w=o,e._onValueChanged&&e._onValueChanged()},t.rotationY=function(r,e){r*=.5;var n=Math.sin(r),o=Math.cos(r);e._x=0,e._y=n,e._z=0,e._w=o,e._onValueChanged&&e._onValueChanged()},t.rotationZ=function(r,e){r*=.5;var n=Math.sin(r),o=Math.cos(r);e._x=0,e._y=0,e._z=n,e._w=o,e._onValueChanged&&e._onValueChanged()},t.rotateX=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=r._w;e*=.5;var c=Math.sin(e),f=Math.cos(e);n._x=o*f+u*c,n._y=s*f+l*c,n._z=l*f-s*c,n._w=u*f-o*c,n._onValueChanged&&n._onValueChanged()},t.rotateY=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=r._w;e*=.5;var c=Math.sin(e),f=Math.cos(e);n._x=o*f-l*c,n._y=s*f+u*c,n._z=l*f+o*c,n._w=u*f-s*c,n._onValueChanged&&n._onValueChanged()},t.rotateZ=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=r._w;e*=.5;var c=Math.sin(e),f=Math.cos(e);n._x=o*f+s*c,n._y=s*f-o*c,n._z=l*f+u*c,n._w=u*f-l*c,n._onValueChanged&&n._onValueChanged()},t.scale=function(r,e,n){n._x=r._x*e,n._y=r._y*e,n._z=r._z*e,n._w=r._w*e,n._onValueChanged&&n._onValueChanged()};function t(i,r,e,n){i===void 0&&(i=0),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=1),this._x=void 0,this._y=void 0,this._z=void 0,this._w=void 0,this._onValueChanged=null,this._x=i,this._y=r,this._z=e,this._w=n}var a=t.prototype;return a.set=function(r,e,n,o){return this._x=r,this._y=e,this._z=n,this._w=o,this._onValueChanged&&this._onValueChanged(),this},a.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onValueChanged&&this._onValueChanged(),this},a.getAxisAngle=function(r){var e=this._x,n=this._y,o=this._z,s=e*e+n*n+o*o;if(s<W.zeroTolerance)return r._x=1,r._y=0,r._z=0,0;var l=1/s;return r._x=this._x*l,r._y=this._y*l,r._z=this._z*l,Math.acos(this._w)*2},a.identity=function(){return this._x=0,this._y=0,this._z=0,this._w=1,this._onValueChanged&&this._onValueChanged(),this},a.length=function(){var r=this._x,e=this._y,n=this._z,o=this._w;return Math.sqrt(r*r+e*e+n*n+o*o)},a.lengthSquared=function(){var r=this._x,e=this._y,n=this._z,o=this._w;return r*r+e*e+n*n+o*o},a.normalize=function(){return t.normalize(this,this),this},a.toEuler=function(r){this._toYawPitchRoll(r);var e=r._x;return r._x=r._y,r._y=e,r._onValueChanged&&r._onValueChanged(),r},a.toYawPitchRoll=function(r){return this._toYawPitchRoll(r),r._onValueChanged&&r._onValueChanged(),r},a.rotateX=function(r){return t.rotateX(this,r,this),this},a.rotateY=function(r){return t.rotateY(this,r,this),this},a.rotateZ=function(r){return t.rotateZ(this,r,this),this},a.rotationAxisAngle=function(r,e){return t.rotationAxisAngle(r,e,this),this},a.multiply=function(r){return t.multiply(this,r,this),this},a.invert=function(){return t.invert(this,this),this},a.dot=function(r){return t.dot(this,r)},a.lerp=function(r,e){return t.lerp(this,r,e,this),this},a.rotateAxisAngle=function(r,e){return t._tempQuat1.rotationAxisAngle(r,e),this.multiply(t._tempQuat1),this},a.clone=function(){return new t(this._x,this._y,this._z,this._w)},a.copyFrom=function(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onValueChanged&&this._onValueChanged(),this},a.copyFromArray=function(r,e){return e===void 0&&(e=0),this._x=r[e],this._y=r[e+1],this._z=r[e+2],this._w=r[e+3],this._onValueChanged&&this._onValueChanged(),this},a.copyToArray=function(r,e){e===void 0&&(e=0),r[e]=this._x,r[e+1]=this._y,r[e+2]=this._z,r[e+3]=this._w},a._toYawPitchRoll=function(r){var e=this._x,n=this._y,o=this._z,s=this._w,l=e*e,u=n*n,c=o*o,f=e*n,h=o*s,d=o*e,_=n*s,m=n*o,p=e*s;return r._y=Math.asin(2*(p-m)),Math.cos(r.y)>W.zeroTolerance?(r._z=Math.atan2(2*(f+h),1-2*(c+l)),r._x=Math.atan2(2*(d+_),1-2*(u+l))):(r._z=Math.atan2(-2*(f-h),1-2*(u+c)),r._x=0),r},_l(t,[{key:"x",get:function(){return this._x},set:function(r){this._x=r,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(r){this._y=r,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(r){this._z=r,this._onValueChanged&&this._onValueChanged()}},{key:"normalized",get:function(){return Math.abs(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w-1)<W.zeroTolerance}},{key:"w",get:function(){return this._w},set:function(r){this._w=r,this._onValueChanged&&this._onValueChanged()}}]),t}();we._tempVector3=new C;we._tempQuat1=new we;var re=function(){t.multiply=function(r,e,n){var o=r.elements,s=e.elements,l=n.elements,u=o[0],c=o[1],f=o[2],h=o[3],d=o[4],_=o[5],m=o[6],p=o[7],v=o[8],g=o[9],y=o[10],x=o[11],P=o[12],S=o[13],w=o[14],b=o[15],E=s[0],M=s[1],F=s[2],A=s[3],T=s[4],R=s[5],z=s[6],L=s[7],N=s[8],V=s[9],D=s[10],j=s[11],I=s[12],H=s[13],G=s[14],te=s[15];l[0]=u*E+d*M+v*F+P*A,l[1]=c*E+_*M+g*F+S*A,l[2]=f*E+m*M+y*F+w*A,l[3]=h*E+p*M+x*F+b*A,l[4]=u*T+d*R+v*z+P*L,l[5]=c*T+_*R+g*z+S*L,l[6]=f*T+m*R+y*z+w*L,l[7]=h*T+p*R+x*z+b*L,l[8]=u*N+d*V+v*D+P*j,l[9]=c*N+_*V+g*D+S*j,l[10]=f*N+m*V+y*D+w*j,l[11]=h*N+p*V+x*D+b*j,l[12]=u*I+d*H+v*G+P*te,l[13]=c*I+_*H+g*G+S*te,l[14]=f*I+m*H+y*G+w*te,l[15]=h*I+p*H+x*G+b*te},t.equals=function(r,e){var n=r.elements,o=e.elements;return W.equals(n[0],o[0])&&W.equals(n[1],o[1])&&W.equals(n[2],o[2])&&W.equals(n[3],o[3])&&W.equals(n[4],o[4])&&W.equals(n[5],o[5])&&W.equals(n[6],o[6])&&W.equals(n[7],o[7])&&W.equals(n[8],o[8])&&W.equals(n[9],o[9])&&W.equals(n[10],o[10])&&W.equals(n[11],o[11])&&W.equals(n[12],o[12])&&W.equals(n[13],o[13])&&W.equals(n[14],o[14])&&W.equals(n[15],o[15])},t.lerp=function(r,e,n,o){var s=r.elements,l=e.elements,u=o.elements,c=1-n;u[0]=s[0]*c+l[0]*n,u[1]=s[1]*c+l[1]*n,u[2]=s[2]*c+l[2]*n,u[3]=s[3]*c+l[3]*n,u[4]=s[4]*c+l[4]*n,u[5]=s[5]*c+l[5]*n,u[6]=s[6]*c+l[6]*n,u[7]=s[7]*c+l[7]*n,u[8]=s[8]*c+l[8]*n,u[9]=s[9]*c+l[9]*n,u[10]=s[10]*c+l[10]*n,u[11]=s[11]*c+l[11]*n,u[12]=s[12]*c+l[12]*n,u[13]=s[13]*c+l[13]*n,u[14]=s[14]*c+l[14]*n,u[15]=s[15]*c+l[15]*n},t.rotationQuaternion=function(r,e){var n=e.elements,o=r._x,s=r._y,l=r._z,u=r._w,c=o+o,f=s+s,h=l+l,d=o*c,_=s*c,m=s*f,p=l*c,v=l*f,g=l*h,y=u*c,x=u*f,P=u*h;n[0]=1-m-g,n[1]=_+P,n[2]=p-x,n[3]=0,n[4]=_-P,n[5]=1-d-g,n[6]=v+y,n[7]=0,n[8]=p+x,n[9]=v-y,n[10]=1-d-m,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},t.rotationAxisAngle=function(r,e,n){var o=n.elements,s=r._x,l=r._y,u=r._z,c=Math.sqrt(s*s+l*l+u*u),f,h,d;Math.abs(c)<W.zeroTolerance||(c=1/c,s*=c,l*=c,u*=c,f=Math.sin(e),h=Math.cos(e),d=1-h,o[0]=s*s*d+h,o[1]=l*s*d+u*f,o[2]=u*s*d-l*f,o[3]=0,o[4]=s*l*d-u*f,o[5]=l*l*d+h,o[6]=u*l*d+s*f,o[7]=0,o[8]=s*u*d+l*f,o[9]=l*u*d-s*f,o[10]=u*u*d+h,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1)},t.rotationTranslation=function(r,e,n){t.rotationQuaternion(r,n);var o=n.elements;o[12]=e._x,o[13]=e._y,o[14]=e._z},t.affineTransformation=function(r,e,n,o){var s=o.elements,l=e._x,u=e._y,c=e._z,f=e._w,h=l+l,d=u+u,_=c+c,m=l*h,p=l*d,v=l*_,g=u*d,y=u*_,x=c*_,P=f*h,S=f*d,w=f*_,b=r._x,E=r._y,M=r._z;s[0]=(1-(g+x))*b,s[1]=(p+w)*b,s[2]=(v-S)*b,s[3]=0,s[4]=(p-w)*E,s[5]=(1-(m+x))*E,s[6]=(y+P)*E,s[7]=0,s[8]=(v+S)*M,s[9]=(y-P)*M,s[10]=(1-(m+g))*M,s[11]=0,s[12]=n._x,s[13]=n._y,s[14]=n._z,s[15]=1},t.scaling=function(r,e){var n=e.elements;n[0]=r._x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r._y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r._z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1},t.translation=function(r,e){var n=e.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r._x,n[13]=r._y,n[14]=r._z,n[15]=1},t.invert=function(r,e){var n=r.elements,o=e.elements,s=n[0],l=n[1],u=n[2],c=n[3],f=n[4],h=n[5],d=n[6],_=n[7],m=n[8],p=n[9],v=n[10],g=n[11],y=n[12],x=n[13],P=n[14],S=n[15],w=s*h-l*f,b=s*d-u*f,E=s*_-c*f,M=l*d-u*h,F=l*_-c*h,A=u*_-c*d,T=m*x-p*y,R=m*P-v*y,z=m*S-g*y,L=p*P-v*x,N=p*S-g*x,V=v*S-g*P,D=w*V-b*N+E*L+M*z-F*R+A*T;if(!D)return null;D=1/D,o[0]=(h*V-d*N+_*L)*D,o[1]=(u*N-l*V-c*L)*D,o[2]=(x*A-P*F+S*M)*D,o[3]=(v*F-p*A-g*M)*D,o[4]=(d*z-f*V-_*R)*D,o[5]=(s*V-u*z+c*R)*D,o[6]=(P*E-y*A-S*b)*D,o[7]=(m*A-v*E+g*b)*D,o[8]=(f*N-h*z+_*T)*D,o[9]=(l*z-s*N-c*T)*D,o[10]=(y*F-x*E+S*w)*D,o[11]=(p*E-m*F-g*w)*D,o[12]=(h*R-f*L-d*T)*D,o[13]=(s*L-l*R+u*T)*D,o[14]=(x*b-y*M-P*w)*D,o[15]=(m*M-p*b+v*w)*D},t.lookAt=function(r,e,n,o){var s=o.elements,l=t._tempVec30,u=t._tempVec31,c=t._tempVec32;C.subtract(r,e,c),c.normalize(),C.cross(n,c,l),l.normalize(),C.cross(c,l,u),s[0]=l._x,s[1]=u._x,s[2]=c._x,s[3]=0,s[4]=l._y,s[5]=u._y,s[6]=c._y,s[7]=0,s[8]=l._z,s[9]=u._z,s[10]=c._z,s[11]=0,s[12]=-C.dot(l,r),s[13]=-C.dot(u,r),s[14]=-C.dot(c,r),s[15]=1},t.ortho=function(r,e,n,o,s,l,u){var c=u.elements,f=1/(r-e),h=1/(n-o),d=1/(s-l);c[0]=-2*f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*h,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*d,c[11]=0,c[12]=(r+e)*f,c[13]=(o+n)*h,c[14]=(l+s)*d,c[15]=1},t.perspective=function(r,e,n,o,s){var l=s.elements,u=1/Math.tan(r/2),c=1/(n-o);l[0]=u/e,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=u,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=(o+n)*c,l[11]=-1,l[12]=0,l[13]=0,l[14]=2*o*n*c,l[15]=0},t.rotateAxisAngle=function(r,e,n,o){var s=e._x,l=e._y,u=e._z,c=Math.sqrt(s*s+l*l+u*u);if(!(Math.abs(c)<W.zeroTolerance)){var f=r.elements,h=o.elements,d,_,m;c=1/c,s*=c,l*=c,u*=c,d=Math.sin(n),_=Math.cos(n),m=1-_;var p=f[0],v=f[1],g=f[2],y=f[3],x=f[4],P=f[5],S=f[6],w=f[7],b=f[8],E=f[9],M=f[10],F=f[11],A=s*s*m+_,T=l*s*m+u*d,R=u*s*m-l*d,z=s*l*m-u*d,L=l*l*m+_,N=u*l*m+s*d,V=s*u*m+l*d,D=l*u*m-s*d,j=u*u*m+_;h[0]=p*A+x*T+b*R,h[1]=v*A+P*T+E*R,h[2]=g*A+S*T+M*R,h[3]=y*A+w*T+F*R,h[4]=p*z+x*L+b*N,h[5]=v*z+P*L+E*N,h[6]=g*z+S*L+M*N,h[7]=y*z+w*L+F*N,h[8]=p*V+x*D+b*j,h[9]=v*V+P*D+E*j,h[10]=g*V+S*D+M*j,h[11]=y*V+w*D+F*j,r!==o&&(h[12]=f[12],h[13]=f[13],h[14]=f[14],h[15]=f[15])}},t.scale=function(r,e,n){var o=r.elements,s=n.elements,l=e._x,u=e._y,c=e._z;s[0]=o[0]*l,s[1]=o[1]*l,s[2]=o[2]*l,s[3]=o[3]*l,s[4]=o[4]*u,s[5]=o[5]*u,s[6]=o[6]*u,s[7]=o[7]*u,s[8]=o[8]*c,s[9]=o[9]*c,s[10]=o[10]*c,s[11]=o[11]*c,s[12]=o[12],s[13]=o[13],s[14]=o[14],s[15]=o[15]},t.translate=function(r,e,n){var o=r.elements,s=n.elements,l=e._x,u=e._y,c=e._z;if(r===n)s[12]=o[0]*l+o[4]*u+o[8]*c+o[12],s[13]=o[1]*l+o[5]*u+o[9]*c+o[13],s[14]=o[2]*l+o[6]*u+o[10]*c+o[14],s[15]=o[3]*l+o[7]*u+o[11]*c+o[15];else{var f=o[0],h=o[1],d=o[2],_=o[3],m=o[4],p=o[5],v=o[6],g=o[7],y=o[8],x=o[9],P=o[10],S=o[11];s[0]=f,s[1]=h,s[2]=d,s[3]=_,s[4]=m,s[5]=p,s[6]=v,s[7]=g,s[8]=y,s[9]=x,s[10]=P,s[11]=S,s[12]=f*l+m*u+y*c+o[12],s[13]=h*l+p*u+x*c+o[13],s[14]=d*l+v*u+P*c+o[14],s[15]=_*l+g*u+S*c+o[15]}},t.transpose=function(r,e){var n=r.elements,o=e.elements;if(e===r){var s=n[1],l=n[2],u=n[3],c=n[6],f=n[7],h=n[11];o[1]=n[4],o[2]=n[8],o[3]=n[12],o[4]=s,o[6]=n[9],o[7]=n[13],o[8]=l,o[9]=c,o[11]=n[14],o[12]=u,o[13]=f,o[14]=h}else o[0]=n[0],o[1]=n[4],o[2]=n[8],o[3]=n[12],o[4]=n[1],o[5]=n[5],o[6]=n[9],o[7]=n[13],o[8]=n[2],o[9]=n[6],o[10]=n[10],o[11]=n[14],o[12]=n[3],o[13]=n[7],o[14]=n[11],o[15]=n[15]};function t(i,r,e,n,o,s,l,u,c,f,h,d,_,m,p,v){i===void 0&&(i=1),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),o===void 0&&(o=0),s===void 0&&(s=1),l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=0),f===void 0&&(f=0),h===void 0&&(h=1),d===void 0&&(d=0),_===void 0&&(_=0),m===void 0&&(m=0),p===void 0&&(p=0),v===void 0&&(v=1),this.elements=new Float32Array(16);var g=this.elements;g[0]=i,g[1]=r,g[2]=e,g[3]=n,g[4]=o,g[5]=s,g[6]=l,g[7]=u,g[8]=c,g[9]=f,g[10]=h,g[11]=d,g[12]=_,g[13]=m,g[14]=p,g[15]=v}var a=t.prototype;return a.set=function(r,e,n,o,s,l,u,c,f,h,d,_,m,p,v,g){var y=this.elements;return y[0]=r,y[1]=e,y[2]=n,y[3]=o,y[4]=s,y[5]=l,y[6]=u,y[7]=c,y[8]=f,y[9]=h,y[10]=d,y[11]=_,y[12]=m,y[13]=p,y[14]=v,y[15]=g,this},a.multiply=function(r){return t.multiply(this,r,this),this},a.determinant=function(){var r=this.elements,e=r[0],n=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],f=r[7],h=r[8],d=r[9],_=r[10],m=r[11],p=r[12],v=r[13],g=r[14],y=r[15],x=e*u-n*l,P=e*c-o*l,S=e*f-s*l,w=n*c-o*u,b=n*f-s*u,E=o*f-s*c,M=h*v-d*p,F=h*g-_*p,A=h*y-m*p,T=d*g-_*v,R=d*y-m*v,z=_*y-m*g;return x*z-P*R+S*T+w*A-b*F+E*M},a.decompose=function(r,e,n){var o=t._tempMat30,s=this.elements,l=o.elements,u=s[0],c=s[1],f=s[2],h=s[3],d=s[4],_=s[5],m=s[6],p=s[7],v=s[8],g=s[9],y=s[10],x=s[11];r.set(s[12],s[13],s[14]);var P=Math.sign(u*c*f*h)<0?-1:1,S=Math.sign(d*_*m*p)<0?-1:1,w=Math.sign(v*g*y*x)<0?-1:1,b=P*Math.sqrt(u*u+c*c+f*f),E=S*Math.sqrt(d*d+_*_+m*m),M=w*Math.sqrt(v*v+g*g+y*y);if(n.set(b,E,M),Math.abs(b)<W.zeroTolerance||Math.abs(E)<W.zeroTolerance||Math.abs(M)<W.zeroTolerance)return e.identity(),!1;var F=1/b,A=1/E,T=1/M;return l[0]=u*F,l[1]=c*F,l[2]=f*F,l[3]=d*A,l[4]=_*A,l[5]=m*A,l[6]=v*T,l[7]=g*T,l[8]=y*T,we.rotationMatrix3x3(o,e),!0},a.getRotation=function(r){var e=this.elements,n=e[0]+e[5]+e[10];if(n>W.zeroTolerance){var o=Math.sqrt(n+1)*2;r._w=.25*o,r._x=(e[6]-e[9])/o,r._y=(e[8]-e[2])/o,r._z=(e[1]-e[4])/o}else if(e[0]>e[5]&&e[0]>e[10]){var s=Math.sqrt(1+e[0]-e[5]-e[10])*2;r._w=(e[6]-e[9])/s,r._x=.25*s,r._y=(e[1]+e[4])/s,r._z=(e[8]+e[2])/s}else if(e[5]>e[10]){var l=Math.sqrt(1+e[5]-e[0]-e[10])*2;r._w=(e[8]-e[2])/l,r._x=(e[1]+e[4])/l,r._y=.25*l,r._z=(e[6]+e[9])/l}else{var u=Math.sqrt(1+e[10]-e[0]-e[5])*2;r._w=(e[1]-e[4])/u,r._x=(e[8]+e[2])/u,r._y=(e[6]+e[9])/u,r._z=.25*u}return r._onValueChanged&&r._onValueChanged(),r},a.getScaling=function(r){var e=this.elements,n=e[0],o=e[1],s=e[2],l=e[4],u=e[5],c=e[6],f=e[8],h=e[9],d=e[10];return r.set(Math.sqrt(n*n+o*o+s*s),Math.sqrt(l*l+u*u+c*c),Math.sqrt(f*f+h*h+d*d)),r},a.getTranslation=function(r){var e=this.elements;return r.set(e[12],e[13],e[14]),r},a.identity=function(){var r=this.elements;return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},a.invert=function(){return t.invert(this,this),this},a.rotateAxisAngle=function(r,e){return t.rotateAxisAngle(this,r,e,this),this},a.scale=function(r){return t.scale(this,r,this),this},a.translate=function(r){return t.translate(this,r,this),this},a.transpose=function(){return t.transpose(this,this),this},a.clone=function(){var r=this.elements,e=new t(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]);return e},a.copyFrom=function(r){var e=this.elements,n=r.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},a.copyFromArray=function(r,e){e===void 0&&(e=0);for(var n=this.elements,o=0;o<16;o++)n[o]=r[o+e];return this},a.copyToArray=function(r,e){e===void 0&&(e=0);var n=this.elements;r[e]=n[0],r[e+1]=n[1],r[e+2]=n[2],r[e+3]=n[3],r[e+4]=n[4],r[e+5]=n[5],r[e+6]=n[6],r[e+7]=n[7],r[e+8]=n[8],r[e+9]=n[9],r[e+10]=n[10],r[e+11]=n[11],r[e+12]=n[12],r[e+13]=n[13],r[e+14]=n[14],r[e+15]=n[15]},t}();re._tempVec30=new C;re._tempVec31=new C;re._tempVec32=new C;re._tempMat30=new ki;re._identity=new re(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);var D1=function(){function t(i,r){i===void 0&&(i=null),r===void 0&&(r=null),this.origin=new C,this.direction=new C,i&&this.origin.copyFrom(i),r&&this.direction.copyFrom(r)}var a=t.prototype;return a.intersectPlane=function(r){return vi.intersectsRayAndPlane(this,r)},a.intersectSphere=function(r){return vi.intersectsRayAndSphere(this,r)},a.intersectBox=function(r){return vi.intersectsRayAndBox(this,r)},a.getPoint=function(r,e){return C.scale(this.direction,r,e),e.add(this.origin)},t}(),$=function(){t.add=function(r,e,n){n._x=r._x+e._x,n._y=r._y+e._y,n._onValueChanged&&n._onValueChanged()},t.subtract=function(r,e,n){n._x=r._x-e._x,n._y=r._y-e._y,n._onValueChanged&&n._onValueChanged()},t.multiply=function(r,e,n){n._x=r._x*e._x,n._y=r._y*e._y,n._onValueChanged&&n._onValueChanged()},t.divide=function(r,e,n){n._x=r._x/e._x,n._y=r._y/e._y,n._onValueChanged&&n._onValueChanged()},t.dot=function(r,e){return r._x*e._x+r._y*e._y},t.distance=function(r,e){var n=e._x-r._x,o=e._y-r._y;return Math.sqrt(n*n+o*o)},t.distanceSquared=function(r,e){var n=e._x-r._x,o=e._y-r._y;return n*n+o*o},t.equals=function(r,e){return W.equals(r._x,e._x)&&W.equals(r._y,e._y)},t.lerp=function(r,e,n,o){var s=r._x,l=r._y;o._x=s+(e._x-s)*n,o._y=l+(e._y-l)*n,o._onValueChanged&&o._onValueChanged()},t.max=function(r,e,n){n._x=Math.max(r._x,e._x),n._y=Math.max(r._y,e._y),n._onValueChanged&&n._onValueChanged()},t.min=function(r,e,n){n._x=Math.min(r._x,e._x),n._y=Math.min(r._y,e._y),n._onValueChanged&&n._onValueChanged()},t.negate=function(r,e){e._x=-r._x,e._y=-r._y,e._onValueChanged&&e._onValueChanged()},t.normalize=function(r,e){var n=r._x,o=r._y,s=Math.sqrt(n*n+o*o);s>W.zeroTolerance&&(s=1/s,e._x=n*s,e._y=o*s,e._onValueChanged&&e._onValueChanged())},t.scale=function(r,e,n){n._x=r._x*e,n._y=r._y*e,n._onValueChanged&&n._onValueChanged()};function t(i,r){i===void 0&&(i=0),r===void 0&&(r=0),this._x=void 0,this._y=void 0,this._onValueChanged=null,this._x=i,this._y=r}var a=t.prototype;return a.set=function(r,e){return this._x=r,this._y=e,this._onValueChanged&&this._onValueChanged(),this},a.add=function(r){return this._x+=r._x,this._y+=r._y,this._onValueChanged&&this._onValueChanged(),this},a.subtract=function(r){return this._x-=r._x,this._y-=r._y,this._onValueChanged&&this._onValueChanged(),this},a.multiply=function(r){return this._x*=r._x,this._y*=r._y,this._onValueChanged&&this._onValueChanged(),this},a.divide=function(r){return this._x/=r._x,this._y/=r._y,this._onValueChanged&&this._onValueChanged(),this},a.length=function(){var r=this._x,e=this._y;return Math.sqrt(r*r+e*e)},a.lengthSquared=function(){var r=this._x,e=this._y;return r*r+e*e},a.negate=function(){return this._x=-this._x,this._y=-this._y,this._onValueChanged&&this._onValueChanged(),this},a.normalize=function(){return t.normalize(this,this),this},a.scale=function(r){return this._x*=r,this._y*=r,this._onValueChanged&&this._onValueChanged(),this},a.clone=function(){return new t(this._x,this._y)},a.copyFrom=function(r){return this._x=r.x,this._y=r.y,this._onValueChanged&&this._onValueChanged(),this},a.copyFromArray=function(r,e){return e===void 0&&(e=0),this._x=r[e],this._y=r[e+1],this._onValueChanged&&this._onValueChanged(),this},a.copyToArray=function(r,e){e===void 0&&(e=0),r[e]=this._x,r[e+1]=this._y},_l(t,[{key:"x",get:function(){return this._x},set:function(r){this._x=r,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(r){this._y=r,this._onValueChanged&&this._onValueChanged()}}]),t}();$._zero=new $(0,0);$._one=new $(1,1);var Ee=function(){t.add=function(r,e,n){n._x=r._x+e._x,n._y=r._y+e._y,n._z=r._z+e._z,n._w=r._w+e._w,n._onValueChanged&&n._onValueChanged()},t.subtract=function(r,e,n){n._x=r._x-e._x,n._y=r._y-e._y,n._z=r._z-e._z,n._w=r._w-e._w,n._onValueChanged&&n._onValueChanged()},t.multiply=function(r,e,n){n._x=r._x*e._x,n._y=r._y*e._y,n._z=r._z*e._z,n._w=r._w*e._w,n._onValueChanged&&n._onValueChanged()},t.divide=function(r,e,n){n._x=r._x/e._x,n._y=r._y/e._y,n._z=r._z/e._z,n._w=r._w/e._w,n._onValueChanged&&n._onValueChanged()},t.dot=function(r,e){return r._x*e._x+r._y*e._y+r._z*e._z+r._w*e._w},t.distance=function(r,e){var n=e._x-r._x,o=e._y-r._y,s=e._z-r._z,l=e._w-r._w;return Math.sqrt(n*n+o*o+s*s+l*l)},t.distanceSquared=function(r,e){var n=e._x-r._x,o=e._y-r._y,s=e._z-r._z,l=e._w-r._w;return n*n+o*o+s*s+l*l},t.equals=function(r,e){return W.equals(r._x,e._x)&&W.equals(r._y,e._y)&&W.equals(r._z,e._z)&&W.equals(r._w,e._w)},t.lerp=function(r,e,n,o){var s=r._x,l=r._y,u=r._z,c=r._w;o._x=s+(e._x-s)*n,o._y=l+(e._y-l)*n,o._z=u+(e._z-u)*n,o._w=c+(e._w-c)*n,o._onValueChanged&&o._onValueChanged()},t.max=function(r,e,n){n._x=Math.max(r._x,e._x),n._y=Math.max(r._y,e._y),n._z=Math.max(r._z,e._z),n._w=Math.max(r._w,e._w),n._onValueChanged&&n._onValueChanged()},t.min=function(r,e,n){n._x=Math.min(r._x,e._x),n._y=Math.min(r._y,e._y),n._z=Math.min(r._z,e._z),n._w=Math.min(r._w,e._w),n._onValueChanged&&n._onValueChanged()},t.negate=function(r,e){e._x=-r._x,e._y=-r._y,e._z=-r._z,e._w=-r._w,e._onValueChanged&&e._onValueChanged()},t.normalize=function(r,e){var n=r._x,o=r._y,s=r._z,l=r._w,u=Math.sqrt(n*n+o*o+s*s+l*l);u>W.zeroTolerance&&(u=1/u,e._x=n*u,e._y=o*u,e._z=s*u,e._w=l*u,e._onValueChanged&&e._onValueChanged())},t.scale=function(r,e,n){n._x=r._x*e,n._y=r._y*e,n._z=r._z*e,n._w=r._w*e,n._onValueChanged&&n._onValueChanged()},t.transform=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=r._w,c=e.elements;n._x=o*c[0]+s*c[4]+l*c[8]+u*c[12],n._y=o*c[1]+s*c[5]+l*c[9]+u*c[13],n._z=o*c[2]+s*c[6]+l*c[10]+u*c[14],n._w=o*c[3]+s*c[7]+l*c[11]+u*c[15],n._onValueChanged&&n._onValueChanged()},t.transformByQuat=function(r,e,n){var o=r._x,s=r._y,l=r._z,u=r._w,c=e._x,f=e._y,h=e._z,d=e._w,_=d*o+f*l-h*s,m=d*s+h*o-c*l,p=d*l+c*s-f*o,v=-c*o-f*s-h*l;n._x=_*d-v*c-m*h+p*f,n._y=m*d-v*f-p*c+_*h,n._z=p*d-v*h-_*f+m*c,n._w=u,n._onValueChanged&&n._onValueChanged()};function t(i,r,e,n){i===void 0&&(i=0),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),this._x=void 0,this._y=void 0,this._z=void 0,this._w=void 0,this._onValueChanged=null,this._x=i,this._y=r,this._z=e,this._w=n}var a=t.prototype;return a.set=function(r,e,n,o){return this._x=r,this._y=e,this._z=n,this._w=o,this._onValueChanged&&this._onValueChanged(),this},a.add=function(r){return this._x+=r._x,this._y+=r._y,this._z+=r._z,this._w+=r._w,this._onValueChanged&&this._onValueChanged(),this},a.subtract=function(r){return this._x-=r._x,this._y-=r._y,this._z-=r._z,this._w-=r._w,this._onValueChanged&&this._onValueChanged(),this},a.multiply=function(r){return this._x*=r._x,this._y*=r._y,this._z*=r._z,this._w*=r._w,this._onValueChanged&&this._onValueChanged(),this},a.divide=function(r){return this._x/=r._x,this._y/=r._y,this._z/=r._z,this._w/=r._w,this._onValueChanged&&this._onValueChanged(),this},a.length=function(){var r=this._x,e=this._y,n=this._z,o=this._w;return Math.sqrt(r*r+e*e+n*n+o*o)},a.lengthSquared=function(){var r=this._x,e=this._y,n=this._z,o=this._w;return r*r+e*e+n*n+o*o},a.negate=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._onValueChanged&&this._onValueChanged(),this},a.normalize=function(){return t.normalize(this,this),this},a.scale=function(r){return this._x*=r,this._y*=r,this._z*=r,this._w*=r,this._onValueChanged&&this._onValueChanged(),this},a.clone=function(){var r=new t(this._x,this._y,this._z,this._w);return r},a.copyFrom=function(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onValueChanged&&this._onValueChanged(),this},a.copyFromArray=function(r,e){return e===void 0&&(e=0),this._x=r[e],this._y=r[e+1],this._z=r[e+2],this._w=r[e+3],this._onValueChanged&&this._onValueChanged(),this},a.copyToArray=function(r,e){e===void 0&&(e=0),r[e]=this._x,r[e+1]=this._y,r[e+2]=this._z,r[e+3]=this._w},_l(t,[{key:"x",get:function(){return this._x},set:function(r){this._x=r,this._onValueChanged&&this._onValueChanged()}},{key:"y",get:function(){return this._y},set:function(r){this._y=r,this._onValueChanged&&this._onValueChanged()}},{key:"z",get:function(){return this._z},set:function(r){this._z=r,this._onValueChanged&&this._onValueChanged()}},{key:"w",get:function(){return this._w},set:function(r){this._w=r,this._onValueChanged&&this._onValueChanged()}}]),t}();Ee._zero=new Ee(0,0,0,0);Ee._one=new Ee(1,1,1,1);var ne=function(){t.gammaToLinearSpace=function(r){return r<=0?0:r<=.04045?r/12.92:r<1?Math.pow((r+.055)/1.055,2.4):Math.pow(r,2.4)},t.linearToGammaSpace=function(r){return r<=0?0:r<.0031308?12.92*r:r<1?1.055*Math.pow(r,.41666)-.055:Math.pow(r,.41666)},t.equals=function(r,e){return W.equals(r.r,e.r)&&W.equals(r.g,e.g)&&W.equals(r.b,e.b)&&W.equals(r.a,e.a)},t.add=function(r,e,n){return n.r=r.r+e.r,n.g=r.g+e.g,n.b=r.b+e.b,n.a=r.a+e.a,n},t.scale=function(r,e,n){return n.r=r.r*e,n.g=r.g*e,n.b=r.b*e,n.a=r.a*e,n};function t(i,r,e,n){i===void 0&&(i=1),r===void 0&&(r=1),e===void 0&&(e=1),n===void 0&&(n=1),this.r=void 0,this.g=void 0,this.b=void 0,this.a=void 0,this.r=i,this.g=r,this.b=e,this.a=n}var a=t.prototype;return a.set=function(r,e,n,o){return this.r=r,this.g=e,this.b=n,this.a=o,this},a.add=function(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this.a+=r.a,this},a.scale=function(r){return this.r*=r,this.g*=r,this.b*=r,this.a*=r,this},a.clone=function(){var r=new t(this.r,this.g,this.b,this.a);return r},a.copyFrom=function(r){return this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a,this},a.toLinear=function(r){return r.r=t.gammaToLinearSpace(this.r),r.g=t.gammaToLinearSpace(this.g),r.b=t.gammaToLinearSpace(this.b),r},a.toGamma=function(r){return r.r=t.linearToGammaSpace(this.r),r.g=t.linearToGammaSpace(this.g),r.b=t.linearToGammaSpace(this.b),r},t}(),$u=function(){function t(i,r,e,n){i===void 0&&(i=0),r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.x=i,this.y=r,this.width=e,this.height=n}var a=t.prototype;return a.set=function(r,e,n,o){return this.x=r,this.y=e,this.width=n,this.height=o,this},a.clone=function(){return new t(this.x,this.y,this.width,this.height)},a.copyFrom=function(r){return this.x=r.x,this.y=r.y,this.width=r.width,this.height=r.height,this},t}(),O1=function(){function t(){this.coefficients=new Float32Array(27)}var a=t.prototype;return a.addLight=function(r,e,n){e.scale(n);var o=this.coefficients,s=r._x,l=r._y,u=r._z,c=e.r,f=e.g,h=e.b,d=.282095,_=-.488603*l,m=.488603*u,p=-.488603*s,v=1.092548*(s*l),g=-1.092548*(l*u),y=.315392*(3*u*u-1),x=-1.092548*(s*u),P=.546274*(s*s-l*l);o[0]+=c*d,o[1]+=f*d,o[2]+=h*d,o[3]+=c*_,o[4]+=f*_,o[5]+=h*_,o[6]+=c*m,o[7]+=f*m,o[8]+=h*m,o[9]+=c*p,o[10]+=f*p,o[11]+=h*p,o[12]+=c*v,o[13]+=f*v,o[14]+=h*v,o[15]+=c*g,o[16]+=f*g,o[17]+=h*g,o[18]+=c*y,o[19]+=f*y,o[20]+=h*y,o[21]+=c*x,o[22]+=f*x,o[23]+=h*x,o[24]+=c*P,o[25]+=f*P,o[26]+=h*P},a.evaluate=function(r,e){var n=this.coefficients,o=r._x,s=r._y,l=r._z,u=.886227,c=-1.023327*s,f=1.023327*l,h=-1.023327*o,d=.858086*s*o,_=-.858086*s*l,m=.247708*(3*l*l-1),p=-.858086*l*o,v=.429042*(o*o-s*s),g=n[0]*u,y=n[1]*u,x=n[2]*u;return g+=n[3]*c+n[6]*f+n[9]*h,y+=n[4]*c+n[7]*f+n[10]*h,x+=n[5]*c+n[8]*f+n[11]*h,g+=n[12]*d+n[15]*_+n[18]*m+n[21]*p+n[24]*v,y+=n[13]*d+n[16]*_+n[19]*m+n[22]*p+n[25]*v,x+=n[14]*d+n[17]*_+n[20]*m+n[23]*p+n[26]*v,e.set(g,y,x,1),e},a.scale=function(r){var e=this.coefficients;e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=r,e[5]*=r,e[6]*=r,e[7]*=r,e[8]*=r,e[9]*=r,e[10]*=r,e[11]*=r,e[12]*=r,e[13]*=r,e[14]*=r,e[15]*=r,e[16]*=r,e[17]*=r,e[18]*=r,e[19]*=r,e[20]*=r,e[21]*=r,e[22]*=r,e[23]*=r,e[24]*=r,e[25]*=r,e[26]*=r},a.clone=function(){var r=new t;return r.copyFrom(this),r},a.copyFrom=function(r){return r.copyToArray(this.coefficients),this},a.copyFromArray=function(r,e){e===void 0&&(e=0);var n=this.coefficients;n[0]=r[e],n[1]=r[1+e],n[2]=r[2+e],n[3]=r[3+e],n[4]=r[4+e],n[5]=r[5+e],n[6]=r[6+e],n[7]=r[7+e],n[8]=r[8+e],n[9]=r[9+e],n[10]=r[10+e],n[11]=r[11+e],n[12]=r[12+e],n[13]=r[13+e],n[14]=r[14+e],n[15]=r[15+e],n[16]=r[16+e],n[17]=r[17+e],n[18]=r[18+e],n[19]=r[19+e],n[20]=r[20+e],n[21]=r[21+e],n[22]=r[22+e],n[23]=r[23+e],n[24]=r[24+e],n[25]=r[25+e],n[26]=r[26+e]},a.copyToArray=function(r,e){e===void 0&&(e=0);var n=this.coefficients;r[0+e]=n[0],r[1+e]=n[1],r[2+e]=n[2],r[3+e]=n[3],r[4+e]=n[4],r[5+e]=n[5],r[6+e]=n[6],r[7+e]=n[7],r[8+e]=n[8],r[9+e]=n[9],r[10+e]=n[10],r[11+e]=n[11],r[12+e]=n[12],r[13+e]=n[13],r[14+e]=n[14],r[15+e]=n[15],r[16+e]=n[16],r[17+e]=n[17],r[18+e]=n[18],r[19+e]=n[19],r[20+e]=n[20],r[21+e]=n[21],r[22+e]=n[22],r[23+e]=n[23],r[24+e]=n[24],r[25+e]=n[25],r[26+e]=n[26]},t}();function Uh(t,a){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)}return i}function Vh(t){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?Uh(Object(i),!0).forEach(function(r){I1(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Uh(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function Gh(t,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Y(t,a,i){return a&&Gh(t.prototype,a),i&&Gh(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function I1(t,a,i){return a in t?Object.defineProperty(t,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[a]=i,t}function Co(){return Co=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},Co.apply(this,arguments)}function q(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,Po(t,a)}function qu(t){return qu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},qu(t)}function Po(t,a){return Po=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Po(t,a)}function N1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function xs(t,a,i){return N1()?xs=Reflect.construct.bind():xs=function(e,n,o){var s=[null];s.push.apply(s,n);var l=Function.bind.apply(e,s),u=new l;return o&&Po(u,o.prototype),u},xs.apply(null,arguments)}function k1(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function Yu(t){var a=typeof Map=="function"?new Map:void 0;return Yu=function(r){if(r===null||!k1(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(r))return a.get(r);a.set(r,e)}function e(){return xs(r,arguments,qu(this).constructor)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Po(e,r)},Yu(t)}function B(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function U1(t,a){if(!!t){if(typeof t=="string")return Hh(t,a);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Hh(t,a)}}function Hh(t,a){(a==null||a>t.length)&&(a=t.length);for(var i=0,r=new Array(a);i<a;i++)r[i]=t[i];return r}function V1(t,a){var i=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(i)return(i=i.call(t)).next.bind(i);if(Array.isArray(t)||(i=U1(t))||a&&t&&typeof t.length=="number"){i&&(t=i);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k(t,a,i,r){!i||Object.defineProperty(t,a,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function U(t,a,i,r,e){var n={};return Object.keys(r).forEach(function(o){n[o]=r[o]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(o,s){return s(t,a,o)||o},n),e&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(e):void 0,n.initializer=void 0),n.initializer===void 0&&(Object.defineProperty(t,a,n),n=null),n}var ws={isArray:"isArray"in Array?Array.isArray:function(t){return toString.call(t)==="[object Array]"},isArrayLike:function(a){return!!a&&typeof a.length=="number"&&typeof a!="function"},clone:function(a){if(typeof a!="object"||a===null)return a;var i;if(ws.isArrayLike(a)){i=a.slice();for(var r=0,e=a.length;r<e;r++)i[r]=ws.clone(a[r])}else{i={};for(var n in a)a.hasOwnProperty(n)&&(i[n]=ws.clone(a[n]))}return i},downloadBlob:function(a,i){i===void 0&&(i="");var r=window.URL.createObjectURL(a),e=document.createElement("a");document.body.appendChild(e),e.style.display="none",e.href=r,e.download=i,e.addEventListener("click",function(){e.parentElement&&e.parentElement.removeChild(e)}),e.click(),window.URL.revokeObjectURL(r)}};function G1(t,a){var i=t.indexOf(a);if(i<0)return!1;var r=t.length-1;if(i!==r){var e=t[r];t[i]=e}return t.length--,!0}function Qu(t){return Object.keys(t).map(function(a){return t[a]})}var H1=function(){function t(){}return t._reflectGet=function(i,r){for(var e=this._stringToPath(r),n=i,o=0,s=e.length;n!=null&&o<s;)n=n[e[o++]];return o&&o==s?n:void 0},t._stringToPath=function(i){var r=[];return i.charCodeAt(0)===W1&&r.push(""),i.replace(X1,function(e,n,o,s){var l=e;o?l=s.replace(j1,"$1"):n&&(l=n.trim()),r.push(l)}),r},t}(),W1=".".charCodeAt(0),j1=/\\(\\)?/g,X1=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),li;(function(t){t[t.Success=0]="Success",t[t.Pending=1]="Pending",t[t.Failed=2]="Failed"})(li||(li={}));var Xe=function(t){q(i,t),i.all=function(e){return new i(function(n,o,s){if(!Array.isArray(e))return n([e]);var l=0,u=e.length,c=new Array(u);e.forEach(function(f,h){Promise.resolve(f).then(function(d){c[h]=d,l+=1,s(l/u),l==u&&n(c)}).catch(function(d){return o(d)})})})};var a=i.prototype;a.onProgress=function(e){return this._listeners.add(e),this},a.cancel=function(){return this._status!==li.Pending?this:(this._reject("Promise Canceled"),this)};function i(r){var e,n,o=function(l){if(!(l<=e._progress)){e._progress=l;for(var u=V1(e._listeners),c;!(c=u()).done;){var f=c.value;f(l)}}};return e=t.call(this,function(s,l){n=function(c){Promise.resolve().then(function(){e._status=li.Failed,l(c)})},r(function(u){Promise.resolve().then(function(){o(1),e._status=li.Success,s(u)})},n,function(u){Promise.resolve().then(function(){o(u)})})})||this,e._status=void 0,e._progress=void 0,e._reject=void 0,e._listeners=void 0,e._reject=n,e._listeners=new Set,e._progress=0,e._status=li.Pending,e}return Y(i,[{key:"status",get:function(){return this._status}},{key:"progress",get:function(){return this._progress}}]),i}(Yu(Promise)),No=function(){t._addLoader=function(r,e,n){this._loaders[r]=e;for(var o=0,s=n.length;o<s;o++)this._extTypeMapping[n[o]]=r},t._getTypeByUrl=function(r){var e=r.split("?")[0];return this._extTypeMapping[e.substring(e.lastIndexOf(".")+1)]};function t(i){this.engine=i,this.retryCount=1,this.retryInterval=0,this.timeout=1/0,this._objectPool=Object.create(null),this._editorResourceConfig=Object.create(null),this._virtualPathMap=Object.create(null),this._assetPool=Object.create(null),this._assetUrlPool=Object.create(null),this._refObjectPool=Object.create(null),this._loadingPromises={}}var a=t.prototype;return a.load=function(r){var e=this;if(!Array.isArray(r))return this._loadSingleItem(r);var n=r.map(function(o){return e._loadSingleItem(o)});return Xe.all(n)},a.cancelNotLoaded=function(r){var e=this;if(!r)Qu(this._loadingPromises).forEach(function(o){o.cancel()});else if(typeof r=="string"){var n;(n=this._loadingPromises[r])===null||n===void 0||n.cancel()}else r.forEach(function(o){var s;(s=e._loadingPromises[o])===null||s===void 0||s.cancel()})},a.gc=function(){this._gc(!1)},a.getAssetPath=function(r){return this._assetPool[r]},a.getResourceByRef=function(r){var e=r.refId,n=r.key,o=r.isClone,s=this._objectPool[e],l=s?Promise.resolve(s):this.load({type:this._editorResourceConfig[e].type,url:this._editorResourceConfig[e].path});return l.then(function(u){return n?H1._reflectGet(u,n):u}).then(function(u){return o?u.clone():u})},a.initVirtualResources=function(r){var e=this;r.forEach(function(n){e._virtualPathMap[n.virtualPath]=n.path,e._editorResourceConfig[n.id]=n})},a._addAsset=function(r,e){this._assetPool[e.instanceId]=r,this._assetUrlPool[r]=e},a._deleteAsset=function(r){var e=r.instanceId,n=this._assetPool[e];n&&(delete this._assetPool[e],delete this._assetUrlPool[n])},a._addRefObject=function(r,e){this._refObjectPool[r]=e},a._deleteRefObject=function(r){delete this._refObjectPool[r]},a._destroy=function(){this.cancelNotLoaded(),this._gc(!0),this._assetPool=null,this._assetUrlPool=null,this._refObjectPool=null,this._loadingPromises=null},a._assignDefaultOptions=function(r){var e,n,o,s,l;if(r.type=(e=r.type)!=null?e:t._getTypeByUrl(r.url),r.type===void 0)throw"asset type should be specified: "+r.url;return r.retryCount=(n=r.retryCount)!=null?n:this.retryCount,r.timeout=(o=r.timeout)!=null?o:this.timeout,r.retryInterval=(s=r.retryInterval)!=null?s:this.retryInterval,r.url=(l=r.url)!=null?l:r.urls.join(","),r},a._loadSingleItem=function(r){var e=this,n=this._assignDefaultOptions(typeof r=="string"?{url:r}:r),o=n.url,s=this._virtualPathMap[o]?this._virtualPathMap[o]:o;if(this._assetUrlPool[s])return new Xe(function(c){c(e._assetUrlPool[s])});if(this._loadingPromises[s])return this._loadingPromises[n.url];var l=t._loaders[n.type];if(!l)throw"loader not found: "+n.type;n.url=s;var u=l.load(n,this);return this._loadingPromises[s]=u,u.then(function(c){l.useCache&&e._addAsset(s,c),e._loadingPromises&&delete e._loadingPromises[s]}).catch(function(c){return e._loadingPromises&&delete e._loadingPromises[s],Promise.reject(c)}),u},a._gc=function(r){for(var e=Qu(this._refObjectPool),n=0,o=e.length;n<o;n++)(!e[n].isGCIgnored||r)&&e[n].destroy()},t}();No._loaders={};No._extTypeMapping={};function ht(t,a,i){return i===void 0&&(i=!0),function(r){var e=new r(i);No._addLoader(t,e,a)}}var Ju=function(){function t(i,r,e,n){r===void 0&&(r=null),e===void 0&&(e={}),n===void 0&&(n=!0),this.data=void 0,this._timeStamp=void 0,this._target=void 0,this._currentTarget=void 0,this._bubbles=void 0,this._propagationStopped=void 0,this._type=void 0,this._timeStamp=new Date().getTime(),this._target=r,this.data=e,this._currentTarget=null,this._bubbles=n,this._propagationStopped=!1,this._type=i}var a=t.prototype;return a.stopPropagation=function(){this._propagationStopped=!0},Y(t,[{key:"propagationStopped",get:function(){return this._propagationStopped}},{key:"target",get:function(){return this._target},set:function(r){this._target=r}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"currentTarget",get:function(){return this._currentTarget},set:function(r){this._currentTarget=r}},{key:"bubbles",get:function(){return this._bubbles}},{key:"type",get:function(){return this._type}}]),t}(),Zr;(function(t){t[t.Ignore=0]="Ignore",t[t.Assignment=1]="Assignment",t[t.Shallow=2]="Shallow",t[t.Deep=3]="Deep"})(Zr||(Zr={}));function Q(t,a){ur.registerCloneMode(t,a,Zr.Ignore)}function Be(t,a){ur.registerCloneMode(t,a,Zr.Assignment)}function O0(t,a){ur.registerCloneMode(t,a,Zr.Shallow)}function Ve(t,a){ur.registerCloneMode(t,a,Zr.Deep)}var ur=function(){function t(){}return t.registerCloneMode=function(i,r,e){var n=t._subCloneModeMap.get(i.constructor);n||(n=Object.create(null),t._subCloneModeMap.set(i.constructor,n)),n[r]=e},t.getCloneMode=function(i){var r=t._cloneModeMap.get(i);if(!r){r=Object.create(null),t._cloneModeMap.set(i,r);for(var e=t._objectType,n=t._subCloneModeMap;i!==e;){var o=n.get(i);o&&Co(r,o),i=Object.getPrototypeOf(i)}}return r},t.deepCloneObject=function(i,r){var e=i.constructor;switch(e){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:r.set(i);break;case Array:for(var n=0,o=i.length;n<o;n++)t._deepCloneObjectItem(i,r,n);break;default:var s=i;if(s.clone&&s.cloneTo)s.cloneTo(r);else for(var l=Object.keys(i),u=0,c=l.length;u<c;u++)t._deepCloneObjectItem(i,r,l[u])}},t._deepCloneObjectItem=function(i,r,e){var n=i[e];if(n instanceof Object){var o=n.constructor;switch(o){case Uint8Array:case Uint16Array:case Uint32Array:case Int8Array:case Int16Array:case Int32Array:case Float32Array:case Float64Array:var s=n,l=r[e];l==null?r[e]=s.slice():l.set(s);break;case Array:var u=n,c=r[e];c==null?r[e]=new Array(u.length):c.length=u.length,t.deepCloneObject(u,c);break;default:if(n.clone&&n.cloneTo){var f=n,h=r[e];h?f.cloneTo(h):r[e]=f.clone()}else{var d=r[e];d==null&&(r[e]=d=new n.constructor),t.deepCloneObject(n,d);break}}}else r[e]=n},t}();ur._subCloneModeMap=new Map;ur._cloneModeMap=new Map;ur._objectType=Object.getPrototypeOf(Object);var Jl,Wh,I0=(Jl=function(){function t(){k(this,"_evts",Wh,this),this._evtCount=0}var a=t.prototype;return a.hasEvent=function(r){return this._evts[r]!=null},a.eventNames=function(){return this._evtCount===0?[]:Object.keys(this._evts)},a.listenerCount=function(r){var e=this._evts[r];return e?e.fn?1:e.length:0},a.dispatch=function(r,e){if(!this._evts[r])return!1;var n=this._evts[r];if(n.fn)n.once&&this.removeEventListener(r,n.fn),n.fn(e);else for(var o=n.length,s=0;s<o;s++)n[s].once&&this.removeEventListener(r,n[s].fn),n[s].fn(e);return!0},a.on=function(r,e){return this.addEventListener(r,e)},a.once=function(r,e){return this.addEventListener(r,e,!0)},a.addEventListener=function(r,e,n){var o={fn:e,once:n},s=this._evts;return s[r]?s[r].fn?s[r]=[s[r],o]:s[r].push(o):(s[r]=o,this._evtCount++),this},a.off=function(r,e){if(!this._evts[r])return this;if(!e)return this._clearEvent(r),this;var n=this._evts[r];if(n.fn&&n.fn===e)this._clearEvent(r);else{var o=n.indexOf(e);if(o>-1){var s=n[n.length-1];n[o]=s,n.length--,n.length===1&&(this._evts[r]=n[0])}}return this},a.removeEventListener=function(r,e){return this.off(r,e)},a.removeAllEventListeners=function(r){r?this._evts[r]&&this._clearEvent(r):(this._evts=Object.create(null),this._evtCount=0)},a.trigger=function(r){this.dispatch(r.type,r.data)},a._clearEvent=function(r){--this._evtCount===0?this._evts=Object.create(null):delete this._evts[r]},t}(),Wh=U(Jl.prototype,"_evts",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Object.create(null)}}),Jl),hn=function(a){},$1=console.log.bind(console),q1=console.info.bind(console),Y1=console.warn.bind(console),Q1=console.error.bind(console),de={debug:hn,info:hn,warn:hn,error:hn,isEnabled:!1,enable:function(){this.debug=$1,this.info=q1,this.warn=Y1,this.error=Q1,this.isEnabled=!0},disable:function(){this.debug=hn,this.info=hn,this.warn=hn,this.error=hn,this.isEnabled=!1}},N0=function(){function t(){this._clock=void 0,this._timeScale=void 0,this._deltaTime=void 0,this._startTime=void 0,this._lastTickTime=void 0,this._clock=performance||Date,this._timeScale=1,this._deltaTime=1e-4;var i=this._clock.now();this._startTime=i,this._lastTickTime=i}var a=t.prototype;return a.reset=function(){this._lastTickTime=this._clock.now()},a.tick=function(){var r=this.nowTime;this._deltaTime=(r-this._lastTickTime)*this._timeScale,this._lastTickTime=r},Y(t,[{key:"nowTime",get:function(){return this._clock.now()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"timeScale",get:function(){return this._timeScale},set:function(r){this._timeScale=r}},{key:"unscaledDeltaTime",get:function(){return this._deltaTime/this._timeScale}},{key:"timeSinceStartup",get:function(){return this.nowTime-this._startTime}}]),t}(),ns,jh,Xh,Kl,ln=(ns=(Kl=function(){function t(i){k(this,"instanceId",jh,this),k(this,"_engine",Xh,this),this._destroyed=!1,this._engine=i}var a=t.prototype;return a.destroy=function(){var r;this._destroyed||((r=this._engine.resourceManager)===null||r===void 0||r._deleteAsset(this),this._destroyed=!0)},Y(t,[{key:"engine",get:function(){return this._engine}},{key:"destroyed",get:function(){return this._destroyed}}]),t}(),Kl._instanceIdCounter=0,Kl),jh=U(ns.prototype,"instanceId",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return++ln._instanceIdCounter}}),Xh=U(ns.prototype,"_engine",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ns),Ue;(function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.FLOAT_ARRAY=35677]="FLOAT_ARRAY",t[t.FLOAT_VEC2_ARRAY=1e5]="FLOAT_VEC2_ARRAY",t[t.FLOAT_VEC3_ARRAY=100001]="FLOAT_VEC3_ARRAY",t[t.FLOAT_VEC4_ARRAY=100002]="FLOAT_VEC4_ARRAY",t[t.INT_ARRAY=100003]="INT_ARRAY",t[t.INT_VEC2_ARRAY=100004]="INT_VEC2_ARRAY",t[t.INT_VEC3_ARRAY=100005]="INT_VEC3_ARRAY",t[t.INT_VEC4_ARRAY=100006]="INT_VEC4_ARRAY",t[t.FLOAT_MAT2_ARRAY=100007]="FLOAT_MAT2_ARRAY",t[t.FLOAT_MAT3_ARRAY=100008]="FLOAT_MAT3_ARRAY",t[t.FLOAT_MAT4_ARRAY=100009]="FLOAT_MAT4_ARRAY",t[t.SAMPLER_2D_ARRAY=100010]="SAMPLER_2D_ARRAY",t[t.SAMPLER_CUBE_ARRAY=100011]="SAMPLER_CUBE_ARRAY",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT"})(Ue||(Ue={}));var Z;(function(t){t.shaderVertexID="shaderVertexID",t.standardDerivatives="OES_standard_derivatives",t.shaderTextureLod="EXT_shader_texture_lod",t.elementIndexUint="OES_element_index_uint",t.depthTexture="WEBGL_depth_texture",t.drawBuffers="WEBGL_draw_buffers",t.vertexArrayObject="OES_vertex_array_object",t.instancedArrays="ANGLE_instanced_arrays",t.multipleSample="multipleSampleOnlySupportedInWebGL2",t.textureFloat="OES_texture_float",t.textureFloatLinear="OES_texture_float_linear",t.textureHalfFloat="OES_texture_half_float",t.textureHalfFloatLinear="OES_texture_half_float_linear",t.WEBGL_colorBufferFloat="WEBGL_color_buffer_float",t.colorBufferFloat="EXT_color_buffer_float",t.colorBufferHalfFloat="EXT_color_buffer_half_float",t.textureFilterAnisotropic="EXT_texture_filter_anisotropic",t.blendMinMax="EXT_blend_minmax",t.astc="WEBGL_compressed_texture_astc",t.astc_webkit="WEBKIT_WEBGL_compressed_texture_astc",t.etc="WEBGL_compressed_texture_etc",t.etc_webkit="WEBKIT_WEBGL_compressed_texture_etc",t.etc1="WEBGL_compressed_texture_etc1",t.etc1_webkit="WEBKIT_WEBGL_compressed_texture_etc1",t.pvrtc="WEBGL_compressed_texture_pvrtc",t.pvrtc_webkit="WEBKIT_WEBGL_compressed_texture_pvrtc",t.s3tc="WEBGL_compressed_texture_s3tc",t.s3tc_webkit="WEBKIT_WEBGL_compressed_texture_s3tc"})(Z||(Z={}));var Bt=function(){function t(i){i===void 0&&(i=0),this._elements=void 0,this.length=0,this._elements=new Array(i)}var a=t.prototype;return a.add=function(r){this.length===this._elements.length?this._elements.push(r):this._elements[this.length]=r,this.length++},a.delete=function(r){var e=this._elements.indexOf(r);this.deleteByIndex(e)},a.get=function(r){if(r>=this.length)throw"Index is out of range.";return this._elements[r]},a.deleteByIndex=function(r){var e=this._elements,n=null,o=this.length-1;return r!==o&&(n=e[o],e[r]=n),this.length--,n},a.garbageCollection=function(){this._elements.length=this.length},t}(),Jt=function(){function t(){this._mask=[],this._length=0}t.unionCollection=function(r,e,n){var o=n._mask,s,l,u,c;r._length<e._length?(s=r._length,l=e._length,u=r._mask,c=e._mask):(s=e._length,l=r._length,u=e._mask,c=r._mask);var f=0;for(o.length<l&&(o.length=l);f<s;f++)o[f]=u[f]|c[f];for(;f<l;f++)o[f]=c[f];n._length=l};var a=t.prototype;return a.enable=function(r){var e=r._maskIndex,n=e+1,o=this._mask,s=this._length;if(s<n){for(o.length<n&&(o.length=n);s<e;s++)o[s]=0;o[e]=r._maskValue,this._length=n}else o[e]|=r._maskValue},a.disable=function(r){var e=r._maskIndex,n=this._mask,o=this._length-1;if(!(e>o)){var s=n[e]&~r._maskValue;e==o&&s===0?this._length--:n[e]=s}},a.unionCollection=function(r){var e=r._mask,n=r._length,o=this._mask,s=this._length;if(s<n){o.length<n&&(o.length=n);for(var l=0;l<s;l++)o[l]|=e[l];for(;l<n;l++)o[l]=e[l];this._length=n}else for(var u=0;u<n;u++)o[u]|=e[u]},a.complementaryCollection=function(r){for(var e=r._mask,n=this._mask,o=this._length-1,s=Math.min(r._length-1,o);s>=0;s--){var l=n[s]&~e[s];s==o&&l===0?(o--,this._length--):n[s]=l}},a.intersectionCollection=function(r){for(var e=r._mask,n=this._mask,o=this._length-1;o>=0;o--){var s=n[o]&e[o];s==0&&o==this._length-1?this._length--:n[o]=s}},a.isEnable=function(r){var e=r._maskIndex;return e>=this._length?!1:(this._mask[e]&r._maskValue)!==0},a.clear=function(){this._length=0},t}(),nf=function(){function t(){this._onStartScripts=new Bt,this._onUpdateScripts=new Bt,this._onLateUpdateScripts=new Bt,this._onPhysicsUpdateScripts=new Bt,this._disableScripts=[],this._destroyScripts=[],this._onUpdateAnimations=new Bt,this._renderers=new Bt,this._onUpdateRenderers=new Bt,this._componentsContainerPool=[]}var a=t.prototype;return a.addRenderer=function(r){r._rendererIndex=this._renderers.length,this._renderers.add(r)},a.removeRenderer=function(r){var e=this._renderers.deleteByIndex(r._rendererIndex);e&&(e._rendererIndex=r._rendererIndex),r._rendererIndex=-1},a.addOnStartScript=function(r){r._onStartIndex=this._onStartScripts.length,this._onStartScripts.add(r)},a.removeOnStartScript=function(r){var e=this._onStartScripts.deleteByIndex(r._onStartIndex);e&&(e._onStartIndex=r._onStartIndex),r._onStartIndex=-1},a.addOnUpdateScript=function(r){r._onUpdateIndex=this._onUpdateScripts.length,this._onUpdateScripts.add(r)},a.removeOnUpdateScript=function(r){var e=this._onUpdateScripts.deleteByIndex(r._onUpdateIndex);e&&(e._onUpdateIndex=r._onUpdateIndex),r._onUpdateIndex=-1},a.addOnLateUpdateScript=function(r){r._onLateUpdateIndex=this._onLateUpdateScripts.length,this._onLateUpdateScripts.add(r)},a.removeOnLateUpdateScript=function(r){var e=this._onLateUpdateScripts.deleteByIndex(r._onLateUpdateIndex);e&&(e._onLateUpdateIndex=r._onLateUpdateIndex),r._onLateUpdateIndex=-1},a.addOnPhysicsUpdateScript=function(r){r._onPhysicsUpdateIndex=this._onPhysicsUpdateScripts.length,this._onPhysicsUpdateScripts.add(r)},a.removeOnPhysicsUpdateScript=function(r){var e=this._onPhysicsUpdateScripts.deleteByIndex(r._onPhysicsUpdateIndex);e&&(e._onPhysicsUpdateIndex=r._onPhysicsUpdateIndex),r._onPhysicsUpdateIndex=-1},a.addOnUpdateAnimations=function(r){r._onUpdateIndex=this._onUpdateAnimations.length,this._onUpdateAnimations.add(r)},a.removeOnUpdateAnimations=function(r){var e=this._onUpdateAnimations.deleteByIndex(r._onUpdateIndex);e&&(e._onUpdateIndex=r._onUpdateIndex),r._onUpdateIndex=-1},a.addOnUpdateRenderers=function(r){r._onUpdateIndex=this._onUpdateRenderers.length,this._onUpdateRenderers.add(r)},a.removeOnUpdateRenderers=function(r){var e=this._onUpdateRenderers.deleteByIndex(r._onUpdateIndex);e&&(e._onUpdateIndex=r._onUpdateIndex),r._onUpdateIndex=-1},a.addDisableScript=function(r){this._disableScripts.push(r)},a.addDestroyScript=function(r){this._destroyScripts.push(r)},a.callScriptOnStart=function(){var r=this._onStartScripts;if(r.length>0){for(var e=r._elements,n=0;n<r.length;n++){var o=e[n];o._waitHandlingInValid||(o._started=!0,o._onStartIndex=-1,o.onStart())}r.length=0}},a.callScriptOnUpdate=function(r){for(var e=this._onUpdateScripts._elements,n=this._onUpdateScripts.length-1;n>=0;--n){var o=e[n];!o._waitHandlingInValid&&o._started&&o.onUpdate(r)}},a.callScriptOnLateUpdate=function(r){for(var e=this._onLateUpdateScripts._elements,n=this._onLateUpdateScripts.length-1;n>=0;--n){var o=e[n];!o._waitHandlingInValid&&o._started&&o.onLateUpdate(r)}},a.callScriptOnPhysicsUpdate=function(){for(var r=this._onPhysicsUpdateScripts._elements,e=this._onPhysicsUpdateScripts.length-1;e>=0;--e){var n=r[e];!n._waitHandlingInValid&&n._started&&n.onPhysicsUpdate()}},a.callAnimationUpdate=function(r){for(var e=this._onUpdateAnimations._elements,n=this._onUpdateAnimations.length-1;n>=0;--n)e[n].update(r)},a.callRendererOnUpdate=function(r){for(var e=this._onUpdateRenderers._elements,n=this._onUpdateRenderers.length-1;n>=0;--n)e[n].update(r)},a.callRender=function(r){for(var e=r._camera,n=this._renderers._elements,o=this._renderers.length-1;o>=0;--o){var s=n[o];if(!!(e.cullingMask&s._entity.layer)&&!(e.enableFrustumCulling&&(s.isCulled=!e._frustum.intersectsBox(s.bounds),s.isCulled))){var l=e.entity.transform,u=l.worldPosition,c=s.bounds.getCenter(t._tempVector0);if(e.isOrthographic){var f=l.getWorldForward(t._tempVector1);C.subtract(c,u,c),s._distanceForSort=C.dot(c,f)}else s._distanceForSort=C.distanceSquared(c,u);s._updateShaderData(r),s._render(e),Jt.unionCollection(e._globalShaderMacro,s.shaderData._macroCollection,s._globalShaderMacro)}}},a.handlingInvalidScripts=function(){var r=this._disableScripts,e=this._destroyScripts,n=r.length;if(n>0){for(var o=n-1;o>=0;o--){var s=r[o];s._waitHandlingInValid&&s._handlingInValid()}r.length=0}if(n=e.length,n>0){for(var l=n-1;l>=0;l--)e[l].onDestroy();e.length=0}},a.callCameraOnBeginRender=function(r){for(var e=r.entity._scripts,n=e.length-1;n>=0;--n){var o=e.get(n);o._waitHandlingInValid||o.onBeginRender(r)}},a.callCameraOnEndRender=function(r){for(var e=r.entity._scripts,n=e.length-1;n>=0;--n){var o=e.get(n);o._waitHandlingInValid||o.onEndRender(r)}},a.getActiveChangedTempList=function(){return this._componentsContainerPool.length?this._componentsContainerPool.pop():[]},a.putActiveChangedTempList=function(r){r.length=0,this._componentsContainerPool.push(r)},t}();nf._tempVector0=new C;nf._tempVector1=new C;var J1=function(){function t(){}return t.cloneComponent=function(i,r){for(var e=ur.getCloneMode(i.constructor),n=Object.keys(i),o=0,s=n.length;o<s;o++){var l=n[o],u=e[l];switch(u){case void 0:case Zr.Assignment:r[l]=i[l];break;case Zr.Shallow:var c=i[l];if(c instanceof Object){var f=r[l];f==null&&(f=r[l]=c.constructor()),Co(f,c)}else r[l]=c;break;case Zr.Deep:var h=i[l];if(h instanceof Object){var d=r[l];d==null&&(d=r[l]=h.constructor()),ur.deepCloneObject(h,d)}else r[l]=h;break}}i._cloneTo&&i._cloneTo(r)},t}(),Ao=function(){t._register=function(i,r){this._addDependency(i,r,this._dependenciesMap),this._addDependency(r,i,this._invDependenciesMap)},t._addCheck=function(i,r){var e=t._dependenciesMap.get(r);if(e)for(var n=0,o=e.length;n<o;n++){var s=e[n];i.getComponent(s)||i.addComponent(s)}},t._removeCheck=function(i,r){var e=t._invDependenciesMap.get(r);if(e){for(var n=0,o=e.length;n<o;n++)if(i.getComponent(e[n]))throw"you should remove "+e[n]+" before adding "+r}},t._addDependency=function(i,r,e){var n=e.get(i);n||(n=[],e.set(i,n)),n.indexOf(r)===-1&&n.push(r)};function t(){}return t}();Ao._dependenciesMap=new Map;Ao._invDependenciesMap=new Map;function ko(){for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return function(r){a.forEach(function(e){return Ao._register(r,e)})}}var Ut;(function(t){t[t.Layer0=1]="Layer0",t[t.Layer1=2]="Layer1",t[t.Layer2=4]="Layer2",t[t.Layer3=8]="Layer3",t[t.Layer4=16]="Layer4",t[t.Layer5=32]="Layer5",t[t.Layer6=64]="Layer6",t[t.Layer7=128]="Layer7",t[t.Layer8=256]="Layer8",t[t.Layer9=512]="Layer9",t[t.Layer10=1024]="Layer10",t[t.Layer11=2048]="Layer11",t[t.Layer12=4096]="Layer12",t[t.Layer13=8192]="Layer13",t[t.Layer14=16384]="Layer14",t[t.Layer15=32768]="Layer15",t[t.Layer16=65536]="Layer16",t[t.Layer17=131072]="Layer17",t[t.Layer18=262144]="Layer18",t[t.Layer19=524288]="Layer19",t[t.Layer20=1048576]="Layer20",t[t.Layer21=2097152]="Layer21",t[t.Layer22=4194304]="Layer22",t[t.Layer23=8388608]="Layer23",t[t.Layer24=16777216]="Layer24",t[t.Layer25=33554432]="Layer25",t[t.Layer26=67108864]="Layer26",t[t.Layer27=134217728]="Layer27",t[t.Layer28=268435456]="Layer28",t[t.Layer29=536870912]="Layer29",t[t.Layer30=1073741824]="Layer30",t[t.Layer31=2147483648]="Layer31",t[t.Everything=4294967295]="Everything",t[t.Nothing=0]="Nothing"})(Ut||(Ut={}));var k0=function(){function t(){this._flagManagers=[]}var a=t.prototype;return a.clearFromManagers=function(){this._removeFromManagers(),this._flagManagers.length=0},a.destroy=function(){this._removeFromManagers(),this._flagManagers=null},a._removeFromManagers=function(){for(var r=this._flagManagers,e=0,n=r.length;e<n;e++)G1(r[e]._updateFlags,this)},t}(),Uo=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.flag=!0,r}var i=a.prototype;return i.dispatch=function(){this.flag=!0},a}(k0),$n,$h,qh,Yh,Qh,Jh,hr=($n=function(t){q(a,t);function a(r){var e;return e=t.call(this,r.engine)||this,k(e,"_entity",$h,B(e)),k(e,"_awoken",qh,B(e)),k(e,"_destroyed",Yh,B(e)),k(e,"_phasedActive",Qh,B(e)),k(e,"_enabled",Jh,B(e)),e._entity=r,e}var i=a.prototype;return i.destroy=function(){this._destroyed||(this._entity._removeComponent(this),this._entity.isActiveInHierarchy&&this._enabled&&this._onDisable(),this._destroyed=!0,this._onDestroy())},i._onAwake=function(){},i._onEnable=function(){},i._onDisable=function(){},i._onDestroy=function(){},i._setActive=function(e){var n=this._entity;e?(!this._awoken&&n._isActiveInHierarchy&&(this._awoken=!0,this._onAwake()),!this._phasedActive&&n._isActiveInHierarchy&&this._enabled&&(this._phasedActive=!0,this._onEnable())):this._phasedActive&&!(n._isActiveInHierarchy&&this._enabled)&&(this._phasedActive=!1,this._onDisable())},Y(a,[{key:"enabled",get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,this._entity.isActiveInHierarchy&&(e?(this._phasedActive=!0,this._onEnable()):(this._phasedActive=!1,this._onDisable())))}},{key:"destroyed",get:function(){return this._destroyed}},{key:"entity",get:function(){return this._entity}},{key:"scene",get:function(){return this._entity.scene}}]),a}(ln),$h=U($n.prototype,"_entity",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qh=U($n.prototype,"_awoken",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yh=U($n.prototype,"_destroyed",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qh=U($n.prototype,"_phasedActive",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Jh=U($n.prototype,"_enabled",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$n),vl=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.listener=void 0,r}var i=a.prototype;return i.dispatch=function(e){this.listener&&this.listener(e)},a}(k0),fa=function(){function t(){this._updateFlags=[]}var a=t.prototype;return a.createFlag=function(r){var e=new r;return this.addFlag(e),e},a.addFlag=function(r){this._updateFlags.push(r),r._flagManagers.push(this)},a.dispatch=function(r){for(var e=this._updateFlags,n=e.length-1;n>=0;n--)e[n].dispatch(r)},t}(),Et,Kh,Zh,ed,td,rd,nd,id,ad,od,sd,ld,ud,cd,_r,Yt=(Et=(_r=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,k(e,"_position",Kh,B(e)),k(e,"_rotation",Zh,B(e)),k(e,"_rotationQuaternion",ed,B(e)),k(e,"_scale",td,B(e)),k(e,"_worldPosition",rd,B(e)),k(e,"_worldRotation",nd,B(e)),k(e,"_worldRotationQuaternion",id,B(e)),k(e,"_lossyWorldScale",ad,B(e)),k(e,"_localMatrix",od,B(e)),k(e,"_worldMatrix",sd,B(e)),k(e,"_updateFlagManager",ld,B(e)),k(e,"_isParentDirty",ud,B(e)),k(e,"_parentTransformCache",cd,B(e)),e._dirtyFlag=ue.WmWpWeWqWs,e._onPositionChanged=e._onPositionChanged.bind(B(e)),e._onWorldPositionChanged=e._onWorldPositionChanged.bind(B(e)),e._onRotationChanged=e._onRotationChanged.bind(B(e)),e._onWorldRotationChanged=e._onWorldRotationChanged.bind(B(e)),e._onRotationQuaternionChanged=e._onRotationQuaternionChanged.bind(B(e)),e._onWorldRotationQuaternionChanged=e._onWorldRotationQuaternionChanged.bind(B(e)),e._onScaleChanged=e._onScaleChanged.bind(B(e)),e._position._onValueChanged=e._onPositionChanged,e._worldPosition._onValueChanged=e._onWorldPositionChanged,e._rotation._onValueChanged=e._onRotationChanged,e._worldRotation._onValueChanged=e._onWorldRotationChanged,e._rotationQuaternion._onValueChanged=e._onRotationQuaternionChanged,e._worldRotationQuaternion._onValueChanged=e._onWorldRotationQuaternionChanged,e._scale._onValueChanged=e._onScaleChanged,e}var i=a.prototype;return i.setPosition=function(e,n,o){this._position.set(e,n,o)},i.setRotation=function(e,n,o){this._rotation.set(e,n,o)},i.setRotationQuaternion=function(e,n,o,s){this._rotationQuaternion.set(e,n,o,s)},i.setScale=function(e,n,o){this._scale.set(e,n,o)},i.setWorldPosition=function(e,n,o){this._worldPosition.set(e,n,o)},i.setWorldRotation=function(e,n,o){this._worldRotation.set(e,n,o)},i.setWorldRotationQuaternion=function(e,n,o,s){this._worldRotationQuaternion.set(e,n,o,s)},i.getWorldForward=function(e){var n=this.worldMatrix.elements;return e.set(-n[8],-n[9],-n[10]),e.normalize()},i.getWorldRight=function(e){var n=this.worldMatrix.elements;return e.set(n[0],n[1],n[2]),e.normalize()},i.getWorldUp=function(e){var n=this.worldMatrix.elements;return e.set(n[4],n[5],n[6]),e.normalize()},i.translate=function(e,n,o,s){if(typeof e=="number"){var l=a._tempVec30;l.set(e,n,o),this._translate(l,s)}else this._translate(e,n)},i.rotate=function(e,n,o,s){typeof e=="number"?this._rotateXYZ(e,n,o,s):this._rotateXYZ(e.x,e.y,e.z,n)},i.rotateByAxis=function(e,n,o){o===void 0&&(o=!0);var s=n*W.degreeToRadFactor;we.rotationAxisAngle(e,s,a._tempQuat0),this._rotateByQuat(a._tempQuat0,o)},i.lookAt=function(e,n){var o=a._tempVec30;C.subtract(this.worldPosition,e,o);var s=o.length();if(!(s<=W.zeroTolerance)){o.scale(1/s);var l=a._tempVec31;if(n?C.cross(n,o,l):l.set(o.z,0,-o.x),s=l.length(),!(s<=W.zeroTolerance)){l.scale(1/s);var u=a._tempVec32;C.cross(o,l,u);var c=a._tempMat41,f=c.elements;f[0]=l.x,f[1]=l.y,f[2]=l.z,f[4]=u.x,f[5]=u.y,f[6]=u.z,f[8]=o.x,f[9]=o.y,f[10]=o.z,c.getRotation(this._worldRotationQuaternion)}}},i.registerWorldChangeFlag=function(){return this._updateFlagManager.createFlag(Uo)},i._registerWorldChangeListener=function(){return this._updateFlagManager.createFlag(vl)},i._parentChange=function(){this._isParentDirty=!0,this._updateAllWorldFlag()},i._isFrontFaceInvert=function(){var e=this.lossyWorldScale,n=e.x<0;return e.y<0&&(n=!n),e.z<0&&(n=!n),n},i._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(ue.WmWp)){this._worldAssociatedChange(ue.WmWp);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionFlag()}}},i._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(ue.WmWeWq)){this._worldAssociatedChange(ue.WmWeWq);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndRotationFlag()}}},i._updateWorldPositionAndRotationFlag=function(){if(!this._isContainDirtyFlags(ue.WmWpWeWq)){this._worldAssociatedChange(ue.WmWpWeWq);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndRotationFlag()}}},i._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(ue.WmWs)){this._worldAssociatedChange(ue.WmWs);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndScaleFlag()}}},i._updateWorldPositionAndScaleFlag=function(){if(!this._isContainDirtyFlags(ue.WmWpWs)){this._worldAssociatedChange(ue.WmWpWs);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateWorldPositionAndScaleFlag()}}},i._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(ue.WmWpWeWqWs)){this._worldAssociatedChange(ue.WmWpWeWqWs);for(var e=this._entity._children,n=0,o=e.length;n<o;n++){var s;(s=e[n].transform)===null||s===void 0||s._updateAllWorldFlag()}}},i._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;for(var e=null,n=this._entity.parent;n;){var o=n.transform;if(o){e=o;break}else n=n.parent}return this._parentTransformCache=e,this._isParentDirty=!1,e},i._getScaleMatrix=function(){var e=a._tempQuat0,n=a._tempMat30,o=a._tempMat31,s=a._tempMat32;return o.copyFromMatrix(this.worldMatrix),we.invert(this.worldRotationQuaternion,e),ki.rotationQuaternion(e,n),ki.multiply(n,o,s),s},i._isContainDirtyFlags=function(e){return(this._dirtyFlag&e)===e},i._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},i._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},i._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},i._worldAssociatedChange=function(e){this._dirtyFlag|=e,this._updateFlagManager.dispatch()},i._rotateByQuat=function(e,n){n?we.multiply(this.rotationQuaternion,e,this._rotationQuaternion):we.multiply(e,this.worldRotationQuaternion,this._worldRotationQuaternion)},i._translate=function(e,n){if(n===void 0&&(n=!0),n){var o=a._tempVec30;C.transformByQuat(e,this.worldRotationQuaternion,o),this._worldPosition.add(o)}else this._worldPosition.add(e)},i._rotateXYZ=function(e,n,o,s){s===void 0&&(s=!0);var l=W.degreeToRadFactor,u=a._tempQuat0;we.rotationEuler(e*l,n*l,o*l,u),this._rotateByQuat(u,s)},i._onPositionChanged=function(){this._setDirtyFlagTrue(ue.LocalMatrix),this._updateWorldPositionFlag()},i._onWorldPositionChanged=function(){var e=this._worldPosition,n=this._getParentTransform();n?(re.invert(n.worldMatrix,a._tempMat41),C.transformCoordinate(e,a._tempMat41,this._position)):this._position.copyFrom(e),this._setDirtyFlagFalse(ue.WorldPosition)},i._onRotationChanged=function(){this._setDirtyFlagTrue(ue.LocalMatrix|ue.LocalQuat),this._setDirtyFlagFalse(ue.LocalEuler),this._updateWorldRotationFlag()},i._onWorldRotationChanged=function(){var e=this._worldRotation;we.rotationEuler(W.degreeToRadian(e.x),W.degreeToRadian(e.y),W.degreeToRadian(e.z),this._worldRotationQuaternion),this._setDirtyFlagFalse(ue.WorldEuler)},i._onRotationQuaternionChanged=function(){this._setDirtyFlagTrue(ue.LocalMatrix|ue.LocalEuler),this._setDirtyFlagFalse(ue.LocalQuat),this._updateWorldRotationFlag()},i._onWorldRotationQuaternionChanged=function(){var e=this._worldRotationQuaternion,n=this._getParentTransform();if(n){var o=a._tempQuat0;we.invert(n.worldRotationQuaternion,o),we.multiply(o,e,this._rotationQuaternion)}else this._rotationQuaternion.copyFrom(e);this._setDirtyFlagFalse(ue.WorldQuat)},i._onScaleChanged=function(){this._setDirtyFlagTrue(ue.LocalMatrix),this._updateWorldScaleFlag()},Y(a,[{key:"position",get:function(){return this._position},set:function(e){this._position!==e&&this._position.copyFrom(e)}},{key:"worldPosition",get:function(){var e=this._worldPosition;return this._isContainDirtyFlag(ue.WorldPosition)&&(e._onValueChanged=null,this._getParentTransform()?this.worldMatrix.getTranslation(e):e.copyFrom(this._position),e._onValueChanged=this._onWorldPositionChanged,this._setDirtyFlagFalse(ue.WorldPosition)),e},set:function(e){this._worldPosition!==e&&this._worldPosition.copyFrom(e)}},{key:"rotation",get:function(){var e=this._rotation;return this._isContainDirtyFlag(ue.LocalEuler)&&(e._onValueChanged=null,this._rotationQuaternion.toEuler(e),e._onValueChanged=this._onRotationChanged,e.scale(W.radToDegreeFactor),this._setDirtyFlagFalse(ue.LocalEuler)),e},set:function(e){this._rotation!==e&&this._rotation.copyFrom(e)}},{key:"worldRotation",get:function(){var e=this._worldRotation;return this._isContainDirtyFlag(ue.WorldEuler)&&(e._onValueChanged=null,this.worldRotationQuaternion.toEuler(e),e.scale(W.radToDegreeFactor),e._onValueChanged=this._onWorldRotationChanged,this._setDirtyFlagFalse(ue.WorldEuler)),e},set:function(e){this._worldRotation!==e&&this._worldRotation.copyFrom(e)}},{key:"rotationQuaternion",get:function(){var e=this._rotationQuaternion;return this._isContainDirtyFlag(ue.LocalQuat)&&(e._onValueChanged=null,we.rotationEuler(W.degreeToRadian(this._rotation.x),W.degreeToRadian(this._rotation.y),W.degreeToRadian(this._rotation.z),e),e._onValueChanged=this._onRotationQuaternionChanged,this._setDirtyFlagFalse(ue.LocalQuat)),e},set:function(e){this._rotationQuaternion!==e?e.normalized?this._rotationQuaternion.copyFrom(e):we.normalize(e,this._rotationQuaternion):e.normalized||e.normalize()}},{key:"worldRotationQuaternion",get:function(){var e=this._worldRotationQuaternion;if(this._isContainDirtyFlag(ue.WorldQuat)){e._onValueChanged=null;var n=this._getParentTransform();n!=null?we.multiply(n.worldRotationQuaternion,this.rotationQuaternion,e):e.copyFrom(this.rotationQuaternion),e._onValueChanged=this._onWorldRotationQuaternionChanged,this._setDirtyFlagFalse(ue.WorldQuat)}return e},set:function(e){this._worldRotationQuaternion!==e&&(e.normalized?this._worldRotationQuaternion.copyFrom(e):we.normalize(e,this._worldRotationQuaternion)),e.normalized||e.normalize()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&this._scale.copyFrom(e)}},{key:"lossyWorldScale",get:function(){if(this._isContainDirtyFlag(ue.WorldScale)){if(this._getParentTransform()){var e=this._getScaleMatrix(),n=e.elements;this._lossyWorldScale.set(n[0],n[4],n[8])}else this._lossyWorldScale.copyFrom(this._scale);this._setDirtyFlagFalse(ue.WorldScale)}return this._lossyWorldScale}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(ue.LocalMatrix)&&(re.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(ue.LocalMatrix)),this._localMatrix},set:function(e){this._localMatrix!==e&&this._localMatrix.copyFrom(e),this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._setDirtyFlagTrue(ue.LocalEuler),this._setDirtyFlagFalse(ue.LocalMatrix),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(ue.WorldMatrix)){var e=this._getParentTransform();e?re.multiply(e.worldMatrix,this.localMatrix,this._worldMatrix):this._worldMatrix.copyFrom(this.localMatrix),this._setDirtyFlagFalse(ue.WorldMatrix)}return this._worldMatrix},set:function(e){this._worldMatrix!==e&&this._worldMatrix.copyFrom(e);var n=this._getParentTransform();n?(re.invert(n.worldMatrix,a._tempMat42),re.multiply(a._tempMat42,e,this._localMatrix)):this._localMatrix.copyFrom(e),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(ue.WorldMatrix)}}]),a}(hr),_r._tempQuat0=new we,_r._tempVec30=new C,_r._tempVec31=new C,_r._tempVec32=new C,_r._tempMat30=new ki,_r._tempMat31=new ki,_r._tempMat32=new ki,_r._tempMat41=new re,_r._tempMat42=new re,_r),Kh=U(Et.prototype,"_position",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C}}),Zh=U(Et.prototype,"_rotation",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C}}),ed=U(Et.prototype,"_rotationQuaternion",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new we}}),td=U(Et.prototype,"_scale",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C(1,1,1)}}),rd=U(Et.prototype,"_worldPosition",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C}}),nd=U(Et.prototype,"_worldRotation",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C}}),id=U(Et.prototype,"_worldRotationQuaternion",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new we}}),ad=U(Et.prototype,"_lossyWorldScale",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C(1,1,1)}}),od=U(Et.prototype,"_localMatrix",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),sd=U(Et.prototype,"_worldMatrix",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),ld=U(Et.prototype,"_updateFlagManager",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fa}}),ud=U(Et.prototype,"_isParentDirty",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),cd=U(Et.prototype,"_parentTransformCache",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Et),ue;(function(t){t[t.LocalEuler=1]="LocalEuler",t[t.LocalQuat=2]="LocalQuat",t[t.WorldPosition=4]="WorldPosition",t[t.WorldEuler=8]="WorldEuler",t[t.WorldQuat=16]="WorldQuat",t[t.WorldScale=32]="WorldScale",t[t.LocalMatrix=64]="LocalMatrix",t[t.WorldMatrix=128]="WorldMatrix",t[t.WmWp=132]="WmWp",t[t.WmWeWq=152]="WmWeWq",t[t.WmWpWeWq=156]="WmWpWeWq",t[t.WmWs=160]="WmWs",t[t.WmWpWs=164]="WmWpWs",t[t.WmWpWeWqWs=188]="WmWpWeWqWs"})(ue||(ue={}));var Qr=function(t){q(a,t),a._findChildByName=function(e,n){for(var o=e._children,s=o.length-1;s>=0;s--){var l=o[s];if(l.name===n)return l}return null},a._traverseSetOwnerScene=function(e,n){e._scene=n;for(var o=e._children,s=e.childCount-1;s>=0;s--)this._traverseSetOwnerScene(o[s],n)};function a(r,e){var n;return n=t.call(this,r)||this,n.name=void 0,n.layer=Ut.Layer0,n.transform=void 0,n._isActiveInHierarchy=!1,n._components=[],n._scripts=new Bt,n._children=[],n._scene=void 0,n._isRoot=!1,n._isActive=!0,n._siblingIndex=-1,n._parent=null,n._activeChangedComponents=void 0,n._invModelMatrix=new re,n._inverseWorldMatFlag=void 0,n.name=e,n.transform=n.addComponent(Yt),n._inverseWorldMatFlag=n.transform.registerWorldChangeFlag(),n}var i=a.prototype;return i.addComponent=function(e){Ao._addCheck(this,e);var n=new e(this);return this._components.push(n),n._setActive(!0),n},i.getComponent=function(e){for(var n=this._components.length-1;n>=0;n--){var o=this._components[n];if(o instanceof e)return o}},i.getComponents=function(e,n){n.length=0;for(var o=this._components.length-1;o>=0;o--){var s=this._components[o];s instanceof e&&n.push(s)}return n},i.getComponentsIncludeChildren=function(e,n){return n.length=0,this._getComponentsInChildren(e,n),n},i.addChild=function(e,n){var o;if(typeof e=="number"?o=e:(o=void 0,n=e),n._isRoot){n._scene._removeFromEntityList(n),n._isRoot=!1,this._addToChildrenList(o,n),n._parent=this;var s=this._scene;n._scene!==s&&a._traverseSetOwnerScene(n,s),this._isActiveInHierarchy?!n._isActiveInHierarchy&&n._isActive&&n._processActive():n._isActiveInHierarchy&&n._processInActive(),n._setTransformDirty()}else n._setParent(this,o)},i.removeChild=function(e){e._setParent(null)},i.getChild=function(e){return this._children[e]},i.findByName=function(e){var n=this._children,o=a._findChildByName(this,e);if(o)return o;for(var s=n.length-1;s>=0;s--){var l=n[s],u=l.findByName(e);if(u)return u}return null},i.findByPath=function(e){for(var n=e.split("/"),o=this,s=0,l=n.length;s<l;++s){var u=n[s];if(u&&(o=a._findChildByName(o,u),!o))return null}return o},i.createChild=function(e){var n=new a(this.engine,e);return n.layer=this.layer,n.parent=this,n},i.clearChildren=function(){for(var e=this._children,n=e.length-1;n>=0;n--){var o=e[n];o._parent=null,o._isActiveInHierarchy&&o._processInActive(),a._traverseSetOwnerScene(o,null)}e.length=0},i.clone=function(){var e=new a(this._engine,this.name);e._isActive=this._isActive,e.transform.localMatrix=this.transform.localMatrix;for(var n=this._children,o=0,s=this._children.length;o<s;o++){var l=n[o];e.addChild(l.clone())}for(var u=this._components,c=0,f=u.length;c<f;c++){var h=u[c];if(!(h instanceof Yt)){var d=e.addComponent(h.constructor);J1.cloneComponent(h,d)}}return e},i.destroy=function(){if(!this._destroyed){t.prototype.destroy.call(this);for(var e=this._components,n=e.length-1;n>=0;n--)e[n].destroy();this._components.length=0;for(var o=this._children,s=o.length-1;s>=0;s--)o[s].destroy();this._children.length=0,this._isRoot?(this._scene._removeFromEntityList(this),this._isRoot=!1):this._removeFromParent()}},i._removeComponent=function(e){Ao._removeCheck(this,e.constructor);var n=this._components;n.splice(n.indexOf(e),1)},i._addScript=function(e){e._entityScriptsIndex=this._scripts.length,this._scripts.add(e)},i._removeScript=function(e){var n=this._scripts.deleteByIndex(e._entityScriptsIndex);n&&(n._entityScriptsIndex=e._entityScriptsIndex),e._entityScriptsIndex=-1},i._removeFromParent=function(){var e=this._parent;if(e!=null){var n=e._children,o=this._siblingIndex;n.splice(o,1);for(var s=n.length;o<s;o++)n[o]._siblingIndex--;this._parent=null,this._siblingIndex=-1}},i._processActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main inActive entity' active in hierarchy, if the operation is in main inActive entity or it's children script's onDisable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!0)},i._processInActive=function(){if(this._activeChangedComponents)throw"Note: can't set the 'main active entity' inActive in hierarchy, if the operation is in main active entity or it's children script's onEnable Event.";this._activeChangedComponents=this._engine._componentsManager.getActiveChangedTempList(),this._setInActiveInHierarchy(this._activeChangedComponents),this._setActiveComponents(!1)},i._addToChildrenList=function(e,n){var o=this._children,s=o.length;if(e===void 0)n._siblingIndex=s,o.push(n);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;n._siblingIndex=e,o.splice(e,0,n);for(var l=e+1,u=s+1;l<u;l++)o[l]._siblingIndex++}},i._setParent=function(e,n){var o=this._parent;if(e!==o){if(this._removeFromParent(),this._parent=e,e){e._addToChildrenList(n,this);var s=e._scene;this._scene!==s&&a._traverseSetOwnerScene(this,s),e._isActiveInHierarchy?!this._isActiveInHierarchy&&this._isActive&&this._processActive():this._isActiveInHierarchy&&this._processInActive()}else this._isActiveInHierarchy&&this._processInActive(),o&&a._traverseSetOwnerScene(this,null);this._setTransformDirty()}},i._getComponentsInChildren=function(e,n){for(var o=this._components.length-1;o>=0;o--){var s=this._components[o];s instanceof e&&n.push(s)}for(var l=this._children.length-1;l>=0;l--)this._children[l]._getComponentsInChildren(e,n)},i._setActiveComponents=function(e){for(var n=this._activeChangedComponents,o=0,s=n.length;o<s;++o)n[o]._setActive(e);this._engine._componentsManager.putActiveChangedTempList(n),this._activeChangedComponents=null},i._setActiveInHierarchy=function(e){this._isActiveInHierarchy=!0;for(var n=this._components,o=n.length-1;o>=0;o--){var s=n[o];(s.enabled||!s._awoken)&&e.push(s)}for(var l=this._children,u=l.length-1;u>=0;u--){var c=l[u];c.isActive&&c._setActiveInHierarchy(e)}},i._setInActiveInHierarchy=function(e){this._isActiveInHierarchy=!1;for(var n=this._components,o=n.length-1;o>=0;o--){var s=n[o];s.enabled&&e.push(s)}for(var l=this._children,u=l.length-1;u>=0;u--){var c=l[u];c.isActive&&c._setInActiveInHierarchy(e)}},i._setTransformDirty=function(){if(this.transform)this.transform._parentChange();else for(var e=0,n=this._children.length;e<n;e++)this._children[e]._setTransformDirty()},i._setSiblingIndex=function(e,n){if(n=Math.min(n,e.length-1),n<0)throw"Sibling index "+n+" should large than 0";if(this._siblingIndex!==n){var o=this._siblingIndex;if(n<o)for(var s=o;s>=n;s--){var l=s==n?this:e[s-1];e[s]=l,l._siblingIndex=s}else for(var u=o;u<=n;u++){var c=u==n?this:e[u+1];e[u]=c,c._siblingIndex=u}}},i.getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&(re.invert(this.transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},Y(a,[{key:"isActive",get:function(){return this._isActive},set:function(e){if(e!==this._isActive)if(this._isActive=e,e){var n=this._parent;(n!=null&&n._isActiveInHierarchy||this._isRoot&&this._scene._isActiveInEngine)&&this._processActive()}else this._isActiveInHierarchy&&this._processInActive()}},{key:"isActiveInHierarchy",get:function(){return this._isActiveInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this._setParent(e)}},{key:"children",get:function(){return this._children}},{key:"childCount",get:function(){return this._children.length}},{key:"scene",get:function(){return this._scene}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(e){if(this._siblingIndex===-1)throw"The entity "+this.name+" is not in the hierarchy";this._setSiblingIndex(this._isRoot?this._scene._rootEntities:this._parent._children,e)}}]),a}(ln),U0=function(){function t(){this._features=[],this._objects=[]}var a=t.prototype;return a.registerFeature=function(r){for(var e=this._features,n=0,o=e.length;n<o;n++)if(e[n]===r)return;e.push(r);for(var s=this._objects,l=0,u=s.length;l<u;l++)s[l].features.push(new r)},a.addObject=function(r){r.features=[];for(var e=0,n=this._features.length;e<n;e++){var o;r.features.push(new this._features[e]((o=r.engine)!=null?o:r))}this._objects.push(r)},a.callFeatureMethod=function(r,e,n){for(var o=r.features,s=o.length,l=0;l<s;l++){var u=o[l];u[e]&&u[e].apply(u,n)}},a.findFeature=function(r,e){for(var n=r.features,o=n.length,s=0;s<o;s++){var l=n[s];if(l.constructor===e)return l}},t}(),tr;(function(t){t[t.Backquote=0]="Backquote",t[t.Backslash=1]="Backslash",t[t.Backspace=2]="Backspace",t[t.BracketLeft=3]="BracketLeft",t[t.BracketRight=4]="BracketRight",t[t.Comma=5]="Comma",t[t.Digit0=6]="Digit0",t[t.Digit1=7]="Digit1",t[t.Digit2=8]="Digit2",t[t.Digit3=9]="Digit3",t[t.Digit4=10]="Digit4",t[t.Digit5=11]="Digit5",t[t.Digit6=12]="Digit6",t[t.Digit7=13]="Digit7",t[t.Digit8=14]="Digit8",t[t.Digit9=15]="Digit9",t[t.Equal=16]="Equal",t[t.IntlBackslash=17]="IntlBackslash",t[t.IntlRo=18]="IntlRo",t[t.IntlYen=19]="IntlYen",t[t.KeyA=20]="KeyA",t[t.KeyB=21]="KeyB",t[t.KeyC=22]="KeyC",t[t.KeyD=23]="KeyD",t[t.KeyE=24]="KeyE",t[t.KeyF=25]="KeyF",t[t.KeyG=26]="KeyG",t[t.KeyH=27]="KeyH",t[t.KeyI=28]="KeyI",t[t.KeyJ=29]="KeyJ",t[t.KeyK=30]="KeyK",t[t.KeyL=31]="KeyL",t[t.KeyM=32]="KeyM",t[t.KeyN=33]="KeyN",t[t.KeyO=34]="KeyO",t[t.KeyP=35]="KeyP",t[t.KeyQ=36]="KeyQ",t[t.KeyR=37]="KeyR",t[t.KeyS=38]="KeyS",t[t.KeyT=39]="KeyT",t[t.KeyU=40]="KeyU",t[t.KeyV=41]="KeyV",t[t.KeyW=42]="KeyW",t[t.KeyX=43]="KeyX",t[t.KeyY=44]="KeyY",t[t.KeyZ=45]="KeyZ",t[t.Minus=46]="Minus",t[t.Period=47]="Period",t[t.Quote=48]="Quote",t[t.Semicolon=49]="Semicolon",t[t.Slash=50]="Slash",t[t.AltLeft=51]="AltLeft",t[t.AltRight=52]="AltRight",t[t.CapsLock=53]="CapsLock",t[t.ContextMenu=54]="ContextMenu",t[t.ControlLeft=55]="ControlLeft",t[t.ControlRight=56]="ControlRight",t[t.Enter=57]="Enter",t[t.MetaLeft=58]="MetaLeft",t[t.MetaRight=59]="MetaRight",t[t.ShiftLeft=60]="ShiftLeft",t[t.ShiftRight=61]="ShiftRight",t[t.Space=62]="Space",t[t.Tab=63]="Tab",t[t.Convert=64]="Convert",t[t.KanaMode=65]="KanaMode",t[t.Lang1=66]="Lang1",t[t.Lang2=67]="Lang2",t[t.Lang3=68]="Lang3",t[t.Lang4=69]="Lang4",t[t.Lang5=70]="Lang5",t[t.NonConvert=71]="NonConvert",t[t.Delete=72]="Delete",t[t.End=73]="End",t[t.Help=74]="Help",t[t.Home=75]="Home",t[t.Insert=76]="Insert",t[t.PageDown=77]="PageDown",t[t.PageUp=78]="PageUp",t[t.ArrowDown=79]="ArrowDown",t[t.ArrowLeft=80]="ArrowLeft",t[t.ArrowRight=81]="ArrowRight",t[t.ArrowUp=82]="ArrowUp",t[t.NumLock=83]="NumLock",t[t.Numpad0=84]="Numpad0",t[t.Numpad1=85]="Numpad1",t[t.Numpad2=86]="Numpad2",t[t.Numpad3=87]="Numpad3",t[t.Numpad4=88]="Numpad4",t[t.Numpad5=89]="Numpad5",t[t.Numpad6=90]="Numpad6",t[t.Numpad7=91]="Numpad7",t[t.Numpad8=92]="Numpad8",t[t.Numpad9=93]="Numpad9",t[t.NumpadAdd=94]="NumpadAdd",t[t.NumpadBackspace=95]="NumpadBackspace",t[t.NumpadClear=96]="NumpadClear",t[t.NumpadClearEntry=97]="NumpadClearEntry",t[t.NumpadComma=98]="NumpadComma",t[t.NumpadDecimal=99]="NumpadDecimal",t[t.NumpadDivide=100]="NumpadDivide",t[t.NumpadEnter=101]="NumpadEnter",t[t.NumpadEqual=102]="NumpadEqual",t[t.NumpadHash=103]="NumpadHash",t[t.NumpadMemoryAdd=104]="NumpadMemoryAdd",t[t.NumpadMemoryClear=105]="NumpadMemoryClear",t[t.NumpadMemoryRecall=106]="NumpadMemoryRecall",t[t.NumpadMemoryStore=107]="NumpadMemoryStore",t[t.NumpadMemorySubtract=108]="NumpadMemorySubtract",t[t.NumpadMultiply=109]="NumpadMultiply",t[t.NumpadParenLeft=110]="NumpadParenLeft",t[t.NumpadParenRight=111]="NumpadParenRight",t[t.NumpadStar=112]="NumpadStar",t[t.NumpadSubtract=113]="NumpadSubtract",t[t.Escape=114]="Escape",t[t.F1=115]="F1",t[t.F2=116]="F2",t[t.F3=117]="F3",t[t.F4=118]="F4",t[t.F5=119]="F5",t[t.F6=120]="F6",t[t.F7=121]="F7",t[t.F8=122]="F8",t[t.F9=123]="F9",t[t.F10=124]="F10",t[t.F11=125]="F11",t[t.F12=126]="F12",t[t.F13=127]="F13",t[t.F14=128]="F14",t[t.F15=129]="F15",t[t.Fn=130]="Fn",t[t.FnLock=131]="FnLock",t[t.PrintScreen=132]="PrintScreen",t[t.ScrollLock=133]="ScrollLock",t[t.Pause=134]="Pause",t[t.BrowserBack=135]="BrowserBack",t[t.BrowserFavorites=136]="BrowserFavorites",t[t.BrowserForward=137]="BrowserForward",t[t.BrowserHome=138]="BrowserHome",t[t.BrowserRefresh=139]="BrowserRefresh",t[t.BrowserSearch=140]="BrowserSearch",t[t.BrowserStop=141]="BrowserStop",t[t.Eject=142]="Eject",t[t.LaunchApp1=143]="LaunchApp1",t[t.LaunchApp2=144]="LaunchApp2",t[t.LaunchMail=145]="LaunchMail",t[t.MediaPlayPause=146]="MediaPlayPause",t[t.MediaSelect=147]="MediaSelect",t[t.MediaStop=148]="MediaStop",t[t.MediaTrackNext=149]="MediaTrackNext",t[t.MediaTrackPrevious=150]="MediaTrackPrevious",t[t.Power=151]="Power",t[t.Sleep=152]="Sleep",t[t.AudioVolumeDown=153]="AudioVolumeDown",t[t.AudioVolumeMute=154]="AudioVolumeMute",t[t.AudioVolumeUp=155]="AudioVolumeUp",t[t.WakeUp=156]="WakeUp",t[t.Hyper=157]="Hyper",t[t.Super=158]="Super",t[t.Turbo=159]="Turbo",t[t.Abort=160]="Abort",t[t.Resume=161]="Resume",t[t.Suspend=162]="Suspend",t[t.Again=163]="Again",t[t.Copy=164]="Copy",t[t.Cut=165]="Cut",t[t.Find=166]="Find",t[t.Open=167]="Open",t[t.Paste=168]="Paste",t[t.Props=169]="Props",t[t.Select=170]="Select",t[t.Undo=171]="Undo",t[t.Hiragana=172]="Hiragana",t[t.Katakana=173]="Katakana",t[t.Unidentified=174]="Unidentified"})(tr||(tr={}));var K1=function(){function t(i){this._curHeldDownKeyToIndexMap=[],this._upKeyToFrameCountMap=[],this._downKeyToFrameCountMap=[],this._curFrameHeldDownList=new Bt,this._curFrameDownList=new Bt,this._curFrameUpList=new Bt,this._htmlCanvas=void 0,this._nativeEvents=[],this._hadListener=!1,this._htmlCanvas=i,i.tabIndex=i.tabIndex,this._onKeyEvent=this._onKeyEvent.bind(this),i.addEventListener("keydown",this._onKeyEvent),i.addEventListener("keyup",this._onKeyEvent),this._hadListener=!0}var a=t.prototype;return a._update=function(r){var e=this._nativeEvents,n=this._curFrameDownList,o=this._curFrameUpList;if(n.length=0,o.length=0,e.length>0){for(var s=this._curHeldDownKeyToIndexMap,l=this._curFrameHeldDownList,u=this._downKeyToFrameCountMap,c=this._upKeyToFrameCountMap,f=0,h=e.length;f<h;f++){var d=e[f],_=tr[d.code];switch(d.type){case"keydown":s[_]==null&&(n.add(_),l.add(_),s[_]=l.length-1,u[_]=r);break;case"keyup":var m=s[_];if(m!=null){s[_]=null;var p=l.deleteByIndex(m);p&&(s[p]=m)}o.add(_),c[_]=r;break}}e.length=0}},a._onFocus=function(){this._hadListener||(this._htmlCanvas.addEventListener("keydown",this._onKeyEvent),this._htmlCanvas.addEventListener("keyup",this._onKeyEvent),this._hadListener=!0)},a._onBlur=function(){this._hadListener&&(this._htmlCanvas.removeEventListener("keydown",this._onKeyEvent),this._htmlCanvas.removeEventListener("keyup",this._onKeyEvent),this._curHeldDownKeyToIndexMap.length=0,this._curFrameHeldDownList.length=0,this._curFrameDownList.length=0,this._curFrameUpList.length=0,this._nativeEvents.length=0,this._hadListener=!1)},a._destroy=function(){this._hadListener&&(this._htmlCanvas.removeEventListener("keydown",this._onKeyEvent),this._htmlCanvas.removeEventListener("keyup",this._onKeyEvent),this._hadListener=!1),this._curHeldDownKeyToIndexMap=null,this._upKeyToFrameCountMap=null,this._downKeyToFrameCountMap=null,this._nativeEvents=null,this._curFrameHeldDownList=null,this._curFrameDownList=null,this._curFrameUpList=null},a._onKeyEvent=function(r){r.cancelable&&r.preventDefault(),this._nativeEvents.push(r)},t}(),Tr;(function(t){t[t.None=0]="None",t[t.Color=1]="Color",t[t.Depth=2]="Depth",t[t.Stencil=4]="Stencil",t[t.ColorDepth=3]="ColorDepth",t[t.ColorStencil=5]="ColorStencil",t[t.DepthStencil=6]="DepthStencil",t[t.All=7]="All"})(Tr||(Tr={}));var V0=function(){this.entity=null,this.distance=0,this.point=new C,this.normal=new C},jt=function(){function t(i){var r=this;this._initialized=!1,this._engine=void 0,this._restTime=0,this._colliders=new Bt,this._gravity=new C(0,-9.81,0),this._nativePhysicsManager=void 0,this._physicalObjectsMap={},this._onContactEnter=function(e,n){for(var o=r._physicalObjectsMap[e],s=r._physicalObjectsMap[n],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var f=l.get(u);f._waitHandlingInValid||f.onCollisionEnter(s)}l=s.collider.entity._scripts;for(var h=0,d=l.length;h<d;h++){var _=l.get(h);_._waitHandlingInValid||_.onCollisionEnter(o)}},this._onContactExit=function(e,n){for(var o=r._physicalObjectsMap[e],s=r._physicalObjectsMap[n],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var f=l.get(u);f._waitHandlingInValid||f.onCollisionExit(s)}l=s.collider.entity._scripts;for(var h=0,d=l.length;h<d;h++){var _=l.get(h);_._waitHandlingInValid||_.onCollisionExit(o)}},this._onContactStay=function(e,n){for(var o=r._physicalObjectsMap[e],s=r._physicalObjectsMap[n],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var f=l.get(u);f._waitHandlingInValid||f.onCollisionStay(s)}l=s.collider.entity._scripts;for(var h=0,d=l.length;h<d;h++){var _=l.get(h);_._waitHandlingInValid||_.onCollisionStay(o)}},this._onTriggerEnter=function(e,n){for(var o=r._physicalObjectsMap[e],s=r._physicalObjectsMap[n],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var f=l.get(u);f._waitHandlingInValid||f.onTriggerEnter(s)}l=s.collider.entity._scripts;for(var h=0,d=l.length;h<d;h++){var _=l.get(h);_._waitHandlingInValid||_.onTriggerEnter(o)}},this._onTriggerExit=function(e,n){for(var o=r._physicalObjectsMap[e],s=r._physicalObjectsMap[n],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var f=l.get(u);f._waitHandlingInValid||f.onTriggerExit(s)}l=s.collider.entity._scripts;for(var h=0,d=l.length;h<d;h++){var _=l.get(h);_._waitHandlingInValid||_.onTriggerExit(o)}},this._onTriggerStay=function(e,n){for(var o=r._physicalObjectsMap[e],s=r._physicalObjectsMap[n],l=o.collider.entity._scripts,u=0,c=l.length;u<c;u++){var f=l.get(u);f._waitHandlingInValid||f.onTriggerStay(s)}l=s.collider.entity._scripts;for(var h=0,d=l.length;h<d;h++){var _=l.get(h);_._waitHandlingInValid||_.onTriggerStay(o)}},this.fixedTimeStep=1/60,this.maxSumTimeStep=1/3,this._engine=i}var a=t.prototype;return a.initialize=function(r){this._initialized||(t._nativePhysics=r,this._nativePhysicsManager=t._nativePhysics.createPhysicsManager(this._onContactEnter,this._onContactExit,this._onContactStay,this._onTriggerEnter,this._onTriggerExit,this._onTriggerStay),this._initialized=!0)},a.raycast=function(r,e,n,o){var s=this,l,u=Number.MAX_VALUE;typeof e=="number"?u=e:e!=null&&(l=e);var c=Ut.Everything;if(typeof n=="number"?c=n:n!=null&&(l=n),o&&(l=o),l!=null){var f=this._nativePhysicsManager.raycast(r,u,function(h,d,_,m){l.entity=s._physicalObjectsMap[h]._collider.entity,l.distance=d,l.normal.copyFrom(m),l.point.copyFrom(_)});return f?l.entity.layer&c?!0:(l.entity=null,l.distance=0,l.point.set(0,0,0),l.normal.set(0,0,0),!1):!1}else return this._nativePhysicsManager.raycast(r,u)},a._update=function(r){var e=this.fixedTimeStep,n=this._nativePhysicsManager,o=this._engine._componentsManager,s=r+this._restTime,l=Math.floor(Math.min(this.maxSumTimeStep,s)/e);this._restTime=s-l*e;for(var u=0;u<l;u++)o.callScriptOnPhysicsUpdate(),this._callColliderOnUpdate(),n.update(e),this._callColliderOnLateUpdate()},a._addColliderShape=function(r){this._physicalObjectsMap[r.id]=r,this._nativePhysicsManager.addColliderShape(r._nativeShape)},a._removeColliderShape=function(r){delete this._physicalObjectsMap[r.id],this._nativePhysicsManager.removeColliderShape(r._nativeShape)},a._addCollider=function(r){r._index===-1&&(r._index=this._colliders.length,this._colliders.add(r)),this._nativePhysicsManager.addCollider(r._nativeCollider)},a._addCharacterController=function(r){r._index===-1&&(r._index=this._colliders.length,this._colliders.add(r)),this._nativePhysicsManager.addCharacterController(r._nativeCollider)},a._removeCollider=function(r){var e=this._colliders.deleteByIndex(r._index);e&&(e._index=r._index),r._index=-1,this._nativePhysicsManager.removeCollider(r._nativeCollider)},a._removeCharacterController=function(r){var e=this._colliders.deleteByIndex(r._index);e&&(e._index=r._index),r._index=-1,this._nativePhysicsManager.removeCharacterController(r._nativeCollider)},a._callColliderOnUpdate=function(){for(var r=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)r[e]._onUpdate()},a._callColliderOnLateUpdate=function(){for(var r=this._colliders._elements,e=this._colliders.length-1;e>=0;--e)r[e]._onLateUpdate()},Y(t,[{key:"gravity",get:function(){return this._gravity},set:function(r){var e=this._gravity;e!==r&&e.copyFrom(r),this._nativePhysicsManager.setGravity(e)}}]),t}();jt._nativePhysics=void 0;var To;(function(t){t[t.Average=0]="Average",t[t.Minimum=1]="Minimum",t[t.Multiply=2]="Multiply",t[t.Maximum=3]="Maximum"})(To||(To={}));var G0=function(){function t(){this._bounciness=.1,this._dynamicFriction=.1,this._staticFriction=.1,this._bounceCombine=To.Average,this._frictionCombine=To.Average,this._nativeMaterial=void 0,this._nativeMaterial=jt._nativePhysics.createPhysicsMaterial(this._staticFriction,this._dynamicFriction,this._bounciness,this._bounceCombine,this._frictionCombine)}var a=t.prototype;return a._destroy=function(){this._nativeMaterial.destroy()},Y(t,[{key:"bounciness",get:function(){return this._bounciness},set:function(r){this._bounciness=r,this._nativeMaterial.setBounciness(r)}},{key:"dynamicFriction",get:function(){return this._dynamicFriction},set:function(r){this._dynamicFriction=r,this._nativeMaterial.setDynamicFriction(r)}},{key:"staticFriction",get:function(){return this._staticFriction},set:function(r){this._staticFriction=r,this._nativeMaterial.setStaticFriction(r)}},{key:"bounceCombine",get:function(){return this._bounceCombine},set:function(r){this._bounceCombine=r,this._nativeMaterial.setBounceCombine(r)}},{key:"frictionCombine",get:function(){return this._frictionCombine},set:function(r){this._frictionCombine=r,this._nativeMaterial.setFrictionCombine(r)}}]),t}(),fd,hd,Zl,dd,Hn=(fd=ko(Yt),fd(hd=(Zl=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,k(e,"_index",dd,B(e)),e._nativeCollider=void 0,e._updateFlag=void 0,e._shapes=[],e._updateFlag=e.entity.transform.registerWorldChangeFlag(),e}var i=a.prototype;return i.addShape=function(e){var n=e._collider;n!==this&&(n&&n.removeShape(e),this._shapes.push(e),this.engine.physicsManager._addColliderShape(e),e._collider=this,this._nativeCollider.addShape(e._nativeShape))},i.removeShape=function(e){var n=this._shapes.indexOf(e);n!==-1&&(this._shapes.splice(n,1),this.engine.physicsManager._removeColliderShape(e),e._collider=null,this._nativeCollider.removeShape(e._nativeShape))},i.clearShapes=function(){for(var e=this._shapes,n=0,o=e.length;n<o;n++){var s=e[n];this.engine.physicsManager._removeColliderShape(s),s._destroy(),this._nativeCollider.removeShape(s._nativeShape)}e.length=0},i._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform;this._nativeCollider.setWorldTransform(e.worldPosition,e.worldRotationQuaternion);for(var n=e.lossyWorldScale,o=0,s=this.shapes.length;o<s;o++)this.shapes[o]._nativeShape.setWorldScale(n);this._updateFlag.flag=!1}},i._onLateUpdate=function(){},i._onEnable=function(){this.engine.physicsManager._addCollider(this)},i._onDisable=function(){this.engine.physicsManager._removeCollider(this)},i._onDestroy=function(){this.clearShapes(),this._nativeCollider.destroy()},Y(a,[{key:"shapes",get:function(){return this._shapes}}]),a}(hr),dd=U(Zl.prototype,"_index",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Zl))||hd),Xs;(function(t){t[t.PreventClimbing=0]="PreventClimbing",t[t.PreventClimbingAndForceSliding=1]="PreventClimbingAndForceSliding"})(Xs||(Xs={}));var Z1=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,e._index=-1,e._stepOffset=0,e._nonWalkableMode=Xs.PreventClimbing,e._upDirection=new C(0,1,0),e._slopeLimit=0,e._nativeCollider=jt._nativePhysics.createCharacterController(),e}var i=a.prototype;return i.move=function(e,n,o){return this._nativeCollider.move(e,n,o)},i.addShape=function(e){if(this._shapes.length>0)throw"only allow single shape on controller!";t.prototype.addShape.call(this,e),this._updateFlag.flag=!0},i.clearShapes=function(){this._shapes.length>0&&t.prototype.removeShape.call(this,this._shapes[0])},i._onUpdate=function(){if(this._updateFlag.flag){var e=this.entity.transform,n=this.shapes;this._nativeCollider.setWorldPosition(e.worldPosition);for(var o=e.lossyWorldScale,s=0,l=n.length;s<l;s++)n[s]._nativeShape.setWorldScale(o);this._updateFlag.flag=!1}},i._onLateUpdate=function(){var e=this.entity.transform.worldPosition;this._nativeCollider.getWorldPosition(e),this.entity.transform.worldPosition=e,this._updateFlag.flag=!1},i._onEnable=function(){this.engine.physicsManager._addCharacterController(this)},i._onDisable=function(){this.engine.physicsManager._removeCharacterController(this)},Y(a,[{key:"stepOffset",get:function(){return this._stepOffset},set:function(e){this._stepOffset=e,this._nativeCollider.setStepOffset(e)}},{key:"nonWalkableMode",get:function(){return this._nonWalkableMode},set:function(e){this._nonWalkableMode=e,this._nativeCollider.setNonWalkableMode(e)}},{key:"upDirection",get:function(){return this._upDirection},set:function(e){this._upDirection!==e&&this._upDirection.copyFrom(e),this._nativeCollider.setUpDirection(this._upDirection)}},{key:"slopeLimit",get:function(){return this._slopeLimit},set:function(e){this._slopeLimit=e,this._nativeCollider.setSlopeLimit(e)}}]),a}(Hn),Ca=function(){function t(){this._collider=void 0,this._nativeShape=void 0,this._id=void 0,this._position=new C,this._material=void 0,this._isTrigger=!1,this._isSceneQuery=!0,this._contactOffset=0,this._material=new G0,this._id=t._idGenerator++}var a=t.prototype;return a.setPosition=function(r,e,n){this._position.set(r,e,n),this._nativeShape.setPosition(this._position)},a._destroy=function(){this._material._destroy(),this._nativeShape.destroy()},Y(t,[{key:"collider",get:function(){return this._collider}},{key:"id",get:function(){return this._id}},{key:"contactOffset",get:function(){return this._contactOffset},set:function(r){this._contactOffset=r,this._nativeShape.setContactOffset(r)}},{key:"material",get:function(){return this._material},set:function(r){this._material=r,this._nativeShape.setMaterial(r._nativeMaterial)}},{key:"position",get:function(){return this._position},set:function(r){this._position!==r&&this._position.copyFrom(r),this._nativeShape.setPosition(r)}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(r){this._isTrigger=r,this._nativeShape.setIsTrigger(r)}}]),t}();Ca._idGenerator=0;var ex=function(t){q(a,t);function a(){var r;return r=t.call(this)||this,r._size=new C(1,1,1),r._nativeShape=jt._nativePhysics.createBoxColliderShape(r._id,r._size,r._material._nativeMaterial),r}var i=a.prototype;return i.setSize=function(e,n,o){this._size.x=e,this._size.y=n,this._size.z=o,this._nativeShape.setSize(this._size)},Y(a,[{key:"size",get:function(){return this._size},set:function(e){this._size!=e&&this._size.copyFrom(e),this._nativeShape.setSize(e)}}]),a}(Ca),tx=function(t){q(a,t);function a(){var i;return i=t.call(this)||this,i._radius=1,i._nativeShape=jt._nativePhysics.createSphereColliderShape(i._id,i._radius,i._material._nativeMaterial),i}return Y(a,[{key:"radius",get:function(){return this._radius},set:function(r){this._radius=r,this._nativeShape.setRadius(r)}}]),a}(Ca),rx=function(t){q(a,t);function a(){var r;return r=t.call(this)||this,r._rotation=new C,r._nativeShape=jt._nativePhysics.createPlaneColliderShape(r._id,r._material._nativeMaterial),r}var i=a.prototype;return i.setRotation=function(e,n,o){this._rotation.set(e,n,o),this._nativeShape.setRotation(this._rotation)},Y(a,[{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation!=e&&this._rotation.copyFrom(e),this._nativeShape.setRotation(e)}}]),a}(Ca),bo;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(bo||(bo={}));var nx=function(t){q(a,t);function a(){var i;return i=t.call(this)||this,i._radius=1,i._height=2,i._upAxis=bo.Y,i._nativeShape=jt._nativePhysics.createCapsuleColliderShape(i._id,i._radius,i._height,i._material._nativeMaterial),i._nativeShape.setUpAxis(bo.Y),i}return Y(a,[{key:"radius",get:function(){return this._radius},set:function(r){this._radius=r,this._nativeShape.setRadius(r)}},{key:"height",get:function(){return this._height},set:function(r){this._height=r,this._nativeShape.setHeight(r)}},{key:"upAxis",get:function(){return this._upAxis},set:function(r){this._upAxis=r,this._nativeShape.setUpAxis(r)}}]),a}(Ca),_d,vd,pl=(_d=ko(Hn),_d(vd=function(t){q(a,t);function a(i){var r;return r=t.call(this,i)||this,r._connectedCollider=new pd,r._collider=new pd,r._nativeJoint=void 0,r._force=0,r._torque=0,r._connectedCollider.localPosition=new C,r}return Y(a,[{key:"connectedCollider",get:function(){return this._connectedCollider.collider},set:function(r){this._connectedCollider.collider!==r&&(this._connectedCollider.collider=r,this._nativeJoint.setConnectedCollider(r._nativeCollider))}},{key:"connectedAnchor",get:function(){return this._connectedCollider.localPosition},set:function(r){var e=this._connectedCollider.localPosition;r!==e&&e.copyFrom(r),this._nativeJoint.setConnectedAnchor(r)}},{key:"connectedMassScale",get:function(){return this._connectedCollider.massScale},set:function(r){r!==this._connectedCollider.massScale&&(this._connectedCollider.massScale=r,this._nativeJoint.setConnectedMassScale(r))}},{key:"connectedInertiaScale",get:function(){return this._connectedCollider.inertiaScale},set:function(r){r!==this._connectedCollider.inertiaScale&&(this._connectedCollider.inertiaScale=r,this._nativeJoint.setConnectedInertiaScale(r))}},{key:"massScale",get:function(){return this._collider.massScale},set:function(r){r!==this._collider.massScale&&(this._collider.massScale=r,this._nativeJoint.setMassScale(r))}},{key:"inertiaScale",get:function(){return this._collider.inertiaScale},set:function(r){r!==this._collider.inertiaScale&&(this._collider.inertiaScale=r,this._nativeJoint.setInertiaScale(r))}},{key:"breakForce",get:function(){return this._force},set:function(r){r!==this._force&&(this._force=r,this._nativeJoint.setBreakForce(r))}},{key:"breakTorque",get:function(){return this._torque},set:function(r){r!==this._torque&&(this._torque=r,this._nativeJoint.setBreakTorque(r))}}]),a}(hr))||vd),pd=function(){this.collider=null,this.localPosition=void 0,this.localRotation=void 0,this.massScale=0,this.inertiaScale=0},ix=function(t){q(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i._onAwake=function(){var e=this._collider;e.collider=this.entity.getComponent(Hn),this._nativeJoint=jt._nativePhysics.createFixedJoint(e.collider._nativeCollider)},a}(pl),mr;(function(t){t[t.LimitEnabled=1]="LimitEnabled",t[t.DriveEnabled=2]="DriveEnabled",t[t.DriveFreeSpin=4]="DriveFreeSpin"})(mr||(mr={}));var ax=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r._axis=new C(1,0,0),r._hingeFlags=0,r._useSpring=!1,r._jointMonitor=void 0,r._limits=void 0,r}var i=a.prototype;return i._onAwake=function(){var e=this._collider;e.localPosition=new C,e.collider=this.entity.getComponent(Hn),this._nativeJoint=jt._nativePhysics.createHingeJoint(e.collider._nativeCollider)},Y(a,[{key:"axis",get:function(){return this._axis},set:function(e){var n=this._axis;e!==n&&n.copyFrom(e),this._nativeJoint.setAxis(n)}},{key:"swingOffset",get:function(){return this._collider.localPosition},set:function(e){var n=this._collider.localPosition;e!==n&&n.copyFrom(e),this._nativeJoint.setSwingOffset(n)}},{key:"angle",get:function(){return this._nativeJoint.getAngle()}},{key:"velocity",get:function(){return this._nativeJoint.getVelocity()}},{key:"useLimits",get:function(){return(this._hingeFlags&mr.LimitEnabled)==mr.LimitEnabled},set:function(e){e!==this.useLimits&&(this._hingeFlags|=mr.LimitEnabled),this._nativeJoint.setHingeJointFlag(mr.LimitEnabled,e)}},{key:"useMotor",get:function(){return(this._hingeFlags&mr.DriveEnabled)==mr.DriveEnabled},set:function(e){e!==this.useMotor&&(this._hingeFlags|=mr.DriveEnabled),this._nativeJoint.setHingeJointFlag(mr.DriveEnabled,e)}},{key:"useSpring",get:function(){return this._useSpring},set:function(e){this._useSpring=e,this.limits=this._limits}},{key:"motor",get:function(){return this._jointMonitor},set:function(e){this._jointMonitor=e,this._nativeJoint.setDriveVelocity(e.targetVelocity),this._nativeJoint.setDriveForceLimit(e.forceLimit),this._nativeJoint.setDriveGearRatio(e.gearRation),this._nativeJoint.setHingeJointFlag(mr.DriveFreeSpin,e.freeSpin)}},{key:"limits",get:function(){return this._limits},set:function(e){this._limits=e,this.useSpring?this._nativeJoint.setSoftLimit(e.min,e.max,e.stiffness,e.damping):this._nativeJoint.setHardLimit(e.min,e.max,e.contactDistance)}}]),a}(pl),ox=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r._minDistance=0,r._maxDistance=0,r._tolerance=.25,r._stiffness=0,r._damping=0,r}var i=a.prototype;return i._onAwake=function(){var e=this._collider;e.localPosition=new C,e.collider=this.entity.getComponent(Hn),this._nativeJoint=jt._nativePhysics.createSpringJoint(e.collider._nativeCollider)},Y(a,[{key:"swingOffset",get:function(){return this._collider.localPosition},set:function(e){var n=this._collider.localPosition;e!==n&&n.copyFrom(e),this._nativeJoint.setSwingOffset(e)}},{key:"minDistance",get:function(){return this._minDistance},set:function(e){this._minDistance=e,this._nativeJoint.setMinDistance(e)}},{key:"maxDistance",get:function(){return this._maxDistance},set:function(e){this._maxDistance=e,this._nativeJoint.setMaxDistance(e)}},{key:"tolerance",get:function(){return this._tolerance},set:function(e){this._tolerance=e,this._nativeJoint.setTolerance(e)}},{key:"stiffness",get:function(){return this._stiffness},set:function(e){this._stiffness=e,this._nativeJoint.setStiffness(e)}},{key:"damping",get:function(){return this._damping},set:function(e){this._damping=e,this._nativeJoint.setDamping(e)}}]),a}(pl),sx=function(){this.max=0,this.min=0,this.contactDistance=-1,this.stiffness=0,this.damping=0},lx=function(){this.targetVelocity=0,this.forceLimit=Number.MAX_VALUE,this.gearRation=1,this.freeSpin=!1},Ku;(function(t){t[t.Sides=1]="Sides",t[t.Up=2]="Up",t[t.Down=4]="Down"})(Ku||(Ku={}));var ux=function(t){q(a,t);function a(i){var r;r=t.call(this,i)||this;var e=r.entity.transform;return r._nativeCollider=jt._nativePhysics.createStaticCollider(e.worldPosition,e.worldRotationQuaternion),r}return a}(Hn),cx=function(t){q(a,t);function a(r){var e;e=t.call(this,r)||this,e._linearDamping=0,e._angularDamping=0,e._linearVelocity=new C,e._angularVelocity=new C,e._mass=0,e._centerOfMass=new C,e._inertiaTensor=new C,e._maxAngularVelocity=0,e._maxDepenetrationVelocity=0,e._sleepThreshold=0,e._solverIterations=0,e._isKinematic=!1,e._constraints=0,e._collisionDetectionMode=$s.Discrete;var n=e.entity.transform;return e._nativeCollider=jt._nativePhysics.createDynamicCollider(n.worldPosition,n.worldRotationQuaternion),e}var i=a.prototype;return i.applyForce=function(e){this._nativeCollider.addForce(e)},i.applyTorque=function(e){this._nativeCollider.addTorque(e)},i.move=function(e,n){this._nativeCollider.move(e,n)},i.sleep=function(){this._nativeCollider.sleep()},i.wakeUp=function(){this._nativeCollider.wakeUp()},i._onLateUpdate=function(){var e=this.entity.transform,n=e.worldPosition,o=e.worldRotationQuaternion;this._nativeCollider.getWorldTransform(n,o),this._updateFlag.flag=!1},Y(a,[{key:"linearDamping",get:function(){return this._linearDamping},set:function(e){this._linearDamping=e,this._nativeCollider.setLinearDamping(e)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(e){this._angularDamping=e,this._nativeCollider.setAngularDamping(e)}},{key:"linearVelocity",get:function(){return this._linearVelocity},set:function(e){this._linearVelocity!==e&&this._linearVelocity.copyFrom(e),this._nativeCollider.setLinearVelocity(this._linearVelocity)}},{key:"angularVelocity",get:function(){return this._angularVelocity},set:function(e){this._angularVelocity!==e&&this._angularVelocity.copyFrom(e),this._nativeCollider.setAngularVelocity(this._angularVelocity)}},{key:"mass",get:function(){return this._mass},set:function(e){this._mass=e,this._nativeCollider.setMass(e)}},{key:"centerOfMass",get:function(){return this._centerOfMass},set:function(e){this._centerOfMass!==e&&this._centerOfMass.copyFrom(e),this._nativeCollider.setCenterOfMass(this._centerOfMass)}},{key:"inertiaTensor",get:function(){return this._inertiaTensor},set:function(e){this._inertiaTensor!==e&&this._inertiaTensor.copyFrom(e),this._nativeCollider.setInertiaTensor(this._inertiaTensor)}},{key:"maxAngularVelocity",get:function(){return this._maxAngularVelocity},set:function(e){this._maxAngularVelocity=e,this._nativeCollider.setMaxAngularVelocity(e)}},{key:"maxDepenetrationVelocity",get:function(){return this._maxDepenetrationVelocity},set:function(e){this._maxDepenetrationVelocity=e,this._nativeCollider.setMaxDepenetrationVelocity(e)}},{key:"sleepThreshold",get:function(){return this._sleepThreshold},set:function(e){this._sleepThreshold=e,this._nativeCollider.setSleepThreshold(e)}},{key:"solverIterations",get:function(){return this._solverIterations},set:function(e){this._solverIterations=e,this._nativeCollider.setSolverIterations(e)}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(e){this._isKinematic=e,this._nativeCollider.setIsKinematic(e)}},{key:"constraints",get:function(){return this._constraints},set:function(e){this._constraints=e,this._nativeCollider.setConstraints(e)}},{key:"collisionDetectionMode",get:function(){return this._collisionDetectionMode},set:function(e){this._collisionDetectionMode=e,this._nativeCollider.setCollisionDetectionMode(e)}}]),a}(Hn),$s;(function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous",t[t.ContinuousDynamic=2]="ContinuousDynamic",t[t.ContinuousSpeculative=3]="ContinuousSpeculative"})($s||($s={}));var Zu;(function(t){t[t.None=0]="None",t[t.FreezePositionX=1]="FreezePositionX",t[t.FreezePositionY=2]="FreezePositionY",t[t.FreezePositionZ=4]="FreezePositionZ",t[t.FreezeRotationX=8]="FreezeRotationX",t[t.FreezeRotationY=16]="FreezeRotationY",t[t.FreezeRotationZ=32]="FreezeRotationZ"})(Zu||(Zu={}));var xr;(function(t){t[t.Down=0]="Down",t[t.Move=1]="Move",t[t.Up=2]="Up",t[t.Leave=3]="Leave"})(xr||(xr={}));var Lr;(function(t){t[t.Primary=0]="Primary",t[t.Auxiliary=1]="Auxiliary",t[t.Secondary=2]="Secondary",t[t.XButton1=3]="XButton1",t[t.XButton2=4]="XButton2",t[t.XButton3=5]="XButton3",t[t.XButton4=6]="XButton4",t[t.XButton5=7]="XButton5",t[t.XButton6=8]="XButton6",t[t.XButton7=9]="XButton7",t[t.XButton8=10]="XButton8"})(Lr||(Lr={}));var H0=function(a){this.id=void 0,this.phase=xr.Leave,this.position=new $,this._uniqueID=void 0,this.id=a},ha=function(){function t(i,r){this._pointers=[],this._movingDelta=new $,this._multiPointerEnabled=!0,this._buttons=0,this._upMap=[],this._downMap=[],this._downList=new Bt,this._upList=new Bt,this._currentPosition=new $,this._currentPressedEntity=void 0,this._currentEnteredEntity=void 0,this._engine=void 0,this._canvas=void 0,this._htmlCanvas=void 0,this._nativeEvents=[],this._pointerPool=void 0,this._keyEventList=[],this._keyEventCount=0,this._needOverallPointers=!1,this._hadListener=!1,this._lastPositionFrameCount=0,this._engine=i,this._canvas=i.canvas,this._htmlCanvas=r,r.oncontextmenu=function(n){return!1};var e=this._onPointerEvent=this._onPointerEvent.bind(this);r.addEventListener("pointerdown",e),r.addEventListener("pointerup",e),r.addEventListener("pointerout",e),r.addEventListener("pointermove",e),this._hadListener=!0,this._pointerPool=new Array(11)}var a=t.prototype;return a._update=function(r){if(this._needOverallPointers&&this._overallPointers(),this._downList.length=0,this._upList.length=0,this._movingDelta.set(0,0),this._nativeEvents.length>0&&this._handlePointerEvent(this._nativeEvents,r),this._pointers.length>0&&(this._lastPositionFrameCount=r),this._engine.physicsManager._initialized){var e=this._pointerRayCast(),n=this._keyEventCount;if(n>0){for(var o=this._keyEventList,s=0;s<n;s++)switch(o[s]){case mn.Down:this._firePointerDown(e);break;case mn.Up:this._firePointerUpAndClick(e);break}this._firePointerExitAndEnter(e),o[n-1]===mn.Leave&&(this._currentPressedEntity=null),this._keyEventCount=0}else this._firePointerDrag(),this._firePointerExitAndEnter(e)}},a._onFocus=function(){if(!this._hadListener){var r=this._htmlCanvas,e=this._onPointerEvent;r.addEventListener("pointerdown",e),r.addEventListener("pointerup",e),r.addEventListener("pointerout",e),r.addEventListener("pointermove",e),this._hadListener=!0}},a._onBlur=function(){if(this._hadListener){var r=this._htmlCanvas,e=this._onPointerEvent;r.removeEventListener("pointerdown",e),r.removeEventListener("pointerup",e),r.removeEventListener("pointerout",e),r.removeEventListener("pointermove",e),this._nativeEvents.length=0,this._pointerPool.length=0,this._currentEnteredEntity=null,this._currentPressedEntity=null,this._downList.length=0,this._upList.length=0,this._hadListener=!1}},a._destroy=function(){if(this._hadListener){var r=this._htmlCanvas,e=this._onPointerEvent;r.removeEventListener("pointerdown",e),r.removeEventListener("pointerup",e),r.removeEventListener("pointerout",e),r.removeEventListener("pointermove",e),this._hadListener=!1}this._nativeEvents.length=0,this._pointerPool.length=0,this._pointers.length=0,this._currentPosition=null,this._currentEnteredEntity=null,this._currentPressedEntity=null,this._engine=null,this._canvas=null},a._onPointerEvent=function(r){r.cancelable&&r.preventDefault(),r.type==="pointerdown"&&this._htmlCanvas.focus(),this._nativeEvents.push(r)},a._overallPointers=function(){for(var r=this._pointers,e=0,n=r.length,o=0;o<n;o++)r[o].phase===xr.Leave?e++:e>0&&(r[o-e]=r[o]);r.length=n-e,this._needOverallPointers=!1},a._getIndexByPointerID=function(r){for(var e=this._pointers,n=e.length-1;n>=0;n--)if(e[n]._uniqueID===r)return n;return-1},a._addPointer=function(r,e,n,o){var s=this._pointers,l=s.length;if(l===0||this._multiPointerEnabled){for(var u=this._pointerPool,c=0;c<l&&!(s[c].id>c);c++);var f=u[c];f||(f=u[c]=new H0(c)),f._uniqueID=r,f.position.set(e,n),f.phase=o,s.splice(c,0,f)}},a._removePointer=function(r){var e=this._pointers[r];e.phase=xr.Leave},a._updatePointer=function(r,e,n,o){var s=this._pointers[r];s.position.set(e,n),s.phase=o},a._handlePointerEvent=function(r,e){for(var n=this._pointers,o=this._keyEventList,s=this._upMap,l=this._downMap,u=this._upList,c=this._downList,f=n.length,h=this._canvas.width/this._htmlCanvas.clientWidth,d=this._canvas.height/this._htmlCanvas.clientHeight,_=r.length,m=0;m<_;m++){var p=r[m],v=p.button|Lr.Primary,g=this._getIndexByPointerID(p.pointerId);switch(p.type){case"pointerdown":g===-1?(this._addPointer(p.pointerId,p.offsetX*h,p.offsetY*d,xr.Down),f++):this._updatePointer(g,p.offsetX*h,p.offsetY*d,xr.Down),f===1&&(o[this._keyEventCount++]=mn.Down),c.add(v),l[v]=e;break;case"pointerup":g>=0&&(this._updatePointer(g,p.offsetX*h,p.offsetY*d,xr.Up),f===1&&(o[this._keyEventCount++]=mn.Up)),u.add(v),s[v]=e;break;case"pointermove":g===-1?(this._addPointer(p.pointerId,p.offsetX*h,p.offsetY*d,xr.Move),f++):this._updatePointer(g,p.offsetX*h,p.offsetY*d,xr.Move);break;case"pointerout":g>=0&&(this._removePointer(g),--f===0&&(o[this._keyEventCount++]=mn.Leave),this._needOverallPointers=!0);break}}this._buttons=r[_-1].buttons;var y=n.length;if(y>0){var x=this._currentPosition,P=x.x,S=x.y;if(f===0){var w=r[_-1];x.set(w.offsetX*h,w.offsetY*d)}else{x.set(0,0);for(var b=0;b<y;b++)x.add(n[b].position);x.scale(1/y)}this._lastPositionFrameCount===e-1&&this._movingDelta.set(x.x-P,x.y-S)}r.length=0},a._pointerRayCast=function(){if(this._pointers.length>0)for(var r=t._tempPoint,e=t._tempRay,n=t._tempHitResult,o=this._engine.sceneManager.activeScene._activeCameras,s=this._currentPosition.x/this._canvas.width,l=this._currentPosition.y/this._canvas.height,u=o.length-1;u>=0;u--){var c=o[u];if(!(!c.enabled||c.renderTarget)){var f=c.viewport,h=f.x,d=f.y,_=f.z,m=f.w;if(s>=h&&l>=d&&s-h<=_&&l-d<=m){if(r.set((s-h)/_,(l-d)/m),this._engine.physicsManager.raycast(c.viewportPointToRay(r,e),Number.MAX_VALUE,c.cullingMask,n))return n.entity;if(c.clearFlags&Tr.Color)return null}}}return null},a._firePointerDrag=function(){if(this._currentPressedEntity)for(var r=this._currentPressedEntity._scripts,e=r.length-1;e>=0;e--){var n=r.get(e);n._waitHandlingInValid||n.onPointerDrag()}},a._firePointerExitAndEnter=function(r){if(this._currentEnteredEntity!==r){if(this._currentEnteredEntity)for(var e=this._currentEnteredEntity._scripts,n=e.length-1;n>=0;n--){var o=e.get(n);o._waitHandlingInValid||o.onPointerExit()}if(r)for(var s=r._scripts,l=s.length-1;l>=0;l--){var u=s.get(l);u._waitHandlingInValid||u.onPointerEnter()}this._currentEnteredEntity=r}},a._firePointerDown=function(r){if(r)for(var e=r._scripts,n=e.length-1;n>=0;n--){var o=e.get(n);o._waitHandlingInValid||o.onPointerDown()}this._currentPressedEntity=r},a._firePointerUpAndClick=function(r){var e=this._currentPressedEntity;if(e){for(var n=e===r,o=e._scripts,s=o.length-1;s>=0;s--){var l=o.get(s);l._waitHandlingInValid||(n&&l.onPointerClick(),l.onPointerUp())}this._currentPressedEntity=null}},t}();ha.Buttons=[1,4,2,8,16,32,64,128,256,512,1024];ha._tempRay=new D1;ha._tempPoint=new $;ha._tempHitResult=new V0;var mn;(function(t){t[t.Down=0]="Down",t[t.Up=1]="Up",t[t.Leave=2]="Leave"})(mn||(mn={}));var fx=function(){function t(i){this._delta=new C,this._nativeEvents=[],this._canvas=void 0,this._hadListener=void 0,this._onWheelEvent=this._onWheelEvent.bind(this),i.addEventListener("wheel",this._onWheelEvent),this._canvas=i,this._hadListener=!0}var a=t.prototype;return a._update=function(){var r=this._delta;r.set(0,0,0);var e=this._nativeEvents;if(e.length>0){for(var n=e.length-1;n>=0;n--){var o=e[n];r.x+=o.deltaX,r.y+=o.deltaY,r.z+=o.deltaZ}e.length=0}},a._onFocus=function(){this._hadListener||(this._canvas.addEventListener("wheel",this._onWheelEvent),this._hadListener=!0)},a._onBlur=function(){this._hadListener&&(this._canvas.removeEventListener("wheel",this._onWheelEvent),this._nativeEvents.length=0,this._delta.set(0,0,0),this._hadListener=!1)},a._destroy=function(){this._hadListener&&(this._canvas.removeEventListener("wheel",this._onWheelEvent),this._hadListener=!1),this._nativeEvents=null},a._onWheelEvent=function(r){r.cancelable&&r.preventDefault(),this._nativeEvents.push(r)},t}(),W0=function(){var t=a.prototype;t.isKeyHeldDown=function(r){return this._initialized?r===void 0?this._keyboardManager._curFrameHeldDownList.length>0:this._keyboardManager._curHeldDownKeyToIndexMap[r]!=null:!1},t.isKeyDown=function(r){return this._initialized?r===void 0?this._keyboardManager._curFrameDownList.length>0:this._keyboardManager._downKeyToFrameCountMap[r]===this._curFrameCount:!1},t.isKeyUp=function(r){return this._initialized?r===void 0?this._keyboardManager._curFrameUpList.length>0:this._keyboardManager._upKeyToFrameCountMap[r]===this._curFrameCount:!1},t.isPointerHeldDown=function(r){return this._initialized?r===void 0?this._pointerManager._buttons!==0:(this._pointerManager._buttons&ha.Buttons[r])!==0:!1},t.isPointerDown=function(r){return this._initialized?r===void 0?this._pointerManager._downList.length>0:this._pointerManager._downMap[r]===this._curFrameCount:!1},t.isPointerUp=function(r){return this._initialized?r===void 0?this._pointerManager._upList.length>0:this._pointerManager._upMap[r]===this._curFrameCount:!1};function a(i){this._initialized=!1,this._curFrameCount=0,this._wheelManager=void 0,this._pointerManager=void 0,this._keyboardManager=void 0;var r=i._canvas._webCanvas;(typeof OffscreenCanvas=="undefined"||!(r instanceof OffscreenCanvas))&&(this._wheelManager=new fx(r),this._pointerManager=new ha(i,r),this._keyboardManager=new K1(r),this._onBlur=this._onBlur.bind(this),window.addEventListener("blur",this._onBlur),this._onFocus=this._onFocus.bind(this),window.addEventListener("focus",this._onFocus),this._initialized=!0)}return t._update=function(){this._initialized&&(++this._curFrameCount,this._wheelManager._update(),this._pointerManager._update(this._curFrameCount),this._keyboardManager._update(this._curFrameCount))},t._destroy=function(){this._initialized&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._wheelManager._destroy(),this._pointerManager._destroy(),this._keyboardManager._destroy())},t._onBlur=function(){this._wheelManager._onBlur(),this._pointerManager._onBlur(),this._keyboardManager._onBlur()},t._onFocus=function(){this._wheelManager._onFocus(),this._pointerManager._onFocus(),this._keyboardManager._onFocus()},Y(a,[{key:"pointers",get:function(){return this._initialized?this._pointerManager._pointers:null}},{key:"multiPointerEnabled",get:function(){return this._initialized?this._pointerManager._multiPointerEnabled:!1},set:function(r){this._initialized&&(this._pointerManager._multiPointerEnabled=r)}},{key:"wheelDelta",get:function(){return this._initialized?this._wheelManager._delta:null}},{key:"pointerMovingDelta",get:function(){return this._initialized?this._pointerManager._movingDelta:null}},{key:"pointerPosition",get:function(){return this._initialized&&this._pointerManager._pointers.length>0?this._pointerManager._currentPosition:null}}]),a}(),_t;(function(t){t[t.Opaque=0]="Opaque",t[t.AlphaTest=1]="AlphaTest",t[t.Transparent=2]="Transparent"})(_t||(_t={}));var un=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,e.isGCIgnored=!1,e._refCount=0,r.resourceManager._addRefObject(e.instanceId,B(e)),e}var i=a.prototype;return i.destroy=function(e){if(e===void 0&&(e=!1),this._destroyed)return!0;if(!e&&this._refCount!==0)return!1;var n=this._engine.resourceManager;n&&(t.prototype.destroy.call(this),n._deleteRefObject(this.instanceId));var o=this._getRefCount();return o>0&&this._addRefCount(-o),this._engine=null,this._onDestroy(),!0},i._getRefCount=function(){return this._refCount},i._addRefCount=function(e){this._refCount+=e},i._addToResourceManager=function(e){this._engine.resourceManager._addAsset(e,this)},Y(a,[{key:"refCount",get:function(){return this._refCount}}]),a}(ln),Cr;(function(t){t[t.Scene=0]="Scene",t[t.Camera=1]="Camera",t[t.Renderer=2]="Renderer",t[t.Material=3]="Material"})(Cr||(Cr={}));var Ur=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.name=void 0,r._platformTexture=void 0,r._mipmap=void 0,r._format=void 0,r._width=void 0,r._height=void 0,r._mipmapCount=void 0,r._wrapModeU=void 0,r._wrapModeV=void 0,r._filterMode=void 0,r._anisoLevel=1,r}var i=a.prototype;return i.generateMipmaps=function(){!this._mipmap||this._platformTexture.generateMipmaps()},i._onDestroy=function(){this._platformTexture.destroy(),this._platformTexture=null},i._getMaxMiplevel=function(e){return Math.floor(Math.log2(e))},i._getMipmapCount=function(){return this._mipmap?Math.floor(Math.log2(Math.max(this._width,this._height)))+1:1},Y(a,[{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"wrapModeU",get:function(){return this._wrapModeU},set:function(e){e!==this._wrapModeU&&(this._wrapModeU=e,this._platformTexture.wrapModeU=e)}},{key:"wrapModeV",get:function(){return this._wrapModeV},set:function(e){e!==this._wrapModeV&&(this._wrapModeV=e,this._platformTexture.wrapModeV=e)}},{key:"mipmapCount",get:function(){return this._mipmapCount}},{key:"filterMode",get:function(){return this._filterMode},set:function(e){e!==this._filterMode&&(this._filterMode=e,this._platformTexture.filterMode=e)}},{key:"anisoLevel",get:function(){return this._anisoLevel},set:function(e){var n=this._engine._hardwareRenderer.capability.maxAnisoLevel;e>n&&(de.warn("anisoLevel:"+e+", exceeds the limit and is automatically downgraded to:"+n),e=n),e<1&&(de.warn("anisoLevel:"+e+", must be greater than 0, and is automatically downgraded to 1"),e=1),e!==this._anisoLevel&&(this._anisoLevel=e,this._platformTexture.anisoLevel=e)}}]),a}(un),zt;(function(t){t[t.Float=0]="Float",t[t.Int=1]="Int",t[t.Vector2=2]="Vector2",t[t.Vector3=3]="Vector3",t[t.Vector4=4]="Vector4",t[t.Matrix=5]="Matrix",t[t.Color=6]="Color",t[t.Texture=7]="Texture",t[t.FloatArray=8]="FloatArray",t[t.IntArray=9]="IntArray",t[t.TextureArray=10]="TextureArray"})(zt||(zt={}));var hx=`#define GLSLIFY 1
#define PI 3.14159265359
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6
#define LOG2 1.442695
#define saturate( a ) clamp( a, 0.0, 1.0 )
#define whiteCompliment(a) ( 1.0 - saturate( a ) )
float pow2(float x){return x*x;}vec4 RGBMToLinear(vec4 value,float maxRange){return vec4(value.rgb*value.a*maxRange,1.0);}vec4 gammaToLinear(vec4 srgbIn){return vec4(pow(srgbIn.rgb,vec3(2.2)),srgbIn.a);}vec4 linearToGamma(vec4 linearIn){return vec4(pow(linearIn.rgb,vec3(1.0/2.2)),linearIn.a);}`,dx=`#define GLSLIFY 1
attribute vec3 POSITION;
#ifdef O3_HAS_UV
attribute vec2 TEXCOORD_0;
#endif
#ifdef O3_HAS_UV1
attribute vec2 TEXCOORD_1;
#endif
#ifdef O3_HAS_SKIN
attribute vec4 JOINTS_0;attribute vec4 WEIGHTS_0;
#ifdef O3_USE_JOINT_TEXTURE
uniform sampler2D u_jointSampler;uniform float u_jointCount;mat4 getJointMatrix(sampler2D smp,float index){float base=index/u_jointCount;float hf=0.5/u_jointCount;float v=base+hf;vec4 m0=texture2D(smp,vec2(0.125,v));vec4 m1=texture2D(smp,vec2(0.375,v));vec4 m2=texture2D(smp,vec2(0.625,v));vec4 m3=texture2D(smp,vec2(0.875,v));return mat4(m0,m1,m2,m3);}
#else
uniform mat4 u_jointMatrix[O3_JOINTS_NUM];
#endif
#endif
#ifdef O3_HAS_VERTEXCOLOR
attribute vec4 COLOR_0;
#endif
uniform mat4 u_localMat;uniform mat4 u_modelMat;uniform mat4 u_viewMat;uniform mat4 u_projMat;uniform mat4 u_MVMat;uniform mat4 u_MVPMat;uniform mat4 u_normalMat;uniform vec3 u_cameraPos;uniform vec4 u_tilingOffset;
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
attribute vec3 NORMAL;
#endif
#ifdef O3_HAS_TANGENT
attribute vec4 TANGENT;
#endif
#endif
`,_x=`#define GLSLIFY 1
uniform mat4 u_localMat;uniform mat4 u_modelMat;uniform mat4 u_viewMat;uniform mat4 u_projMat;uniform mat4 u_MVMat;uniform mat4 u_MVPMat;uniform mat4 u_normalMat;uniform vec3 u_cameraPos;`,vx=`#define GLSLIFY 1
#ifdef O3_HAS_VERTEXCOLOR
varying vec4 v_color;
#endif
`,px=`#define GLSLIFY 1
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
varying vec3 v_normal;
#if defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
varying mat3 v_TBN;
#endif
#endif
#endif
`,gx=`#define GLSLIFY 1
varying vec2 v_uv;
#ifdef O3_HAS_UV1
varying vec2 v_uv1;
#endif
`,mx=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
varying vec3 v_pos;
#endif
`,yx=`#define GLSLIFY 1
#ifdef O3_GENERATE_SHADOW_MAP
uniform mat4 u_viewMatFromLight;uniform mat4 u_projMatFromLight;
#endif
#ifdef O3_SHADOW_MAP_COUNT
uniform mat4 u_viewMatFromLight[O3_SHADOW_MAP_COUNT];uniform mat4 u_projMatFromLight[O3_SHADOW_MAP_COUNT];varying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];
#endif
`,xx=`#define GLSLIFY 1
#ifdef O3_HAS_FOG
varying vec3 v_fogDepth;uniform vec3 u_fogColor;
#ifdef O3_FOG_EXP2
uniform float u_fogDensity;
#else
uniform float u_fogNear;uniform float u_fogFar;
#endif
#endif
`,wx=`#define GLSLIFY 1
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
vec3 normal=vec3(NORMAL);
#endif
#ifdef O3_HAS_TANGENT
vec4 tangent=vec4(TANGENT);
#endif
#endif
`,Sx=`#define GLSLIFY 1
vec4 position=vec4(POSITION,1.0);`,Cx=`#define GLSLIFY 1
#ifndef O3_GENERATE_SHADOW_MAP
gl_Position=u_MVPMat*position;
#endif
`,Px=`#define GLSLIFY 1
#ifdef O3_HAS_VERTEXCOLOR
v_color=COLOR_0;
#endif
`,Ax=`#define GLSLIFY 1
#ifndef OMIT_NORMAL
#ifdef O3_HAS_NORMAL
v_normal=normalize(mat3(u_normalMat)*normal);
#if defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
vec3 normalW=normalize(mat3(u_normalMat)*normal.xyz);vec3 tangentW=normalize(mat3(u_normalMat)*tangent.xyz);vec3 bitangentW=cross(normalW,tangentW)*tangent.w;v_TBN=mat3(tangentW,bitangentW,normalW);
#endif
#endif
#endif
`,Tx=`#define GLSLIFY 1
#ifdef O3_HAS_SKIN
#ifdef O3_USE_JOINT_TEXTURE
mat4 skinMatrix=WEIGHTS_0.x*getJointMatrix(u_jointSampler,JOINTS_0.x)+WEIGHTS_0.y*getJointMatrix(u_jointSampler,JOINTS_0.y)+WEIGHTS_0.z*getJointMatrix(u_jointSampler,JOINTS_0.z)+WEIGHTS_0.w*getJointMatrix(u_jointSampler,JOINTS_0.w);
#else
mat4 skinMatrix=WEIGHTS_0.x*u_jointMatrix[int(JOINTS_0.x)]+WEIGHTS_0.y*u_jointMatrix[int(JOINTS_0.y)]+WEIGHTS_0.z*u_jointMatrix[int(JOINTS_0.z)]+WEIGHTS_0.w*u_jointMatrix[int(JOINTS_0.w)];
#endif
position=skinMatrix*position;
#if defined(O3_HAS_NORMAL) && !defined(OMIT_NORMAL)
normal=vec4(skinMatrix*vec4(normal,0.0)).xyz;
#if defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
tangent.xyz=vec4(skinMatrix*vec4(tangent.xyz,0.0)).xyz;
#endif
#endif
#endif
`,bx=`#define GLSLIFY 1
#ifdef OASIS_BLENDSHAPE
#ifdef OASIS_BLENDSHAPE_TEXTURE
uniform mediump sampler2DArray u_blendShapeTexture;uniform ivec3 u_blendShapeTextureInfo;uniform float u_blendShapeWeights[OASIS_BLENDSHAPE_COUNT];
#else
attribute vec3 POSITION_BS0;attribute vec3 POSITION_BS1;attribute vec3 POSITION_BS2;attribute vec3 POSITION_BS3;
#if defined( OASIS_BLENDSHAPE_NORMAL ) || defined( OASIS_BLENDSHAPE_TANGENT )
#ifdef OASIS_BLENDSHAPE_NORMAL
attribute vec3 NORMAL_BS0;attribute vec3 NORMAL_BS1;attribute vec3 NORMAL_BS2;attribute vec3 NORMAL_BS3;
#endif
#ifdef OASIS_BLENDSHAPE_TANGENT
attribute vec3 TANGENT_BS0;attribute vec3 TANGENT_BS1;attribute vec3 TANGENT_BS2;attribute vec3 TANGENT_BS3;
#endif
uniform float u_blendShapeWeights[4];
#else
attribute vec3 POSITION_BS4;attribute vec3 POSITION_BS5;attribute vec3 POSITION_BS6;attribute vec3 POSITION_BS7;uniform float u_blendShapeWeights[8];
#endif
#endif
#ifdef OASIS_BLENDSHAPE_TEXTURE
vec3 getBlendShapeVertexElement(int blendShapeIndex,int vertexElementIndex){int y=vertexElementIndex/u_blendShapeTextureInfo.y;int x=vertexElementIndex-y*u_blendShapeTextureInfo.y;ivec3 uv=ivec3(x,y,blendShapeIndex);return texelFetch(u_blendShapeTexture,uv,0).xyz;}
#endif
#endif
`,Ex=`#define GLSLIFY 1
#ifdef OASIS_BLENDSHAPE
#ifdef OASIS_BLENDSHAPE_TEXTURE
int vertexOffset=gl_VertexID*u_blendShapeTextureInfo.x;for(int i=0;i<OASIS_BLENDSHAPE_COUNT;i++){int vertexElementOffset=vertexOffset;float weight=u_blendShapeWeights[i];position.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#ifndef OMIT_NORMAL
#if defined( O3_HAS_NORMAL ) && defined( OASIS_BLENDSHAPE_NORMAL )
vertexElementOffset+=1;normal+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#if defined( O3_HAS_TANGENT ) && defined(OASIS_BLENDSHAPE_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
vertexElementOffset+=1;tangent.xyz+=getBlendShapeVertexElement(i,vertexElementOffset)*weight;
#endif
#endif
}
#else
position.xyz+=POSITION_BS0*u_blendShapeWeights[0];position.xyz+=POSITION_BS1*u_blendShapeWeights[1];position.xyz+=POSITION_BS2*u_blendShapeWeights[2];position.xyz+=POSITION_BS3*u_blendShapeWeights[3];
#if defined( OASIS_BLENDSHAPE_NORMAL ) || defined( OASIS_BLENDSHAPE_TANGENT )
#ifndef OMIT_NORMAL
#if defined( O3_HAS_NORMAL ) && defined( OASIS_BLENDSHAPE_NORMAL )
normal+=NORMAL_BS0*u_blendShapeWeights[0];normal+=NORMAL_BS1*u_blendShapeWeights[1];normal+=NORMAL_BS2*u_blendShapeWeights[2];normal+=NORMAL_BS3*u_blendShapeWeights[3];
#endif
#if defined( O3_HAS_TANGENT ) && defined(OASIS_BLENDSHAPE_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
tangent.xyz+=TANGENT_BS0*u_blendShapeWeights[0];tangent.xyz+=TANGENT_BS1*u_blendShapeWeights[1];tangent.xyz+=TANGENT_BS2*u_blendShapeWeights[2];tangent.xyz+=TANGENT_BS3*u_blendShapeWeights[3];
#endif
#endif
#else
position.xyz+=POSITION_BS4*u_blendShapeWeights[4];position.xyz+=POSITION_BS5*u_blendShapeWeights[5];position.xyz+=POSITION_BS6*u_blendShapeWeights[6];position.xyz+=POSITION_BS7*u_blendShapeWeights[7];
#endif
#endif
#endif
`,Mx=`#define GLSLIFY 1
#ifdef O3_HAS_UV
v_uv=TEXCOORD_0;
#else
v_uv=vec2(0.,0.);
#endif
#ifdef O3_HAS_UV1
v_uv1=TEXCOORD_1;
#endif
#ifdef O3_NEED_TILINGOFFSET
v_uv=v_uv*u_tilingOffset.xy+u_tilingOffset.zw;
#endif
`,Rx=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
vec4 temp_pos=u_modelMat*position;v_pos=temp_pos.xyz/temp_pos.w;
#endif
`,Fx=`#define GLSLIFY 1
#ifdef O3_GENERATE_SHADOW_MAP
gl_Position=u_projMatFromLight*u_viewMatFromLight*u_modelMat*position;
#endif
#ifdef O3_SHADOW_MAP_COUNT
for(int i=0;i<O3_SHADOW_MAP_COUNT;i++){v_PositionFromLight[i]=u_projMatFromLight[i]*u_viewMatFromLight[i]*u_modelMat*vec4(POSITION,1.0);}
#endif
`,zx=`#define GLSLIFY 1
#ifdef O3_HAS_FOG
v_fogDepth=(u_MVMat*position).xyz;
#endif
`,Lx=`#define GLSLIFY 1
#ifdef O3_DIRECT_LIGHT_COUNT
struct DirectLight{vec3 color;vec3 direction;};uniform vec3 u_directLightColor[O3_DIRECT_LIGHT_COUNT];uniform vec3 u_directLightDirection[O3_DIRECT_LIGHT_COUNT];
#endif
#ifdef O3_POINT_LIGHT_COUNT
struct PointLight{vec3 color;vec3 position;float distance;};uniform vec3 u_pointLightColor[O3_POINT_LIGHT_COUNT];uniform vec3 u_pointLightPosition[O3_POINT_LIGHT_COUNT];uniform float u_pointLightDistance[O3_POINT_LIGHT_COUNT];
#endif
#ifdef O3_SPOT_LIGHT_COUNT
struct SpotLight{vec3 color;vec3 position;vec3 direction;float distance;float angleCos;float penumbraCos;};uniform vec3 u_spotLightColor[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightPosition[O3_SPOT_LIGHT_COUNT];uniform vec3 u_spotLightDirection[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightDistance[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightAngleCos[O3_SPOT_LIGHT_COUNT];uniform float u_spotLightPenumbraCos[O3_SPOT_LIGHT_COUNT];
#endif
struct EnvMapLight{vec3 diffuse;float mipMapLevel;float diffuseIntensity;float specularIntensity;};uniform EnvMapLight u_envMapLight;
#ifdef O3_USE_SH
uniform vec3 u_env_sh[9];
#endif
#ifdef O3_USE_SPECULAR_ENV
uniform samplerCube u_env_specularSampler;
#endif
`,Bx=`#define GLSLIFY 1
uniform vec4 u_emissiveColor;uniform vec4 u_baseColor;uniform vec4 u_specularColor;uniform float u_shininess;uniform float u_normalIntensity;uniform float u_alphaCutoff;
#ifdef EMISSIVETEXTURE
uniform sampler2D u_emissiveTexture;
#endif
#ifdef BASETEXTURE
uniform sampler2D u_baseTexture;
#endif
#ifdef O3_SPECULAR_TEXTURE
uniform sampler2D u_specularTexture;
#endif
#ifdef NORMALTEXTURE
uniform sampler2D u_normalTexture;
#endif
`,Dx=`#define GLSLIFY 1
#ifdef O3_HAS_FOG
float fogDepth=length(v_fogDepth);
#ifdef O3_FOG_EXP2
float fogFactor=whiteCompliment(exp2(-u_fogDensity*u_fogDensity*fogDepth*fogDepth*LOG2));
#else
float fogFactor=smoothstep(u_fogNear,u_fogFar,fogDepth);
#endif
gl_FragColor.rgb=mix(gl_FragColor.rgb,u_fogColor,fogFactor);
#endif
`,Ox=`#define GLSLIFY 1
vec4 ambient=vec4(0.0);vec4 emission=u_emissiveColor;vec4 diffuse=u_baseColor;vec4 specular=u_specularColor;
#ifdef EMISSIVETEXTURE
vec4 emissiveTextureColor=texture2D(u_emissiveTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
emissiveTextureColor=gammaToLinear(emissiveTextureColor);
#endif
emission*=emissiveTextureColor;
#endif
#ifdef BASETEXTURE
vec4 diffuseTextureColor=texture2D(u_baseTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
diffuseTextureColor=gammaToLinear(diffuseTextureColor);
#endif
diffuse*=diffuseTextureColor;
#endif
#ifdef O3_HAS_VERTEXCOLOR
diffuse*=v_color;
#endif
#ifdef O3_SPECULAR_TEXTURE
vec4 specularTextureColor=texture2D(u_specularTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
specularTextureColor=gammaToLinear(specularTextureColor);
#endif
specular*=specularTextureColor;
#endif
ambient=vec4(u_envMapLight.diffuse*u_envMapLight.diffuseIntensity,1.0)*diffuse;`,Ix=`#define GLSLIFY 1
#ifdef O3_NEED_WORLDPOS
vec3 V=normalize(u_cameraPos-v_pos);
#endif
`,Nx=`#define GLSLIFY 1
#ifdef NORMALTEXTURE
mat3 tbn=getTBN();vec3 N=getNormalByNormalTexture(tbn,u_normalTexture,u_normalIntensity,v_uv);
#else
vec3 N=getNormal();
#endif
vec3 lightDiffuse=vec3(0.0,0.0,0.0);vec3 lightSpecular=vec3(0.0,0.0,0.0);
#ifdef O3_DIRECT_LIGHT_COUNT
DirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];directionalLight.direction=u_directLightDirection[i];float d=max(dot(N,-directionalLight.direction),0.0);lightDiffuse+=directionalLight.color*d;vec3 halfDir=normalize(V-directionalLight.direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess);lightSpecular+=directionalLight.color*s;}
#endif
#ifdef O3_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];vec3 direction=v_pos-pointLight.position;float dist=length(direction);direction/=dist;float decay=clamp(1.0-pow(dist/pointLight.distance,4.0),0.0,1.0);float d=max(dot(N,-direction),0.0)*decay;lightDiffuse+=pointLight.color*d;vec3 halfDir=normalize(V-direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decay;lightSpecular+=pointLight.color*s;}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];vec3 direction=spotLight.position-v_pos;float lightDistance=length(direction);direction/=lightDistance;float angleCos=dot(direction,-spotLight.direction);float decay=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayTotal=decay*spotEffect;float d=max(dot(N,direction),0.0)*decayTotal;lightDiffuse+=spotLight.color*d;vec3 halfDir=normalize(V+direction);float s=pow(clamp(dot(N,halfDir),0.0,1.0),u_shininess)*decayTotal;lightSpecular+=spotLight.color*s;}
#endif
diffuse*=vec4(lightDiffuse,1.0);specular*=vec4(lightSpecular,1.0);
#ifdef ALPHA_CUTOFF
if(diffuse.a<u_alphaCutoff){discard;}
#endif
`,kx=`#define GLSLIFY 1
vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;}float mod289(float x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod7(vec4 x){return x-floor(x*(1.0/7.0))*7.0;}vec3 mod7(vec3 x){return x-floor(x*(1.0/7.0))*7.0;}vec4 permute(vec4 x){return mod289((34.0*x+1.0)*x);}vec3 permute(vec3 x){return mod289((34.0*x+1.0)*x);}float permute(float x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float taylorInvSqrt(float r){return 1.79284291400159-0.85373472095314*r;}vec4 fade(vec4 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec3 fade(vec3 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}vec2 fade(vec2 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}
#define K 0.142857142857
#define Ko 0.428571428571
#define K2 0.020408163265306
#define Kd2 0.0714285714285
#define Kz 0.166666666667
#define Kzo 0.416666666667
#define jitter 1.0
#define jitter1 0.8
`,Ux=`#define GLSLIFY 1
vec2 cellular(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec3 oi=vec3(-1.0,0.0,1.0);vec3 of=vec3(-0.5,0.5,1.5);vec3 px=permute(Pi.x+oi);vec3 p=permute(px.x+Pi.y+oi);vec3 ox=fract(p*K)-Ko;vec3 oy=mod7(floor(p*K))*K-Ko;vec3 dx=Pf.x+0.5+jitter*ox;vec3 dy=Pf.y-of+jitter*oy;vec3 d1=dx*dx+dy*dy;p=permute(px.y+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-0.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d2=dx*dx+dy*dy;p=permute(px.z+Pi.y+oi);ox=fract(p*K)-Ko;oy=mod7(floor(p*K))*K-Ko;dx=Pf.x-1.5+jitter*ox;dy=Pf.y-of+jitter*oy;vec3 d3=dx*dx+dy*dy;vec3 d1a=min(d1,d2);d2=max(d1,d2);d2=min(d2,d3);d1=min(d1a,d2);d2=max(d1a,d2);d1.xy=(d1.x<d1.y)? d1.xy : d1.yx;d1.xz=(d1.x<d1.z)? d1.xz : d1.zx;d1.yz=min(d1.yz,d2.yz);d1.y=min(d1.y,d1.z);d1.y=min(d1.y,d2.x);return sqrt(d1.xy);}`,Vx=`#define GLSLIFY 1
vec2 cellular2x2(vec2 P){vec2 Pi=mod289(floor(P));vec2 Pf=fract(P);vec4 Pfx=Pf.x+vec4(-0.5,-1.5,-0.5,-1.5);vec4 Pfy=Pf.y+vec4(-0.5,-0.5,-1.5,-1.5);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 ox=mod7(p)*K+Kd2;vec4 oy=mod7(floor(p*K))*K+Kd2;vec4 dx=Pfx+jitter1*ox;vec4 dy=Pfy+jitter1*oy;vec4 d=dx*dx+dy*dy;d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.y=min(d.y,d.z);d.y=min(d.y,d.w);return sqrt(d.xy);}`,Gx=`#define GLSLIFY 1
vec2 cellular2x2x2(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P);vec4 Pfx=Pf.x+vec4(0.0,-1.0,0.0,-1.0);vec4 Pfy=Pf.y+vec4(0.0,0.0,-1.0,-1.0);vec4 p=permute(Pi.x+vec4(0.0,1.0,0.0,1.0));p=permute(p+Pi.y+vec4(0.0,0.0,1.0,1.0));vec4 p1=permute(p+Pi.z);vec4 p2=permute(p+Pi.z+vec4(1.0));vec4 ox1=fract(p1*K)-Ko;vec4 oy1=mod7(floor(p1*K))*K-Ko;vec4 oz1=floor(p1*K2)*Kz-Kzo;vec4 ox2=fract(p2*K)-Ko;vec4 oy2=mod7(floor(p2*K))*K-Ko;vec4 oz2=floor(p2*K2)*Kz-Kzo;vec4 dx1=Pfx+jitter1*ox1;vec4 dy1=Pfy+jitter1*oy1;vec4 dz1=Pf.z+jitter1*oz1;vec4 dx2=Pfx+jitter1*ox2;vec4 dy2=Pfy+jitter1*oy2;vec4 dz2=Pf.z-1.0+jitter1*oz2;vec4 d1=dx1*dx1+dy1*dy1+dz1*dz1;vec4 d2=dx2*dx2+dy2*dy2+dz2*dz2;vec4 d=min(d1,d2);d2=max(d1,d2);d.xy=(d.x<d.y)? d.xy : d.yx;d.xz=(d.x<d.z)? d.xz : d.zx;d.xw=(d.x<d.w)? d.xw : d.wx;d.yzw=min(d.yzw,d2.yzw);d.y=min(d.y,d.z);d.y=min(d.y,d.w);d.y=min(d.y,d2.x);return sqrt(d.xy);}`,Hx=`#define GLSLIFY 1
vec2 cellular(vec3 P){vec3 Pi=mod289(floor(P));vec3 Pf=fract(P)-0.5;vec3 Pfx=Pf.x+vec3(1.0,0.0,-1.0);vec3 Pfy=Pf.y+vec3(1.0,0.0,-1.0);vec3 Pfz=Pf.z+vec3(1.0,0.0,-1.0);vec3 p=permute(Pi.x+vec3(-1.0,0.0,1.0));vec3 p1=permute(p+Pi.y-1.0);vec3 p2=permute(p+Pi.y);vec3 p3=permute(p+Pi.y+1.0);vec3 p11=permute(p1+Pi.z-1.0);vec3 p12=permute(p1+Pi.z);vec3 p13=permute(p1+Pi.z+1.0);vec3 p21=permute(p2+Pi.z-1.0);vec3 p22=permute(p2+Pi.z);vec3 p23=permute(p2+Pi.z+1.0);vec3 p31=permute(p3+Pi.z-1.0);vec3 p32=permute(p3+Pi.z);vec3 p33=permute(p3+Pi.z+1.0);vec3 ox11=fract(p11*K)-Ko;vec3 oy11=mod7(floor(p11*K))*K-Ko;vec3 oz11=floor(p11*K2)*Kz-Kzo;vec3 ox12=fract(p12*K)-Ko;vec3 oy12=mod7(floor(p12*K))*K-Ko;vec3 oz12=floor(p12*K2)*Kz-Kzo;vec3 ox13=fract(p13*K)-Ko;vec3 oy13=mod7(floor(p13*K))*K-Ko;vec3 oz13=floor(p13*K2)*Kz-Kzo;vec3 ox21=fract(p21*K)-Ko;vec3 oy21=mod7(floor(p21*K))*K-Ko;vec3 oz21=floor(p21*K2)*Kz-Kzo;vec3 ox22=fract(p22*K)-Ko;vec3 oy22=mod7(floor(p22*K))*K-Ko;vec3 oz22=floor(p22*K2)*Kz-Kzo;vec3 ox23=fract(p23*K)-Ko;vec3 oy23=mod7(floor(p23*K))*K-Ko;vec3 oz23=floor(p23*K2)*Kz-Kzo;vec3 ox31=fract(p31*K)-Ko;vec3 oy31=mod7(floor(p31*K))*K-Ko;vec3 oz31=floor(p31*K2)*Kz-Kzo;vec3 ox32=fract(p32*K)-Ko;vec3 oy32=mod7(floor(p32*K))*K-Ko;vec3 oz32=floor(p32*K2)*Kz-Kzo;vec3 ox33=fract(p33*K)-Ko;vec3 oy33=mod7(floor(p33*K))*K-Ko;vec3 oz33=floor(p33*K2)*Kz-Kzo;vec3 dx11=Pfx+jitter*ox11;vec3 dy11=Pfy.x+jitter*oy11;vec3 dz11=Pfz.x+jitter*oz11;vec3 dx12=Pfx+jitter*ox12;vec3 dy12=Pfy.x+jitter*oy12;vec3 dz12=Pfz.y+jitter*oz12;vec3 dx13=Pfx+jitter*ox13;vec3 dy13=Pfy.x+jitter*oy13;vec3 dz13=Pfz.z+jitter*oz13;vec3 dx21=Pfx+jitter*ox21;vec3 dy21=Pfy.y+jitter*oy21;vec3 dz21=Pfz.x+jitter*oz21;vec3 dx22=Pfx+jitter*ox22;vec3 dy22=Pfy.y+jitter*oy22;vec3 dz22=Pfz.y+jitter*oz22;vec3 dx23=Pfx+jitter*ox23;vec3 dy23=Pfy.y+jitter*oy23;vec3 dz23=Pfz.z+jitter*oz23;vec3 dx31=Pfx+jitter*ox31;vec3 dy31=Pfy.z+jitter*oy31;vec3 dz31=Pfz.x+jitter*oz31;vec3 dx32=Pfx+jitter*ox32;vec3 dy32=Pfy.z+jitter*oy32;vec3 dz32=Pfz.y+jitter*oz32;vec3 dx33=Pfx+jitter*ox33;vec3 dy33=Pfy.z+jitter*oy33;vec3 dz33=Pfz.z+jitter*oz33;vec3 d11=dx11*dx11+dy11*dy11+dz11*dz11;vec3 d12=dx12*dx12+dy12*dy12+dz12*dz12;vec3 d13=dx13*dx13+dy13*dy13+dz13*dz13;vec3 d21=dx21*dx21+dy21*dy21+dz21*dz21;vec3 d22=dx22*dx22+dy22*dy22+dz22*dz22;vec3 d23=dx23*dx23+dy23*dy23+dz23*dz23;vec3 d31=dx31*dx31+dy31*dy31+dz31*dz31;vec3 d32=dx32*dx32+dy32*dy32+dz32*dz32;vec3 d33=dx33*dx33+dy33*dy33+dz33*dz33;vec3 d1a=min(d11,d12);d12=max(d11,d12);d11=min(d1a,d13);d13=max(d1a,d13);d12=min(d12,d13);vec3 d2a=min(d21,d22);d22=max(d21,d22);d21=min(d2a,d23);d23=max(d2a,d23);d22=min(d22,d23);vec3 d3a=min(d31,d32);d32=max(d31,d32);d31=min(d3a,d33);d33=max(d3a,d33);d32=min(d32,d33);vec3 da=min(d11,d21);d21=max(d11,d21);d11=min(da,d31);d31=max(da,d31);d11.xy=(d11.x<d11.y)? d11.xy : d11.yx;d11.xz=(d11.x<d11.z)? d11.xz : d11.zx;d12=min(d12,d21);d12=min(d12,d22);d12=min(d12,d31);d12=min(d12,d32);d11.yz=min(d11.yz,d12.xy);d11.y=min(d11.y,d12.z);d11.y=min(d11.y,d11.z);return sqrt(d11.xy);}`,Wx=`#define GLSLIFY 1
#include <noise_cellular_2D>
#include <noise_cellular_3D>
#include <noise_cellular_2x2>
#include <noise_cellular_2x2x2>
`,jx=`#define GLSLIFY 1
float perlin(vec2 P){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}float perlin(vec2 P,vec2 rep){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod(Pi,rep.xyxy);Pi=mod289(Pi);vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);float n_xy=mix(n_x.x,n_x.y,fade_xy.y);return 2.3*n_xy;}`,Xx=`#define GLSLIFY 1
float perlin(vec3 P){vec3 Pi0=floor(P);vec3 Pi1=Pi0+vec3(1.0);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}float perlin(vec3 P,vec3 rep){vec3 Pi0=mod(floor(P),rep);vec3 Pi1=mod(Pi0+vec3(1.0),rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P);vec3 Pf1=Pf0-vec3(1.0);vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}`,$x=`#define GLSLIFY 1
float perlin(vec4 P){vec4 Pi0=floor(P);vec4 Pi1=Pi0+1.0;Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}float perlin(vec4 P,vec4 rep){vec4 Pi0=mod(floor(P),rep);vec4 Pi1=mod(Pi0+1.0,rep);Pi0=mod289(Pi0);Pi1=mod289(Pi1);vec4 Pf0=fract(P);vec4 Pf1=Pf0-1.0;vec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=vec4(Pi0.zzzz);vec4 iz1=vec4(Pi1.zzzz);vec4 iw0=vec4(Pi0.wwww);vec4 iw1=vec4(Pi1.wwww);vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 ixy00=permute(ixy0+iw0);vec4 ixy01=permute(ixy0+iw1);vec4 ixy10=permute(ixy1+iw0);vec4 ixy11=permute(ixy1+iw1);vec4 gx00=ixy00*(1.0/7.0);vec4 gy00=floor(gx00)*(1.0/7.0);vec4 gz00=floor(gy00)*(1.0/6.0);gx00=fract(gx00)-0.5;gy00=fract(gy00)-0.5;gz00=fract(gz00)-0.5;vec4 gw00=vec4(0.75)-abs(gx00)-abs(gy00)-abs(gz00);vec4 sw00=step(gw00,vec4(0.0));gx00-=sw00*(step(0.0,gx00)-0.5);gy00-=sw00*(step(0.0,gy00)-0.5);vec4 gx01=ixy01*(1.0/7.0);vec4 gy01=floor(gx01)*(1.0/7.0);vec4 gz01=floor(gy01)*(1.0/6.0);gx01=fract(gx01)-0.5;gy01=fract(gy01)-0.5;gz01=fract(gz01)-0.5;vec4 gw01=vec4(0.75)-abs(gx01)-abs(gy01)-abs(gz01);vec4 sw01=step(gw01,vec4(0.0));gx01-=sw01*(step(0.0,gx01)-0.5);gy01-=sw01*(step(0.0,gy01)-0.5);vec4 gx10=ixy10*(1.0/7.0);vec4 gy10=floor(gx10)*(1.0/7.0);vec4 gz10=floor(gy10)*(1.0/6.0);gx10=fract(gx10)-0.5;gy10=fract(gy10)-0.5;gz10=fract(gz10)-0.5;vec4 gw10=vec4(0.75)-abs(gx10)-abs(gy10)-abs(gz10);vec4 sw10=step(gw10,vec4(0.0));gx10-=sw10*(step(0.0,gx10)-0.5);gy10-=sw10*(step(0.0,gy10)-0.5);vec4 gx11=ixy11*(1.0/7.0);vec4 gy11=floor(gx11)*(1.0/7.0);vec4 gz11=floor(gy11)*(1.0/6.0);gx11=fract(gx11)-0.5;gy11=fract(gy11)-0.5;gz11=fract(gz11)-0.5;vec4 gw11=vec4(0.75)-abs(gx11)-abs(gy11)-abs(gz11);vec4 sw11=step(gw11,vec4(0.0));gx11-=sw11*(step(0.0,gx11)-0.5);gy11-=sw11*(step(0.0,gy11)-0.5);vec4 g0000=vec4(gx00.x,gy00.x,gz00.x,gw00.x);vec4 g1000=vec4(gx00.y,gy00.y,gz00.y,gw00.y);vec4 g0100=vec4(gx00.z,gy00.z,gz00.z,gw00.z);vec4 g1100=vec4(gx00.w,gy00.w,gz00.w,gw00.w);vec4 g0010=vec4(gx10.x,gy10.x,gz10.x,gw10.x);vec4 g1010=vec4(gx10.y,gy10.y,gz10.y,gw10.y);vec4 g0110=vec4(gx10.z,gy10.z,gz10.z,gw10.z);vec4 g1110=vec4(gx10.w,gy10.w,gz10.w,gw10.w);vec4 g0001=vec4(gx01.x,gy01.x,gz01.x,gw01.x);vec4 g1001=vec4(gx01.y,gy01.y,gz01.y,gw01.y);vec4 g0101=vec4(gx01.z,gy01.z,gz01.z,gw01.z);vec4 g1101=vec4(gx01.w,gy01.w,gz01.w,gw01.w);vec4 g0011=vec4(gx11.x,gy11.x,gz11.x,gw11.x);vec4 g1011=vec4(gx11.y,gy11.y,gz11.y,gw11.y);vec4 g0111=vec4(gx11.z,gy11.z,gz11.z,gw11.z);vec4 g1111=vec4(gx11.w,gy11.w,gz11.w,gw11.w);vec4 norm00=taylorInvSqrt(vec4(dot(g0000,g0000),dot(g0100,g0100),dot(g1000,g1000),dot(g1100,g1100)));g0000*=norm00.x;g0100*=norm00.y;g1000*=norm00.z;g1100*=norm00.w;vec4 norm01=taylorInvSqrt(vec4(dot(g0001,g0001),dot(g0101,g0101),dot(g1001,g1001),dot(g1101,g1101)));g0001*=norm01.x;g0101*=norm01.y;g1001*=norm01.z;g1101*=norm01.w;vec4 norm10=taylorInvSqrt(vec4(dot(g0010,g0010),dot(g0110,g0110),dot(g1010,g1010),dot(g1110,g1110)));g0010*=norm10.x;g0110*=norm10.y;g1010*=norm10.z;g1110*=norm10.w;vec4 norm11=taylorInvSqrt(vec4(dot(g0011,g0011),dot(g0111,g0111),dot(g1011,g1011),dot(g1111,g1111)));g0011*=norm11.x;g0111*=norm11.y;g1011*=norm11.z;g1111*=norm11.w;float n0000=dot(g0000,Pf0);float n1000=dot(g1000,vec4(Pf1.x,Pf0.yzw));float n0100=dot(g0100,vec4(Pf0.x,Pf1.y,Pf0.zw));float n1100=dot(g1100,vec4(Pf1.xy,Pf0.zw));float n0010=dot(g0010,vec4(Pf0.xy,Pf1.z,Pf0.w));float n1010=dot(g1010,vec4(Pf1.x,Pf0.y,Pf1.z,Pf0.w));float n0110=dot(g0110,vec4(Pf0.x,Pf1.yz,Pf0.w));float n1110=dot(g1110,vec4(Pf1.xyz,Pf0.w));float n0001=dot(g0001,vec4(Pf0.xyz,Pf1.w));float n1001=dot(g1001,vec4(Pf1.x,Pf0.yz,Pf1.w));float n0101=dot(g0101,vec4(Pf0.x,Pf1.y,Pf0.z,Pf1.w));float n1101=dot(g1101,vec4(Pf1.xy,Pf0.z,Pf1.w));float n0011=dot(g0011,vec4(Pf0.xy,Pf1.zw));float n1011=dot(g1011,vec4(Pf1.x,Pf0.y,Pf1.zw));float n0111=dot(g0111,vec4(Pf0.x,Pf1.yzw));float n1111=dot(g1111,Pf1);vec4 fade_xyzw=fade(Pf0);vec4 n_0w=mix(vec4(n0000,n1000,n0100,n1100),vec4(n0001,n1001,n0101,n1101),fade_xyzw.w);vec4 n_1w=mix(vec4(n0010,n1010,n0110,n1110),vec4(n0011,n1011,n0111,n1111),fade_xyzw.w);vec4 n_zw=mix(n_0w,n_1w,fade_xyzw.z);vec2 n_yzw=mix(n_zw.xy,n_zw.zw,fade_xyzw.y);float n_xyzw=mix(n_yzw.x,n_yzw.y,fade_xyzw.x);return 2.2*n_xyzw;}`,qx=`#define GLSLIFY 1
#include <noise_perlin_2D>
#include <noise_perlin_3D>
#include <noise_perlin_4D>
`,Yx=`#define GLSLIFY 1
vec2 rgrad2(vec2 p,float rot){float u=permute(permute(p.x)+p.y)*0.0243902439+rot;u=fract(u)*6.28318530718;return vec2(cos(u),sin(u));}vec3 psrdnoise(vec2 pos,vec2 per,float rot){pos.y+=0.01;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 psdnoise(vec2 pos,vec2 per){return psrdnoise(pos,per,0.0);}float psrnoise(vec2 pos,vec2 per,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 xw=mod(vec3(p0.x,p1.x,p2.x),per.x);vec3 yw=mod(vec3(p0.y,p1.y,p2.y),per.y);vec3 iuw=xw+0.5*yw;vec3 ivw=yw;vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float psnoise(vec2 pos,vec2 per){return psrnoise(pos,per,0.0);}vec3 srdnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));vec3 dtdx=-2.0*vec3(d0.x,d1.x,d2.x);vec3 dtdy=-2.0*vec3(d0.y,d1.y,d2.y);if(t.x<0.0){dtdx.x=0.0;dtdy.x=0.0;t.x=0.0;}if(t.y<0.0){dtdx.y=0.0;dtdy.y=0.0;t.y=0.0;}if(t.z<0.0){dtdx.z=0.0;dtdy.z=0.0;t.z=0.0;}vec3 t2=t*t;vec3 t4=t2*t2;vec3 t3=t2*t;float n=dot(t4,w);vec2 dt0=vec2(dtdx.x,dtdy.x)*4.0*t3.x;vec2 dn0=t4.x*g0+dt0*w.x;vec2 dt1=vec2(dtdx.y,dtdy.y)*4.0*t3.y;vec2 dn1=t4.y*g1+dt1*w.y;vec2 dt2=vec2(dtdx.z,dtdy.z)*4.0*t3.z;vec2 dn2=t4.z*g2+dt2*w.z;return 11.0*vec3(n,dn0+dn1+dn2);}vec3 sdnoise(vec2 pos){return srdnoise(pos,0.0);}float srnoise(vec2 pos,float rot){pos.y+=0.001;vec2 uv=vec2(pos.x+pos.y*0.5,pos.y);vec2 i0=floor(uv);vec2 f0=fract(uv);vec2 i1=(f0.x>f0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec2 p0=vec2(i0.x-i0.y*0.5,i0.y);vec2 p1=vec2(p0.x+i1.x-i1.y*0.5,p0.y+i1.y);vec2 p2=vec2(p0.x+0.5,p0.y+1.0);i1=i0+i1;vec2 i2=i0+vec2(1.0,1.0);vec2 d0=pos-p0;vec2 d1=pos-p1;vec2 d2=pos-p2;vec3 x=vec3(p0.x,p1.x,p2.x);vec3 y=vec3(p0.y,p1.y,p2.y);vec3 iuw=x+0.5*y;vec3 ivw=y;iuw=mod289(iuw);ivw=mod289(ivw);vec2 g0=rgrad2(vec2(iuw.x,ivw.x),rot);vec2 g1=rgrad2(vec2(iuw.y,ivw.y),rot);vec2 g2=rgrad2(vec2(iuw.z,ivw.z),rot);vec3 w=vec3(dot(g0,d0),dot(g1,d1),dot(g2,d2));vec3 t=0.8-vec3(dot(d0,d0),dot(d1,d1),dot(d2,d2));t=max(t,0.0);vec3 t2=t*t;vec3 t4=t2*t2;float n=dot(t4,w);return 11.0*n;}float snoise(vec2 pos){return srnoise(pos,0.0);}`,Qx=`#define GLSLIFY 1
float simplex(vec2 v){const vec4 C=vec4(0.211324865405187,0.366025403784439,-0.577350269189626,0.024390243902439);vec2 i=floor(v+dot(v,C.yy));vec2 x0=v-i+dot(i,C.xx);vec2 i1;i1=(x0.x>x0.y)? vec2(1.0,0.0): vec2(0.0,1.0);vec4 x12=x0.xyxy+C.xxzz;x12.xy-=i1;i=mod289(i);vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0));vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0);m=m*m;m=m*m;vec3 x=2.0*fract(p*C.www)-1.0;vec3 h=abs(x)-0.5;vec3 ox=floor(x+0.5);vec3 a0=x-ox;m*=1.79284291400159-0.85373472095314*(a0*a0+h*h);vec3 g;g.x=a0.x*x0.x+h.x*x0.y;g.yz=a0.yz*x12.xz+h.yz*x12.yw;return 130.0*dot(m,g);}`,Jx=`#define GLSLIFY 1
float simplex(vec3 v,out vec3 gradient){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);vec4 m2=m*m;vec4 m4=m2*m2;vec4 pdotx=vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3));vec4 temp=m2*m*pdotx;gradient=-8.0*(temp.x*x0+temp.y*x1+temp.z*x2+temp.w*x3);gradient+=m4.x*p0+m4.y*p1+m4.z*p2+m4.w*p3;gradient*=42.0;return 42.0*dot(m4,pdotx);}`,Kx=`#define GLSLIFY 1
float simplex(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`,Zx=`#define GLSLIFY 1
vec4 grad4(float j,vec4 ip){const vec4 ones=vec4(1.0,1.0,1.0,-1.0);vec4 p,s;p.xyz=floor(fract(vec3(j)*ip.xyz)*7.0)*ip.z-1.0;p.w=1.5-dot(abs(p.xyz),ones.xyz);s=vec4(lessThan(p,vec4(0.0)));p.xyz=p.xyz+(s.xyz*2.0-1.0)*s.www;return p;}
#define F4 0.309016994374947451
float simplex(vec4 v){const vec4 C=vec4(0.138196601125011,0.276393202250021,0.414589803375032,-0.447213595499958);vec4 i=floor(v+dot(v,vec4(F4)));vec4 x0=v-i+dot(i,C.xxxx);vec4 i0;vec3 isX=step(x0.yzw,x0.xxx);vec3 isYZ=step(x0.zww,x0.yyz);i0.x=isX.x+isX.y+isX.z;i0.yzw=1.0-isX;i0.y+=isYZ.x+isYZ.y;i0.zw+=1.0-isYZ.xy;i0.z+=isYZ.z;i0.w+=1.0-isYZ.z;vec4 i3=clamp(i0,0.0,1.0);vec4 i2=clamp(i0-1.0,0.0,1.0);vec4 i1=clamp(i0-2.0,0.0,1.0);vec4 x1=x0-i1+C.xxxx;vec4 x2=x0-i2+C.yyyy;vec4 x3=x0-i3+C.zzzz;vec4 x4=x0+C.wwww;i=mod289(i);float j0=permute(permute(permute(permute(i.w)+i.z)+i.y)+i.x);vec4 j1=permute(permute(permute(permute(i.w+vec4(i1.w,i2.w,i3.w,1.0))+i.z+vec4(i1.z,i2.z,i3.z,1.0))+i.y+vec4(i1.y,i2.y,i3.y,1.0))+i.x+vec4(i1.x,i2.x,i3.x,1.0));vec4 ip=vec4(1.0/294.0,1.0/49.0,1.0/7.0,0.0);vec4 p0=grad4(j0,ip);vec4 p1=grad4(j1.x,ip);vec4 p2=grad4(j1.y,ip);vec4 p3=grad4(j1.z,ip);vec4 p4=grad4(j1.w,ip);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;p4*=taylorInvSqrt(dot(p4,p4));vec3 m0=max(0.6-vec3(dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);vec2 m1=max(0.6-vec2(dot(x3,x3),dot(x4,x4)),0.0);m0=m0*m0;m1=m1*m1;return 49.0*(dot(m0*m0,vec3(dot(p0,x0),dot(p1,x1),dot(p2,x2)))+dot(m1*m1,vec2(dot(p3,x3),dot(p4,x4))));}`,ew=`#define GLSLIFY 1
#include <noise_simplex_2D>
#include <noise_simplex_3D>
#include <noise_simplex_3D_grad>
#include <noise_simplex_4D>
`,tw=`#define GLSLIFY 1
uniform float u_alphaCutoff;uniform vec4 u_baseColor;uniform float u_metal;uniform float u_roughness;uniform vec3 u_PBRSpecularColor;uniform float u_glossiness;uniform vec3 u_emissiveColor;
#ifdef CLEARCOAT
uniform float u_clearCoat;uniform float u_clearCoatRoughness;
#endif
uniform float u_normalIntensity;uniform float u_occlusionIntensity;uniform float u_occlusionTextureCoord;
#ifdef BASETEXTURE
uniform sampler2D u_baseTexture;
#endif
#ifdef NORMALTEXTURE
uniform sampler2D u_normalTexture;
#endif
#ifdef EMISSIVETEXTURE
uniform sampler2D u_emissiveTexture;
#endif
#ifdef ROUGHNESSMETALLICTEXTURE
uniform sampler2D u_roughnessMetallicTexture;
#endif
#ifdef SPECULARGLOSSINESSTEXTURE
uniform sampler2D u_specularGlossinessTexture;
#endif
#ifdef OCCLUSIONTEXTURE
uniform sampler2D u_occlusionTexture;
#endif
#ifdef HAS_CLEARCOATTEXTURE
uniform sampler2D u_clearCoatTexture;
#endif
#ifdef HAS_CLEARCOATROUGHNESSTEXTURE
uniform sampler2D u_clearCoatRoughnessTexture;
#endif
#ifdef HAS_CLEARCOATNORMALTEXTURE
uniform sampler2D u_clearCoatNormalTexture;
#endif
struct ReflectedLight{vec3 directDiffuse;vec3 directSpecular;vec3 indirectDiffuse;vec3 indirectSpecular;};struct Geometry{vec3 position;vec3 normal;vec3 viewDir;float dotNV;
#ifdef CLEARCOAT
vec3 clearCoatNormal;float clearCoatDotNV;
#endif
};struct Material{vec3 diffuseColor;float roughness;vec3 specularColor;float opacity;
#ifdef CLEARCOAT
float clearCoat;float clearCoatRoughness;
#endif
};`,rw=`#define GLSLIFY 1
#include <normal_get>
float computeSpecularOcclusion(float ambientOcclusion,float roughness,float dotNV){return saturate(pow(dotNV+ambientOcclusion,exp2(-16.0*roughness-1.0))-1.0+ambientOcclusion);}float getAARoughnessFactor(vec3 normal){
#ifdef HAS_DERIVATIVES
vec3 dxy=max(abs(dFdx(normal)),abs(dFdy(normal)));return 0.04+max(max(dxy.x,dxy.y),dxy.z);
#else
return 0.04;
#endif
}void initGeometry(out Geometry geometry){geometry.position=v_pos;geometry.viewDir=normalize(u_cameraPos-v_pos);
#if defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE)
mat3 tbn=getTBN();
#endif
#ifdef NORMALTEXTURE
geometry.normal=getNormalByNormalTexture(tbn,u_normalTexture,u_normalIntensity,v_uv);
#else
geometry.normal=getNormal();
#endif
geometry.dotNV=saturate(dot(geometry.normal,geometry.viewDir));
#ifdef CLEARCOAT
#ifdef HAS_CLEARCOATNORMALTEXTURE
geometry.clearCoatNormal=getNormalByNormalTexture(tbn,u_clearCoatNormalTexture,u_normalIntensity,v_uv);
#else
geometry.clearCoatNormal=getNormal();
#endif
geometry.clearCoatDotNV=saturate(dot(geometry.clearCoatNormal,geometry.viewDir));
#endif
}void initMaterial(out Material material,const in Geometry geometry){vec4 baseColor=u_baseColor;float metal=u_metal;float roughness=u_roughness;vec3 specularColor=u_PBRSpecularColor;float glossiness=u_glossiness;float alphaCutoff=u_alphaCutoff;
#ifdef BASETEXTURE
vec4 baseTextureColor=texture2D(u_baseTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
baseTextureColor=gammaToLinear(baseTextureColor);
#endif
baseColor*=baseTextureColor;
#endif
#ifdef O3_HAS_VERTEXCOLOR
baseColor*=v_color;
#endif
#ifdef ALPHA_CUTOFF
if(baseColor.a<alphaCutoff){discard;}
#endif
#ifdef ROUGHNESSMETALLICTEXTURE
vec4 metalRoughMapColor=texture2D(u_roughnessMetallicTexture,v_uv);roughness*=metalRoughMapColor.g;metal*=metalRoughMapColor.b;
#endif
#ifdef SPECULARGLOSSINESSTEXTURE
vec4 specularGlossinessColor=texture2D(u_specularGlossinessTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
specularGlossinessColor=gammaToLinear(specularGlossinessColor);
#endif
specularColor*=specularGlossinessColor.rgb;glossiness*=specularGlossinessColor.a;
#endif
#ifdef IS_METALLIC_WORKFLOW
material.diffuseColor=baseColor.rgb*(1.0-metal);material.specularColor=mix(vec3(0.04),baseColor.rgb,metal);material.roughness=roughness;
#else
float specularStrength=max(max(specularColor.r,specularColor.g),specularColor.b);material.diffuseColor=baseColor.rgb*(1.0-specularStrength);material.specularColor=specularColor;material.roughness=1.0-glossiness;
#endif
material.roughness=max(material.roughness,getAARoughnessFactor(geometry.normal));
#ifdef CLEARCOAT
material.clearCoat=u_clearCoat;material.clearCoatRoughness=u_clearCoatRoughness;
#ifdef HAS_CLEARCOATTEXTURE
material.clearCoat*=texture2D(u_clearCoatTexture,v_uv).r;
#endif
#ifdef HAS_CLEARCOATROUGHNESSTEXTURE
material.clearCoatRoughness*=texture2D(u_clearCoatRoughnessTexture,v_uv).g;
#endif
material.clearCoat=saturate(material.clearCoat);material.clearCoatRoughness=max(material.clearCoatRoughness,getAARoughnessFactor(geometry.clearCoatNormal));
#endif
material.opacity=baseColor.a;}
#include <brdf>
#include <direct_irradiance_frag_define>
#include <ibl_frag_define>
`,nw=`#define GLSLIFY 1
float F_Schlick(float dotLH){return 0.04+0.96*(pow(1.0-dotLH,5.0));}vec3 F_Schlick(vec3 specularColor,float dotLH){float fresnel=exp2((-5.55473*dotLH-6.98316)*dotLH);return(1.0-specularColor)*fresnel+specularColor;}float G_GGX_SmithCorrelated(float alpha,float dotNL,float dotNV){float a2=pow2(alpha);float gv=dotNL*sqrt(a2+(1.0-a2)*pow2(dotNV));float gl=dotNV*sqrt(a2+(1.0-a2)*pow2(dotNL));return 0.5/max(gv+gl,EPSILON);}float D_GGX(float alpha,float dotNH){float a2=pow2(alpha);float denom=pow2(dotNH)*(a2-1.0)+1.0;return RECIPROCAL_PI*a2/pow2(denom);}vec3 BRDF_Specular_GGX(vec3 incidentDirection,vec3 viewDir,vec3 normal,vec3 specularColor,float roughness){float alpha=pow2(roughness);vec3 halfDir=normalize(incidentDirection+viewDir);float dotNL=saturate(dot(normal,incidentDirection));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotLH=saturate(dot(incidentDirection,halfDir));vec3 F=F_Schlick(specularColor,dotLH);float G=G_GGX_SmithCorrelated(alpha,dotNL,dotNV);float D=D_GGX(alpha,dotNH);return F*(G*D);}vec3 BRDF_Diffuse_Lambert(vec3 diffuseColor){return RECIPROCAL_PI*diffuseColor;}`,iw=`#define GLSLIFY 1
void addDirectRadiance(vec3 incidentDirection,vec3 color,Geometry geometry,Material material,inout ReflectedLight reflectedLight){float attenuation=1.0;
#ifdef CLEARCOAT
float clearCoatDotNL=saturate(dot(geometry.clearCoatNormal,incidentDirection));vec3 clearCoatIrradiance=clearCoatDotNL*color;reflectedLight.directSpecular+=material.clearCoat*clearCoatIrradiance*BRDF_Specular_GGX(incidentDirection,geometry.viewDir,geometry.clearCoatNormal,vec3(0.04),material.clearCoatRoughness);attenuation-=material.clearCoat*F_Schlick(geometry.clearCoatDotNV);
#endif
float dotNL=saturate(dot(geometry.normal,incidentDirection));vec3 irradiance=dotNL*color*PI;reflectedLight.directSpecular+=attenuation*irradiance*BRDF_Specular_GGX(incidentDirection,geometry.viewDir,geometry.normal,material.specularColor,material.roughness);reflectedLight.directDiffuse+=attenuation*irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);}
#ifdef O3_DIRECT_LIGHT_COUNT
void addDirectionalDirectLightRadiance(DirectLight directionalLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 color=directionalLight.color;vec3 direction=-directionalLight.direction;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef O3_POINT_LIGHT_COUNT
void addPointDirectLightRadiance(PointLight pointLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=pointLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);vec3 color=pointLight.color;color*=clamp(1.0-pow(lightDistance/pointLight.distance,4.0),0.0,1.0);addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
void addSpotDirectLightRadiance(SpotLight spotLight,Geometry geometry,Material material,inout ReflectedLight reflectedLight){vec3 lVector=spotLight.position-geometry.position;vec3 direction=normalize(lVector);float lightDistance=length(lVector);float angleCos=dot(direction,-spotLight.direction);float spotEffect=smoothstep(spotLight.penumbraCos,spotLight.angleCos,angleCos);float decayEffect=clamp(1.0-pow(lightDistance/spotLight.distance,4.0),0.0,1.0);vec3 color=spotLight.color;color*=spotEffect*decayEffect;addDirectRadiance(direction,color,geometry,material,reflectedLight);}
#endif
void addTotalDirectRadiance(Geometry geometry,Material material,inout ReflectedLight reflectedLight){
#ifdef O3_DIRECT_LIGHT_COUNT
DirectLight directionalLight;for(int i=0;i<O3_DIRECT_LIGHT_COUNT;i++){directionalLight.color=u_directLightColor[i];directionalLight.direction=u_directLightDirection[i];addDirectionalDirectLightRadiance(directionalLight,geometry,material,reflectedLight);}
#endif
#ifdef O3_POINT_LIGHT_COUNT
PointLight pointLight;for(int i=0;i<O3_POINT_LIGHT_COUNT;i++){pointLight.color=u_pointLightColor[i];pointLight.position=u_pointLightPosition[i];pointLight.distance=u_pointLightDistance[i];addPointDirectLightRadiance(pointLight,geometry,material,reflectedLight);}
#endif
#ifdef O3_SPOT_LIGHT_COUNT
SpotLight spotLight;for(int i=0;i<O3_SPOT_LIGHT_COUNT;i++){spotLight.color=u_spotLightColor[i];spotLight.position=u_spotLightPosition[i];spotLight.direction=u_spotLightDirection[i];spotLight.distance=u_spotLightDistance[i];spotLight.angleCos=u_spotLightAngleCos[i];spotLight.penumbraCos=u_spotLightPenumbraCos[i];addSpotDirectLightRadiance(spotLight,geometry,material,reflectedLight);}
#endif
}`,aw=`#define GLSLIFY 1
vec3 getLightProbeIrradiance(vec3 sh[9],vec3 normal){normal.x=-normal.x;vec3 result=sh[0]+sh[1]*(normal.y)+sh[2]*(normal.z)+sh[3]*(normal.x)+sh[4]*(normal.y*normal.x)+sh[5]*(normal.y*normal.z)+sh[6]*(3.0*normal.z*normal.z-1.0)+sh[7]*(normal.z*normal.x)+sh[8]*(normal.x*normal.x-normal.y*normal.y);return max(result,vec3(0.0));}vec3 envBRDFApprox(vec3 specularColor,float roughness,float dotNV){const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}float getSpecularMIPLevel(float roughness,int maxMIPLevel){return roughness*float(maxMIPLevel);}vec3 getLightProbeRadiance(vec3 viewDir,vec3 normal,float roughness,int maxMIPLevel,float specularIntensity){
#ifndef O3_USE_SPECULAR_ENV
return vec3(0);
#else
vec3 reflectVec=reflect(-viewDir,normal);reflectVec.x=-reflectVec.x;float specularMIPLevel=getSpecularMIPLevel(roughness,maxMIPLevel);
#ifdef HAS_TEX_LOD
vec4 envMapColor=textureCubeLodEXT(u_env_specularSampler,reflectVec,specularMIPLevel);
#else
vec4 envMapColor=textureCube(u_env_specularSampler,reflectVec,specularMIPLevel);
#endif
#ifdef O3_DECODE_ENV_RGBM
envMapColor.rgb=RGBMToLinear(envMapColor,5.0).rgb;
#ifdef OASIS_COLORSPACE_GAMMA
envMapColor=linearToGamma(envMapColor);
#endif
#else
#ifndef OASIS_COLORSPACE_GAMMA
envMapColor=gammaToLinear(envMapColor);
#endif
#endif
return envMapColor.rgb*specularIntensity;
#endif
}`,ow=`#define GLSLIFY 1
Geometry geometry;Material material;ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));initGeometry(geometry);initMaterial(material,geometry);addTotalDirectRadiance(geometry,material,reflectedLight);
#ifdef O3_USE_SH
vec3 irradiance=getLightProbeIrradiance(u_env_sh,geometry.normal);
#ifdef OASIS_COLORSPACE_GAMMA
irradiance=linearToGamma(vec4(irradiance,1.0)).rgb;
#endif
irradiance*=u_envMapLight.diffuseIntensity;
#else
vec3 irradiance=u_envMapLight.diffuse*u_envMapLight.diffuseIntensity;irradiance*=PI;
#endif
reflectedLight.indirectDiffuse+=irradiance*BRDF_Diffuse_Lambert(material.diffuseColor);vec3 radiance=getLightProbeRadiance(geometry.viewDir,geometry.normal,material.roughness,int(u_envMapLight.mipMapLevel),u_envMapLight.specularIntensity);float radianceAttenuation=1.0;
#ifdef CLEARCOAT
vec3 clearCoatRadiance=getLightProbeRadiance(geometry.viewDir,geometry.clearCoatNormal,material.clearCoatRoughness,int(u_envMapLight.mipMapLevel),u_envMapLight.specularIntensity);reflectedLight.indirectSpecular+=clearCoatRadiance*material.clearCoat*envBRDFApprox(vec3(0.04),material.clearCoatRoughness,geometry.clearCoatDotNV);radianceAttenuation-=material.clearCoat*F_Schlick(geometry.clearCoatDotNV);
#endif
reflectedLight.indirectSpecular+=radianceAttenuation*radiance*envBRDFApprox(material.specularColor,material.roughness,geometry.dotNV);
#ifdef OCCLUSIONTEXTURE
vec2 aoUV=v_uv;
#ifdef O3_HAS_UV1
if(u_occlusionTextureCoord==1.0){aoUV=v_uv1;}
#endif
float ambientOcclusion=(texture2D(u_occlusionTexture,aoUV).r-1.0)*u_occlusionIntensity+1.0;reflectedLight.indirectDiffuse*=ambientOcclusion;
#ifdef O3_USE_SPECULAR_ENV
reflectedLight.indirectSpecular*=computeSpecularOcclusion(ambientOcclusion,material.roughness,geometry.dotNV);
#endif
#endif
vec3 emissiveRadiance=u_emissiveColor;
#ifdef EMISSIVETEXTURE
vec4 emissiveColor=texture2D(u_emissiveTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
emissiveColor=gammaToLinear(emissiveColor);
#endif
emissiveRadiance*=emissiveColor.rgb;
#endif
vec3 totalRadiance=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular+emissiveRadiance;vec4 targetColor=vec4(totalRadiance,material.opacity);
#ifndef OASIS_COLORSPACE_GAMMA
targetColor=linearToGamma(targetColor);
#endif
gl_FragColor=targetColor;`,sw={pbr_frag_define:tw,pbr_helper:rw,brdf:nw,direct_irradiance_frag_define:iw,ibl_frag_define:aw,pbr_frag:ow},lw=`#define GLSLIFY 1
vec3 getNormal(){
#ifdef O3_HAS_NORMAL
vec3 normal=normalize(v_normal);
#elif defined(HAS_DERIVATIVES)
vec3 pos_dx=dFdx(v_pos);vec3 pos_dy=dFdy(v_pos);vec3 normal=normalize(cross(pos_dx,pos_dy));
#else
vec3 normal=vec3(0,0,1);
#endif
normal*=float(gl_FrontFacing)*2.0-1.0;return normal;}vec3 getNormalByNormalTexture(mat3 tbn,sampler2D normalTexture,float normalIntensity,vec2 uv){vec3 normal=texture2D(normalTexture,uv).rgb;normal=normalize(tbn*((2.0*normal-1.0)*vec3(normalIntensity,normalIntensity,1.0)));normal*=float(gl_FrontFacing)*2.0-1.0;return normal;}mat3 getTBN(){
#if defined(O3_HAS_NORMAL) && defined(O3_HAS_TANGENT) && ( defined(NORMALTEXTURE) || defined(HAS_CLEARCOATNORMALTEXTURE) )
mat3 tbn=v_TBN;
#else
vec3 normal=getNormal();vec3 position=v_pos;vec2 uv=gl_FrontFacing? v_uv:-v_uv;
#ifdef HAS_DERIVATIVES
vec3 dp1=dFdx(position);vec3 dp2=dFdy(position);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));mat3 tbn=mat3(tangent*invmax,binormal*invmax,normal);
#else
mat3 tbn=mat3(vec3(0.0),vec3(0.0),normal);
#endif
#endif
return tbn;}`,uw=Vh(Vh({common:hx,common_vert:dx,common_frag:_x,color_share:vx,normal_share:px,uv_share:gx,worldpos_share:mx,shadow_share:yx,fog_share:xx,begin_normal_vert:wx,begin_position_vert:Sx,position_vert:Cx,color_vert:Px,normal_vert:Ax,skinning_vert:Tx,blendShape_input:bx,blendShape_vert:Ex,uv_vert:Mx,worldpos_vert:Rx,shadow_vert:Fx,fog_vert:zx,light_frag_define:Lx,mobile_material_frag:Bx,fog_frag:Dx,begin_mobile_frag:Ox,begin_viewdir_frag:Ix,mobile_blinnphong_frag:Nx,noise_common:kx,noise_cellular_2D:Ux,noise_cellular_2x2:Vx,noise_cellular_2x2x2:Gx,noise_cellular_3D:Hx,noise_cellular:Wx,noise_perlin_2D:jx,noise_perlin_3D:Xx,noise_perlin_4D:$x,noise_perlin:qx,noise_psrd_2D:Yx,noise_simplex_2D:Qx,noise_simplex_3D_grad:Jx,noise_simplex_3D:Kx,noise_simplex_4D:Zx,noise_simplex:ew},sw),{},{normal_get:lw}),Zn=function(){function t(){}return t.parseCustomMacros=function(i){return i.map(function(r){return"#define "+r+`
`}).join("")},t.parseIncludes=function(i){var r=/^[ \t]*#include +<([\w\d.]+)>/gm;function e(n,o){var s=uw[o];return s===void 0?(de.error('Shader slice "'+n.trim()+'" not founded.'),""):t.parseIncludes(s)}return i.replace(r,e)},t.parseExtension=function(i){return i.map(function(r){return"#extension "+r+` : enable
`}).join("")},t.convertTo300=function(i,r){if(i=i.replace(/\battribute\b/g,"in"),i=i.replace(/\bvarying\b/g,r?"in":"out"),i=i.replace(/\btexture(2D|Cube)\b/g,"texture"),i=i.replace(/\btexture(2D|Cube)LodEXT\b/g,"textureLod"),r){var e=/\bgl_FragData\[.+?\]/g.test(i);if(e){i=i.replace(/\bgl_FragColor\b/g,"gl_FragData[0]");var n=i.match(/\bgl_FragData\[.+?\]/g);i=this._replaceMRTShader(i,n)}else i=i.replace(/void\s+?main\s*\(/g,`out vec4 glFragColor;
void main(`),i=i.replace(/\bgl_FragColor\b/g,"glFragColor")}return i},t._replaceMRTShader=function(i,r){for(var e="",n=new Set,o=0;o<r.length;o++){var s=r[o].match(/\bgl_FragData\[(.+?)\]/);n.add(s[1])}return n.forEach(function(l){e+="layout(location="+l+") out vec4 fragOutColor"+l+`;
`}),e+="void main(",i=i.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1"),i=i.replace(/void\s+?main\s*\(/g,e),i},t}(),gl=function t(a,i,r,e){this.name=void 0,this.value=void 0,this._nameId=void 0,this._maskIndex=void 0,this._maskValue=void 0,this.name=a,this._maskIndex=r,this._maskValue=e,this.value=i;var n=t._macroNameIdMap,o=n[a];n[a]===void 0&&(n[a]=o=t._macroNameCounter++),this._nameId=o};gl._macroNameIdMap=Object.create(null);gl._macroNameCounter=0;var Bn;(function(t){t[t.Linear=0]="Linear",t[t.Gamma=1]="Gamma"})(Bn||(Bn={}));var cw=function(){function t(i){this.name=void 0,this.propertyId=void 0,this.location=void 0,this.applyFunc=void 0,this.cacheValue=void 0,this.textureIndex=void 0,this.textureDefault=void 0,this._rhi=void 0,this._gl=void 0,this._colorSpace=void 0;var r=i._hardwareRenderer;this._rhi=r,this._gl=r.gl,this._colorSpace=i.settings.colorSpace}var a=t.prototype;return a.upload1f=function(r,e){this.cacheValue!==e&&(this._gl.uniform1f(r.location,e),this.cacheValue=e)},a.upload1fv=function(r,e){this._gl.uniform1fv(r.location,e)},a.upload2f=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g)&&(this._colorSpace===Bn.Linear?this._gl.uniform2f(r.location,ne.gammaToLinearSpace(e.r),ne.gammaToLinearSpace(e.g)):this._gl.uniform2f(r.location,e.r,e.g),n.x=e.r,n.y=e.g):(n.x!==e.x||n.y!==e.y)&&(this._gl.uniform2f(r.location,e.x,e.y),n.x=e.x,n.y=e.y)},a.upload2fv=function(r,e){this._gl.uniform2fv(r.location,e)},a.upload3f=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b)&&(this._colorSpace===Bn.Linear?this._gl.uniform3f(r.location,ne.gammaToLinearSpace(e.r),ne.gammaToLinearSpace(e.g),ne.gammaToLinearSpace(e.b)):this._gl.uniform3f(r.location,e.r,e.g,e.b),n.x=e.r,n.y=e.g,n.z=e.b):(n.x!==e.x||n.y!==e.y||n.z!==e.z)&&(this._gl.uniform3f(r.location,e.x,e.y,e.z),n.x=e.x,n.y=e.y,n.z=e.z)},a.upload3fv=function(r,e){this._gl.uniform3fv(r.location,e)},a.upload4f=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b||n.w!==e.a)&&(this._colorSpace===Bn.Linear?this._gl.uniform4f(r.location,ne.gammaToLinearSpace(e.r),ne.gammaToLinearSpace(e.g),ne.gammaToLinearSpace(e.b),e.a):this._gl.uniform4f(r.location,e.r,e.g,e.b,e.a),n.x=e.r,n.y=e.g,n.z=e.b,n.w=e.a):(n.x!==e.x||n.y!==e.y||n.z!==e.z||n.w!==e.w)&&(this._gl.uniform4f(r.location,e.x,e.y,e.z,e.w),n.x=e.x,n.y=e.y,n.z=e.z,n.w=e.w)},a.upload4fv=function(r,e){this._gl.uniform4fv(r.location,e)},a.upload1i=function(r,e){this.cacheValue!==e&&(this._gl.uniform1i(r.location,e),this.cacheValue=e)},a.upload1iv=function(r,e){this._gl.uniform1iv(r.location,e)},a.upload2i=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g)&&(this._gl.uniform2i(r.location,e.r,e.g),n.x=e.r,n.y=e.g):(n.x!==e.x||n.y!==e.y)&&(this._gl.uniform2i(r.location,e.x,e.y),n.x=e.x,n.y=e.y)},a.upload2iv=function(r,e){this._gl.uniform2iv(r.location,e)},a.upload3i=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b)&&(this._gl.uniform3i(r.location,e.r,e.g,e.b),n.x=e.r,n.y=e.g,n.z=e.b):(n.x!==e.x||n.y!==e.y||n.z!==e.z)&&(this._gl.uniform3i(r.location,e.x,e.y,e.z),n.x=e.x,n.y=e.y,n.z=e.z)},a.upload3iv=function(r,e){this._gl.uniform3iv(r.location,e)},a.upload4i=function(r,e){var n=this.cacheValue;e.r!==void 0?(n.x!==e.r||n.y!==e.g||n.z!==e.b||n.w!==e.a)&&(this._gl.uniform4i(r.location,e.r,e.g,e.b,e.a),n.x=e.r,n.y=e.g,n.z=e.b,n.w=e.a):(n.x!==e.x||n.y!==e.y||n.z!==e.z||n.w!==e.w)&&(this._gl.uniform4i(r.location,e.x,e.y,e.z,e.w),n.x=e.x,n.y=e.y,n.z=e.z,n.w=e.w)},a.upload4iv=function(r,e){this._gl.uniform4iv(r.location,e)},a.uploadMat4=function(r,e){this._gl.uniformMatrix4fv(r.location,!1,e.elements)},a.uploadMat4v=function(r,e){this._gl.uniformMatrix4fv(r.location,!1,e)},a.uploadTexture=function(r,e){var n=this._rhi;n.activeTexture(r.textureIndex),n.bindTexture(e._platformTexture)},a.uploadTextureArray=function(r,e){for(var n=this._rhi,o=r.textureIndex,s=0;s<e.length;s++){var l=e[s];n.activeTexture(o[s]),n.bindTexture(l._platformTexture)}},t}(),Na=function(){this.constUniforms=[],this.textureUniforms=[]},j0=function(){t._addLineNum=function(r){var e=r.split(`
`),n=(e.length+1).toString().length+6,o;return e.map(function(s,l){if(o="0:"+(l+1),o.length>=n)return o.substring(0,n)+s;for(var u=0;u<n-o.length;u++)o+=" ";return o+s}).join(`
`)};function t(i,r,e){this.id=void 0,this.sceneUniformBlock=new Na,this.cameraUniformBlock=new Na,this.rendererUniformBlock=new Na,this.materialUniformBlock=new Na,this.otherUniformBlock=new Na,this._uploadRenderCount=-1,this._uploadCamera=void 0,this._uploadRenderer=void 0,this._uploadMaterial=void 0,this.attributeLocation=Object.create(null),this._isValid=void 0,this._engine=void 0,this._gl=void 0,this._vertexShader=void 0,this._fragmentShader=void 0,this._glProgram=void 0,this._activeTextureUint=0,this._engine=i,this._gl=i._hardwareRenderer.gl,this._glProgram=this._createProgram(r,e),this._glProgram?(this._isValid=!0,this._recordLocation()):this._isValid=!1,this.id=t._counter++}var a=t.prototype;return a.uploadAll=function(r,e){this.uploadUniforms(r,e),this.uploadTextures(r,e)},a.uploadUniforms=function(r,e){for(var n=e._propertyValueMap,o=r.constUniforms,s=0,l=o.length;s<l;s++){var u=o[s],c=n[u.propertyId];c!=null&&u.applyFunc(u,c)}},a.uploadTextures=function(r,e){var n=e._propertyValueMap,o=r.textureUniforms;if(o)for(var s=0,l=o.length;s<l;s++){var u=o[s],c=n[u.propertyId];c&&!c.destroyed?u.applyFunc(u,c):u.applyFunc(u,u.textureDefault)}},a.uploadUnGroupTextures=function(){var r=this.otherUniformBlock.textureUniforms;if(r)for(var e=0,n=r.length;e<n;e++){var o=r[e];o.applyFunc(o,o.textureDefault)}},a.groupingOtherUniformBlock=function(){var r=this.otherUniformBlock,e=r.constUniforms,n=r.textureUniforms;e.length>0&&this._groupingSubOtherUniforms(e,!1),n.length>0&&this._groupingSubOtherUniforms(n,!0)},a.bind=function(){var r=this._engine._hardwareRenderer;return r._currentBind!==this?(this._gl.useProgram(this._glProgram),r._currentBind=this,!0):!1},a.destroy=function(){var r=this._gl;this._vertexShader&&r.deleteShader(this._vertexShader),this._fragmentShader&&r.deleteShader(this._fragmentShader),this._glProgram&&r.deleteProgram(this._glProgram)},a._groupingSubOtherUniforms=function(r,e){for(var n=r.length-1;n>=0;n--){var o=r[n],s=O._getShaderPropertyGroup(o.name);s!==void 0&&(r.splice(r.indexOf(o),1),this._groupingUniform(o,s,e))}},a._groupingUniform=function(r,e,n){switch(e){case Cr.Scene:n?this.sceneUniformBlock.textureUniforms.push(r):this.sceneUniformBlock.constUniforms.push(r);break;case Cr.Camera:n?this.cameraUniformBlock.textureUniforms.push(r):this.cameraUniformBlock.constUniforms.push(r);break;case Cr.Renderer:n?this.rendererUniformBlock.textureUniforms.push(r):this.rendererUniformBlock.constUniforms.push(r);break;case Cr.Material:n?this.materialUniformBlock.textureUniforms.push(r):this.materialUniformBlock.constUniforms.push(r);break;default:n?this.otherUniformBlock.textureUniforms.push(r):this.otherUniformBlock.constUniforms.push(r)}},a._createProgram=function(r,e){var n=this._gl,o=this._createShader(n.VERTEX_SHADER,r);if(!o)return null;var s=this._createShader(n.FRAGMENT_SHADER,e);if(!s)return null;var l=n.createProgram();return n.attachShader(l,o),n.attachShader(l,s),n.linkProgram(l),n.validateProgram(l),n.isContextLost()?(de.error("Context lost while linking program."),n.deleteShader(o),n.deleteShader(s),null):de.isEnabled&&!n.getProgramParameter(l,n.LINK_STATUS)?(de.error(`Could not link WebGL program. 
`+n.getProgramInfoLog(l)),n.deleteProgram(l),null):(this._vertexShader=o,this._fragmentShader=s,l)},a._createShader=function(r,e){var n=this._gl,o=n.createShader(r);return o?(n.shaderSource(o,e),n.compileShader(o),n.isContextLost()?(de.error("Context lost while compiling shader."),n.deleteShader(o),null):de.isEnabled&&!n.getShaderParameter(o,n.COMPILE_STATUS)?(de.error(`Could not compile WebGL shader.
`+n.getShaderInfoLog(o),t._addLineNum(e)),n.deleteShader(o),null):o):(de.error("Context lost while create shader."),null)},a._recordLocation=function(){var r=this,e=this._gl,n=this._glProgram,o=this._getUniformInfos(),s=this._getAttributeInfos();o.forEach(function(l){var u=l.name,c=l.size,f=l.type,h=new cw(r._engine),d=!1,_=!1;u.indexOf("[0]")>0&&(u=u.substr(0,u.length-3),d=!0);var m=e.getUniformLocation(n,u);switch(h.name=u,h.propertyId=O.getPropertyByName(u)._uniqueId,h.location=m,f){case e.FLOAT:d?h.applyFunc=h.upload1fv:(h.applyFunc=h.upload1f,h.cacheValue=0);break;case e.FLOAT_VEC2:d?h.applyFunc=h.upload2fv:(h.applyFunc=h.upload2f,h.cacheValue=new $(0,0));break;case e.FLOAT_VEC3:d?h.applyFunc=h.upload3fv:(h.applyFunc=h.upload3f,h.cacheValue=new C(0,0,0));break;case e.FLOAT_VEC4:d?h.applyFunc=h.upload4fv:(h.applyFunc=h.upload4f,h.cacheValue=new Ee(0,0,0,0));break;case e.BOOL:case e.INT:d?h.applyFunc=h.upload1iv:(h.applyFunc=h.upload1i,h.cacheValue=0);break;case e.BOOL_VEC2:case e.INT_VEC2:d?h.applyFunc=h.upload2iv:(h.applyFunc=h.upload2i,h.cacheValue=new $(0,0));break;case e.BOOL_VEC3:case e.INT_VEC3:h.applyFunc=d?h.upload3iv:h.upload3i,h.cacheValue=new C(0,0,0);break;case e.BOOL_VEC4:case e.INT_VEC4:d?h.applyFunc=h.upload4iv:(h.applyFunc=h.upload4i,h.cacheValue=new Ee(0,0,0));break;case e.FLOAT_MAT4:h.applyFunc=d?h.uploadMat4v:h.uploadMat4;break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.SAMPLER_2D_ARRAY:var p;switch(f){case e.SAMPLER_2D:p=r._engine._magentaTexture2D;break;case e.SAMPLER_CUBE:p=r._engine._magentaTextureCube;break;case e.SAMPLER_2D_ARRAY:p=r._engine._magentaTexture2DArray;break;default:throw new Error("Unsupported texture type.")}if(_=!0,d){for(var v=new Array(c),g=new Int32Array(c),y=new Array(c),x=0;x<c;x++)v[x]=p,g[x]=r._activeTextureUint,y[x]=e.TEXTURE0+r._activeTextureUint++;h.textureDefault=v,h.textureIndex=y,h.applyFunc=h.uploadTextureArray,r.bind(),e.uniform1iv(m,g),h.uploadTextureArray(h,v)}else{var P=e.TEXTURE0+r._activeTextureUint;h.textureDefault=p,h.textureIndex=P,h.applyFunc=h.uploadTexture,r.bind(),e.uniform1i(m,r._activeTextureUint++),h.uploadTexture(h,p)}break}var S=O._getShaderPropertyGroup(u);r._groupingUniform(h,S,_)}),s.forEach(function(l){var u=l.name;r.attributeLocation[u]=e.getAttribLocation(n,u)})},a._getUniformInfos=function(){for(var r=this._gl,e=this._glProgram,n=new Array,o=r.getProgramParameter(e,r.ACTIVE_UNIFORMS),s=0;s<o;++s){var l=r.getActiveUniform(e,s);n[s]=l}return n},a._getAttributeInfos=function(){for(var r=this._gl,e=this._glProgram,n=new Array,o=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES),s=0;s<o;++s){var l=r.getActiveAttrib(e,s);n[s]=l}return n},Y(t,[{key:"isValid",get:function(){return this._isValid}}]),t}();j0._counter=0;var af=function(){function t(a){this._uniqueId=void 0,this._group=void 0,this._type=void 0,this.name=void 0,this.name=a,this._uniqueId=t._propertyNameCounter++}return Y(t,[{key:"type",get:function(){return this._type}}]),t}();af._propertyNameCounter=0;var O=function(){t.create=function(r,e,n){var o=t._shaderMap;if(o[r])throw'Shader named "'+r+'" already exists.';return o[r]=new t(r,e,n)},t.find=function(r){return t._shaderMap[r]},t.getMacroByName=function(r,e){var n=e?r+" "+e:r,o=t._macroMap[n];if(!o){var s=t._macroMaskMap,l=t._macroCounter,u=Math.floor(l/32),c=l%32;o=new gl(r,e,u,1<<c),t._macroMap[n]=o,u==s.length&&(s.length++,s[u]=new Array(32)),s[u][c]=n,t._macroCounter++}return o},t.getPropertyByName=function(r){var e=t._propertyNameMap;if(e[r]!=null)return e[r];var n=new af(r);return e[r]=n,t._propertyIdMap[n._uniqueId]=n,n},t._getShaderPropertyGroup=function(r){var e=t._propertyNameMap[r];return e==null?void 0:e._group},t._getNamesByMacros=function(r,e){var n=t._macroMaskMap,o=r._mask;e.length=0;for(var s=0,l=r._length;s<l;s++)for(var u=n[s],c=o[s],f=c<0?32:Math.floor(Math.log2(c))+1,h=0;h<f;h++)c&1<<h&&e.push(u[h])};function t(i,r,e){this.name=void 0,this._shaderId=0,this._vertexSource=void 0,this._fragmentSource=void 0,this._shaderId=t._shaderCounter++,this.name=i,this._vertexSource=r,this._fragmentSource=e}var a=t.prototype;return a.compileVariant=function(r,e){var n=t._compileMacros;n.clear();for(var o=0,s=e.length;o<s;o++)n.enable(t.getMacroByName(e[o]));return this._getShaderProgram(r,n).isValid},a._getShaderProgram=function(r,e){var n=r._getShaderProgramPool(this),o=n.get(e);if(o)return o;var s=r._hardwareRenderer.isWebGL2,l=[];t._getNamesByMacros(e,l);var u=Zn.parseCustomMacros(l),c=s?"#version 300 es":"#version 100",f=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      precision highp int;
    #else
      precision mediump float;
      precision mediump int;
    #endif
    `;r._hardwareRenderer.canIUse(Z.shaderTextureLod)&&(f+=`#define HAS_TEX_LOD
`),r._hardwareRenderer.canIUse(Z.standardDerivatives)&&(f+=`#define HAS_DERIVATIVES
`);var h=Zn.parseIncludes(" "+c+`
        `+f+`
        `+u+`
        `+this._vertexSource),d=Zn.parseIncludes(" "+c+`
        `+(s?"":Zn.parseExtension(t._shaderExtension))+`
        `+f+`
        `+u+`
      `+this._fragmentSource);return s&&(h=Zn.convertTo300(h),d=Zn.convertTo300(d,!0)),o=new j0(r,h,d),n.cache(o),o},t}();O._compileMacros=new Jt;O._propertyIdMap=Object.create(null);O._shaderCounter=0;O._shaderMap=Object.create(null);O._propertyNameMap=Object.create(null);O._macroMaskMap=[];O._macroCounter=0;O._macroMap=Object.create(null);O._shaderExtension=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers"];var Vo=function(){function t(i){this._group=void 0,this._propertyValueMap=Object.create(null),this._macroCollection=new Jt,this._macroMap=Object.create(null),this._refCount=0,this._group=i}var a=t.prototype;return a.getFloat=function(r){return this.getPropertyValue(r)},a.setFloat=function(r,e){this._setPropertyValue(r,zt.Float,e)},a.getInt=function(r){return this.getPropertyValue(r)},a.setInt=function(r,e){this._setPropertyValue(r,zt.Int,e)},a.getFloatArray=function(r){return this.getPropertyValue(r)},a.setFloatArray=function(r,e){this._setPropertyValue(r,zt.FloatArray,e)},a.getIntArray=function(r){return this.getPropertyValue(r)},a.setIntArray=function(r,e){this._setPropertyValue(r,zt.IntArray,e)},a.getVector2=function(r){return this.getPropertyValue(r)},a.setVector2=function(r,e){this._setPropertyValue(r,zt.Vector2,e)},a.getVector3=function(r){return this.getPropertyValue(r)},a.setVector3=function(r,e){this._setPropertyValue(r,zt.Vector3,e)},a.getVector4=function(r){return this.getPropertyValue(r)},a.setVector4=function(r,e){this._setPropertyValue(r,zt.Vector4,e)},a.getMatrix=function(r){return this.getPropertyValue(r)},a.setMatrix=function(r,e){this._setPropertyValue(r,zt.Matrix,e)},a.getColor=function(r){return this.getPropertyValue(r)},a.setColor=function(r,e){this._setPropertyValue(r,zt.Color,e)},a.getTexture=function(r){return this.getPropertyValue(r)},a.setTexture=function(r,e){if(this._getRefCount()>0){var n=this.getPropertyValue(r);n&&n._addRefCount(-1),e&&e._addRefCount(1)}this._setPropertyValue(r,zt.Texture,e)},a.getTextureArray=function(r){return this.getPropertyValue(r)},a.setTextureArray=function(r,e){if(this._getRefCount()>0){var n=this.getPropertyValue(r);if(n)for(var o=0,s=n.length;o<s;o++)n[o]._addRefCount(-1);if(e)for(var l=0,u=e.length;l<u;l++)e[l]._addRefCount(1)}this._setPropertyValue(r,zt.TextureArray,e)},a.getPropertyValue=function(r){return typeof r=="string"&&(r=O.getPropertyByName(r)),this._propertyValueMap[r._uniqueId]},a.enableMacro=function(r,e){typeof r=="string"&&(r=O.getMacroByName(r,e));var n=r._nameId,o=this._macroMap[n];if(o!==r){var s=this._macroCollection;o&&s.disable(o),s.enable(r),this._macroMap[n]=r}},a.disableMacro=function(r){var e;if(typeof r=="string"){if(e=gl._macroNameIdMap[r],e===void 0)return}else e=r._nameId;var n=this._macroMap[e];n&&(this._macroCollection.disable(n),delete this._macroMap[e])},a.getMacros=function(r){if(r){var e=this._macroMap;r.length=0;for(var n in e)r.push(e[n])}else return Object.values(this._macroMap)},a.getProperties=function(r){var e;r?(r.length=0,e=r):e=[];var n=this._propertyValueMap,o=O._propertyIdMap;for(var s in n)e.push(o[s]);if(!r)return e},a.clone=function(){var r=new t(this._group);return this.cloneTo(r),r},a.cloneTo=function(r){ur.deepCloneObject(this._macroCollection,r._macroCollection),Co(r._macroMap,this._macroMap);for(var e=this._propertyValueMap,n=r._propertyValueMap,o=Object.keys(e),s=0,l=o.length;s<l;s++){var u=o[s],c=e[u];if(c!=null)if(typeof c=="number")n[u]=c;else if(c instanceof Ur)n[u]=c;else if(c instanceof Array||c instanceof Float32Array||c instanceof Int32Array)n[u]=c.slice();else{var f=n[u];f?f.copyFrom(c):n[u]=c.clone()}else n[u]=c}},a._setPropertyValue=function(r,e,n){if(typeof r=="string"&&(r=O.getPropertyByName(r)),r._group!==this._group)if(r._group===void 0)r._group=this._group;else throw"Shader property "+r.name+" has been used as "+Cr[r._group]+" group.";if(r._type!==e)if(r._type===void 0)r._type=e;else throw"Shader property "+r.name+" has been used as "+zt[r._type]+" type.";this._propertyValueMap[r._uniqueId]=n},a._getRefCount=function(){return this._refCount},a._addRefCount=function(r){this._refCount+=r;var e=this._propertyValueMap;for(var n in e){var o=e[n];o&&o instanceof Ur&&o._addRefCount(r)}},t}(),ae;(function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.SourceColor=2]="SourceColor",t[t.OneMinusSourceColor=3]="OneMinusSourceColor",t[t.DestinationColor=4]="DestinationColor",t[t.OneMinusDestinationColor=5]="OneMinusDestinationColor",t[t.SourceAlpha=6]="SourceAlpha",t[t.OneMinusSourceAlpha=7]="OneMinusSourceAlpha",t[t.DestinationAlpha=8]="DestinationAlpha",t[t.OneMinusDestinationAlpha=9]="OneMinusDestinationAlpha",t[t.SourceAlphaSaturate=10]="SourceAlphaSaturate",t[t.BlendColor=11]="BlendColor",t[t.OneMinusBlendColor=12]="OneMinusBlendColor"})(ae||(ae={}));var Xt;(function(t){t[t.Add=0]="Add",t[t.Subtract=1]="Subtract",t[t.ReverseSubtract=2]="ReverseSubtract",t[t.Min=3]="Min",t[t.Max=4]="Max"})(Xt||(Xt={}));var Pr;(function(t){t[t.None=0]="None",t[t.Red=1]="Red",t[t.Green=2]="Green",t[t.Blue=4]="Blue",t[t.Alpha=8]="Alpha",t[t.All=15]="All"})(Pr||(Pr={}));var fw=function(){this.enabled=!1,this.colorBlendOperation=Xt.Add,this.alphaBlendOperation=Xt.Add,this.sourceColorBlendFactor=ae.One,this.sourceAlphaBlendFactor=ae.One,this.destinationColorBlendFactor=ae.Zero,this.destinationAlphaBlendFactor=ae.Zero,this.colorWriteMask=Pr.All},hw=function(){function t(){this.targetBlendState=new fw,this.blendColor=new ne(0,0,0,0),this.alphaToCoverage=!1}t._getGLBlendFactor=function(r,e){var n=r.gl;switch(e){case ae.Zero:return n.ZERO;case ae.One:return n.ONE;case ae.SourceColor:return n.SRC_COLOR;case ae.OneMinusSourceColor:return n.ONE_MINUS_SRC_COLOR;case ae.DestinationColor:return n.DST_COLOR;case ae.OneMinusDestinationColor:return n.ONE_MINUS_DST_COLOR;case ae.SourceAlpha:return n.SRC_ALPHA;case ae.OneMinusSourceAlpha:return n.ONE_MINUS_SRC_ALPHA;case ae.DestinationAlpha:return n.DST_ALPHA;case ae.OneMinusDestinationAlpha:return n.ONE_MINUS_DST_ALPHA;case ae.SourceAlphaSaturate:return n.SRC_ALPHA_SATURATE;case ae.BlendColor:return n.CONSTANT_COLOR;case ae.OneMinusBlendColor:return n.ONE_MINUS_CONSTANT_COLOR}},t._getGLBlendOperation=function(r,e){var n=r.gl;switch(e){case Xt.Add:return n.FUNC_ADD;case Xt.Subtract:return n.FUNC_SUBTRACT;case Xt.ReverseSubtract:return n.FUNC_REVERSE_SUBTRACT;case Xt.Min:if(!r.canIUse(Z.blendMinMax))throw new Error("BlendOperation.Min is not supported in this context");return n.MIN;case Xt.Max:if(!r.canIUse(Z.blendMinMax))throw new Error("BlendOperation.Max is not supported in this context");return n.MAX}};var a=t.prototype;return a._apply=function(r,e){this._platformApply(r,e.blendState)},a._platformApply=function(r,e){var n=r.gl,o=e.targetBlendState,s=this.targetBlendState,l=s.enabled,u=s.colorBlendOperation,c=s.alphaBlendOperation,f=s.sourceColorBlendFactor,h=s.destinationColorBlendFactor,d=s.sourceAlphaBlendFactor,_=s.destinationAlphaBlendFactor,m=s.colorWriteMask;if(l!==o.enabled&&(l?n.enable(n.BLEND):n.disable(n.BLEND),o.enabled=l),l){(f!==o.sourceColorBlendFactor||h!==o.destinationColorBlendFactor||d!==o.sourceAlphaBlendFactor||_!==o.destinationAlphaBlendFactor)&&(n.blendFuncSeparate(t._getGLBlendFactor(r,f),t._getGLBlendFactor(r,h),t._getGLBlendFactor(r,d),t._getGLBlendFactor(r,_)),o.sourceColorBlendFactor=f,o.destinationColorBlendFactor=h,o.sourceAlphaBlendFactor=d,o.destinationAlphaBlendFactor=_),(u!==o.colorBlendOperation||c!==o.alphaBlendOperation)&&(n.blendEquationSeparate(t._getGLBlendOperation(r,u),t._getGLBlendOperation(r,c)),o.colorBlendOperation=u,o.alphaBlendOperation=c);var p=this.blendColor;ne.equals(e.blendColor,p)||(n.blendColor(p.r,p.g,p.b,p.a),e.blendColor.copyFrom(p))}m!==o.colorWriteMask&&(n.colorMask((m&Pr.Red)!==0,(m&Pr.Green)!==0,(m&Pr.Blue)!==0,(m&Pr.Alpha)!==0),o.colorWriteMask=m);var v=this.alphaToCoverage;v!==e.alphaToCoverage&&(v?n.enable(n.SAMPLE_ALPHA_TO_COVERAGE):n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),e.alphaToCoverage=v)},t}(),Pe;(function(t){t[t.Never=0]="Never",t[t.Less=1]="Less",t[t.Equal=2]="Equal",t[t.LessEqual=3]="LessEqual",t[t.Greater=4]="Greater",t[t.NotEqual=5]="NotEqual",t[t.GreaterEqual=6]="GreaterEqual",t[t.Always=7]="Always"})(Pe||(Pe={}));var dw=function(){function t(){this.enabled=!0,this.writeEnabled=!0,this.compareFunction=Pe.Less}t._getGLCompareFunction=function(r,e){var n=r.gl;switch(e){case Pe.Never:return n.NEVER;case Pe.Less:return n.LESS;case Pe.Equal:return n.EQUAL;case Pe.LessEqual:return n.LEQUAL;case Pe.Greater:return n.GREATER;case Pe.NotEqual:return n.NOTEQUAL;case Pe.GreaterEqual:return n.GEQUAL;case Pe.Always:return n.ALWAYS}};var a=t.prototype;return a._apply=function(r,e){this._platformApply(r,e.depthState)},a._platformApply=function(r,e){var n=r.gl,o=this.enabled,s=this.compareFunction,l=this.writeEnabled;o!=e.enabled&&(o?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),e.enabled=o),o&&(s!=e.compareFunction&&(n.depthFunc(t._getGLCompareFunction(r,s)),e.compareFunction=s),l!=e.writeEnabled&&(n.depthMask(l),e.writeEnabled=l))},t}(),Qt;(function(t){t[t.Off=0]="Off",t[t.Front=1]="Front",t[t.Back=2]="Back"})(Qt||(Qt={}));var _w=function(){function t(){this.cullMode=Qt.Back,this.depthBias=0,this.slopeScaledDepthBias=0,this._cullFaceEnable=!0,this._frontFaceInvert=!1}var a=t.prototype;return a._apply=function(r,e,n){this._platformApply(r,e.rasterState,n)},a._platformApply=function(r,e,n){var o=r.gl,s=this.cullMode,l=this.depthBias,u=this.slopeScaledDepthBias,c=s!==Qt.Off;c!==e._cullFaceEnable&&(c?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),e._cullFaceEnable=c),c&&s!==e.cullMode&&(s==Qt.Back?o.cullFace(o.BACK):o.cullFace(o.FRONT),e.cullMode=s),n!==e._frontFaceInvert&&(n?o.frontFace(o.CW):o.frontFace(o.CCW),e._frontFaceInvert=n),(l!==e.depthBias||u!==e.slopeScaledDepthBias)&&(l!==0||u!==0?(o.enable(o.POLYGON_OFFSET_FILL),o.polygonOffset(u,l)):o.disable(o.POLYGON_OFFSET_FILL),e.depthBias=l,e.slopeScaledDepthBias=u)},t}(),it;(function(t){t[t.Keep=0]="Keep",t[t.Zero=1]="Zero",t[t.Replace=2]="Replace",t[t.IncrementSaturate=3]="IncrementSaturate",t[t.DecrementSaturate=4]="DecrementSaturate",t[t.Invert=5]="Invert",t[t.IncrementWrap=6]="IncrementWrap",t[t.DecrementWrap=7]="DecrementWrap"})(it||(it={}));var vw=function(){function t(){this.enabled=!1,this.referenceValue=0,this.mask=255,this.writeMask=255,this.compareFunctionFront=Pe.Always,this.compareFunctionBack=Pe.Always,this.passOperationFront=it.Keep,this.passOperationBack=it.Keep,this.failOperationFront=it.Keep,this.failOperationBack=it.Keep,this.zFailOperationFront=it.Keep,this.zFailOperationBack=it.Keep}t._getGLCompareFunction=function(r,e){var n=r.gl;switch(e){case Pe.Never:return n.NEVER;case Pe.Less:return n.LESS;case Pe.Equal:return n.EQUAL;case Pe.LessEqual:return n.LEQUAL;case Pe.Greater:return n.GREATER;case Pe.NotEqual:return n.NOTEQUAL;case Pe.GreaterEqual:return n.GEQUAL;case Pe.Always:return n.ALWAYS}},t._getGLStencilOperation=function(r,e){var n=r.gl;switch(e){case it.Keep:return n.KEEP;case it.Zero:return n.ZERO;case it.Replace:return n.REPLACE;case it.IncrementSaturate:return n.INCR;case it.DecrementSaturate:return n.DECR;case it.Invert:return n.INVERT;case it.IncrementWrap:return n.INCR_WRAP;case it.DecrementWrap:return n.DECR_WRAP}};var a=t.prototype;return a._apply=function(r,e){this._platformApply(r,e.stencilState)},a._platformApply=function(r,e){var n=r.gl,o=this.enabled,s=this.referenceValue,l=this.mask,u=this.compareFunctionFront,c=this.compareFunctionBack,f=this.failOperationFront,h=this.zFailOperationFront,d=this.passOperationFront,_=this.failOperationBack,m=this.zFailOperationBack,p=this.passOperationBack,v=this.writeMask;if(o!=e.enabled&&(o?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),e.enabled=o),o){var g=s!==e.referenceValue||l!==e.mask;(g||u!==e.compareFunctionFront)&&(n.stencilFuncSeparate(n.FRONT,t._getGLCompareFunction(r,u),s,l),e.compareFunctionFront=u),(g||c!==e.compareFunctionBack)&&(n.stencilFuncSeparate(n.BACK,t._getGLCompareFunction(r,c),s,l),e.compareFunctionBack=this.compareFunctionBack),g&&(e.referenceValue=this.referenceValue,e.mask=this.mask),(f!==e.failOperationFront||h!==e.zFailOperationFront||d!==e.passOperationFront)&&(n.stencilOpSeparate(n.FRONT,t._getGLStencilOperation(r,f),t._getGLStencilOperation(r,h),t._getGLStencilOperation(r,d)),e.failOperationFront=f,e.zFailOperationFront=h,e.passOperationFront=d),(_!==e.failOperationBack||m!==e.zFailOperationBack||p!==e.passOperationBack)&&(n.stencilOpSeparate(n.BACK,t._getGLStencilOperation(r,_),t._getGLStencilOperation(r,m),t._getGLStencilOperation(r,p)),e.failOperationBack=_,e.zFailOperationBack=m,e.passOperationBack=p),v!==e.writeMask&&(n.stencilMask(v),e.writeMask=v)}},t}(),X0=function(){function t(){this.blendState=new hw,this.depthState=new dw,this.stencilState=new vw,this.rasterState=new _w}var a=t.prototype;return a._apply=function(r,e){var n=r._hardwareRenderer,o=r._lastRenderState;this.blendState._apply(n,o),this.depthState._apply(n,o),this.stencilState._apply(n,o),this.rasterState._apply(n,o,e)},t}(),Ar=function(t){q(a,t);function a(r,e){var n;return n=t.call(this,r)||this,n.name=void 0,n.shader=void 0,n.renderQueueType=_t.Opaque,n.shaderData=new Vo(Cr.Material),n.renderState=new X0,n.shader=e,n}var i=a.prototype;return i.clone=function(){var e=new a(this._engine,this.shader);return this.cloneTo(e),e},i.cloneTo=function(e){e.shader=this.shader,e.renderQueueType=this.renderQueueType,this.shaderData.cloneTo(e.shaderData),ur.deepCloneObject(this.renderState,e.renderState)},i._addRefCount=function(e){t.prototype._addRefCount.call(this,e),this.shaderData._addRefCount(e)},i._preRender=function(e){},i._onDestroy=function(){},a}(un),ui=function(){function t(i){this._elementPoolIndex=0,this._elementPool=[],this._type=void 0,this._type=i}var a=t.prototype;return a.getFromPool=function(){var r=this._elementPoolIndex,e=this._elementPool;if(this._elementPoolIndex++,e.length===r){var n=new this._type;return e.push(n),n}else return e[r]},a.resetPool=function(){this._elementPoolIndex=0},t}(),ml=function(){this.component=void 0,this.material=void 0,this.multiRenderData=void 0},$0=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.mesh=void 0,r.subMesh=void 0,r}var i=a.prototype;return i.setValue=function(e,n,o,s){this.component=e,this.mesh=n,this.subMesh=o,this.material=s},a}(ml),pw=function(){function t(){this._camera=void 0,this._viewProjectMatrix=new re}var a=t.prototype;return a._setContext=function(r){this._camera=r,re.multiply(r.projectionMatrix,r.viewMatrix,this._viewProjectMatrix)},t}(),q0=function(t){q(a,t);function a(){var r;return r=t.call(this)||this,r.renderData=void 0,r.texture=void 0,r.multiRenderData=!1,r}var i=a.prototype;return i.setValue=function(e,n,o,s){this.component=e,this.renderData=n,this.material=o,this.texture=s},a}(ml),gw=function(t){q(a,t);function a(){var r;return r=t.call(this)||this,r.renderData=void 0,r.isAdd=!0,r.multiRenderData=!1,r}var i=a.prototype;return i.setValue=function(e,n,o){this.component=e,this.renderData=n,this.material=o},a}(ml),ar;(function(t){t[t.None=0]="None",t[t.VisibleInsideMask=1]="VisibleInsideMask",t[t.VisibleOutsideMask=2]="VisibleOutsideMask"})(ar||(ar={}));var gd,md,st,yd,xd,wd,Sd,Cd,Pd,Ad,Td,bd,Ed,Md,Rd,Fd,zd,Ld,Bd,dn,Go=(gd=ko(Yt),gd(md=(st=(dn=function(t){q(a,t);function a(r){var e;e=t.call(this,r)||this,k(e,"shaderData",yd,B(e)),k(e,"isCulled",xd,B(e)),k(e,"_distanceForSort",wd,B(e)),k(e,"_onUpdateIndex",Sd,B(e)),k(e,"_rendererIndex",Cd,B(e)),k(e,"_globalShaderMacro",Pd,B(e)),k(e,"_transformChangeFlag",Ad,B(e)),k(e,"_bounds",Td,B(e)),k(e,"_overrideUpdate",bd,B(e)),k(e,"_materials",Ed,B(e)),k(e,"_mvMatrix",Md,B(e)),k(e,"_mvpMatrix",Rd,B(e)),k(e,"_mvInvMatrix",Fd,B(e)),k(e,"_normalMatrix",zd,B(e)),k(e,"_materialsInstanced",Ld,B(e)),k(e,"_priority",Bd,B(e));var n=a.prototype;return e._overrideUpdate=e.update!==n.update,e._transformChangeFlag=e.entity.transform.registerWorldChangeFlag(),e.shaderData._addRefCount(1),e}var i=a.prototype;return i.getInstanceMaterial=function(e){e===void 0&&(e=0);var n=this._materials;if(n.length>e){var o=n[e];if(o)return this._materialsInstanced[e]?o:this._createInstanceMaterial(o,e)}return null},i.getMaterial=function(e){return e===void 0&&(e=0),this._materials[e]||null},i.setMaterial=function(e,n){n===void 0&&(n=null),typeof e=="number"?this._setMaterial(e,n):this._setMaterial(0,e)},i.getInstanceMaterials=function(){for(var e=this._materials,n=this._materialsInstanced,o=0,s=e.length;o<s;o++)n[o]||this._createInstanceMaterial(this._materials[o],o);return e},i.getMaterials=function(){return this._materials},i.setMaterials=function(e){for(var n=e.length,o=this._materials,s=this._materialsInstanced,l=n,u=o.length;l<u;l++){var c=o[l];c&&c._addRefCount(-1)}o.length!==n&&(o.length=n),s.length!==0&&(s.length=0);for(var f=0;f<n;f++){var h=o[f],d=e[f];h!==d&&(o[f]=d,h&&h._addRefCount(-1),d&&d._addRefCount(1))}},i.update=function(e){},i._updateShaderData=function(e){var n=this.shaderData,o=this.entity.transform.worldMatrix,s=this._mvMatrix,l=this._mvpMatrix,u=this._mvInvMatrix,c=this._normalMatrix;re.multiply(e._camera.viewMatrix,o,s),re.multiply(e._viewProjectMatrix,o,l),re.invert(s,u),re.invert(o,c),c.transpose(),n.setMatrix(a._localMatrixProperty,this.entity.transform.localMatrix),n.setMatrix(a._worldMatrixProperty,o),n.setMatrix(a._mvMatrixProperty,s),n.setMatrix(a._mvpMatrixProperty,l),n.setMatrix(a._mvInvMatrixProperty,u),n.setMatrix(a._normalMatrixProperty,c)},i._onEnable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.addOnUpdateRenderers(this),e.addRenderer(this)},i._onDisable=function(){var e=this.engine._componentsManager;this._overrideUpdate&&e.removeOnUpdateRenderers(this),e.removeRenderer(this)},i._render=function(e){throw"not implement"},i._onDestroy=function(){var e=this._transformChangeFlag;e&&(e.destroy(),this._transformChangeFlag=null),this.shaderData._addRefCount(-1);for(var n=this._materials,o=0,s=n.length;o<s;o++){var l;(l=n[o])===null||l===void 0||l._addRefCount(-1)}},i._updateBounds=function(e){},i._createInstanceMaterial=function(e,n){var o=e.clone();return o.name=o.name+"(Instance)",e._addRefCount(-1),o._addRefCount(1),this._materialsInstanced[n]=!0,this._materials[n]=o,o},i._setMaterial=function(e,n){var o=this._materials;e>=o.length&&(o.length=e+1);var s=o[e];if(s!==n){var l=this._materialsInstanced;e<l.length&&(l[e]=!1),s&&s._addRefCount(-1),n&&n._addRefCount(1),o[e]=n}},Y(a,[{key:"materialCount",get:function(){return this._materials.length},set:function(e){var n=this._materials,o=this._materialsInstanced;n.length!==e&&(n.length=e),o.length>e&&(o.length=e)}},{key:"bounds",get:function(){var e=this._transformChangeFlag;return e.flag&&(this._updateBounds(this._bounds),e.flag=!1),this._bounds}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}}]),a}(hr),dn._localMatrixProperty=O.getPropertyByName("u_localMat"),dn._worldMatrixProperty=O.getPropertyByName("u_modelMat"),dn._mvMatrixProperty=O.getPropertyByName("u_MVMat"),dn._mvpMatrixProperty=O.getPropertyByName("u_MVPMat"),dn._mvInvMatrixProperty=O.getPropertyByName("u_MVInvMat"),dn._normalMatrixProperty=O.getPropertyByName("u_normalMat"),dn),yd=U(st.prototype,"shaderData",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vo(Cr.Renderer)}}),xd=U(st.prototype,"isCulled",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wd=U(st.prototype,"_distanceForSort",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd=U(st.prototype,"_onUpdateIndex",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Cd=U(st.prototype,"_rendererIndex",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Pd=U(st.prototype,"_globalShaderMacro",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jt}}),Ad=U(st.prototype,"_transformChangeFlag",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td=U(st.prototype,"_bounds",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gr}}),bd=U(st.prototype,"_overrideUpdate",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ed=U(st.prototype,"_materials",[O0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Md=U(st.prototype,"_mvMatrix",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),Rd=U(st.prototype,"_mvpMatrix",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),Fd=U(st.prototype,"_mvInvMatrix",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),zd=U(st.prototype,"_normalMatrix",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),Ld=U(st.prototype,"_materialsInstanced",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bd=U(st.prototype,"_priority",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st))||md);function Y0(){return function(t){}}var Dd,Od,is,ja=(Dd=Y0(),Dd(Od=(is=function(){function t(){}return t.resetData=function(i){var r=i._renderData,e=r.vertexCount=4,n=r.positions,o=r.uvs;if(n.length<e)for(var s=n.length;s<e;s++)n.push(new C),o.push(new $);r.triangles=t._rectangleTriangles},t.updatePositions=function(i){var r=i.width,e=i.height,n=i.sprite,o=n.pivot,s=o.x,l=o.y,u=t._worldMatrix,c=u.elements,f=i.entity.transform.worldMatrix.elements,h=i.flipX?-r:r,d=i.flipY?-e:e;c[0]=f[0]*h,c[1]=f[1]*h,c[2]=f[2]*h,c[4]=f[4]*d,c[5]=f[5]*d,c[6]=f[6]*d,c[8]=f[8],c[9]=f[9],c[10]=f[10],c[12]=f[12]-s*c[0]-l*c[4],c[13]=f[13]-s*c[1]-l*c[5],c[14]=f[14]-s*c[2]-l*c[6];for(var _=n._getPositions(),m=i._renderData.positions,p=0;p<4;p++){var v=_[p],g=v.x,y=v.y;m[p].set(c[0]*g+c[4]*y+c[12],c[1]*g+c[5]*y+c[13],c[2]*g+c[6]*y+c[14])}Gr.transform(n._getBounds(),u,i._bounds)},t.updateUVs=function(i){var r=i.sprite._getUVs(),e=i._renderData.uvs,n=r[0],o=n.x,s=n.y,l=r[3],u=l.x,c=l.y;e[0].set(o,s),e[1].set(u,s),e[2].set(o,c),e[3].set(u,c)},t}(),is._rectangleTriangles=[0,1,2,2,1,3],is._worldMatrix=new re,is))||Od),of=function(a,i,r,e,n){e===void 0&&(e=null),n===void 0&&(n=null),this.vertexCount=a,this.positions=i,this.uvs=r,this.triangles=e,this.color=n},ze;(function(t){t[t.texture=1]="texture",t[t.size=2]="size",t[t.atlasRotate=4]="atlasRotate",t[t.atlasRegion=8]="atlasRegion",t[t.atlasRegionOffset=16]="atlasRegionOffset",t[t.region=32]="region",t[t.pivot=64]="pivot",t[t.border=128]="border"})(ze||(ze={}));var da;(function(t){t[t.Layer0=1]="Layer0",t[t.Layer1=2]="Layer1",t[t.Layer2=4]="Layer2",t[t.Layer3=8]="Layer3",t[t.Layer4=16]="Layer4",t[t.Layer5=32]="Layer5",t[t.Layer6=64]="Layer6",t[t.Layer7=128]="Layer7",t[t.Layer8=256]="Layer8",t[t.Layer9=512]="Layer9",t[t.Layer10=1024]="Layer10",t[t.Layer11=2048]="Layer11",t[t.Layer12=4096]="Layer12",t[t.Layer13=8192]="Layer13",t[t.Layer14=16384]="Layer14",t[t.Layer15=32768]="Layer15",t[t.Layer16=65536]="Layer16",t[t.Layer17=131072]="Layer17",t[t.Layer18=262144]="Layer18",t[t.Layer19=524288]="Layer19",t[t.Layer20=1048576]="Layer20",t[t.Layer21=2097152]="Layer21",t[t.Layer22=4194304]="Layer22",t[t.Layer23=8388608]="Layer23",t[t.Layer24=16777216]="Layer24",t[t.Layer25=33554432]="Layer25",t[t.Layer26=67108864]="Layer26",t[t.Layer27=134217728]="Layer27",t[t.Layer28=268435456]="Layer28",t[t.Layer29=536870912]="Layer29",t[t.Layer30=1073741824]="Layer30",t[t.Layer31=2147483648]="Layer31",t[t.Everything=4294967295]="Everything"})(da||(da={}));var vr,Id,Nd,kd,Ud,Vd,Gd,Hd,Wd,jd,as,ec=(vr=(as=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,k(e,"influenceLayers",Id,B(e)),e._maskElement=void 0,e._renderData=void 0,k(e,"_sprite",Nd,B(e)),k(e,"_width",kd,B(e)),k(e,"_height",Ud,B(e)),k(e,"_flipX",Vd,B(e)),k(e,"_flipY",Gd,B(e)),k(e,"_alphaCutoff",Hd,B(e)),k(e,"_dirtyFlag",Wd,B(e)),k(e,"_spriteChangeFlag",jd,B(e)),e._renderData=new of(4,[],[]),ja.resetData(B(e)),e.setMaterial(e._engine._spriteMaskDefaultMaterial),e.shaderData.setFloat(a._alphaCutoffProperty,e._alphaCutoff),e._onSpriteChange=e._onSpriteChange.bind(B(e)),e}var i=a.prototype;return i._onDestroy=function(){this._sprite=null,this._renderData=null,this._spriteChangeFlag&&(this._spriteChangeFlag.destroy(),this._spriteChangeFlag=null),t.prototype._onDestroy.call(this)},i._render=function(e){var n;if(!(!((n=this.sprite)!==null&&n!==void 0&&n.texture)||!this.width||!this.height)){(this._transformChangeFlag.flag||this._dirtyFlag&Ft.Position)&&(ja.updatePositions(this),this._dirtyFlag&=~Ft.Position,this._transformChangeFlag.flag=!1),this._dirtyFlag&Ft.UV&&(ja.updateUVs(this),this._dirtyFlag&=~Ft.UV);var o=this._engine._spriteMaskElementPool,s=o.getFromPool();s.setValue(this,this._renderData,this.getMaterial()),e._renderPipeline._allSpriteMasks.add(this),this._maskElement=s}},i._cloneTo=function(e){e.sprite=this._sprite},i._onSpriteChange=function(e){switch(e){case ze.texture:this.shaderData.setTexture(a._textureProperty,this.sprite.texture);break;case ze.region:case ze.atlasRegionOffset:this._dirtyFlag|=Ft.All;break;case ze.atlasRegion:this._dirtyFlag|=Ft.UV;break}},Y(a,[{key:"width",get:function(){return this._width===void 0&&this._sprite&&(this.width=this._sprite.width),this._width},set:function(e){this._width!==e&&(this._width=e,this._dirtyFlag|=Ft.Position)}},{key:"height",get:function(){return this._height===void 0&&this._sprite&&(this.height=this._sprite.height),this._height},set:function(e){this._height!==e&&(this._height=e,this._dirtyFlag|=Ft.Position)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyFlag|=Ft.Position)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyFlag|=Ft.Position)}},{key:"sprite",get:function(){return this._sprite},set:function(e){this._sprite!==e&&(this._sprite=e,this._spriteChangeFlag&&this._spriteChangeFlag.destroy(),e?(this._spriteChangeFlag=e._registerUpdateFlag(),this._spriteChangeFlag.listener=this._onSpriteChange,this._dirtyFlag|=Ft.All,this.shaderData.setTexture(a._textureProperty,e.texture)):(this._spriteChangeFlag=null,this.shaderData.setTexture(a._textureProperty,null)))}},{key:"alphaCutoff",get:function(){return this._alphaCutoff},set:function(e){this._alphaCutoff!==e&&(this._alphaCutoff=e,this.shaderData.setFloat(a._alphaCutoffProperty,e))}},{key:"bounds",get:function(){var e;return!((e=this.sprite)!==null&&e!==void 0&&e.texture)||!this.width||!this.height?Er._defaultBoundingBox:((this._transformChangeFlag.flag||this._dirtyFlag&Ft.Position)&&(ja.updatePositions(this),this._dirtyFlag&=~Ft.Position,this._transformChangeFlag.flag=!1),this._bounds)}}]),a}(Go),as._textureProperty=O.getPropertyByName("u_maskTexture"),as._alphaCutoffProperty=O.getPropertyByName("u_maskAlphaCutoff"),as),Id=U(vr.prototype,"influenceLayers",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return da.Everything}}),Nd=U(vr.prototype,"_sprite",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kd=U(vr.prototype,"_width",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Ud=U(vr.prototype,"_height",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Vd=U(vr.prototype,"_flipX",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Gd=U(vr.prototype,"_flipY",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Hd=U(vr.prototype,"_alphaCutoff",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Wd=U(vr.prototype,"_dirtyFlag",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jd=U(vr.prototype,"_spriteChangeFlag",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vr),Ft;(function(t){t[t.Position=1]="Position",t[t.UV=2]="UV",t[t.All=3]="All"})(Ft||(Ft={}));var K;(function(t){t[t.Float=0]="Float",t[t.Vector2=1]="Vector2",t[t.Vector3=2]="Vector3",t[t.Vector4=3]="Vector4",t[t.Byte4=4]="Byte4",t[t.UByte4=5]="UByte4",t[t.NormalizedByte4=6]="NormalizedByte4",t[t.NormalizedUByte4=7]="NormalizedUByte4",t[t.Short2=8]="Short2",t[t.UShort2=9]="UShort2",t[t.NormalizedShort2=10]="NormalizedShort2",t[t.NormalizedUShort2=11]="NormalizedUShort2",t[t.Short4=12]="Short4",t[t.UShort4=13]="UShort4",t[t.NormalizedShort4=14]="NormalizedShort4",t[t.NormalizedUShort4=15]="NormalizedUShort4"})(K||(K={}));var Pt;(function(t){t[t.Static=0]="Static",t[t.Dynamic=1]="Dynamic",t[t.Stream=2]="Stream"})(Pt||(Pt={}));var ct;(function(t){t[t.UInt8=0]="UInt8",t[t.UInt16=1]="UInt16",t[t.UInt32=2]="UInt32"})(ct||(ct={}));var Eo=function(){function t(){}return t._getGLBufferUsage=function(i,r){switch(r){case Pt.Static:return i.STATIC_DRAW;case Pt.Dynamic:return i.DYNAMIC_DRAW;case Pt.Stream:return i.STREAM_DRAW}},t._getGLIndexType=function(i){switch(i){case ct.UInt8:return Ue.UNSIGNED_BYTE;case ct.UInt16:return Ue.UNSIGNED_SHORT;case ct.UInt32:return Ue.UNSIGNED_INT}},t._getGLIndexByteCount=function(i){switch(i){case ct.UInt8:return 1;case ct.UInt16:return 2;case ct.UInt32:return 4}},t._getElementInfo=function(i){var r,e,n=!1;switch(i){case K.Float:r=1,e=Ue.FLOAT;break;case K.Vector2:r=2,e=Ue.FLOAT;break;case K.Vector3:r=3,e=Ue.FLOAT;break;case K.Vector4:r=4,e=Ue.FLOAT;break;case K.Byte4:r=4,e=Ue.BYTE;break;case K.UByte4:r=4,e=Ue.UNSIGNED_BYTE;break;case K.NormalizedByte4:r=4,e=Ue.BYTE,n=!0;break;case K.NormalizedUByte4:r=4,e=Ue.UNSIGNED_BYTE,n=!0;break;case K.Short2:r=2,e=Ue.SHORT;break;case K.UShort2:r=2,e=Ue.UNSIGNED_SHORT;break;case K.NormalizedShort2:r=2,e=Ue.SHORT,n=!0;break;case K.NormalizedUShort2:r=2,e=Ue.UNSIGNED_SHORT,n=!0;break;case K.Short4:r=4,e=Ue.SHORT;break;case K.UShort4:r=4,e=Ue.UNSIGNED_SHORT;break;case K.NormalizedShort4:r=4,e=Ue.SHORT,n=!0;break;case K.NormalizedUShort4:r=4,e=Ue.UNSIGNED_SHORT,n=!0;break}return{size:r,type:e,normalized:n}},t}(),xe=function(){function t(a,i,r,e,n){n===void 0&&(n=0),this._glElementInfo=void 0,this._semantic=void 0,this._offset=void 0,this._format=void 0,this._bindingIndex=void 0,this._instanceStepRate=void 0,this._semantic=a,this._offset=i,this._format=r,this._bindingIndex=e,this._glElementInfo=Eo._getElementInfo(this.format),this._instanceStepRate=Math.floor(n)}return Y(t,[{key:"semantic",get:function(){return this._semantic}},{key:"offset",get:function(){return this._offset},set:function(i){this._offset=i}},{key:"format",get:function(){return this._format}},{key:"bindingIndex",get:function(){return this._bindingIndex},set:function(i){this._bindingIndex=i}},{key:"instanceStepRate",get:function(){return this._instanceStepRate}}]),t}(),br;(function(t){t[t.VertexBuffer=0]="VertexBuffer",t[t.IndexBuffer=1]="IndexBuffer"})(br||(br={}));var Mo;(function(t){t[t.None=0]="None",t[t.Discard=1]="Discard"})(Mo||(Mo={}));var nn=function(t){q(a,t);function a(r,e,n,o){var s;o===void 0&&(o=Pt.Static),s=t.call(this,r)||this,s._glBindTarget=void 0,s._glBufferUsage=void 0,s._nativeBuffer=void 0,s._hardwareRenderer=void 0,s._type=void 0,s._byteLength=void 0,s._bufferUsage=void 0,s._engine=r,s._type=e,s._bufferUsage=o;var l=r._hardwareRenderer,u=l.gl,c=Eo._getGLBufferUsage(u,o),f=e===br.VertexBuffer?u.ARRAY_BUFFER:u.ELEMENT_ARRAY_BUFFER;return s._nativeBuffer=u.createBuffer(),s._hardwareRenderer=l,s._glBufferUsage=c,s._glBindTarget=f,s.bind(),typeof n=="number"?(s._byteLength=n,u.bufferData(f,n,c)):(s._byteLength=n.byteLength,u.bufferData(f,n,c)),u.bindBuffer(f,null),s}var i=a.prototype;return i.bind=function(){var e=this._hardwareRenderer.gl;e.bindBuffer(this._glBindTarget,this._nativeBuffer)},i.setData=function(e,n,o,s,l){n===void 0&&(n=0),o===void 0&&(o=0),l===void 0&&(l=Mo.None);var u=this._hardwareRenderer.gl,c=this._hardwareRenderer.isWebGL2,f=this._glBindTarget;this.bind(),l===Mo.Discard&&u.bufferData(f,this._byteLength,this._glBufferUsage);var h=e.BYTES_PER_ELEMENT||1,d=s?h*s:e.byteLength;if(o!==0||d<e.byteLength){var _=e.byteOffset!==void 0;if(c&&_)u.bufferSubData(f,n,e,o,d/h);else{var m=new Uint8Array(_?e.buffer:e,o*h,d);u.bufferSubData(f,n,m)}}else u.bufferSubData(f,n,e);u.bindBuffer(f,null)},i.getData=function(e,n,o,s){n===void 0&&(n=0),o===void 0&&(o=0);var l=this._hardwareRenderer.isWebGL2;if(l){var u=this._hardwareRenderer.gl;this.bind(),u.getBufferSubData(this._glBindTarget,n,e,o,s)}else throw"Buffer is write-only on WebGL1.0 platforms."},i._onDestroy=function(){var e=this._hardwareRenderer.gl;e.deleteBuffer(this._nativeBuffer),this._nativeBuffer=null,this._hardwareRenderer=null},i.resize=function(e){this.bind();var n=this._hardwareRenderer.gl;n.bufferData(this._glBindTarget,e,this._glBufferUsage),this._byteLength=e},Y(a,[{key:"type",get:function(){return this._type}},{key:"byteLength",get:function(){return this._byteLength}},{key:"bufferUsage",get:function(){return this._bufferUsage}}]),a}(un),yi;(function(t){t[t.Points=0]="Points",t[t.Lines=1]="Lines",t[t.LineLoop=2]="LineLoop",t[t.LineStrip=3]="LineStrip",t[t.Triangles=4]="Triangles",t[t.TriangleStrip=5]="TriangleStrip",t[t.TriangleFan=6]="TriangleFan"})(yi||(yi={}));var qs=function(){function t(a,i){this._buffer=void 0,this._format=void 0,this._buffer=a,this._format=i}return Y(t,[{key:"buffer",get:function(){return this._buffer}},{key:"format",get:function(){return this._format}}]),t}(),sf=function(a,i,r){a===void 0&&(a=0),i===void 0&&(i=0),r===void 0&&(r=yi.Triangles),this.start=void 0,this.count=void 0,this.topology=void 0,this.start=a,this.count=i,this.topology=r},lf=function(t){q(a,t);function a(r,e){var n;return n=t.call(this,r)||this,n.name=void 0,n.bounds=new Gr,n._vertexElementMap={},n._glIndexType=void 0,n._glIndexByteCount=void 0,n._platformPrimitive=void 0,n._instanceCount=0,n._vertexBufferBindings=[],n._indexBufferBinding=null,n._vertexElements=[],n._enableVAO=!0,n._subMeshes=[],n._updateFlagManager=new fa,n.name=e,n._platformPrimitive=n._engine._hardwareRenderer.createPlatformPrimitive(B(n)),n}var i=a.prototype;return i.addSubMesh=function(e,n,o){return o===void 0&&(o=yi.Triangles),typeof e=="number"&&(e=new sf(e,n,o)),this._subMeshes.push(e),e},i.removeSubMesh=function(e){var n=this._subMeshes,o=n.indexOf(e);o!==-1&&n.splice(o,1)},i.clearSubMesh=function(){this._subMeshes.length=0},i.registerUpdateFlag=function(){return this._updateFlagManager.createFlag(Uo)},i._clearVertexElements=function(){this._vertexElements.length=0;var e=this._vertexElementMap;for(var n in e)delete e[n]},i._addVertexElement=function(e){var n=e.semantic;this._vertexElementMap[n]=e,this._vertexElements.push(e),this._updateFlagManager.dispatch()},i._setVertexBufferBinding=function(e,n){if(this._getRefCount()>0){var o=this._vertexBufferBindings[e];o&&o._buffer._addRefCount(-1),n._buffer._addRefCount(1)}this._vertexBufferBindings[e]=n},i._draw=function(e,n){this._platformPrimitive.draw(e,n)},i._addRefCount=function(e){t.prototype._addRefCount.call(this,e);for(var n=this._vertexBufferBindings,o=0,s=n.length;o<s;o++)n[o]._buffer._addRefCount(e)},i._onDestroy=function(){this._vertexBufferBindings=null,this._indexBufferBinding=null,this._vertexElements=null,this._vertexElementMap=null,this._platformPrimitive.destroy()},i._setVertexElements=function(e){this._clearVertexElements();for(var n=0,o=e.length;n<o;n++)this._addVertexElement(e[n])},i._setIndexBufferBinding=function(e){e?(this._indexBufferBinding=e,this._glIndexType=Eo._getGLIndexType(e.format),this._glIndexByteCount=Eo._getGLIndexByteCount(e.format)):(this._indexBufferBinding=null,this._glIndexType=void 0)},Y(a,[{key:"subMesh",get:function(){return this._subMeshes[0]||null}},{key:"subMeshes",get:function(){return this._subMeshes}}]),a}(un),yl=function(){function t(a,i){this._buffer=void 0,this._stride=void 0,this._buffer=a,this._stride=i}return Y(t,[{key:"buffer",get:function(){return this._buffer}},{key:"stride",get:function(){return this._stride}}]),t}(),lt;(function(t){t[t.Depth=0]="Depth",t[t.DepthStencil=1]="DepthStencil",t[t.Stencil=2]="Stencil",t[t.Depth16=3]="Depth16",t[t.Depth24=4]="Depth24",t[t.Depth32=5]="Depth32",t[t.Depth24Stencil8=6]="Depth24Stencil8",t[t.Depth32Stencil8=7]="Depth32Stencil8"})(lt||(lt={}));var Vt;(function(t){t[t.PositiveX=0]="PositiveX",t[t.NegativeX=1]="NegativeX",t[t.PositiveY=2]="PositiveY",t[t.NegativeY=3]="NegativeY",t[t.PositiveZ=4]="PositiveZ",t[t.NegativeZ=5]="NegativeZ"})(Vt||(Vt={}));var or;(function(t){t[t.Point=0]="Point",t[t.Bilinear=1]="Bilinear",t[t.Trilinear=2]="Trilinear"})(or||(or={}));var J;(function(t){t[t.R8G8B8=0]="R8G8B8",t[t.R8G8B8A8=1]="R8G8B8A8",t[t.R4G4B4A4=2]="R4G4B4A4",t[t.R5G5B5A1=3]="R5G5B5A1",t[t.R5G6B5=4]="R5G6B5",t[t.Alpha8=5]="Alpha8",t[t.LuminanceAlpha=6]="LuminanceAlpha",t[t.R16G16B16A16=7]="R16G16B16A16",t[t.R32G32B32A32=8]="R32G32B32A32",t[t.DXT1=9]="DXT1",t[t.DXT5=10]="DXT5",t[t.ETC1_RGB=11]="ETC1_RGB",t[t.ETC2_RGB=12]="ETC2_RGB",t[t.ETC2_RGBA5=13]="ETC2_RGBA5",t[t.ETC2_RGBA8=14]="ETC2_RGBA8",t[t.PVRTC_RGB2=15]="PVRTC_RGB2",t[t.PVRTC_RGBA2=16]="PVRTC_RGBA2",t[t.PVRTC_RGB4=17]="PVRTC_RGB4",t[t.PVRTC_RGBA4=18]="PVRTC_RGBA4",t[t.ASTC_4x4=19]="ASTC_4x4",t[t.ASTC_5x5=20]="ASTC_5x5",t[t.ASTC_6x6=21]="ASTC_6x6",t[t.ASTC_8x8=22]="ASTC_8x8",t[t.ASTC_10x10=23]="ASTC_10x10",t[t.ASTC_12x12=24]="ASTC_12x12",t[t.Depth=25]="Depth",t[t.DepthStencil=26]="DepthStencil",t[t.Stencil=27]="Stencil",t[t.Depth16=28]="Depth16",t[t.Depth24=29]="Depth24",t[t.Depth32=30]="Depth32",t[t.Depth24Stencil8=31]="Depth24Stencil8",t[t.Depth32Stencil8=32]="Depth32Stencil8"})(J||(J={}));var Gt;(function(t){t[t.Clamp=0]="Clamp",t[t.Repeat=1]="Repeat",t[t.Mirror=2]="Mirror"})(Gt||(Gt={}));var Ys=function(t){q(a,t);function a(r,e,n,o,s,l){var u;return s===void 0&&(s=lt.Depth),l===void 0&&(l=1),u=t.call(this,r)||this,u._platformRenderTarget=void 0,u._depth=void 0,u._antiAliasing=void 0,u._autoGenerateMipmaps=!0,u._width=void 0,u._height=void 0,u._colorTextures=void 0,u._depthTexture=void 0,u._width=e,u._height=n,u._antiAliasing=l,u._depth=s,o?u._colorTextures=o instanceof Array?o.slice():[o]:u._colorTextures=[],s instanceof Ur&&(u._depthTexture=s),u._platformRenderTarget=r._hardwareRenderer.createPlatformRenderTarget(B(u)),u}var i=a.prototype;return i.getColorTexture=function(e){return e===void 0&&(e=0),this._colorTextures[e]},i.generateMipmaps=function(){if(this._autoGenerateMipmaps){for(var e=this._colorTextures,n=0,o=e.length;n<o;n++){var s=e[n];s.generateMipmaps()}this._depthTexture&&this._depthTexture.generateMipmaps()}},i.destroy=function(){this._platformRenderTarget.destroy(),this._colorTextures.length=0,this._depthTexture=null,this._depth=null},i._setRenderTargetInfo=function(e,n){this._platformRenderTarget.setRenderTargetInfo(e,n)},i._blitRenderTarget=function(){this._platformRenderTarget.blitRenderTarget()},Y(a,[{key:"autoGenerateMipmaps",get:function(){return this._autoGenerateMipmaps},set:function(e){this._autoGenerateMipmaps=e}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"colorTextureCount",get:function(){return this._colorTextures.length}},{key:"depthTexture",get:function(){return this._depthTexture}},{key:"antiAliasing",get:function(){return this._antiAliasing}}]),a}(ln),cr=function(t){q(a,t);function a(r,e,n,o,s){var l;return o===void 0&&(o=J.R8G8B8A8),s===void 0&&(s=!0),l=t.call(this,r)||this,l._mipmap=s,l._width=e,l._height=n,l._format=o,l._mipmapCount=l._getMipmapCount(),l._platformTexture=r._hardwareRenderer.createPlatformTexture2D(B(l)),l.filterMode=or.Bilinear,l.wrapModeU=l.wrapModeV=Gt.Repeat,l}var i=a.prototype;return i.setPixelBuffer=function(e,n,o,s,l,u){n===void 0&&(n=0),o===void 0&&(o=0),s===void 0&&(s=0),this._platformTexture.setPixelBuffer(e,n,o,s,l,u)},i.setImageSource=function(e,n,o,s,l,u){n===void 0&&(n=0),o===void 0&&(o=!1),s===void 0&&(s=!1),l===void 0&&(l=0),u===void 0&&(u=0),this._platformTexture.setImageSource(e,n,o,s,l,u)},i.getPixelBuffer=function(e,n,o,s,l,u){var c=arguments.length;c===1?this._platformTexture.getPixelBuffer(0,0,this._width,this._height,0,e):c===2?this._platformTexture.getPixelBuffer(0,0,this._width>>e,this._height>>e,e,n):c===5?this._platformTexture.getPixelBuffer(e,n,o,s,0,l):c===6&&this._platformTexture.getPixelBuffer(e,n,o,s,l,u)},a}(Ur),uf=function(t){q(a,t);function a(r,e,n,o,s,l){var u;return s===void 0&&(s=J.R8G8B8A8),l===void 0&&(l=!0),u=t.call(this,r)||this,u._length=void 0,u._mipmap=l,u._width=e,u._height=n,u._length=o,u._format=s,u._mipmapCount=u._getMipmapCount(),u._platformTexture=r._hardwareRenderer.createPlatformTexture2DArray(B(u)),u.filterMode=or.Bilinear,u.wrapModeU=u.wrapModeV=Gt.Repeat,u}var i=a.prototype;return i.setPixelBuffer=function(e,n,o,s,l,u,c,f){o===void 0&&(o=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,n,o,s,l,u,c,f)},i.setImageSource=function(e,n,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1),u===void 0&&(u=0),c===void 0&&(c=0),this._platformTexture.setImageSource(e,n,o,s,l,u,c)},i.getPixelBuffer=function(e,n,o,s,l,u,c){var f=arguments.length;f===1?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,n):f===2?this._platformTexture.getPixelBuffer(e,0,0,this._width>>n,this._height>>n,n,o):f===5?this._platformTexture.getPixelBuffer(e,n,o,s,l,0,u):f===6&&this._platformTexture.getPixelBuffer(e,n,o,s,l,u,c)},Y(a,[{key:"length",get:function(){return this._length}}]),a}(Ur),$t=function(t){q(a,t);function a(r,e,n,o){var s;return n===void 0&&(n=J.R8G8B8A8),o===void 0&&(o=!0),s=t.call(this,r)||this,s._mipmap=o,s._width=e,s._height=e,s._format=n,s._mipmapCount=s._getMipmapCount(),s._platformTexture=r._hardwareRenderer.createPlatformTextureCube(B(s)),s.filterMode=or.Bilinear,s.wrapModeU=s.wrapModeV=Gt.Clamp,s}var i=a.prototype;return i.setPixelBuffer=function(e,n,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=0),l===void 0&&(l=0),this._platformTexture.setPixelBuffer(e,n,o,s,l,u,c)},i.setImageSource=function(e,n,o,s,l,u,c){o===void 0&&(o=0),s===void 0&&(s=!1),l===void 0&&(l=!1),u===void 0&&(u=0),c===void 0&&(c=0),this._platformTexture.setImageSource(e,n,o,s,l,u,c)},i.getPixelBuffer=function(e,n,o,s,l,u,c){var f=arguments.length;f===2?this._platformTexture.getPixelBuffer(e,0,0,this._width,this._height,0,n):f===3?this._platformTexture.getPixelBuffer(e,0,0,this._width>>n,this._height>>n,n,o):f===6?this._platformTexture.getPixelBuffer(e,n,o,s,l,0,u):f===7&&this._platformTexture.getPixelBuffer(e,n,o,s,l,u,c)},a}(Ur),Wn=function(){function t(i,r){this._blendShapeCount=0,this._blendShapes=[],this._blendShapeNames=void 0,this._layoutDirtyListener=new vl,this._subDataDirtyFlags=[],this._vertexTexture=void 0,this._vertexBuffers=[],this._vertices=void 0,this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._vertexElementOffset=void 0,this._storeInVertexBufferInfo=[],this._maxCountSingleVertexBuffer=0,this._engine=void 0,this._modelMesh=void 0,this._lastCreateHostInfo=new C(0,0,0),this._canUseTextureStoreData=!0,this._dataTextureInfo=new C,this._engine=i,this._modelMesh=r,this._canUseTextureStoreData=this._engine._hardwareRenderer.capability.canUseFloatTextureBlendShape,this._layoutDirtyListener.listener=this._updateLayoutChange.bind(this)}var a=t.prototype;return a._addBlendShape=function(r){this._blendShapes.push(r),this._blendShapeCount++,r._addLayoutChangeFlag(this._layoutDirtyListener),this._updateLayoutChange(r),this._subDataDirtyFlags.push(r._createSubDataDirtyFlag())},a._clearBlendShapes=function(){this._useBlendNormal=!1,this._useBlendTangent=!1,this._vertexElementCount=0,this._blendShapes.length=0,this._blendShapeCount=0,this._layoutDirtyListener.clearFromManagers();for(var r=this._subDataDirtyFlags,e=0,n=r.length;e<n;e++)r[e].destroy();r.length=0},a._updateShaderData=function(r,e){var n=this._blendShapeCount;if(n>0){if(r.enableMacro(t._blendShapeMacro),this._useTextureMode())r.enableMacro(t._blendShapeTextureMacro),r.setTexture(t._blendShapeTextureProperty,this._vertexTexture),r.setVector3(t._blendShapeTextureInfoProperty,this._dataTextureInfo),r.setFloatArray(t._blendShapeWeightsProperty,e.blendShapeWeights);else{var o=this._getVertexBufferModeSupportCount();if(n>o){var s=e._condensedBlendShapeWeights;s||(s=new Float32Array(o),e._condensedBlendShapeWeights=s),this._filterCondensedBlendShapeWeights(e.blendShapeWeights,s),r.setFloatArray(t._blendShapeWeightsProperty,s),this._modelMesh._enableVAO=!1,n=o}else r.setFloatArray(t._blendShapeWeightsProperty,e.blendShapeWeights),this._modelMesh._enableVAO=!0;r.disableMacro(t._blendShapeTextureMacro)}r.enableMacro("OASIS_BLENDSHAPE_COUNT",n.toString()),this._useBlendNormal?r.enableMacro(t._blendShapeNormalMacro):r.disableMacro(t._blendShapeNormalMacro),this._useBlendTangent?r.enableMacro(t._blendShapeTangentMacro):r.disableMacro(t._blendShapeTangentMacro)}else r.disableMacro(t._blendShapeMacro),r.disableMacro("OASIS_BLENDSHAPE_COUNT")},a._useTextureMode=function(){return this._canUseTextureStoreData?this._blendShapeCount>this._getVertexBufferModeSupportCount():!1},a._layoutOrCountChange=function(){var r=this._lastCreateHostInfo;return r.x!==this._blendShapeCount||!!r.y!==this._useBlendNormal||!!r.z!==this._useBlendTangent},a._vertexElementsNeedUpdate=function(){var r=this._getVertexBufferModeSupportCount(),e=this._lastCreateHostInfo;return Math.min(e.x,r)!==Math.min(this._blendShapeCount,r)||!!e.y!==this._useBlendNormal||!!e.z!==this._useBlendTangent},a._needUpdateData=function(){for(var r=this._subDataDirtyFlags,e=0,n=r.length;e<n;e++)if(r[e].flag)return!0;return!1},a._addVertexElements=function(r){var e=0;this._vertexElementOffset=r._vertexElements.length;for(var n=0,o=Math.min(this._blendShapeCount,this._getVertexBufferModeSupportCount());n<o;n++)r._addVertexElement(new xe("POSITION_BS"+n,e,K.Vector3,1)),e+=12,this._useBlendNormal&&(r._addVertexElement(new xe("NORMAL_BS"+n,e,K.Vector3,1)),e+=12),this._useBlendTangent&&(r._addVertexElement(new xe("TANGENT_BS"+n,e,K.Vector3,1)),e+=12)},a._update=function(r,e){var n=this._modelMesh.vertexCount,o=this._useTextureMode(),s=this._layoutOrCountChange()||r;s&&(o?this._createTextureArray(n):this._createVertexBuffers(n,e),this._lastCreateHostInfo.set(this._blendShapeCount,+this._useBlendNormal,+this._useBlendTangent)),this._needUpdateData()&&(o?this._updateTextureArray(n,s):this._updateVertexBuffers(n,s))},a._releaseMemoryCache=function(){for(var r=this._blendShapes,e=r.length,n=new Array(e),o=0;o<e;o++)n[o]=r[o].name;this._blendShapeNames=n,this._layoutDirtyListener.destroy();for(var s=this._subDataDirtyFlags,l=0,u=s.length;l<u;l++)s[l].destroy();this._layoutDirtyListener=null,this._subDataDirtyFlags=null,this._blendShapes=null,this._vertices=null},a._createVertexBuffers=function(r,e){var n=this._engine,o=this._modelMesh,s=this._blendShapeCount,l=this._vertexBuffers,u=this._vertexElementCount*3,c=u*4,f=Math.floor(255/c),h=Math.ceil(s/f),d=u*r*Math.min(f,s);l.length=h,this._vertices=new Float32Array(d),this._maxCountSingleVertexBuffer=f,this._storeInVertexBufferInfo.length=s;for(var _=0;_<h;_++){var m=h-1,p=_===m?s-m*f:f,v=p*c,g=v*r,y=e?Pt.Static:Pt.Dynamic,x=new nn(n,br.VertexBuffer,g,y);o._setVertexBufferBinding(_+1,new yl(x,v)),l[_]=x}},a._createTextureArray=function(r){var e=this._engine._hardwareRenderer.capability.maxTextureSize,n=this._vertexElementCount,o=n*r,s=1;o>e&&(s=Math.ceil(o/e),o=e);var l=this._vertexTexture,u=this._blendShapes.length;l&&l.destroy(),l=new uf(this._engine,o,s,u,J.R32G32B32A32,!1),l.filterMode=or.Point,this._vertices=new Float32Array(u*o*s*4),this._vertexTexture=l,this._dataTextureInfo.set(n,o,s)},a._updateVertexBuffers=function(r,e){for(var n=this._blendShapes,o=this._maxCountSingleVertexBuffer,s=this._vertices,l=this._vertexBuffers,u=this._storeInVertexBufferInfo,c=this._subDataDirtyFlags,f=this._vertexElementCount*3,h=f*4,d=0,_=n.length;d<_;d++){var m=c[d];if(e||m.flag){var p=n[d].frames,v=p.length,g=p[v-1];if(v>0&&g.deltaPositions.length!==r)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";var y=Math.floor(d/o),x=d%o,P=l[y],S=P.byteLength/(r*4),w=x*f,b=u[d];b||(u[d]=b=new $),b.set(y+1,x*h);for(var E=g,M=E.deltaPositions,F=0;F<r;F++){var A=w+S*F,T=M[F];T&&(s[A]=T.x,s[A+1]=T.y,s[A+2]=T.z)}if(w+=3,this._useBlendNormal){var R=g,z=R.deltaNormals;if(z)for(var L=0;L<r;L++){var N=w+S*L,V=z[L];V&&(s[N]=V.x,s[N+1]=V.y,s[N+2]=V.z)}w+=3}if(this._useBlendTangent){var D=g,j=D.deltaTangents;if(j)for(var I=0;I<r;I++){var H=w+S*I,G=j[I];G&&(s[H]=G.x,s[H+1]=G.y,s[H+2]=G.z)}w+=3}(x===o-1||d===_-1)&&P.setData(s,0,0,P.byteLength/4),m.flag=!1}}},a._updateTextureArray=function(r,e){for(var n=this._blendShapes,o=this._vertexTexture,s=this._vertices,l=this._subDataDirtyFlags,u=0,c=n.length;u<c;u++){var f=l[u],h=o.width*o.height*4;if(e||f.flag){var d=n[u].frames,_=d.length,m=d[_-1];if(_>0&&m.deltaPositions.length!==r)throw"BlendShape frame deltaPositions length must same with mesh vertexCount.";for(var p=m,v=p.deltaPositions,g=p.deltaNormals,y=p.deltaTangents,x=u*h,P=0;P<r;P++){var S=v[P];if(s[x]=S.x,s[x+1]=S.y,s[x+2]=S.z,x+=4,g){var w=g[P];s[x]=w.x,s[x+1]=w.y,s[x+2]=w.z,x+=4}if(y){var b=y[P];s[x]=b.x,s[x+1]=b.y,s[x+2]=b.z,x+=4}}f.flag=!1}}o.setPixelBuffer(0,s)},a._updateLayoutChange=function(r){var e=this._blendShapeCount>1,n=1,o=r._useBlendShapeNormal,s=r._useBlendShapeTangent;e&&(o&&(o=this._useBlendNormal),s&&(s=this._useBlendTangent)),o&&n++,s&&n++,this._useBlendNormal=o,this._useBlendTangent=s,this._vertexElementCount=n},a._attributeModeUpdateVertexElement=function(r,e,n,o){var s=this._vertexElementOffset+this._vertexElementCount*o,l=e[n],u=l.x,c=l.y,f=r[s];if(f.bindingIndex=u,f.offset=c,this._useBlendNormal){var h=r[++s];c+=12,h.bindingIndex=u,h.offset=c}if(this._useBlendTangent){var d=r[++s];c+=12,d.bindingIndex=u,d.offset=c}},a._getVertexBufferModeSupportCount=function(){return this._useBlendNormal||this._useBlendTangent?4:8},a._filterCondensedBlendShapeWeights=function(r,e){for(var n=e.length,o=this._modelMesh._vertexElements,s=this._storeInVertexBufferInfo,l=Number.POSITIVE_INFINITY,u,c=0,f=Math.min(r.length,this._blendShapeCount);c<f;c++){var h=r[c];if(c<n)this._attributeModeUpdateVertexElement(o,s,c,c),e[c]=h,h<l&&(l=h,u=c);else if(h>l){this._attributeModeUpdateVertexElement(o,s,c,u),e[u]=h,l=Number.POSITIVE_INFINITY;for(var d=0;d<n;d++){var _=e[d];_<l&&(l=_,u=d)}}}},t}();Wn._blendShapeMacro=O.getMacroByName("OASIS_BLENDSHAPE");Wn._blendShapeTextureMacro=O.getMacroByName("OASIS_BLENDSHAPE_TEXTURE");Wn._blendShapeNormalMacro=O.getMacroByName("OASIS_BLENDSHAPE_NORMAL");Wn._blendShapeTangentMacro=O.getMacroByName("OASIS_BLENDSHAPE_TANGENT");Wn._blendShapeWeightsProperty=O.getPropertyByName("u_blendShapeWeights");Wn._blendShapeTextureProperty=O.getPropertyByName("u_blendShapeTexture");Wn._blendShapeTextureInfoProperty=O.getPropertyByName("u_blendShapeTextureInfo");var wr=function(t){q(a,t);function a(r,e){var n;return n=t.call(this,r)||this,n._blendShapeManager=void 0,n._vertexCount=0,n._accessible=!0,n._verticesFloat32=null,n._verticesUint8=null,n._indices=null,n._indicesFormat=null,n._vertexSlotChanged=!0,n._vertexChangeFlag=0,n._indicesChangeFlag=!1,n._vertexStrideFloat=0,n._lastUploadVertexCount=-1,n._positions=[],n._normals=null,n._colors=null,n._tangents=null,n._uv=null,n._uv1=null,n._uv2=null,n._uv3=null,n._uv4=null,n._uv5=null,n._uv6=null,n._uv7=null,n._boneWeights=null,n._boneIndices=null,n.name=e,n._blendShapeManager=new Wn(r,B(n)),n}var i=a.prototype;return i.setPositions=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._positions=e,this._vertexCount=e.length,this._vertexChangeFlag|=Ce.Position},i.getPositions=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._positions},i.setNormals=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._normals!=!!e,this._vertexChangeFlag|=Ce.Normal,this._normals=e},i.getNormals=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._normals},i.setColors=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._colors!=!!e,this._vertexChangeFlag|=Ce.Color,this._colors=e},i.getColors=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._colors},i.setBoneWeights=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=e!=null,this._vertexChangeFlag|=Ce.BoneWeight,this._boneWeights=e},i.getBoneWeights=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneWeights},i.setBoneIndices=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._boneIndices!=!!e,this._vertexChangeFlag|=Ce.BoneIndex,this._boneIndices=e},i.getBoneIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._boneIndices},i.setTangents=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";this._vertexSlotChanged=!!this._tangents!=!!e,this._vertexChangeFlag|=Ce.Tangent,this._tangents=e},i.getTangents=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._tangents},i.setUVs=function(e,n){var o;if(!this._accessible)throw"Not allowed to access data while accessible is false.";if(e.length!==this._vertexCount)throw"The array provided needs to be the same size as vertex count.";switch(n=(o=n)!=null?o:0,n){case 0:this._vertexSlotChanged=!!this._uv!=!!e,this._vertexChangeFlag|=Ce.UV,this._uv=e;break;case 1:this._vertexSlotChanged=!!this._uv1!=!!e,this._vertexChangeFlag|=Ce.UV1,this._uv1=e;break;case 2:this._vertexSlotChanged=!!this._uv2!=!!e,this._vertexChangeFlag|=Ce.UV2,this._uv2=e;break;case 3:this._vertexSlotChanged=!!this._uv3!=!!e,this._vertexChangeFlag|=Ce.UV3,this._uv3=e;break;case 4:this._vertexSlotChanged=!!this._uv4!=!!e,this._vertexChangeFlag|=Ce.UV4,this._uv4=e;break;case 5:this._vertexSlotChanged=!!this._uv5!=!!e,this._vertexChangeFlag|=Ce.UV5,this._uv5=e;break;case 6:this._vertexSlotChanged=!!this._uv6!=!!e,this._vertexChangeFlag|=Ce.UV6,this._uv6=e;break;case 7:this._vertexSlotChanged=!!this._uv7!=!!e,this._vertexChangeFlag|=Ce.UV7,this._uv7=e;break;default:throw"The index of channel needs to be in range [0 - 7]."}},i.getUVs=function(e){var n;if(!this._accessible)throw"Not allowed to access data while accessible is false.";switch(e=(n=e)!=null?n:0,e){case 0:return this._uv;case 1:return this._uv1;case 2:return this._uv2;case 3:return this._uv3;case 4:return this._uv4;case 5:return this._uv5;case 6:return this._uv6;case 7:return this._uv7}throw"The index of channel needs to be in range [0 - 7]."},i.setIndices=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._indices!==e&&(this._indices=e,e instanceof Uint8Array?this._indicesFormat=ct.UInt8:e instanceof Uint16Array?this._indicesFormat=ct.UInt16:e instanceof Uint32Array&&(this._indicesFormat=ct.UInt32)),this._indicesChangeFlag=!0},i.getIndices=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._indices},i.addBlendShape=function(e){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._blendShapeManager._addBlendShape(e)},i.clearBlendShapes=function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";this._blendShapeManager._clearBlendShapes()},i.getBlendShapeName=function(e){if(this._accessible){var n=this._blendShapeManager._blendShapes;return n[e].name}else return this._blendShapeManager._blendShapeNames[e]},i.uploadData=function(e){var n,o;if(!this._accessible)throw"Not allowed to access data while accessible is false.";var s=this._vertexCount,l=this._updateVertexElements(),u=this._lastUploadVertexCount!==s,c=(n=this._vertexBufferBindings[0])===null||n===void 0?void 0:n._buffer;if(u){c==null||c.destroy();var f=this._vertexStrideFloat,h=f*s,d=new Float32Array(h);this._verticesFloat32=d,this._verticesUint8=new Uint8Array(d.buffer),this._updateVertices(d,!0);var _=new nn(this._engine,br.VertexBuffer,d,e?Pt.Static:Pt.Dynamic);this._setVertexBufferBinding(0,new yl(_,f*4)),this._lastUploadVertexCount=s}else if(this._vertexChangeFlag&Ce.All){var m=this._verticesFloat32;this._updateVertices(m,l),c.setData(m)}var p=this._indices,v=(o=this._indexBufferBinding)===null||o===void 0?void 0:o._buffer;if(p)if(!v||p.byteLength!=v.byteLength){v==null||v.destroy();var g=new nn(this._engine,br.IndexBuffer,p);this._setIndexBufferBinding(new qs(g,this._indicesFormat)),this._indicesChangeFlag=!1}else this._indicesChangeFlag&&(v.setData(p),this._indexBufferBinding._format!==this._indicesFormat&&this._setIndexBufferBinding(new qs(v,this._indicesFormat)),this._indicesChangeFlag=!1);else v&&(v.destroy(),this._setIndexBufferBinding(null));var y=this._blendShapeManager;y._blendShapeCount>0&&y._update(u,e),e&&(this._accessible=!1,this._releaseCache())},i._onDestroy=function(){t.prototype._onDestroy.call(this),this._accessible&&this._releaseCache()},i._updateVertexElements=function(){var e=this._blendShapeManager,n=!e._useTextureMode();if(this._vertexSlotChanged||n&&e._vertexElementsNeedUpdate()){var o=12,s=3;return this._clearVertexElements(),this._addVertexElement(mw),this._normals&&(this._addVertexElement(new xe("NORMAL",o,K.Vector3,0)),o+=12,s+=3),this._colors&&(this._addVertexElement(new xe("COLOR_0",o,K.Vector4,0)),o+=16,s+=4),this._boneWeights&&(this._addVertexElement(new xe("WEIGHTS_0",o,K.Vector4,0)),o+=16,s+=4),this._boneIndices&&(this._addVertexElement(new xe("JOINTS_0",o,K.UByte4,0)),o+=4,s+=1),this._tangents&&(this._addVertexElement(new xe("TANGENT",o,K.Vector4,0)),o+=16,s+=4),this._uv&&(this._addVertexElement(new xe("TEXCOORD_0",o,K.Vector2,0)),o+=8,s+=2),this._uv1&&(this._addVertexElement(new xe("TEXCOORD_1",o,K.Vector2,0)),o+=8,s+=2),this._uv2&&(this._addVertexElement(new xe("TEXCOORD_2",o,K.Vector2,0)),o+=8,s+=2),this._uv3&&(this._addVertexElement(new xe("TEXCOORD_3",o,K.Vector2,0)),o+=8,s+=2),this._uv4&&(this._addVertexElement(new xe("TEXCOORD_4",o,K.Vector2,0)),o+=8,s+=2),this._uv5&&(this._addVertexElement(new xe("TEXCOORD_5",o,K.Vector2,0)),o+=8,s+=2),this._uv6&&(this._addVertexElement(new xe("TEXCOORD_6",o,K.Vector2,0)),o+=8,s+=2),this._uv7&&(this._addVertexElement(new xe("TEXCOORD_7",o,K.Vector2,0)),o+=8,s+=2),n&&e._blendShapeCount>0&&e._addVertexElements(this),this._vertexSlotChanged=!1,this._vertexStrideFloat=s,!0}return!1},i._updateVertices=function(e,n){var o=this._vertexStrideFloat,s=this._vertexCount,l=this._positions,u=this._normals,c=this._colors,f=this._vertexChangeFlag,h=this._boneWeights,d=this._boneIndices,_=this._tangents,m=this._uv,p=this._uv1,v=this._uv2,g=this._uv3,y=this._uv4,x=this._uv5,P=this._uv6,S=this._uv7;if(n&&(this._vertexChangeFlag=Ce.All),f&Ce.Position)for(var w=0;w<s;w++){var b=o*w,E=l[w];e[b]=E.x,e[b+1]=E.y,e[b+2]=E.z}var M=3;if(u){if(f&Ce.Normal)for(var F=0;F<s;F++){var A=o*F+M,T=u[F];T&&(e[A]=T.x,e[A+1]=T.y,e[A+2]=T.z)}M+=3}if(c){if(f&Ce.Color)for(var R=0;R<s;R++){var z=o*R+M,L=c[R];L&&(e[z]=L.r,e[z+1]=L.g,e[z+2]=L.b,e[z+3]=L.a)}M+=4}if(h){if(f&Ce.BoneWeight)for(var N=0;N<s;N++){var V=o*N+M,D=h[N];D&&(e[V]=D.x,e[V+1]=D.y,e[V+2]=D.z,e[V+3]=D.w)}M+=4}if(d){if(f&Ce.BoneIndex)for(var j=this._verticesUint8,I=0;I<s;I++){var H=o*I+M,G=d[I];if(G){var te=H*4;j[te]=G.x,j[te+1]=G.y,j[te+2]=G.z,j[te+3]=G.w}}M+=1}if(_){if(f&Ce.Tangent)for(var ie=0;ie<s;ie++){var fe=o*ie+M,ce=_[ie];ce&&(e[fe]=ce.x,e[fe+1]=ce.y,e[fe+2]=ce.z,e[fe+3]=ce.w)}M+=4}if(m){if(f&Ce.UV)for(var me=0;me<s;me++){var Me=o*me+M,Ae=m[me];Ae&&(e[Me]=Ae.x,e[Me+1]=Ae.y)}M+=2}if(p){if(f&Ce.UV1)for(var Oe=0;Oe<s;Oe++){var $e=o*Oe+M,Je=p[Oe];Je&&(e[$e]=Je.x,e[$e+1]=Je.y)}M+=2}if(v){if(f&Ce.UV2)for(var Te=0;Te<s;Te++){var Ze=o*Te+M,et=v[Te];et&&(e[Ze]=et.x,e[Ze+1]=et.y)}M+=2}if(g){if(f&Ce.UV3)for(var qe=0;qe<s;qe++){var tt=o*qe+M,bt=g[qe];bt&&(e[tt]=bt.x,e[tt+1]=bt.y)}M+=2}if(y){if(f&Ce.UV4)for(var Re=0;Re<s;Re++){var Ke=o*Re+M,bi=y[Re];bi&&(e[Ke]=bi.x,e[Ke+1]=bi.y)}M+=2}if(x){if(f&Ce.UV5)for(var Ei=0;Ei<s;Ei++){var Mi=o*Ei+M,Ri=x[Ei];Ri&&(e[Mi]=Ri.x,e[Mi+1]=Ri.y)}M+=2}if(P){if(f&Ce.UV6)for(var Wr=0;Wr<s;Wr++){var Fi=o*Wr+M,zi=P[Wr];zi&&(e[Fi]=zi.x,e[Fi+1]=zi.y)}M+=2}if(S){if(f&Ce.UV7)for(var jn=0;jn<s;jn++){var Xn=o*jn+M,Tl=S[jn];Tl&&(e[Xn]=Tl.x,e[Xn+1]=Tl.y)}M+=2}this._vertexChangeFlag=0},i._releaseCache=function(){this._verticesUint8=null,this._indices=null,this._verticesFloat32=null,this._positions.length=0,this._tangents=null,this._normals=null,this._colors=null,this._uv=null,this._uv1=null,this._uv2=null,this._uv3=null,this._uv4=null,this._uv5=null,this._uv6=null,this._uv7=null,this._blendShapeManager._releaseMemoryCache()},Y(a,[{key:"accessible",get:function(){return this._accessible}},{key:"vertexCount",get:function(){return this._vertexCount}},{key:"blendShapes",get:function(){if(!this._accessible)throw"Not allowed to access data while accessible is false.";return this._blendShapeManager._blendShapes}},{key:"blendShapeCount",get:function(){return this._blendShapeManager._blendShapeCount}}]),a}(lf),mw=new xe("POSITION",0,K.Vector3,0),Ce;(function(t){t[t.Position=1]="Position",t[t.Normal=2]="Normal",t[t.Color=4]="Color",t[t.Tangent=8]="Tangent",t[t.BoneWeight=16]="BoneWeight",t[t.BoneIndex=32]="BoneIndex",t[t.UV=64]="UV",t[t.UV1=128]="UV1",t[t.UV2=256]="UV2",t[t.UV3=512]="UV3",t[t.UV4=1024]="UV4",t[t.UV5=2048]="UV5",t[t.UV6=4096]="UV6",t[t.UV7=8192]="UV7",t[t.All=65535]="All"})(Ce||(Ce={}));var Q0=function(t){q(a,t);function a(i){var r;return r=t.call(this,null)||this,r.name=i,r.inverseBindMatrices=void 0,r.joints=void 0,r.skeleton=void 0,r.inverseBindMatrices=[],r.joints=[],r.skeleton="none",r}return a}(ln),os,Xd,$d,qn,Ho=(os=(qn=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,k(e,"_mesh",Xd,B(e)),k(e,"_meshUpdateFlag",$d,B(e)),e}var i=a.prototype;return i._render=function(e){var n=this._mesh;if(n){if(this._meshUpdateFlag.flag){var o=this.shaderData,s=n._vertexElements;o.disableMacro(a._uvMacro),o.disableMacro(a._uv1Macro),o.disableMacro(a._normalMacro),o.disableMacro(a._tangentMacro),o.disableMacro(a._vertexColorMacro);for(var l=0,u=s.length;l<u;l++){var c=s[l].semantic;switch(c){case"TEXCOORD_0":o.enableMacro(a._uvMacro);break;case"TEXCOORD_1":o.enableMacro(a._uv1Macro);break;case"NORMAL":o.enableMacro(a._normalMacro);break;case"TANGENT":o.enableMacro(a._tangentMacro);break;case"COLOR_0":o.enableMacro(a._vertexColorMacro);break}}this._meshUpdateFlag.flag=!1}for(var f=n.subMeshes,h=e._renderPipeline,d=this._engine._renderElementPool,_=0,m=f.length;_<m;_++){var p=this._materials[_];if(p){var v=d.getFromPool();v.setValue(this,n,f[_],p),h.pushPrimitive(v)}}}else de.error("mesh is null.")},i._onDestroy=function(){t.prototype._onDestroy.call(this);var e=this._mesh;e&&!e.destroyed&&(e._addRefCount(-1),this._mesh=null)},i._cloneTo=function(e){e.mesh=this._mesh},i._updateBounds=function(e){var n=this._mesh;if(n){var o=n.bounds,s=this._entity.transform.worldMatrix;Gr.transform(o,s,e)}else e.min.set(0,0,0),e.max.set(0,0,0)},i._setMesh=function(e){var n=this._mesh;n&&(n._addRefCount(-1),this._meshUpdateFlag.destroy()),e&&(e._addRefCount(1),this._meshUpdateFlag=e.registerUpdateFlag()),this._mesh=e},Y(a,[{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh!==e&&this._setMesh(e)}}]),a}(Go),qn._uvMacro=O.getMacroByName("O3_HAS_UV"),qn._uv1Macro=O.getMacroByName("O3_HAS_UV1"),qn._normalMacro=O.getMacroByName("O3_HAS_NORMAL"),qn._tangentMacro=O.getMacroByName("O3_HAS_TANGENT"),qn._vertexColorMacro=O.getMacroByName("O3_HAS_VERTEXCOLOR"),qn),Xd=U(os.prototype,"_mesh",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$d=U(os.prototype,"_meshUpdateFlag",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),os),Rr,qd,Yd,Qd,Jd,Kd,Zd,e_,t_,Di,_a=(Rr=(Di=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,k(e,"matrixPalette",qd,B(e)),k(e,"jointNodes",Yd,B(e)),k(e,"jointTexture",Qd,B(e)),k(e,"_hasInitJoints",Jd,B(e)),k(e,"_mat",Kd,B(e)),k(e,"_useJointTexture",Zd,B(e)),e._skin=void 0,k(e,"_blendShapeWeights",e_,B(e)),k(e,"_condensedBlendShapeWeights",t_,B(e)),e._mat=new re,e._skin=null,e}var i=a.prototype;return i._updateShaderData=function(e){t.prototype._updateShaderData.call(this,e);var n=this.shaderData;!this._useJointTexture&&this.matrixPalette&&n.setFloatArray(a._jointMatrixProperty,this.matrixPalette);var o=this.mesh;o._blendShapeManager._updateShaderData(n,this)},i._initJoints=function(){if(!!this._skin){for(var e=this._skin,n=e.joints,o=[],s=n.length-1;s>=0;s--)o[s]=this.findByNodeName(this.entity,n[s]);this.matrixPalette=new Float32Array(o.length*16),this.jointNodes=o;var l=this.entity.engine._hardwareRenderer;if(!!l){var u=l.renderStates.getParameter(l.gl.MAX_VERTEX_UNIFORM_VECTORS),c=Math.floor((u-30)/4),f=this.shaderData,h=o.length;if(h)if(f.enableMacro("O3_HAS_SKIN"),f.setInt(a._jointCountProperty,h),h>c)l.canIUseMoreJoints?this._useJointTexture=!0:de.error("component's joints count("+h+") greater than device's MAX_VERTEX_UNIFORM_VECTORS number "+u+", and don't support jointTexture in this device. suggest joint count less than "+c+".",this);else{var d=Math.max(a._maxJoints,h);a._maxJoints=d,f.disableMacro("O3_USE_JOINT_TEXTURE"),f.enableMacro("O3_JOINTS_NUM",d.toString())}else f.disableMacro("O3_HAS_SKIN")}}},i.findByNodeName=function(e,n){if(!e)return null;var o=e.findByName(n);return o||this.findByNodeName(e.parent,n)},i.update=function(){if(this._hasInitJoints||(this._initJoints(),this._hasInitJoints=!0),this._skin){for(var e=this.jointNodes,n=this._skin.inverseBindMatrices,o=this.matrixPalette,s=this.entity.getInvModelMatrix(),l=this._mat,u=e.length-1;u>=0;u--)l.identity(),e[u]?re.multiply(e[u].transform.worldMatrix,n[u],l):l.copyFrom(n[u]),re.multiply(s,l,l),o.set(l.elements,u*16);this._useJointTexture&&this.createJointTexture()}},i.createJointTexture=function(){if(!this.jointTexture){var e=this.engine,n=e._hardwareRenderer;if(!n)return;this.jointTexture=new cr(e,4,this.jointNodes.length,J.R32G32B32A32,!1),this.jointTexture.filterMode=or.Point,this.shaderData.enableMacro("O3_USE_JOINT_TEXTURE"),this.shaderData.setTexture(a._jointSamplerProperty,this.jointTexture)}this.jointTexture.setPixelBuffer(this.matrixPalette)},i._cloneTo=function(e){t.prototype._cloneTo.call(this,e),this._blendShapeWeights&&(e._blendShapeWeights=this._blendShapeWeights.slice())},i._checkBlendShapeWeightLength=function(){var e=this._mesh,n=e?e.blendShapeCount:0,o=this._blendShapeWeights;if(o){if(o.length!==n){var s=new Float32Array(n);if(n>o.length)s.set(o);else for(var l=0,u=o.length;l<u;l++)o[l]=s[l];this._blendShapeWeights=s}}else this._blendShapeWeights=new Float32Array(n)},Y(a,[{key:"blendShapeWeights",get:function(){return this._checkBlendShapeWeightLength(),this._blendShapeWeights},set:function(e){this._checkBlendShapeWeightLength();var n=this._blendShapeWeights;if(e.length<=n.length)n.set(e);else for(var o=0,s=n.length;o<s;o++)n[o]=e[o]}},{key:"skin",get:function(){return this._skin},set:function(e){this._skin=e}}]),a}(Ho),Di._jointCountProperty=O.getPropertyByName("u_jointCount"),Di._jointSamplerProperty=O.getPropertyByName("u_jointSampler"),Di._jointMatrixProperty=O.getPropertyByName("u_jointMatrix"),Di._maxJoints=0,Di),qd=U(Rr.prototype,"matrixPalette",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yd=U(Rr.prototype,"jointNodes",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qd=U(Rr.prototype,"jointTexture",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd=U(Rr.prototype,"_hasInitJoints",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Kd=U(Rr.prototype,"_mat",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd=U(Rr.prototype,"_useJointTexture",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),e_=U(Rr.prototype,"_blendShapeWeights",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t_=U(Rr.prototype,"_condensedBlendShapeWeights",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rr),J0=function(){function t(){}return t.createSphere=function(i,r,e,n){r===void 0&&(r=.5),e===void 0&&(e=18),n===void 0&&(n=!0);var o=new wr(i);e=Math.max(2,Math.floor(e));for(var s=e+1,l=s*s,u=e*e,c=t._generateIndices(i,l,u*6),f=Math.PI,h=f*2,d=1/s,_=1/e,m=new Array(l),p=new Array(l),v=new Array(l),g=0;g<l;++g){var y=g%s,x=g*d|0,P=y*_,S=x*_,w=P*h,b=S*f,E=Math.sin(b),M=-r*Math.cos(w)*E,F=r*Math.cos(b),A=r*Math.sin(w)*E;m[g]=new C(M,F,A),p[g]=new C(M,F,A),v[g]=new $(P,S)}for(var T=0,R=0;R<u;++R){var z=R%e,L=R*_|0,N=L*s+z,V=N+1,D=N+s,j=D+1;c[T++]=V,c[T++]=N,c[T++]=j,c[T++]=N,c[T++]=D,c[T++]=j}var I=o.bounds;return I.min.set(-r,-r,-r),I.max.set(r,r,r),t._initialize(o,m,p,v,c,n),o},t.createCuboid=function(i,r,e,n,o){r===void 0&&(r=1),e===void 0&&(e=1),n===void 0&&(n=1),o===void 0&&(o=!0);var s=new wr(i),l=r/2,u=e/2,c=n/2,f=new Array(24),h=new Array(24),d=new Array(24);f[0]=new C(-l,u,-c),f[1]=new C(l,u,-c),f[2]=new C(l,u,c),f[3]=new C(-l,u,c),h[0]=new C(0,1,0),h[1]=new C(0,1,0),h[2]=new C(0,1,0),h[3]=new C(0,1,0),d[0]=new $(0,0),d[1]=new $(1,0),d[2]=new $(1,1),d[3]=new $(0,1),f[4]=new C(-l,-u,-c),f[5]=new C(l,-u,-c),f[6]=new C(l,-u,c),f[7]=new C(-l,-u,c),h[4]=new C(0,-1,0),h[5]=new C(0,-1,0),h[6]=new C(0,-1,0),h[7]=new C(0,-1,0),d[4]=new $(0,1),d[5]=new $(1,1),d[6]=new $(1,0),d[7]=new $(0,0),f[8]=new C(-l,u,-c),f[9]=new C(-l,u,c),f[10]=new C(-l,-u,c),f[11]=new C(-l,-u,-c),h[8]=new C(-1,0,0),h[9]=new C(-1,0,0),h[10]=new C(-1,0,0),h[11]=new C(-1,0,0),d[8]=new $(0,0),d[9]=new $(1,0),d[10]=new $(1,1),d[11]=new $(0,1),f[12]=new C(l,u,-c),f[13]=new C(l,u,c),f[14]=new C(l,-u,c),f[15]=new C(l,-u,-c),h[12]=new C(1,0,0),h[13]=new C(1,0,0),h[14]=new C(1,0,0),h[15]=new C(1,0,0),d[12]=new $(1,0),d[13]=new $(0,0),d[14]=new $(0,1),d[15]=new $(1,1),f[16]=new C(-l,u,c),f[17]=new C(l,u,c),f[18]=new C(l,-u,c),f[19]=new C(-l,-u,c),h[16]=new C(0,0,1),h[17]=new C(0,0,1),h[18]=new C(0,0,1),h[19]=new C(0,0,1),d[16]=new $(0,0),d[17]=new $(1,0),d[18]=new $(1,1),d[19]=new $(0,1),f[20]=new C(-l,u,-c),f[21]=new C(l,u,-c),f[22]=new C(l,-u,-c),f[23]=new C(-l,-u,-c),h[20]=new C(0,0,-1),h[21]=new C(0,0,-1),h[22]=new C(0,0,-1),h[23]=new C(0,0,-1),d[20]=new $(1,0),d[21]=new $(0,0),d[22]=new $(0,1),d[23]=new $(1,1);var _=new Uint16Array(36);_[0]=0,_[1]=2,_[2]=1,_[3]=2,_[4]=0,_[5]=3,_[6]=4,_[7]=6,_[8]=7,_[9]=6,_[10]=4,_[11]=5,_[12]=8,_[13]=10,_[14]=9,_[15]=10,_[16]=8,_[17]=11,_[18]=12,_[19]=14,_[20]=15,_[21]=14,_[22]=12,_[23]=13,_[24]=16,_[25]=18,_[26]=17,_[27]=18,_[28]=16,_[29]=19,_[30]=20,_[31]=22,_[32]=23,_[33]=22,_[34]=20,_[35]=21;var m=s.bounds;return m.min.set(-l,-u,-c),m.max.set(l,u,c),t._initialize(s,f,h,d,_,o),s},t.createPlane=function(i,r,e,n,o,s){r===void 0&&(r=1),e===void 0&&(e=1),n===void 0&&(n=1),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new wr(i);n=Math.max(1,Math.floor(n)),o=Math.max(1,Math.floor(o));for(var u=n+1,c=o+1,f=r/2,h=e/2,d=r/n,_=e/o,m=u*c,p=o*n,v=t._generateIndices(i,m,p*6),g=1/u,y=1/n,x=1/o,P=new Array(m),S=new Array(m),w=new Array(m),b=0;b<m;++b){var E=b%u,M=b*g|0;P[b]=new C(E*d-f,0,M*_-h),S[b]=new C(0,1,0),w[b]=new $(E*y,M*x)}for(var F=0,A=0;A<p;++A){var T=A%n,R=A*y|0,z=R*u+T,L=z+1,N=z+u,V=N+1;v[F++]=z,v[F++]=N,v[F++]=L,v[F++]=N,v[F++]=V,v[F++]=L}var D=l.bounds;return D.min.set(-f,0,-h),D.max.set(f,0,h),t._initialize(l,P,S,w,v,s),l},t.createCylinder=function(i,r,e,n,o,s,l){r===void 0&&(r=.5),e===void 0&&(e=.5),n===void 0&&(n=2),o===void 0&&(o=20),s===void 0&&(s=1),l===void 0&&(l=!0);var u=new wr(i);o=Math.floor(o),s=Math.floor(s);for(var c=o+1,f=s+1,h=n*.5,d=n/s,_=c*f,m=o*s,p=o*2,v=_+2+p,g=t._generateIndices(i,v,m*6+p*3),y=1/c,x=1/o,P=1/s,S=new Array(v),w=new Array(v),b=new Array(v),E=0,M=Math.PI,F=Math.PI*2,A=e-r,T=A/n,R=A/s,z=0;z<_;++z){var L=z%c,N=z*y|0,V=L*x,D=N*P,j=M+V*F,I=Math.sin(j),H=Math.cos(j),G=e-N*R,te=G*I,ie=N*d-h,fe=G*H;S[z]=new C(te,ie,fe),w[z]=new C(I,T,H),b[z]=new $(V,1-D)}for(var ce=0;ce<m;++ce){var me=ce%o,Me=ce*x|0,Ae=Me*c+me,Oe=Ae+1,$e=Ae+c,Je=$e+1;g[E++]=Oe,g[E++]=$e,g[E++]=Ae,g[E++]=Oe,g[E++]=Je,g[E++]=$e}S[_]=new C(0,-h,0),w[_]=new C(0,-1,0),b[_]=new $(.5,.5),S[_+1]=new C(0,h,0),w[_+1]=new C(0,1,0),b[_+1]=new $(.5,.5);for(var Te=_+2,Ze=1/(r*2),et=1/(e*2),qe=c*s,tt=0;tt<o;++tt){var bt=S[tt],Re=bt.x,Ke=bt.z;S[Te]=new C(Re,-h,Ke),w[Te]=new C(0,-1,0),b[Te++]=new $(Re*et+.5,.5-Ke*et);var bi=S[tt+qe];Re=bi.x,Ke=bi.z,S[Te]=new C(Re,h,Ke),w[Te]=new C(0,1,0),b[Te++]=new $(Re*Ze+.5,Ke*Ze+.5)}for(var Ei=_+1,Mi=_+2,Ri=Mi+1,Wr=0;Wr<o;++Wr){var Fi=Wr*2,zi=Wr===o-1?0:Fi+2;g[E++]=_,g[E++]=Mi+zi,g[E++]=Mi+Fi,g[E++]=Ei,g[E++]=Ri+Fi,g[E++]=Ri+zi}var jn=u.bounds,Xn=Math.max(r,e);return jn.min.set(-Xn,-h,-Xn),jn.max.set(Xn,h,Xn),t._initialize(u,S,w,b,g,l),u},t.createTorus=function(i,r,e,n,o,s,l){r===void 0&&(r=.5),e===void 0&&(e=.1),n===void 0&&(n=30),o===void 0&&(o=30),s===void 0&&(s=360),l===void 0&&(l=!0);var u=new wr(i);n=Math.floor(n),o=Math.floor(o);var c=(n+1)*(o+1),f=n*o,h=t._generateIndices(i,c,f*6),d=new Array(c),_=new Array(c),m=new Array(c);s=s/180*Math.PI;for(var p=0,v=0;v<=n;v++)for(var g=0;g<=o;g++){var y=g/o*s,x=v/n*Math.PI*2,P=Math.cos(x),S=Math.sin(x),w=Math.cos(y),b=Math.sin(y),E=new C((r+e*P)*w,(r+e*P)*b,e*S);d[p]=E;var M=r*w,F=r*b;_[p]=new C(E.x-M,E.y-F,E.z).normalize(),m[p++]=new $(g/o,v/n)}p=0;for(var A=1;A<=n;A++)for(var T=1;T<=o;T++){var R=(o+1)*A+T-1,z=(o+1)*(A-1)+T-1,L=(o+1)*(A-1)+T,N=(o+1)*A+T;h[p++]=R,h[p++]=z,h[p++]=N,h[p++]=z,h[p++]=L,h[p++]=N}var V=u.bounds,D=r+e;return V.min.set(-D,-D,-e),V.max.set(D,D,e),t._initialize(u,d,_,m,h,l),u},t.createCone=function(i,r,e,n,o,s){r===void 0&&(r=.5),e===void 0&&(e=2),n===void 0&&(n=20),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new wr(i);n=Math.floor(n),o=Math.floor(o);for(var u=n+1,c=o+1,f=e*.5,h=e/o,d=u*c,_=n*o,m=d+1+n,p=t._generateIndices(i,m,_*6+n*3),v=1/u,g=1/n,y=1/o,x=new Array(m),P=new Array(m),S=new Array(m),w=0,b=Math.PI,E=Math.PI*2,M=r/e,F=0;F<d;++F){var A=F%u,T=F*v|0,R=A*g,z=T*y,L=b+R*E,N=Math.sin(L),V=Math.cos(L),D=r-T*r,j=D*N,I=T*h-f,H=D*V;x[F]=new C(j,I,H),P[F]=new C(N,M,V),S[F]=new $(R,1-z)}for(var G=0;G<_;++G){var te=G%n,ie=G*g|0,fe=ie*u+te,ce=fe+1,me=fe+u,Me=me+1;p[w++]=ce,p[w++]=me,p[w++]=fe,p[w++]=ce,p[w++]=Me,p[w++]=me}x[d]=new C(0,-f,0),P[d]=new C(0,-1,0),S[d]=new $(.5,.5);for(var Ae=d+1,Oe=1/(r*2),$e=0;$e<n;++$e){var Je=x[$e],Te=Je.x,Ze=Je.z;x[Ae]=new C(Te,-f,Ze),P[Ae]=new C(0,-1,0),S[Ae++]=new $(Te*Oe+.5,.5-Ze*Oe)}for(var et=d+1,qe=0;qe<n;++qe){var tt=qe,bt=qe===n-1?0:tt+1;p[w++]=d,p[w++]=et+bt,p[w++]=et+tt}var Re=l.bounds;return Re.min.set(-r,-f,-r),Re.max.set(r,f,r),t._initialize(l,x,P,S,p,s),l},t.createCapsule=function(i,r,e,n,o,s){r===void 0&&(r=.5),e===void 0&&(e=2),n===void 0&&(n=6),o===void 0&&(o=1),s===void 0&&(s=!0);var l=new wr(i);n=Math.max(2,Math.floor(n)),o=Math.floor(o);for(var u=n+1,c=o+1,f=e*.5,h=e/o,d=u*c,_=n*o,m=u*u,p=n*n,v=d+2*m,g=t._generateIndices(i,v,(_+2*p)*6),y=1/u,x=1/n,P=1/o,S=Math.PI,w=Math.PI*2,b=new Array(v),E=new Array(v),M=new Array(v),F=0,A=0;A<d;++A){var T=A%u,R=A*y|0,z=T*x,L=R*P,N=S+z*w,V=Math.sin(N),D=Math.cos(N);b[A]=new C(r*V,R*h-f,r*D),E[A]=new C(V,0,D),M[A]=new $(z,1-L)}for(var j=0;j<_;++j){var I=j%n,H=j*x|0,G=H*u+I,te=G+1,ie=G+u,fe=ie+1;g[F++]=te,g[F++]=ie,g[F++]=G,g[F++]=te,g[F++]=fe,g[F++]=ie}t._createCapsuleCap(r,e,n,w,d,1,b,E,M,g,F),t._createCapsuleCap(r,e,n,-w,d+m,-1,b,E,M,g,F+6*p);var ce=l.bounds;return ce.min.set(-r,-r-f,-r),ce.max.set(r,r+f,r),t._initialize(l,b,E,M,g,s),l},t._initialize=function(i,r,e,n,o,s){i.setPositions(r),i.setNormals(e),i.setUVs(n),i.setIndices(o),i.uploadData(s),i.addSubMesh(0,o.length)},t._generateIndices=function(i,r,e){var n=null;if(r>65535)if(i._hardwareRenderer.canIUse(Z.elementIndexUint))n=new Uint32Array(e);else throw Error("The vertex count is over limit.");else n=new Uint16Array(e);return n},t._createCapsuleCap=function(i,r,e,n,o,s,l,u,c,f,h){for(var d=e+1,_=r*.5*s,m=d*d,p=e*e,v=1/d,g=1/e,y=0;y<m;++y){var x=y%d,P=y*v|0,S=x*g,w=P*g,b=S*n,E=w*Math.PI/2,M=Math.sin(E),F=-i*Math.cos(b)*M,A=i*Math.cos(E)*s+_,T=i*Math.sin(b)*M,R=y+o;l[R]=new C(F,A,T),u[R]=new C(F,A-_,T),c[R]=new $(S,w)}for(var z=0;z<p;++z){var L=z%e,N=z*g|0,V=N*d+L+o,D=V+1,j=V+d,I=j+1;f[h++]=D,f[h++]=V,f[h++]=I,f[h++]=V,f[h++]=j,f[h++]=I}},t}(),xl=function(t){q(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.setVertexElements=function(e){this._setVertexElements(e)},i.setVertexBufferBinding=function(e,n,o){n===void 0&&(n=0),o===void 0&&(o=0);var s=e,l=s.buffer!==void 0;l||(s=new yl(e,n));var u=this._vertexBufferBindings;u.length<=o&&(u.length=o+1),this._setVertexBufferBinding(l?n:o,s)},i.setVertexBufferBindings=function(e,n){n===void 0&&(n=0);var o=this._vertexBufferBindings,s=e.length,l=n+s;o.length<l&&(o.length=l);for(var u=0;u<s;u++)this._setVertexBufferBinding(n+u,e[u])},i.setIndexBufferBinding=function(e,n){var o=e;if(o){var s=o.buffer!==void 0;s||(o=new qs(e,n))}this._setIndexBufferBinding(o)},Y(a,[{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"vertexBufferBindings",get:function(){return this._vertexBufferBindings}},{key:"indexBufferBinding",get:function(){return this._indexBufferBinding}},{key:"vertexElements",get:function(){return this._vertexElements}}]),a}(lf),K0=function(a,i,r,e){if(r===void 0&&(r=null),e===void 0&&(e=null),this.weight=void 0,this.deltaPositions=void 0,this.deltaNormals=void 0,this.deltaTangents=void 0,r&&r.length!==i.length)throw"deltaNormals length must same with deltaPositions length.";if(e&&e.length!==i.length)throw"deltaTangents length must same with deltaPositions length.";this.weight=a,this.deltaPositions=i,this.deltaNormals=r,this.deltaTangents=e},cf=function(){function t(i){this.name=void 0,this._useBlendShapeNormal=!0,this._useBlendShapeTangent=!0,this._layoutChangeManager=new fa,this._dataChangeManager=new fa,this._frames=[],this.name=i}var a=t.prototype;return a.addFrame=function(r,e,n,o){if(typeof r=="number"){var s=new K0(r,e,n,o);return this._addFrame(s),s}else this._addFrame(r)},a.clearFrames=function(){this._frames.length=0,this._updateUseNormalAndTangent(!0,!0),this._dataChangeManager.dispatch()},a._addLayoutChangeFlag=function(r){this._layoutChangeManager.addFlag(r)},a._addDataDirtyFlag=function(r){this._dataChangeManager.addFlag(r)},a._createSubDataDirtyFlag=function(){return this._dataChangeManager.createFlag(Uo)},a._addFrame=function(r){var e=this._frames,n=e.length;if(n>0&&r.deltaPositions.length!==e[n-1].deltaPositions.length)throw"Frame's deltaPositions length must same with before frame deltaPositions length.";this._frames.push(r),this._updateUseNormalAndTangent(!!r.deltaNormals,!!r.deltaTangents),this._dataChangeManager.dispatch()},a._updateUseNormalAndTangent=function(r,e){var n=this._useBlendShapeNormal&&r,o=this._useBlendShapeTangent&&e;(this._useBlendShapeNormal!==n||this._useBlendShapeTangent!==o)&&(this._useBlendShapeNormal=n,this._useBlendShapeTangent=o,this._layoutChangeManager.dispatch(this))},Y(t,[{key:"frames",get:function(){return this._frames}}]),t}(),wl=function(){function t(i){this._engine=void 0,this._subMeshPool=new ui(sf),this._batchedQueue=[],this._meshes=[],this._meshCount=1,this._vertexBuffers=[],this._indiceBuffers=[],this._vertices=void 0,this._indices=void 0,this._flushId=0,this._vertexCount=0,this._elementCount=0,this._engine=i;var r=t.MAX_VERTEX_COUNT;this._vertices=new Float32Array(r*9),this._indices=new Uint16Array(r*3);for(var e=this._meshes,n=this._meshCount,o=0;o<n;o++)e[o]=this._createMesh(i,o)}var a=t.prototype;return a.drawElement=function(r,e,n){if(r.multiRenderData)for(var o=r.charElements,s=0,l=o.length;s<l;++s)this._drawSubElement(o[s],e,n);else this._drawSubElement(r,e,n)},a._drawSubElement=function(r,e,n){var o=r.renderData.vertexCount;this._vertexCount+o>t.MAX_VERTEX_COUNT&&this.flush(e,n),this._vertexCount+=o,this._batchedQueue[this._elementCount++]=r},a.flush=function(r,e){var n=this._batchedQueue;n.length!==0&&(this._updateData(this._engine),this.drawBatches(r,e),t._canUploadSameBuffer||this._flushId++,n.length=0,this._subMeshPool.resetPool(),this._vertexCount=0,this._elementCount=0)},a.clear=function(){this._flushId=0,this._vertexCount=0,this._elementCount=0,this._batchedQueue.length=0},a.destroy=function(){this._batchedQueue=null;for(var r=this._meshes,e=this._vertexBuffers,n=this._indiceBuffers,o=0,s=r.length;o<s;++o)r[o].destroy();this._meshes=null;for(var l=0,u=e.length;l<u;++l)e[l].destroy();this._vertexBuffers=null;for(var c=0,f=n.length;c<f;++c)n[c].destroy();this._indiceBuffers=null},a._createMesh=function(r,e){var n=t.MAX_VERTEX_COUNT,o=new xl(r,"BufferMesh"+e),s=[],l=this.createVertexElements(s);return this._vertexBuffers[e]=new nn(r,br.VertexBuffer,n*4*l,Pt.Dynamic),this._indiceBuffers[e]=new nn(r,br.IndexBuffer,n*3,Pt.Dynamic),o.setVertexBufferBinding(this._vertexBuffers[e],l),o.setIndexBufferBinding(this._indiceBuffers[e],ct.UInt16),o.setVertexElements(s),o},a._updateData=function(r){var e=this._meshes,n=this._flushId;!t._canUploadSameBuffer&&this._meshCount<=n&&(this._meshCount++,e[n]=this._createMesh(r,n));var o=this._batchedQueue,s=this._vertices,l=this._indices,u=e[n];u.clearSubMesh();for(var c=0,f=0,h=0,d=0,_=0,m=0,p=null,v=0,g=o.length;v<g;v++){var y=o[v];c=this.updateVertices(y,s,c);for(var x=y.renderData.triangles,P=x.length,S=0;S<P;S++)l[f++]=x[S]+_;_+=y.renderData.vertexCount,p===null||this.canBatch(p,y)?d+=P:(u.addSubMesh(this._getSubMeshFromPool(h,d)),h+=d,d=P,o[m++]=p),p=y}u.addSubMesh(this._getSubMeshFromPool(h,d)),o[m]=p,this._vertexBuffers[n].setData(s,0,0,c),this._indiceBuffers[n].setData(l,0,0,f)},a._getSubMeshFromPool=function(r,e){var n=this._subMeshPool.getFromPool();return n.start=r,n.count=e,n.topology=yi.Triangles,n},t}();wl.MAX_VERTEX_COUNT=4096;wl._canUploadSameBuffer=!0;var yw=function(t){q(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.createVertexElements=function(e){return e[0]=new xe("POSITION",0,K.Vector3,0),e[1]=new xe("TEXCOORD_0",12,K.Vector2,0),20},i.canBatch=function(e,n){if(e.isAdd!==n.isAdd)return!1;var o=e.component.shaderData,s=n.component.shaderData,l=ec._textureProperty,u=ec._alphaCutoffProperty;return o.getTexture(l)===s.getTexture(l)&&o.getTexture(u)===s.getTexture(u)},i.updateVertices=function(e,n,o){for(var s=e.renderData,l=s.positions,u=s.uvs,c=s.vertexCount,f=0;f<c;f++){var h=l[f],d=u[f];n[o++]=h.x,n[o++]=h.y,n[o++]=h.z,n[o++]=d.x,n[o++]=d.y}return o},i.drawBatches=function(e){for(var n=this._engine,o=this._batchedQueue,s=this._meshes[this._flushId],l=s.subMeshes,u=e.scene.shaderData,c=e.shaderData,f=0,h=l.length;f<h;f++){var d=l[f],_=o[f];if(!d||!_)return;var m=_.component,p=_.material,v=O._compileMacros;Jt.unionCollection(m._globalShaderMacro,p.shaderData._macroCollection,v);var g=p.renderState.stencilState,y=_.isAdd?it.IncrementSaturate:it.DecrementSaturate;g.passOperationFront=y,g.passOperationBack=y;var x=p.shader._getShaderProgram(n,v);if(!x.isValid)return;x.bind(),x.groupingOtherUniformBlock(),x.uploadAll(x.sceneUniformBlock,u),x.uploadAll(x.cameraUniformBlock,c),x.uploadAll(x.rendererUniformBlock,m.shaderData),x.uploadAll(x.materialUniformBlock,p.shaderData),p.renderState._apply(n,!1),n._hardwareRenderer.drawPrimitive(s,d,x)}},a}(wl),xw=function(){function t(i){this._batcher=void 0,this._preMaskLayer=0,this._batcher=new yw(i)}var a=t.prototype;return a.clear=function(){this._preMaskLayer=0,this._batcher.clear()},a.preRender=function(r,e){e.maskInteraction!==ar.None&&(this._batcher.clear(),this._processMasksDiff(r,e),this._batcher.flush(r,null))},a.postRender=function(r){r.maskInteraction!==ar.None&&(this._preMaskLayer=r.maskLayer)},a.destroy=function(){this._batcher.destroy(),this._batcher=null},a._processMasksDiff=function(r,e){var n=this._preMaskLayer,o=e.maskLayer;if(n!==o)for(var s=r._renderPipeline._allSpriteMasks,l=n&o,u=o&~n,c=n&~o,f=s._elements,h=0,d=s.length;h<d;h++){var _=f[h],m=_.influenceLayers;if(!(m&l)){if(m&u){var p=_._maskElement;p.isAdd=!0,this._batcher.drawElement(p,r,null);continue}if(m&c){var v=_._maskElement;v.isAdd=!1,this._batcher.drawElement(v,r,null)}}}},t}(),ww=function(t){q(a,t);function a(){var i;return i=t.call(this)||this,i.charElements=[],i.multiRenderData=!0,i}return a}(ml),en;(function(t){t[t.SolidColor=0]="SolidColor",t[t.Sky=1]="Sky",t[t.Texture=2]="Texture"})(en||(en={}));var Pn;(function(t){t[t.AspectFitWidth=0]="AspectFitWidth",t[t.AspectFitHeight=1]="AspectFitHeight",t[t.Fill=2]="Fill"})(Pn||(Pn={}));var Z0=function(){this.material=void 0,this.mesh=void 0,this._matrix=new re},em=function(){function t(i){this._engine=i,this.mode=en.SolidColor,this.solidColor=new ne(.25,.25,.25,1),this.sky=new Z0,this._textureFillMode=Pn.AspectFitHeight,this._mesh=void 0,this._texture=null,this._mesh=this._createPlane(i)}var a=t.prototype;return a._resizeBackgroundTexture=function(){if(!!this._texture){var r=this._engine.canvas,e=r.width,n=r.height,o=this._mesh,s=o.getPositions();switch(this._textureFillMode){case Pn.Fill:s[0].set(-1,-1,1),s[1].set(1,-1,1),s[2].set(-1,1,1),s[3].set(1,1,1);break;case Pn.AspectFitWidth:var l=this._texture.height*e/this.texture.width/n;s[0].set(-1,-l,1),s[1].set(1,-l,1),s[2].set(-1,l,1),s[3].set(1,l,1);break;case Pn.AspectFitHeight:var u=this._texture.width*n/this.texture.height/e;s[0].set(-u,-1,1),s[1].set(u,-1,1),s[2].set(-u,1,1),s[3].set(u,1,1);break}o.setPositions(s),o.uploadData(!1)}},a._createPlane=function(r){var e=new wr(r);e.isGCIgnored=!0;for(var n=new Uint8Array([1,2,0,1,3,2]),o=new Array(4),s=new Array(4),l=0;l<4;++l)o[l]=new C,s[l]=new $(l%2,1-(l*.5|0));return e.setPositions(o),e.setUVs(s),e.setIndices(n),e.uploadData(!1),e.addSubMesh(0,n.length),e},Y(t,[{key:"texture",get:function(){return this._texture},set:function(r){this._texture!==r&&(this._texture=r,this._engine._backgroundTextureMaterial.shaderData.setTexture("u_baseTexture",r))}},{key:"textureFillMode",get:function(){return this._textureFillMode},set:function(r){r!==this._textureFillMode&&(this._textureFillMode=r,this._resizeBackgroundTexture())}}]),t}(),va;(function(t){t[t.SolidColor=0]="SolidColor",t[t.SphericalHarmonics=1]="SphericalHarmonics"})(va||(va={}));var er=function(){function t(){this._diffuseSphericalHarmonics=void 0,this._diffuseSolidColor=new ne(.212,.227,.259),this._diffuseIntensity=1,this._specularTexture=void 0,this._specularIntensity=1,this._diffuseMode=va.SolidColor,this._shArray=new Float32Array(27),this._scenes=[],this._specularTextureDecodeRGBM=!1}var a=t.prototype;return a._addToScene=function(r){this._scenes.push(r);var e=r.shaderData;e.setColor(t._diffuseColorProperty,this._diffuseSolidColor),e.setFloat(t._diffuseIntensityProperty,this._diffuseIntensity),e.setFloat(t._specularIntensityProperty,this._specularIntensity),e.setFloatArray(t._diffuseSHProperty,this._shArray),this._setDiffuseMode(e),this._setSpecularTextureDecodeRGBM(e),this._setSpecularTexture(e)},a._removeFromScene=function(r){var e=this._scenes,n=e.indexOf(r);e.splice(n,1)},a._setDiffuseMode=function(r){this._diffuseMode===va.SphericalHarmonics?r.enableMacro(t._shMacro):r.disableMacro(t._shMacro)},a._setSpecularTexture=function(r){this._specularTexture?(r.setTexture(t._specularTextureProperty,this._specularTexture),r.setFloat(t._mipLevelProperty,this._specularTexture.mipmapCount-1),r.enableMacro(t._specularMacro)):r.disableMacro(t._specularMacro)},a._setSpecularTextureDecodeRGBM=function(r){this._specularTextureDecodeRGBM?r.enableMacro(t._decodeRGBMMacro):r.disableMacro(t._decodeRGBMMacro)},a._preComputeSH=function(r,e){var n=r.coefficients;e[0]=n[0]*.886227,e[1]=n[1]*.886227,e[2]=n[2]*.886227,e[3]=n[3]*-1.023327,e[4]=n[4]*-1.023327,e[5]=n[5]*-1.023327,e[6]=n[6]*1.023327,e[7]=n[7]*1.023327,e[8]=n[8]*1.023327,e[9]=n[9]*-1.023327,e[10]=n[10]*-1.023327,e[11]=n[11]*-1.023327,e[12]=n[12]*.858086,e[13]=n[13]*.858086,e[14]=n[14]*.858086,e[15]=n[15]*-.858086,e[16]=n[16]*-.858086,e[17]=n[17]*-.858086,e[18]=n[18]*.247708,e[19]=n[19]*.247708,e[20]=n[20]*.247708,e[21]=n[21]*-.858086,e[22]=n[22]*-.858086,e[23]=n[23]*-.858086,e[24]=n[24]*.429042,e[25]=n[25]*.429042,e[26]=n[26]*.429042},Y(t,[{key:"specularTextureDecodeRGBM",get:function(){return this._specularTextureDecodeRGBM},set:function(r){this._specularTextureDecodeRGBM=r;for(var e=this._scenes,n=0,o=e.length;n<o;n++)this._setSpecularTextureDecodeRGBM(e[n].shaderData)}},{key:"diffuseMode",get:function(){return this._diffuseMode},set:function(r){this._diffuseMode=r;for(var e=this._scenes,n=0,o=e.length;n<o;n++)this._setDiffuseMode(e[n].shaderData)}},{key:"diffuseSolidColor",get:function(){return this._diffuseSolidColor},set:function(r){r!==this._diffuseSolidColor&&this._diffuseSolidColor.copyFrom(r)}},{key:"diffuseSphericalHarmonics",get:function(){return this._diffuseSphericalHarmonics},set:function(r){if(this._diffuseSphericalHarmonics=r,r){this._preComputeSH(r,this._shArray);for(var e=this._scenes,n=0,o=e.length;n<o;n++)e[n].shaderData.setFloatArray(t._diffuseSHProperty,this._shArray)}}},{key:"diffuseIntensity",get:function(){return this._diffuseIntensity},set:function(r){this._diffuseIntensity=r;for(var e=this._scenes,n=0,o=e.length;n<o;n++)e[n].shaderData.setFloat(t._diffuseIntensityProperty,r)}},{key:"specularTexture",get:function(){return this._specularTexture},set:function(r){this._specularTexture=r;for(var e=this._scenes,n=0,o=e.length;n<o;n++)this._setSpecularTexture(e[n].shaderData)}},{key:"specularIntensity",get:function(){return this._specularIntensity},set:function(r){this._specularIntensity=r;for(var e=0,n=this._scenes.length;e<n;e++)this._scenes[e].shaderData.setFloat(t._specularIntensityProperty,r)}}]),t}();er._shMacro=O.getMacroByName("O3_USE_SH");er._specularMacro=O.getMacroByName("O3_USE_SPECULAR_ENV");er._decodeRGBMMacro=O.getMacroByName("O3_DECODE_ENV_RGBM");er._diffuseColorProperty=O.getPropertyByName("u_envMapLight.diffuse");er._diffuseSHProperty=O.getPropertyByName("u_env_sh");er._diffuseIntensityProperty=O.getPropertyByName("u_envMapLight.diffuseIntensity");er._specularTextureProperty=O.getPropertyByName("u_env_specularSampler");er._specularIntensityProperty=O.getPropertyByName("u_envMapLight.specularIntensity");er._mipLevelProperty=O.getPropertyByName("u_envMapLight.mipMapLevel");var ff=function(){function t(){}var a=t.prototype;return a.preUpdate=function(r){},a.postUpdate=function(r){},a.preRender=function(r,e){},a.postRender=function(r,e){},a.destroy=function(r){},t}(),pt=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r._viewMat=void 0,r._inverseViewMat=void 0,r}var i=a.prototype;return i._onEnable=function(){this.scene.findFeature(xi).attachRenderLight(this)},i._onDisable=function(){this.scene.findFeature(xi).detachRenderLight(this)},Y(a,[{key:"viewMatrix",get:function(){return this._viewMat||(this._viewMat=new re),re.invert(this.entity.transform.worldMatrix,this._viewMat),this._viewMat}},{key:"inverseViewMatrix",get:function(){return this._inverseViewMat||(this._inverseViewMat=new re),re.invert(this.viewMatrix,this._inverseViewMat),this._inverseViewMat}}]),a}(hr);pt._maxLight=10;var an=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.color=new ne(1,1,1,1),r.intensity=1,r._forward=new C,r._lightColor=new ne(1,1,1,1),r._reverseDirection=new C,r}a._updateShaderData=function(e){var n=a._combinedData;e.setFloatArray(a._colorProperty,n.color),e.setFloatArray(a._directionProperty,n.direction)};var i=a.prototype;return i._appendData=function(e){var n=e*3,o=e*3,s=this.lightColor,l=this.direction,u=a._combinedData;u.color[n]=s.r,u.color[n+1]=s.g,u.color[n+2]=s.b,u.direction[o]=l.x,u.direction[o+1]=l.y,u.direction[o+2]=l.z},Y(a,[{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}},{key:"reverseDirection",get:function(){return C.scale(this.direction,-1,this._reverseDirection),this._reverseDirection}}]),a}(pt);an._colorProperty=O.getPropertyByName("u_directLightColor");an._directionProperty=O.getPropertyByName("u_directLightDirection");an._combinedData={color:new Float32Array(3*pt._maxLight),direction:new Float32Array(3*pt._maxLight)};var on=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.color=new ne(1,1,1,1),r.intensity=1,r.distance=100,r._lightColor=new ne(1,1,1,1),r}a._updateShaderData=function(e){var n=a._combinedData;e.setFloatArray(a._colorProperty,n.color),e.setFloatArray(a._positionProperty,n.position),e.setFloatArray(a._distanceProperty,n.distance)};var i=a.prototype;return i._appendData=function(e){var n=e*3,o=e*3,s=e,l=this.lightColor,u=this.position,c=a._combinedData;c.color[n]=l.r,c.color[n+1]=l.g,c.color[n+2]=l.b,c.position[o]=u.x,c.position[o+1]=u.y,c.position[o+2]=u.z,c.distance[s]=this.distance},Y(a,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}}]),a}(pt);on._colorProperty=O.getPropertyByName("u_pointLightColor");on._positionProperty=O.getPropertyByName("u_pointLightPosition");on._distanceProperty=O.getPropertyByName("u_pointLightDistance");on._combinedData={color:new Float32Array(3*pt._maxLight),position:new Float32Array(3*pt._maxLight),distance:new Float32Array(pt._maxLight)};var Kt=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.color=new ne(1,1,1,1),r.intensity=1,r.distance=100,r.angle=Math.PI/6,r.penumbra=Math.PI/12,r._forward=new C,r._lightColor=new ne(1,1,1,1),r._inverseDirection=new C,r}a._updateShaderData=function(e){var n=a._combinedData;e.setFloatArray(a._colorProperty,n.color),e.setFloatArray(a._positionProperty,n.position),e.setFloatArray(a._directionProperty,n.direction),e.setFloatArray(a._distanceProperty,n.distance),e.setFloatArray(a._angleCosProperty,n.angleCos),e.setFloatArray(a._penumbraCosProperty,n.penumbraCos)};var i=a.prototype;return i._appendData=function(e){var n=e*3,o=e*3,s=e*3,l=e,u=e,c=e,f=this.lightColor,h=this.position,d=this.direction,_=a._combinedData;_.color[n]=f.r,_.color[n+1]=f.g,_.color[n+2]=f.b,_.position[o]=h.x,_.position[o+1]=h.y,_.position[o+2]=h.z,_.direction[s]=d.x,_.direction[s+1]=d.y,_.direction[s+2]=d.z,_.distance[l]=this.distance,_.angleCos[c]=Math.cos(this.angle),_.penumbraCos[u]=Math.cos(this.angle+this.penumbra)},Y(a,[{key:"position",get:function(){return this.entity.transform.worldPosition}},{key:"direction",get:function(){return this.entity.transform.getWorldForward(this._forward),this._forward}},{key:"reverseDirection",get:function(){return C.scale(this.direction,-1,this._inverseDirection),this._inverseDirection}},{key:"lightColor",get:function(){return this._lightColor.r=this.color.r*this.intensity,this._lightColor.g=this.color.g*this.intensity,this._lightColor.b=this.color.b*this.intensity,this._lightColor.a=this.color.a*this.intensity,this._lightColor}}]),a}(pt);Kt._colorProperty=O.getPropertyByName("u_spotLightColor");Kt._positionProperty=O.getPropertyByName("u_spotLightPosition");Kt._directionProperty=O.getPropertyByName("u_spotLightDirection");Kt._distanceProperty=O.getPropertyByName("u_spotLightDistance");Kt._angleCosProperty=O.getPropertyByName("u_spotLightAngleCos");Kt._penumbraCosProperty=O.getPropertyByName("u_spotLightPenumbraCos");Kt._combinedData={color:new Float32Array(3*pt._maxLight),position:new Float32Array(3*pt._maxLight),direction:new Float32Array(3*pt._maxLight),distance:new Float32Array(pt._maxLight),angleCos:new Float32Array(pt._maxLight),penumbraCos:new Float32Array(pt._maxLight)};function Sw(){return this.findFeature(xi).visibleLights.length>0}var xi=function(t){q(a,t);function a(){var r;return r=t.call(this)||this,r.visibleLights=void 0,r.visibleLights=[],r}var i=a.prototype;return i.attachRenderLight=function(e){var n=this.visibleLights.indexOf(e);n==-1?this.visibleLights.push(e):de.warn("Light already attached.")},i.detachRenderLight=function(e){var n=this.visibleLights.indexOf(e);n!=-1&&this.visibleLights.splice(n,1)},i._updateShaderData=function(e){for(var n=0,o=0,s=0,l=this.visibleLights,u=0,c=l.length;u<c;u++){var f=l[u];f instanceof an?f._appendData(n++):f instanceof on?f._appendData(o++):f instanceof Kt&&f._appendData(s++)}n?(an._updateShaderData(e),e.enableMacro("O3_DIRECT_LIGHT_COUNT",n.toString())):e.disableMacro("O3_DIRECT_LIGHT_COUNT"),o?(on._updateShaderData(e),e.enableMacro("O3_POINT_LIGHT_COUNT",o.toString())):e.disableMacro("O3_POINT_LIGHT_COUNT"),s?(Kt._updateShaderData(e),e.enableMacro("O3_SPOT_LIGHT_COUNT",s.toString())):e.disableMacro("O3_SPOT_LIGHT_COUNT")},a}(ff),tn=function(t){q(a,t);function a(r,e){var n;n=t.call(this,r)||this,n.name=void 0,n.background=new em(n._engine),n.shaderData=new Vo(Cr.Scene),n._activeCameras=[],n._isActiveInEngine=!1,n._globalShaderMacro=new Jt,n._rootEntities=[],n._ambientLight=void 0,n.features=[],n.name=e||"";var o=n.shaderData;return a.sceneFeatureManager.addObject(B(n)),o._addRefCount(1),n.ambientLight=new er,r.sceneManager._allScenes.push(B(n)),n}var i=a.prototype;return i.createRootEntity=function(e){var n=new Qr(this._engine,e);return this.addRootEntity(n),n},i.addRootEntity=function(e,n){var o;typeof e=="number"?o=e:(o=void 0,n=e);var s=n._isRoot;s||(n._isRoot=!0,n._removeFromParent());var l=n._scene;l!==this?(l&&s&&l._removeFromEntityList(n),this._addToRootEntityList(o,n),Qr._traverseSetOwnerScene(n,this)):s||this._addToRootEntityList(o,n),this._isActiveInEngine?!n._isActiveInHierarchy&&n._isActive&&n._processActive():n._isActiveInHierarchy&&n._processInActive()},i.removeRootEntity=function(e){e._isRoot&&e._scene==this&&(this._removeFromEntityList(e),e._isRoot=!1,this._isActiveInEngine&&e._isActiveInHierarchy&&e._processInActive(),Qr._traverseSetOwnerScene(e,null))},i.getRootEntity=function(e){return e===void 0&&(e=0),this._rootEntities[e]},i.findEntityByName=function(e){for(var n=this._rootEntities,o=n.length-1;o>=0;o--){var s=n[o];if(s.name===e)return s}for(var l=n.length-1;l>=0;l--){var u=n[l],c=u.findByName(e);if(c)return c}return null},i.findEntityByPath=function(e){for(var n=e.split("/").filter(Boolean),o=0,s=this.rootEntitiesCount;o<s;o++){var l=this.getRootEntity(o);if(l.name==n[0]){for(var u=1,c=n.length;u<c&&(l=Qr._findChildByName(l,n[u]),!!l);++u);return l}}return null},i.destroy=function(){if(!this._destroyed){this._destroy();var e=this.engine.sceneManager._allScenes;e.splice(e.indexOf(this),1)}},i._attachRenderCamera=function(e){var n=this._activeCameras.indexOf(e);n===-1?this._activeCameras.push(e):de.warn("Camera already attached.")},i._detachRenderCamera=function(e){var n=this._activeCameras.indexOf(e);n!==-1&&this._activeCameras.splice(n,1)},i._processActive=function(e){this._isActiveInEngine=e;for(var n=this._rootEntities,o=n.length-1;o>=0;o--){var s=n[o];s._isActive&&(e?s._processActive():s._processInActive())}},i._updateShaderData=function(){this.findFeature(xi)._updateShaderData(this.shaderData),Jt.unionCollection(this.engine._macroCollection,this.shaderData._macroCollection,this._globalShaderMacro)},i._removeFromEntityList=function(e){var n=this._rootEntities,o=e._siblingIndex;n.splice(o,1);for(var s=n.length;o<s;o++)n[o]._siblingIndex--;e._siblingIndex=-1},i._destroy=function(){this._isActiveInEngine&&(this._engine.sceneManager.activeScene=null),a.sceneFeatureManager.callFeatureMethod(this,"destroy",[this]);for(var e=0,n=this.rootEntitiesCount;e<n;e++)this._rootEntities[e].destroy();this._rootEntities.length=0,this._activeCameras.length=0,a.sceneFeatureManager._objects=[],this.shaderData._addRefCount(-1)},i._addToRootEntityList=function(e,n){var o=this._rootEntities,s=o.length;if(e===void 0)n._siblingIndex=s,o.push(n);else{if(e<0||e>s)throw"The index "+e+" is out of child list bounds "+s;n._siblingIndex=e,o.splice(e,0,n);for(var l=e+1,u=s+1;l<u;l++)o[l]._siblingIndex++}},a.registerFeature=function(e){a.sceneFeatureManager.registerFeature(e)},i.findFeature=function(e){return a.sceneFeatureManager.findFeature(this,e)},Y(a,[{key:"ambientLight",get:function(){return this._ambientLight},set:function(e){if(!e){de.warn("The scene must have one ambient light");return}var n=this._ambientLight;n!==e&&(n&&n._removeFromScene(this),e._addToScene(this),this._ambientLight=e)}},{key:"rootEntitiesCount",get:function(){return this._rootEntities.length}},{key:"rootEntities",get:function(){return this._rootEntities}}]),a}(ln);tn.sceneFeatureManager=new U0;var tm=function(){function t(i){this.engine=i,this._allScenes=[],this._activeScene=void 0}var a=t.prototype;return a.loadScene=function(r,e){var n=this;e===void 0&&(e=!0);var o=this.engine.resourceManager.load(r);return o.then(function(s){var l=n._activeScene;n.activeScene=s,l&&e&&l.destroy()}),o},a.mergeScenes=function(r,e){for(var n=r.rootEntities,o=0,s=n.length;o<s;o++)e.addRootEntity(n[o])},a._destroyAllScene=function(){for(var r=this._allScenes,e=0,n=r.length;e<n;e++)r[e]._destroy();r.length=0},Y(t,[{key:"activeScene",get:function(){return this._activeScene},set:function(r){var e=this._activeScene;e!==r&&(e&&e._processActive(!1),r&&r._processActive(!0),this._activeScene=r)}}]),t}(),Cw=`#define GLSLIFY 1
#include <common>
#include <common_frag>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <mobile_material_frag>
#include <fog_share>
#include <normal_get>
void main(){
#include <begin_mobile_frag>
#include <begin_viewdir_frag>
#include <mobile_blinnphong_frag>
gl_FragColor=emission+ambient+diffuse+specular;gl_FragColor.a=diffuse.a;
#ifndef OASIS_COLORSPACE_GAMMA
gl_FragColor=linearToGamma(gl_FragColor);
#endif
#include <fog_frag>
}`,Pw=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <shadow_share>
#include <fog_share>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <shadow_vert>
#include <position_vert>
#include <fog_vert>
}`,Aw=`#define GLSLIFY 1
varying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;uniform sampler2D u_texture;void main(){if(v_lifeLeft==1.0){discard;}float alphaFactor=1.0;
#ifdef fadeIn
float fadeInFactor=step(0.5,v_lifeLeft);alphaFactor=2.0*fadeInFactor*(1.0-v_lifeLeft)+(1.0-fadeInFactor);
#endif
#ifdef fadeOut
float fadeOutFactor=step(0.5,v_lifeLeft);alphaFactor=alphaFactor*2.0*(1.0-fadeOutFactor)*v_lifeLeft+alphaFactor*fadeOutFactor;
#endif
#ifdef particleTexture
vec4 tex=texture2D(u_texture,v_uv);
#ifdef useOriginColor
gl_FragColor=vec4(tex.rgb,alphaFactor*tex.a*v_color.w);
#else
gl_FragColor=vec4(v_color.xyz*tex.rgb,alphaFactor*tex.a*v_color.w);
#endif
#else
gl_FragColor=vec4(v_color.xyz,alphaFactor*v_color.w);
#endif
}`,Tw=`#define GLSLIFY 1
attribute vec3 a_position;attribute vec3 a_velocity;attribute vec3 a_acceleration;attribute vec4 a_color;attribute vec4 a_lifeAndSize;attribute vec2 a_rotation;attribute vec3 a_uv;attribute vec2 a_normalizedUv;uniform float u_time;uniform bool u_once;uniform mat4 u_MVPMat;varying vec4 v_color;varying float v_lifeLeft;varying vec2 v_uv;
#ifdef is2d
uniform mat4 u_viewInvMat;uniform mat4 u_projMat;uniform mat4 u_viewMat;uniform mat4 u_modelMat;
#endif
mat2 rotation2d(float angle){float s=sin(angle);float c=cos(angle);return mat2(c,-s,s,c);}void main(){v_color=a_color;v_uv=a_uv.xy;float life=a_lifeAndSize.y;float startTime=a_lifeAndSize.x;float deltaTime=max(mod(u_time-startTime,life),0.0);if((u_once&&u_time>life+startTime)){deltaTime=0.0;}v_lifeLeft=1.0-deltaTime/life;float scale=a_lifeAndSize.z;vec3 position=a_position+(a_velocity+a_acceleration*deltaTime*0.5)*deltaTime;
#ifdef isScaleByLifetime
scale*=v_lifeLeft;
#else
scale*=pow(a_lifeAndSize.w,deltaTime);
#endif
#ifdef rotateToVelocity
vec3 v=a_velocity+a_acceleration*deltaTime;float angle=atan(v.z,v.x)*2.0;
#else
float deltaAngle=deltaTime*a_rotation.y;float angle=a_rotation.x+deltaAngle;
#endif
#ifdef is2d
vec2 rotatedPoint=rotation2d(angle)*vec2(a_normalizedUv.x,a_normalizedUv.y*a_uv.z);vec3 basisX=u_viewInvMat[0].xyz;vec3 basisZ=u_viewInvMat[1].xyz;vec3 localPosition=vec3(basisX*rotatedPoint.x+basisZ*rotatedPoint.y)*scale+position;gl_Position=u_projMat*u_viewMat*vec4(localPosition+u_modelMat[3].xyz,1.);
#else
#ifdef rotateToVelocity
float s=sin(angle);float c=cos(angle);
#else
float s=sin(angle);float c=cos(angle);
#endif
vec4 rotatedPoint=vec4((a_normalizedUv.x*c+a_normalizedUv.y*a_uv.z*s)*scale,0.,(a_normalizedUv.x*s-a_normalizedUv.y*a_uv.z*c)*scale,1.);vec4 orientation=vec4(0,0,0,1);vec4 q2=orientation+orientation;vec4 qx=orientation.xxxw*q2.xyzx;vec4 qy=orientation.xyyw*q2.xyzy;vec4 qz=orientation.xxzw*q2.xxzz;mat4 localMatrix=mat4((1.0-qy.y)-qz.z,qx.y+qz.w,qx.z-qy.w,0,qx.y-qz.w,(1.0-qx.x)-qz.z,qy.z+qx.w,0,qx.z+qy.w,qy.z-qx.w,(1.0-qx.x)-qy.y,0,position.x,position.y,position.z,1);rotatedPoint=localMatrix*rotatedPoint;gl_Position=u_MVPMat*rotatedPoint;
#endif
}`,bw=`#define GLSLIFY 1
#define IS_METALLIC_WORKFLOW
#include <common>
#include <common_frag>
#include <fog_share>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <pbr_frag>
#include <fog_frag>
}`,Ew=`#define GLSLIFY 1
#include <common>
#include <common_frag>
#include <fog_share>
#include <uv_share>
#include <normal_share>
#include <color_share>
#include <worldpos_share>
#include <light_frag_define>
#include <pbr_frag_define>
#include <pbr_helper>
void main(){
#include <pbr_frag>
#include <fog_frag>
}`,r_=`#define GLSLIFY 1
#include <common>
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <color_share>
#include <normal_share>
#include <worldpos_share>
#include <shadow_share>
#include <fog_share>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <color_vert>
#include <normal_vert>
#include <worldpos_vert>
#include <shadow_vert>
#include <position_vert>
#include <fog_vert>
}`,Mw=`#define GLSLIFY 1
vec4 pack(float depth){const vec4 bitShift=vec4(1.0,256.0,256.0*256.0,256.0*256.0*256.0);const vec4 bitMask=vec4(1.0/256.0,1.0/256.0,1.0/256.0,0.0);vec4 rgbaDepth=fract(depth*bitShift);rgbaDepth-=rgbaDepth.gbaa*bitMask;return rgbaDepth;}void main(){gl_FragColor=pack(gl_FragCoord.z);}`,n_=`#define GLSLIFY 1
#include <common_vert>
#include <blendShape_input>
#include <normal_share>
#include <shadow_share>
void main(){
#include <begin_position_vert>
#include <begin_normal_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <shadow_vert>
#include <position_vert>
}`,Rw=`#define GLSLIFY 1
#ifdef O3_SHADOW_MAP_COUNT
uniform float u_shadowBias[O3_SHADOW_MAP_COUNT];uniform float u_shadowIntensity[O3_SHADOW_MAP_COUNT];uniform float u_shadowRadius[O3_SHADOW_MAP_COUNT];uniform vec2 u_shadowMapSize[O3_SHADOW_MAP_COUNT];uniform sampler2D u_shadowMaps[O3_SHADOW_MAP_COUNT];varying vec4 v_PositionFromLight[O3_SHADOW_MAP_COUNT];const vec4 bitShift=vec4(1.0,1.0/256.0,1.0/(256.0*256.0),1.0/(256.0*256.0*256.0));float unpack(const in vec4 rgbaDepth){return dot(rgbaDepth,bitShift);}float getVisibility(vec4 positionFromLight,const in sampler2D shadowMap,vec2 mapSize,float intensity,float bias,float radius){vec3 shadowCoord=(positionFromLight.xyz/positionFromLight.w)/2.0+0.5;float filterX=step(0.0,shadowCoord.x)*(1.0-step(1.0,shadowCoord.x));float filterY=step(0.0,shadowCoord.y)*(1.0-step(1.0,shadowCoord.y));shadowCoord.z-=bias;vec2 texelSize=vec2(1.0)/mapSize;float visibility=0.0;for(float y=-1.0;y<=1.0;y+=1.0){for(float x=-1.0;x<=1.0;x+=1.0){vec2 uv=shadowCoord.xy+texelSize*vec2(x,y)*radius;vec4 rgbaDepth=texture2D(shadowMap,uv);float depth=unpack(rgbaDepth);visibility+=step(depth,shadowCoord.z)*intensity;}}visibility*=(1.0/9.0);return visibility*filterX*filterY;}
#endif
void main(){vec4 shadowColor=vec4(1.0,1.0,1.0,1.0);
#ifdef O3_SHADOW_MAP_COUNT
float visibility=1.0;
#if (O3_SHADOW_MAP_COUNT == 1)
visibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);
#elif (O3_SHADOW_MAP_COUNT == 2)
visibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);visibility-=getVisibility(v_PositionFromLight[1],u_shadowMaps[1],u_shadowMapSize[1],u_shadowIntensity[1],u_shadowBias[1],u_shadowRadius[1]);
#elif (O3_SHADOW_MAP_COUNT == 3)
visibility-=getVisibility(v_PositionFromLight[0],u_shadowMaps[0],u_shadowMapSize[0],u_shadowIntensity[0],u_shadowBias[0],u_shadowRadius[0]);visibility-=getVisibility(v_PositionFromLight[1],u_shadowMaps[1],u_shadowMapSize[1],u_shadowIntensity[1],u_shadowBias[1],u_shadowRadius[1]);visibility-=getVisibility(v_PositionFromLight[2],u_shadowMaps[2],u_shadowMapSize[2],u_shadowIntensity[2],u_shadowBias[2],u_shadowRadius[2]);
#endif
visibility=clamp(visibility,0.0,1.0);shadowColor=vec4(visibility,visibility,visibility,1.0);
#endif
gl_FragColor=shadowColor;}`,Fw=`#define GLSLIFY 1
#include <common>
uniform samplerCube u_cube;varying vec3 v_cubeUV;uniform vec4 u_cubeDecodeParam;void main(){vec4 textureColor=textureCube(u_cube,v_cubeUV);if(u_cubeDecodeParam.x>0.0){textureColor=RGBMToLinear(textureColor,u_cubeDecodeParam.y);textureColor=linearToGamma(textureColor);}gl_FragColor=textureColor;}`,zw=`#define GLSLIFY 1
#include <common_vert>
uniform mat4 u_mvpNoscale;varying vec3 v_cubeUV;void main(){v_cubeUV=vec3(-POSITION.x,POSITION.yz);gl_Position=u_mvpNoscale*vec4(POSITION,1.0);gl_Position.z=gl_Position.w;}`,Lw=`#define GLSLIFY 1
uniform sampler2D u_maskTexture;uniform float u_maskAlphaCutoff;varying vec2 v_uv;void main(){vec4 color=texture2D(u_maskTexture,v_uv);if(color.a<u_maskAlphaCutoff){discard;}gl_FragColor=color;}`,Bw=`#define GLSLIFY 1
uniform mat4 u_VPMat;attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=u_VPMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,Dw=`#define GLSLIFY 1
#ifdef USE_CUSTOM_TEXTURE
uniform sampler2D u_cusTomTexture;
#else
uniform sampler2D u_spriteTexture;
#endif
varying vec2 v_uv;varying vec4 v_color;void main(){
#ifdef USE_CUSTOM_TEXTURE
vec4 baseColor=texture2D(u_cusTomTexture,v_uv);
#else
vec4 baseColor=texture2D(u_spriteTexture,v_uv);
#endif
gl_FragColor=baseColor*v_color;}`,Ow=`#define GLSLIFY 1
#ifdef USE_MODEL_MATRIX
uniform mat4 u_MVPMat;
#else
uniform mat4 u_VPMat;
#endif
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;attribute vec4 COLOR_0;varying vec2 v_uv;varying vec4 v_color;void main(){
#ifdef USE_MODEL_MATRIX
gl_Position=u_MVPMat*vec4(POSITION,1.0);
#else
gl_Position=u_VPMat*vec4(POSITION,1.0);
#endif
v_uv=TEXCOORD_0;v_color=COLOR_0;}`,Iw=`#define GLSLIFY 1
#include <common>
#include <uv_share>
#include <fog_share>
uniform vec4 u_baseColor;uniform float u_alphaCutoff;
#ifdef BASETEXTURE
uniform sampler2D u_baseTexture;
#endif
void main(){vec4 baseColor=u_baseColor;
#ifdef BASETEXTURE
vec4 textureColor=texture2D(u_baseTexture,v_uv);
#ifndef OASIS_COLORSPACE_GAMMA
textureColor=gammaToLinear(textureColor);
#endif
baseColor*=textureColor;
#endif
#ifdef ALPHA_CUTOFF
if(baseColor.a<u_alphaCutoff){discard;}
#endif
#ifndef OASIS_COLORSPACE_GAMMA
baseColor=linearToGamma(baseColor);
#endif
gl_FragColor=baseColor;
#include <fog_frag>
}`,Nw=`#define GLSLIFY 1
#include <common_vert>
#include <blendShape_input>
#include <uv_share>
#include <fog_share>
void main(){
#include <begin_position_vert>
#include <blendShape_vert>
#include <skinning_vert>
#include <uv_vert>
#include <position_vert>
#include <fog_vert>
}`,kw=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;void main(){gl_Position=vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`,Uw=`#define GLSLIFY 1
uniform sampler2D u_baseTexture;varying vec2 v_uv;void main(){gl_FragColor=texture2D(u_baseTexture,v_uv);}`,Vw=function(){function t(){}return t.init=function(){O.create("blinn-phong",Pw,Cw),O.create("pbr",r_,bw),O.create("pbr-specular",r_,Ew),O.create("unlit",Nw,Iw),O.create("shadow-map",n_,Mw),O.create("shadow",n_,Rw),O.create("skybox",zw,Fw),O.create("particle-shader",Tw,Aw),O.create("SpriteMask",Bw,Lw),O.create("Sprite",Ow,Dw),O.create("background-texture",kw,Uw)},t}(),Gw=function(){function t(){this._cacheHierarchy=1,this._cacheMap=Object.create(null),this._lastQueryMap=void 0,this._lastQueryKey=void 0}var a=t.prototype;return a.get=function(r){var e=this._cacheMap,n=r._length;n>this._cacheHierarchy&&this._resizeCacheMapHierarchy(e,0,n);for(var o=r._mask,s=r._length-1,l=this._cacheHierarchy-1,u=0;u<l;u++){var c=s<u?0:o[u],f=e[c];f||(e[c]=f=Object.create(null)),e=f}var h=s<l?0:o[l],d=e[h];return d||(this._lastQueryKey=h,this._lastQueryMap=e),d},a.cache=function(r){this._lastQueryMap[this._lastQueryKey]=r},a._resizeCacheMapHierarchy=function(r,e,n){var o=this._cacheHierarchy-1;if(e==o){for(var s in r)for(var l=r[s],u=0,c=n-o;u<c;u++)u==c-1?r[0]=l:r=r[u==0?s:0]=Object.create(null);this._cacheHierarchy=n}else for(var f in r)this._resizeCacheMapHierarchy(r[f],++e,n)},t}(),_n=new U0;Vw.init();var Er=function(t){q(a,t);function a(r,e,n){var o;o=t.call(this)||this,o.physicsManager=void 0,o.inputManager=void 0,o._componentsManager=new nf,o._hardwareRenderer=void 0,o._lastRenderState=new X0,o._renderElementPool=new ui($0),o._spriteElementPool=new ui(q0),o._spriteMaskElementPool=new ui(gw),o._textElementPool=new ui(ww),o._spriteDefaultMaterial=void 0,o._spriteMaskDefaultMaterial=void 0,o._renderContext=new pw,o._magentaTexture2D=void 0,o._magentaTextureCube=void 0,o._magentaTexture2DArray=void 0,o._magentaMaterial=void 0,o._backgroundTextureMaterial=void 0,o._renderCount=0,o._shaderProgramPools=[],o._spriteMaskManager=void 0,o._canSpriteBatch=!0,o._macroCollection=new Jt,o._canvas=void 0,o._settings={},o._resourceManager=new No(B(o)),o._sceneManager=new tm(B(o)),o._vSyncCount=1,o._targetFrameRate=60,o._time=new N0,o._isPaused=!0,o._requestId=void 0,o._timeoutId=void 0,o._vSyncCounter=1,o._targetFrameInterval=1e3/60,o._destroyed=!1,o._waittingDestroy=!1,o._animate=function(){o._vSyncCount?(o._requestId=requestAnimationFrame(o._animate),o._vSyncCounter++%o._vSyncCount===0&&(o.update(),o._vSyncCounter=1)):(o._timeoutId=window.setTimeout(o._animate,o._targetFrameInterval),o.update())},o.features=[],o._hardwareRenderer=e,o._hardwareRenderer.init(r),o.physicsManager=new jt(B(o)),o._canvas=r,_n.addObject(B(o)),o._sceneManager.activeScene=new tn(B(o),"DefaultScene"),o._spriteMaskManager=new xw(B(o)),o._spriteDefaultMaterial=o._createSpriteMaterial(),o._spriteMaskDefaultMaterial=o._createSpriteMaskMaterial(),o.inputManager=new W0(B(o));var s=new Uint8Array([255,0,255,255]),l=new cr(B(o),1,1,J.R8G8B8A8,!1);l.setPixelBuffer(s),l.isGCIgnored=!0;var u=new $t(B(o),1,J.R8G8B8A8,!1);if(u.setPixelBuffer(Vt.PositiveX,s),u.setPixelBuffer(Vt.NegativeX,s),u.setPixelBuffer(Vt.PositiveY,s),u.setPixelBuffer(Vt.NegativeY,s),u.setPixelBuffer(Vt.PositiveZ,s),u.setPixelBuffer(Vt.NegativeZ,s),u.isGCIgnored=!0,o._magentaTexture2D=l,o._magentaTextureCube=u,e.isWebGL2){var c=new uf(B(o),1,1,1,J.R8G8B8A8,!1);c.setPixelBuffer(0,s),c.isGCIgnored=!0,o._magentaTexture2DArray=c}var f=new Ar(B(o),O.find("unlit"));f.shaderData.setColor("u_baseColor",new ne(1,0,1.01,1)),o._magentaMaterial=f;var h=new Ar(B(o),O.find("background-texture"));h.isGCIgnored=!0,h.renderState.depthState.compareFunction=Pe.LessEqual,o._backgroundTextureMaterial=h;var d=(n==null?void 0:n.colorSpace)||Bn.Linear;return d===Bn.Gamma&&o._macroCollection.enable(a._gammaMacro),o._settings.colorSpace=d,o}var i=a.prototype;return i.createEntity=function(e){return new Qr(this,e)},i.pause=function(){this._isPaused=!0,cancelAnimationFrame(this._requestId),clearTimeout(this._timeoutId)},i.resume=function(){!this._isPaused||(this._isPaused=!1,this.time.reset(),this._requestId=requestAnimationFrame(this._animate))},i.update=function(){var e=this._time,n=e.deltaTime;e.tick(),this._renderElementPool.resetPool(),this._spriteElementPool.resetPool(),this._spriteMaskElementPool.resetPool(),this._textElementPool.resetPool(),_n.callFeatureMethod(this,"preTick",[this,this._sceneManager._activeScene]);var o=this._sceneManager._activeScene,s=this._componentsManager;o&&(o._activeCameras.sort(function(l,u){return l.priority-u.priority}),s.callScriptOnStart(),this.physicsManager._initialized&&this.physicsManager._update(n/1e3),this.inputManager._update(),s.callScriptOnUpdate(n),s.callAnimationUpdate(n),s.callScriptOnLateUpdate(n),this._render(o)),_n.callFeatureMethod(this,"postTick",[this,this._sceneManager._activeScene]),this._waittingDestroy&&this._sceneManager._destroyAllScene(),s.handlingInvalidScripts(),this._waittingDestroy&&this._destroy()},i.run=function(){_n.callFeatureMethod(this,"preLoad",[this]),this.resume(),this.trigger(new Ju("run",this))},i.destroy=function(){this._destroyed||(this._waittingDestroy=!0)},i._destroy=function(){this._resourceManager._destroy(),this._magentaTexture2D.destroy(!0),this._magentaTextureCube.destroy(!0),this.inputManager._destroy(),this.trigger(new Ju("shutdown",this)),_n.callFeatureMethod(this,"shutdown",[this]),this.pause(),this._animate=null,this._sceneManager=null,this._resourceManager=null,this._canvas=null,this.features=[],this._time=null,this._spriteMaskManager.destroy(),_n._objects=[],this.removeAllEventListeners(),this._waittingDestroy=!1,this._destroyed=!0},i._getShaderProgramPool=function(e){var n=e._shaderId,o=this._shaderProgramPools,s=o[n];if(!s){var l=n+1;l<o.length&&(o.length=l),o[n]=s=new Gw}return s},i._render=function(e){var n=e._activeCameras,o=this._componentsManager,s=this.time.deltaTime;if(o.callRendererOnUpdate(s),e._updateShaderData(),n.length>0)for(var l=0,u=n.length;l<u;l++){var c=n[l];o.callCameraOnBeginRender(c),tn.sceneFeatureManager.callFeatureMethod(e,"preRender",[e,c]),c.render(),tn.sceneFeatureManager.callFeatureMethod(e,"postRender",[e,c]),o.callCameraOnEndRender(c)}else de.debug("NO active camera.")},i._createSpriteMaterial=function(){var e=new Ar(this,O.find("Sprite")),n=e.renderState,o=n.blendState.targetBlendState;return o.enabled=!0,o.sourceColorBlendFactor=ae.SourceAlpha,o.destinationColorBlendFactor=ae.OneMinusSourceAlpha,o.sourceAlphaBlendFactor=ae.One,o.destinationAlphaBlendFactor=ae.OneMinusSourceAlpha,o.colorBlendOperation=o.alphaBlendOperation=Xt.Add,n.depthState.writeEnabled=!1,n.rasterState.cullMode=Qt.Off,e.renderQueueType=_t.Transparent,e.isGCIgnored=!0,e},i._createSpriteMaskMaterial=function(){var e=new Ar(this,O.find("SpriteMask")),n=e.renderState;return n.blendState.targetBlendState.colorWriteMask=Pr.None,n.rasterState.cullMode=Qt.Off,n.stencilState.enabled=!0,n.depthState.enabled=!1,e.isGCIgnored=!0,e},i.findFeature=function(e){return _n.findFeature(this,e)},a.registerFeature=function(e){_n.registerFeature(e)},Y(a,[{key:"settings",get:function(){return this._settings}},{key:"canvas",get:function(){return this._canvas}},{key:"resourceManager",get:function(){return this._resourceManager}},{key:"sceneManager",get:function(){return this._sceneManager}},{key:"time",get:function(){return this._time}},{key:"isPaused",get:function(){return this._isPaused}},{key:"vSyncCount",get:function(){return this._vSyncCount},set:function(e){this._vSyncCount=Math.max(0,Math.floor(e))}},{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(e){e=Math.max(1e-6,e),this._targetFrameRate=e,this._targetFrameInterval=1e3/e}},{key:"destroyed",get:function(){return this._destroyed}}]),a}(I0);Er._gammaMacro=O.getMacroByName("OASIS_COLORSPACE_GAMMA");Er._pixelsPerUnit=100;Er._defaultBoundingBox=new Gr(new C(0,0,0),new C(0,0,0));var Hw=function(){function t(){}return t._isIos=function(){if(!window)return!1;var i=window.navigator.userAgent.toLocaleLowerCase();return/iphone|ipad|ipod/.test(i)},Y(t,null,[{key:"devicePixelRatio",get:function(){return window.devicePixelRatio}}]),t}(),Ww=function(){function t(){}var a=t.prototype;return a.preLoad=function(r){},a.preTick=function(r,e){},a.postTick=function(r,e){},a.shutdown=function(r){},t}(),pr,i_,a_,o_,s_,l_,u_,c_,f_,h_,Sl=(pr=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,k(r,"_started",i_,B(r)),k(r,"_onStartIndex",a_,B(r)),k(r,"_onUpdateIndex",o_,B(r)),k(r,"_onLateUpdateIndex",s_,B(r)),k(r,"_onPhysicsUpdateIndex",l_,B(r)),k(r,"_onPreRenderIndex",u_,B(r)),k(r,"_onPostRenderIndex",c_,B(r)),k(r,"_entityScriptsIndex",f_,B(r)),k(r,"_waitHandlingInValid",h_,B(r)),r}var i=a.prototype;return i.onAwake=function(){},i.onEnable=function(){},i.onStart=function(){},i.onUpdate=function(e){},i.onLateUpdate=function(e){},i.onBeginRender=function(e){},i.onEndRender=function(e){},i.onPhysicsUpdate=function(){},i.onTriggerEnter=function(e){},i.onTriggerExit=function(e){},i.onTriggerStay=function(e){},i.onCollisionEnter=function(e){},i.onCollisionExit=function(e){},i.onCollisionStay=function(e){},i.onPointerDown=function(){},i.onPointerUp=function(){},i.onPointerClick=function(){},i.onPointerEnter=function(){},i.onPointerExit=function(){},i.onPointerDrag=function(){},i.onDisable=function(){},i.onDestroy=function(){},i._onAwake=function(){this.onAwake()},i._onEnable=function(){if(this._waitHandlingInValid)this._waitHandlingInValid=!1;else{var e=this.engine._componentsManager,n=a.prototype;this._started||e.addOnStartScript(this),this.onUpdate!==n.onUpdate&&e.addOnUpdateScript(this),this.onLateUpdate!==n.onLateUpdate&&e.addOnLateUpdateScript(this),this.onPhysicsUpdate!==n.onPhysicsUpdate&&e.addOnPhysicsUpdateScript(this),this._entity._addScript(this)}this.onEnable()},i._onDisable=function(){this._waitHandlingInValid=!0,this._engine._componentsManager.addDisableScript(this),this.onDisable()},i._onDestroy=function(){this._engine._componentsManager.addDestroyScript(this)},i._handlingInValid=function(){var e=this.engine._componentsManager,n=a.prototype;this.onUpdate!==n.onUpdate&&e.removeOnUpdateScript(this),this.onLateUpdate!==n.onLateUpdate&&e.removeOnLateUpdateScript(this),this.onPhysicsUpdate!==n.onPhysicsUpdate&&e.removeOnPhysicsUpdateScript(this),this._entity._removeScript(this),this._waitHandlingInValid=!1},a}(hr),i_=U(pr.prototype,"_started",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a_=U(pr.prototype,"_onStartIndex",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),o_=U(pr.prototype,"_onUpdateIndex",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),s_=U(pr.prototype,"_onLateUpdateIndex",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),l_=U(pr.prototype,"_onPhysicsUpdateIndex",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),u_=U(pr.prototype,"_onPreRenderIndex",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),c_=U(pr.prototype,"_onPostRenderIndex",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),f_=U(pr.prototype,"_entityScriptsIndex",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),h_=U(pr.prototype,"_waitHandlingInValid",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pr),jw=0,ci=function(){function t(i,r,e,n,o){i===void 0&&(i="RENDER_PASS"+jw++),r===void 0&&(r=0),e===void 0&&(e=null),n===void 0&&(n=null),o===void 0&&(o=null),this.name=void 0,this.enabled=void 0,this.priority=void 0,this.renderTarget=void 0,this.replaceMaterial=void 0,this.mask=void 0,this.renderOverride=void 0,this.clearFlags=void 0,this.clearColor=void 0,this.name=i,this.enabled=!0,this.priority=r,this.renderTarget=e,this.replaceMaterial=n,this.mask=o||Ut.Everything,this.renderOverride=!1}var a=t.prototype;return a.render=function(r,e,n,o){},a.preRender=function(r,e,n,o){},a.postRender=function(r,e,n,o){},t}(),rm=function(t){q(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.createVertexElements=function(e){return e[0]=new xe("POSITION",0,K.Vector3,0),e[1]=new xe("TEXCOORD_0",12,K.Vector2,0),e[2]=new xe("COLOR_0",20,K.Vector4,0),36},i.canBatch=function(e,n){if(!this._engine._canSpriteBatch)return!1;var o=e.component,s=n.component;return!this.checkBatchWithMask(o,s)||e.texture!==n.texture?!1:e.material===n.material},i.checkBatchWithMask=function(e,n){var o=e.maskInteraction;return o!==n.maskInteraction?!1:o===ar.None?!0:e.maskLayer===n.maskLayer},i.updateVertices=function(e,n,o){for(var s=e.renderData,l=s.positions,u=s.uvs,c=s.color,f=s.vertexCount,h=0;h<f;h++){var d=l[h],_=u[h];n[o++]=d.x,n[o++]=d.y,n[o++]=d.z,n[o++]=_.x,n[o++]=_.y,n[o++]=c.r,n[o++]=c.g,n[o++]=c.b,n[o++]=c.a}return o},i.drawBatches=function(e,n){for(var o=this._engine,s=this._batchedQueue,l=this._meshes[this._flushId],u=l.subMeshes,c=o._spriteMaskManager,f=e.scene.shaderData,h=e.shaderData,d=0,_=u.length;d<_;d++){var m=u[d],p=s[d];if(!m||!p)return;var v=p.component,g=p.material;c.preRender(e,v);var y=O._compileMacros;Jt.unionCollection(v._globalShaderMacro,g.shaderData._macroCollection,y),(n||g)._preRender(p);var x=(n||g).shader._getShaderProgram(o,y);if(!x.isValid)return;v.shaderData.setTexture(a._textureProperty,p.texture),x.bind(),x.groupingOtherUniformBlock(),x.uploadAll(x.sceneUniformBlock,f),x.uploadAll(x.cameraUniformBlock,h),x.uploadAll(x.rendererUniformBlock,v.shaderData),x.uploadAll(x.materialUniformBlock,g.shaderData),g.renderState._apply(o,!1),o._hardwareRenderer.drawPrimitive(l,m,x),c.postRender(v)}},i.destroy=function(){this._batchedQueue=null;for(var e=this._meshes,n=this._vertexBuffers,o=this._indiceBuffers,s=0,l=e.length;s<l;++s)e[s].destroy();this._meshes=null;for(var u=0,c=n.length;u<c;++u)n[u].destroy();this._vertexBuffers=null;for(var f=0,h=o.length;f<h;++f)o[f].destroy();this._indiceBuffers=null},a}(wl);rm._textureProperty=O.getPropertyByName("u_spriteTexture");var ei=function(){t._compareFromNearToFar=function(r,e){return r.component.priority-e.component.priority||r.component._distanceForSort-e.component._distanceForSort},t._compareFromFarToNear=function(r,e){return r.component.priority-e.component.priority||e.component._distanceForSort-r.component._distanceForSort};function t(i){this.items=[],this._spriteBatcher=void 0,this._spriteBatcher=new rm(i)}var a=t.prototype;return a.pushPrimitive=function(r){this.items.push(r)},a.render=function(r,e,n){var o=this.items;if(o.length!==0){for(var s=r.engine,l=r.scene,u=s._renderCount,c=s._hardwareRenderer,f=l.shaderData,h=r.shaderData,d=0,_=o.length;d<_;d++){var m=o[d],p=m.component.entity.layer;if(!!(p&n))if(m.mesh){this._spriteBatcher.flush(r,e);var v=O._compileMacros,g=m,y=g.component,x=g.material.destroyed?s._magentaMaterial:g.material,P=y.shaderData,S=x.shaderData;(e||x)._preRender(g),Jt.unionCollection(y._globalShaderMacro,S._macroCollection,v);var w=(e||x).shader._getShaderProgram(s,v);if(!w.isValid)continue;var b=w.bind(),E=u!==w._uploadRenderCount;E?(w.groupingOtherUniformBlock(),w.uploadAll(w.sceneUniformBlock,f),w.uploadAll(w.cameraUniformBlock,h),w.uploadAll(w.rendererUniformBlock,P),w.uploadAll(w.materialUniformBlock,S),w.uploadUnGroupTextures(),w._uploadCamera=r,w._uploadRenderer=y,w._uploadMaterial=x,w._uploadRenderCount=u):(w._uploadCamera!==r?(w.uploadAll(w.cameraUniformBlock,h),w._uploadCamera=r):b&&w.uploadTextures(w.cameraUniformBlock,h),w._uploadRenderer!==y?(w.uploadAll(w.rendererUniformBlock,P),w._uploadRenderer=y):b&&w.uploadTextures(w.rendererUniformBlock,P),w._uploadMaterial!==x?(w.uploadAll(w.materialUniformBlock,S),w._uploadMaterial=x):b&&w.uploadTextures(w.materialUniformBlock,S),b&&w.uploadUnGroupTextures()),x.renderState._apply(s,y.entity.transform._isFrontFaceInvert()),c.drawPrimitive(g.mesh,g.subMesh,w)}else{var M=m;this._spriteBatcher.drawElement(M,r,e)}}this._spriteBatcher.flush(r,e)}},a.clear=function(){this.items.length=0,this._spriteBatcher.clear()},a.destroy=function(){this._spriteBatcher.destroy(),this._spriteBatcher=null},a.sort=function(r){this._quickSort(this.items,0,this.items.length,r)},a._quickSort=function(r,e,n,o){for(;;){if(n-e<=10){this._insertionSort(r,e,n,o);return}var s=e+n>>1,l=r[e],u=r[n-1],c=r[s],f=o(l,u);if(f>0){var h=l;l=u,u=h}var d=o(l,c);if(d>=0){var _=l;l=c,c=u,u=_}else{var m=o(u,c);if(m>0){var p=u;u=c,c=p}}r[e]=l,r[n-1]=c;var v=u,g=e+1,y=n-1;r[s]=r[g],r[g]=v;e:for(var x=g+1;x<y;x++){var P=r[x],S=o(P,v);if(S<0)r[x]=r[g],r[g]=P,g++;else if(S>0){do{if(y--,y==x)break e;var w=r[y];S=o(w,v)}while(S>0);r[x]=r[y],r[y]=P,S<0&&(P=r[x],r[x]=r[g],r[g]=P,g++)}}n-y<g-e?(this._quickSort(r,y,n,o),n=g):(this._quickSort(r,e,g,o),e=y)}},a._insertionSort=function(r,e,n,o){for(var s=e+1;s<n;s++){var l=void 0,u=r[s];for(l=s-1;l>=e;l--){var c=r[l],f=o(c,u);if(f>0)r[l+1]=c;else break}r[l+1]=u}},t}(),nm=function(){function t(i){this._opaqueQueue=void 0,this._transparentQueue=void 0,this._alphaTestQueue=void 0,this._allSpriteMasks=new Bt,this._camera=void 0,this._defaultPass=void 0,this._renderPassArray=void 0,this._lastCanvasSize=new $,this._camera=i;var r=i.engine;this._opaqueQueue=new ei(r),this._alphaTestQueue=new ei(r),this._transparentQueue=new ei(r),this._renderPassArray=[],this._defaultPass=new ci("default",0,null,null,0),this.addRenderPass(this._defaultPass)}var a=t.prototype;return a.addRenderPass=function(r,e,n,o,s){if(e===void 0&&(e=null),n===void 0&&(n=null),o===void 0&&(o=null),s===void 0&&(s=null),typeof r=="string"){var l=new ci(r,e,n,o,s);this._renderPassArray.push(l)}else r instanceof ci&&this._renderPassArray.push(r);this._renderPassArray.sort(function(u,c){return u.priority-c.priority})},a.removeRenderPass=function(r){var e;if(typeof r=="string"?e=this.getRenderPass(r):r instanceof ci&&(e=r),e){var n=this._renderPassArray.indexOf(e);this._renderPassArray.splice(n,1)}},a.getRenderPass=function(r){for(var e=0,n=this._renderPassArray.length;e<n;e++){var o=this._renderPassArray[e];if(o.name===r)return o}return null},a.destroy=function(){this._opaqueQueue.destroy(),this._alphaTestQueue.destroy(),this._transparentQueue.destroy(),this._allSpriteMasks=null,this._renderPassArray=null,this._defaultPass=null,this._camera=null},a.render=function(r,e,n){var o=this._camera,s=this._opaqueQueue,l=this._alphaTestQueue,u=this._transparentQueue;o.engine._spriteMaskManager.clear(),s.clear(),l.clear(),u.clear(),this._allSpriteMasks.length=0,o.engine._componentsManager.callRender(r),s.sort(ei._compareFromNearToFar),l.sort(ei._compareFromNearToFar),u.sort(ei._compareFromFarToNear);for(var c=0,f=this._renderPassArray.length;c<f;c++)this._drawRenderPass(this._renderPassArray[c],o,e,n)},a._drawRenderPass=function(r,e,n,o){if(r.preRender(e,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue),r.enabled){var s,l,u=e.engine,c=e.scene,f=c.background,h=u._hardwareRenderer,d=e.renderTarget||r.renderTarget;h.activeRenderTarget(d,e,o),d==null||d._setRenderTargetInfo(n,o);var _=(s=r.clearFlags)!=null?s:e.clearFlags,m=(l=r.clearColor)!=null?l:f.solidColor;_!==Tr.None&&h.clearRenderTarget(e.engine,_,m),r.renderOverride?r.render(e,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue):(this._opaqueQueue.render(e,r.replaceMaterial,r.mask),this._alphaTestQueue.render(e,r.replaceMaterial,r.mask),e.clearFlags&Tr.Color&&(f.mode===en.Sky?this._drawSky(u,e,f.sky):f.mode===en.Texture&&f.texture&&this._drawBackgroundTexture(u,f)),this._transparentQueue.render(e,r.replaceMaterial,r.mask)),d==null||d._blitRenderTarget(),d==null||d.generateMipmaps()}r.postRender(e,this._opaqueQueue,this._alphaTestQueue,this._transparentQueue)},a.pushPrimitive=function(r){switch(r.material.renderQueueType){case _t.Transparent:this._transparentQueue.pushPrimitive(r);break;case _t.AlphaTest:this._alphaTestQueue.pushPrimitive(r);break;case _t.Opaque:this._opaqueQueue.pushPrimitive(r);break}},a._drawBackgroundTexture=function(r,e){var n=r._hardwareRenderer,o=r._backgroundTextureMaterial,s=r.canvas,l=e._mesh;(this._lastCanvasSize.x!==s.width||this._lastCanvasSize.y!==s.height)&&e._textureFillMode!==Pn.Fill&&(this._lastCanvasSize.set(s.width,s.height),e._resizeBackgroundTexture());var u=o.shader._getShaderProgram(r,O._compileMacros);u.bind(),u.uploadAll(u.materialUniformBlock,o.shaderData),u.uploadUnGroupTextures(),o.renderState._apply(r,!1),n.drawPrimitive(l,l.subMesh,u)},a._drawSky=function(r,e,n){var o=n.material,s=n.mesh,l=n._matrix;if(!o){de.warn("The material of sky is not defined.");return}if(!s){de.warn("The mesh of sky is not defined.");return}var u=r._hardwareRenderer,c=o.shaderData,f=o.shader,h=o.renderState,d=O._compileMacros;Jt.unionCollection(e._globalShaderMacro,c._macroCollection,d);var _=e.viewMatrix,m=e.projectionMatrix;l.copyFrom(_);var p=l.elements;p[12]=p[13]=p[14]=0,re.multiply(m,l,l),c.setMatrix("u_mvpNoscale",l);var v=f._getShaderProgram(r,d);v.bind(),v.groupingOtherUniformBlock(),v.uploadAll(v.materialUniformBlock,c),v.uploadUnGroupTextures(),h._apply(r,!1),u.drawPrimitive(s,s.subMesh,v)},Y(t,[{key:"defaultRenderPass",get:function(){return this._defaultPass}}]),t}(),d_,__,Nt,v_,p_,g_,m_,y_,x_,w_,S_,C_,P_,A_,T_,vn,fi=function(){};fi.tempVec4=new Ee;fi.tempVec3=new C;fi.tempVec2=new $;var Cl=(d_=ko(Yt),d_(__=(Nt=(vn=function(t){q(a,t);function a(r){var e;e=t.call(this,r)||this,e.shaderData=new Vo(Cr.Camera),e.priority=0,e.enableFrustumCulling=!0,e.clearFlags=Tr.All,e.cullingMask=Ut.Everything,e._globalShaderMacro=new Jt,k(e,"_frustum",v_,B(e)),k(e,"_renderPipeline",p_,B(e)),e._isOrthographic=!1,e._isProjMatSetting=!1,e._nearClipPlane=.1,e._farClipPlane=100,e._fieldOfView=45,e._orthographicSize=10,e._isProjectionDirty=!0,e._isInvProjMatDirty=!0,e._isFrustumProjectDirty=!0,e._customAspectRatio=void 0,e._renderTarget=null,k(e,"_frustumViewChangeFlag",g_,B(e)),k(e,"_transform",m_,B(e)),k(e,"_isViewMatrixDirty",y_,B(e)),k(e,"_isInvViewProjDirty",x_,B(e)),k(e,"_projectionMatrix",w_,B(e)),k(e,"_viewMatrix",S_,B(e)),k(e,"_viewport",C_,B(e)),k(e,"_inverseProjectionMatrix",P_,B(e)),k(e,"_lastAspectSize",A_,B(e)),k(e,"_invViewProjMat",T_,B(e));var n=e.entity.transform;return e._transform=n,e._isViewMatrixDirty=n.registerWorldChangeFlag(),e._isInvViewProjDirty=n.registerWorldChangeFlag(),e._frustumViewChangeFlag=n.registerWorldChangeFlag(),e._renderPipeline=new nm(B(e)),e.shaderData._addRefCount(1),e}var i=a.prototype;return i.resetProjectionMatrix=function(){this._isProjMatSetting=!1,this._projMatChange()},i.resetAspectRatio=function(){this._customAspectRatio=void 0,this._projMatChange()},i.worldToViewportPoint=function(e,n){var o=fi.tempVec3,s=fi.tempVec4;C.transformCoordinate(e,this.viewMatrix,o),C.transformToVec4(o,this.projectionMatrix,s);var l=s.w;return n.set((s.x/l+1)*.5,(1-s.y/l)*.5,-o.z),n},i.viewportToWorldPoint=function(e,n){var o=this.nearClipPlane,s=this.farClipPlane,l=1/(o-s),u;if(this.isOrthographic)u=-e.z*2*l,u+=(s+o)*l;else{var c=e.z;u=-c*(o+s)*l,u+=2*o*s*l,u=u/c}return this._innerViewportToWorldPoint(e.x,e.y,(u+1)/2,this._getInvViewProjMat(),n),n},i.viewportPointToRay=function(e,n){var o=this._getInvViewProjMat(),s=this._innerViewportToWorldPoint(e.x,e.y,0,o,n.origin),l=this._innerViewportToWorldPoint(e.x,e.y,1,o,n.direction);return C.subtract(l,s,l),l.normalize(),n},i.screenToViewportPoint=function(e,n){var o=this.engine.canvas,s=this.viewport;return n.x=(e.x/o.width-s.x)/s.z,n.y=(e.y/o.height-s.y)/s.w,e.z!==void 0&&(n.z=e.z),n},i.viewportToScreenPoint=function(e,n){var o=this.engine.canvas,s=this.viewport;return n.x=(s.x+e.x*s.z)*o.width,n.y=(s.y+e.y*s.w)*o.height,e.z!==void 0&&(n.z=e.z),n},i.worldToScreenPoint=function(e,n){return this.worldToViewportPoint(e,n),this.viewportToScreenPoint(n,n)},i.screenToWorldPoint=function(e,n){return this.screenToViewportPoint(e,n),this.viewportToWorldPoint(n,n)},i.screenPointToRay=function(e,n){var o=fi.tempVec2;return this.screenToViewportPoint(e,o),this.viewportPointToRay(o,n)},i.render=function(e,n){n===void 0&&(n=0);var o=this.engine._renderContext;o._setContext(this),this.enableFrustumCulling&&(this._frustumViewChangeFlag.flag||this._isFrustumProjectDirty)&&(this._frustum.calculateFromMatrix(o._viewProjectMatrix),this._frustumViewChangeFlag.flag=!1,this._isFrustumProjectDirty=!1),this._updateShaderData(o),Jt.unionCollection(this.scene._globalShaderMacro,this.shaderData._macroCollection,this._globalShaderMacro),n>0&&!this.engine._hardwareRenderer.isWebGL2&&(n=0,de.error("mipLevel only take effect in WebGL2.0")),this._renderPipeline.render(o,e,n),this._engine._renderCount++},i._onEnable=function(){this.entity.scene._attachRenderCamera(this)},i._onDisable=function(){this.entity.scene._detachRenderCamera(this)},i._onDestroy=function(){var e;(e=this._renderPipeline)===null||e===void 0||e.destroy(),this._isInvViewProjDirty.destroy(),this._isViewMatrixDirty.destroy(),this.shaderData._addRefCount(-1)},i._projMatChange=function(){this._isFrustumProjectDirty=!0,this._isProjectionDirty=!0,this._isInvProjMatDirty=!0,this._isInvViewProjDirty.flag=!0},i._innerViewportToWorldPoint=function(e,n,o,s,l){var u=fi.tempVec3;return u.set(e*2-1,1-n*2,o*2-1),C.transformCoordinate(u,s,l),l},i._updateShaderData=function(e){var n=this.shaderData;n.setMatrix(a._viewMatrixProperty,this.viewMatrix),n.setMatrix(a._projectionMatrixProperty,this.projectionMatrix),n.setMatrix(a._vpMatrixProperty,e._viewProjectMatrix),n.setMatrix(a._inverseViewMatrixProperty,this._transform.worldMatrix),n.setMatrix(a._inverseProjectionMatrixProperty,this._getInverseProjectionMatrix()),n.setVector3(a._cameraPositionProperty,this._transform.worldPosition)},i._getInvViewProjMat=function(){return this._isInvViewProjDirty.flag&&(this._isInvViewProjDirty.flag=!1,re.multiply(this._transform.worldMatrix,this._getInverseProjectionMatrix(),this._invViewProjMat)),this._invViewProjMat},i._getInverseProjectionMatrix=function(){return this._isInvProjMatDirty&&(this._isInvProjMatDirty=!1,re.invert(this.projectionMatrix,this._inverseProjectionMatrix)),this._inverseProjectionMatrix},Y(a,[{key:"nearClipPlane",get:function(){return this._nearClipPlane},set:function(e){this._nearClipPlane=e,this._projMatChange()}},{key:"farClipPlane",get:function(){return this._farClipPlane},set:function(e){this._farClipPlane=e,this._projMatChange()}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e,this._projMatChange()}},{key:"aspectRatio",get:function(){var e,n=this._entity.engine.canvas;return(e=this._customAspectRatio)!=null?e:n.width*this._viewport.z/(n.height*this._viewport.w)},set:function(e){this._customAspectRatio=e,this._projMatChange()}},{key:"viewport",get:function(){return this._viewport},set:function(e){e!==this._viewport&&this._viewport.copyFrom(e),this._projMatChange()}},{key:"isOrthographic",get:function(){return this._isOrthographic},set:function(e){this._isOrthographic=e,this._projMatChange()}},{key:"orthographicSize",get:function(){return this._orthographicSize},set:function(e){this._orthographicSize=e,this._projMatChange()}},{key:"viewMatrix",get:function(){return this._isViewMatrixDirty.flag&&(this._isViewMatrixDirty.flag=!1,re.rotationTranslation(this._transform.worldRotationQuaternion,this._transform.worldPosition,this._viewMatrix),this._viewMatrix.invert()),this._viewMatrix}},{key:"projectionMatrix",get:function(){var e=this._entity.engine.canvas;if((!this._isProjectionDirty||this._isProjMatSetting)&&this._lastAspectSize.x===e.width&&this._lastAspectSize.y===e.height)return this._projectionMatrix;this._isProjectionDirty=!1,this._lastAspectSize.x=e.width,this._lastAspectSize.y=e.height;var n=this.aspectRatio;if(!this._isOrthographic)re.perspective(W.degreeToRadian(this._fieldOfView),n,this._nearClipPlane,this._farClipPlane,this._projectionMatrix);else{var o=this._orthographicSize*n,s=this._orthographicSize;re.ortho(-o,o,-s,s,this._nearClipPlane,this._farClipPlane,this._projectionMatrix)}return this._projectionMatrix},set:function(e){this._projectionMatrix=e,this._isProjMatSetting=!0,this._projMatChange()}},{key:"enableHDR",get:function(){return console.log("not implementation"),!1},set:function(e){console.log("not implementation")}},{key:"renderTarget",get:function(){return this._renderTarget},set:function(e){this._renderTarget=e}}]),a}(hr),vn._viewMatrixProperty=O.getPropertyByName("u_viewMat"),vn._projectionMatrixProperty=O.getPropertyByName("u_projMat"),vn._vpMatrixProperty=O.getPropertyByName("u_VPMat"),vn._inverseViewMatrixProperty=O.getPropertyByName("u_viewInvMat"),vn._inverseProjectionMatrixProperty=O.getPropertyByName("u_projInvMat"),vn._cameraPositionProperty=O.getPropertyByName("u_cameraPos"),vn),v_=U(Nt.prototype,"_frustum",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new B1}}),p_=U(Nt.prototype,"_renderPipeline",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g_=U(Nt.prototype,"_frustumViewChangeFlag",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m_=U(Nt.prototype,"_transform",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y_=U(Nt.prototype,"_isViewMatrixDirty",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x_=U(Nt.prototype,"_isInvViewProjDirty",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w_=U(Nt.prototype,"_projectionMatrix",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),S_=U(Nt.prototype,"_viewMatrix",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),C_=U(Nt.prototype,"_viewport",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ee(0,0,1,1)}}),P_=U(Nt.prototype,"_inverseProjectionMatrix",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),A_=U(Nt.prototype,"_lastAspectSize",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $(0,0)}}),T_=U(Nt.prototype,"_invViewProjMat",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),Nt))||__),Xw={json:"json",gltf:"json",mtl:"json",prefab:"json",txt:"text",bin:"arraybuffer",png:"image",webp:"image",jpg:"image"},$w=1,qw=1/0,Yw=500;function oo(t,a){return a===void 0&&(a={}),new Xe(function(i,r,e){var n,o,s,l,u=(n=a.retryCount)!=null?n:$w,c=(o=a.retryInterval)!=null?o:Yw;a.timeout=(s=a.timeout)!=null?s:qw,a.type=(l=a.type)!=null?l:Kw(t);var f=a.type==="image"?Qw:Jw,h,d=new Zw(function(){return f(t,a).onProgress(e).then(function(_){i(_),d.stop()}).catch(function(_){return h=_})},u,c);d.start(function(){r(h)})})}function Qw(t,a){return new Xe(function(i,r){var e=a.timeout,n=new Image,o=function(){r(new Error("request "+t+" fail"))};n.onerror=o,n.onabort=o;var s=-1;e!=1/0&&(s=window.setTimeout(function(){r(new Error("request "+t+" timeout"))},e)),n.onload=function(l){return function(){requestAnimationFrame(function(){i(n),n.onload=null,n.onerror=null,n.onabort=null}),clearTimeout(l)}}(s),n.crossOrigin="anonymous",n.src=t})}function Jw(t,a){return new Xe(function(i,r,e){var n,o=new XMLHttpRequest;o.timeout=a.timeout,a.method=(n=a.method)!=null?n:"get",o.onload=function(){var l;if(o.status<200||o.status>=300){r(new Error("request failed from: "+t));return}var u=(l=o.response)!=null?l:o.responseText;i(u)},o.onerror=function(){r(new Error("request failed from: "+t))},o.ontimeout=function(){r(new Error("request timeout from: "+t))},o.onprogress=function(l){e(l.loaded/l.total)},o.open(a.method,t,!0),o.withCredentials=a.credentials==="include",o.responseType=a.type;var s=a.headers;s&&Object.keys(s).forEach(function(l){o.setRequestHeader(l,s[l])}),o.send(a.body)})}function Kw(t){var a=t.substring(t.lastIndexOf(".")+1);return Xw[a]}var Zw=function(){function t(i,r,e){this.execFunc=i,this.totalCount=r,this.interval=e,this._timeoutId=-100,this._currentCount=0,this.done=void 0,this.exec=this.exec.bind(this)}var a=t.prototype;return a.start=function(r){this.done=r,this.exec()},a.stop=function(){clearTimeout(this._timeoutId)},a.exec=function(){var r=this;if(this._currentCount>=this.totalCount){this.done&&this.done();return}this._currentCount++,this.execFunc(this._currentCount).then(function(){r._timeoutId=setTimeout(r.exec,r.interval)})},t}(),ke=function(){t.registerClass=function(i,r){this._engineObjects[i]=r},t.getClass=function(i){return this._engineObjects[i]};function t(a){this.useCache=a,this.request=oo}return t}();ke._engineObjects={};var je;(function(t){t.Text="text",t.JSON="json",t.Buffer="buffer",t.Texture2D="texture2d",t.TextureCube="texture-cube",t.Material="material",t.Mesh="mesh",t.AnimationClip="AnimationClip",t.AnimatorController="AnimatorController",t.Prefab="prefab",t.KTX="ktx",t.KTXCube="ktx-cube",t.Sprite="sprite",t.SpriteAtlas="sprite-atlas",t.Env="environment",t.Scene="scene",t.HDR="HDR"})(je||(je={}));var Jr;(function(t){t[t.Front=0]="Front",t[t.Back=1]="Back",t[t.Double=2]="Double"})(Jr||(Jr={}));var ia;(function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive"})(ia||(ia={}));var Dn;(function(t){t[t.UV0=0]="UV0",t[t.UV1=1]="UV1",t[t.UV2=2]="UV2",t[t.UV3=3]="UV3",t[t.UV4=4]="UV4",t[t.UV5=5]="UV5",t[t.UV6=6]="UV6",t[t.UV7=7]="UV7"})(Dn||(Dn={}));var Tt=function(t){q(a,t);function a(r,e){var n;return n=t.call(this,r,e)||this,n._renderFace=Jr.Front,n._isTransparent=!1,n._blendMode=void 0,n.blendMode=ia.Normal,n.shaderData.setFloat(a._alphaCutoffProp,0),n}var i=a.prototype;return i.clone=function(){var e=new a(this._engine,this.shader);return this.cloneTo(e),e},i.cloneTo=function(e){t.prototype.cloneTo.call(this,e),e._renderFace=this._renderFace,e._isTransparent=this._isTransparent,e._blendMode=this._blendMode},Y(a,[{key:"isTransparent",get:function(){return this._isTransparent},set:function(e){if(e!==this._isTransparent){this._isTransparent=e;var n=this.renderState,o=n.depthState,s=n.blendState.targetBlendState;e?(s.enabled=!0,o.writeEnabled=!1,this.renderQueueType=_t.Transparent):(s.enabled=!1,o.writeEnabled=!0,this.renderQueueType=this.shaderData.getFloat(a._alphaCutoffProp)?_t.AlphaTest:_t.Opaque)}}},{key:"alphaCutoff",get:function(){return this.shaderData.getFloat(a._alphaCutoffProp)},set:function(e){this.shaderData.setFloat(a._alphaCutoffProp,e),e>0?(this.shaderData.enableMacro(a._alphaCutoffMacro),this.renderQueueType=this._isTransparent?_t.Transparent:_t.AlphaTest):(this.shaderData.disableMacro(a._alphaCutoffMacro),this.renderQueueType=this._isTransparent?_t.Transparent:_t.Opaque)}},{key:"renderFace",get:function(){return this._renderFace},set:function(e){if(e!==this._renderFace)switch(this._renderFace=e,e){case Jr.Front:this.renderState.rasterState.cullMode=Qt.Back;break;case Jr.Back:this.renderState.rasterState.cullMode=Qt.Front;break;case Jr.Double:this.renderState.rasterState.cullMode=Qt.Off;break}}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){if(e!==this._blendMode){this._blendMode=e;var n=this.renderState.blendState.targetBlendState;switch(e){case ia.Normal:n.sourceColorBlendFactor=ae.SourceAlpha,n.destinationColorBlendFactor=ae.OneMinusSourceAlpha,n.sourceAlphaBlendFactor=ae.One,n.destinationAlphaBlendFactor=ae.OneMinusSourceAlpha,n.colorBlendOperation=n.alphaBlendOperation=Xt.Add;break;case ia.Additive:n.sourceColorBlendFactor=ae.SourceAlpha,n.destinationColorBlendFactor=ae.One,n.sourceAlphaBlendFactor=ae.One,n.destinationAlphaBlendFactor=ae.OneMinusSourceAlpha,n.colorBlendOperation=n.alphaBlendOperation=Xt.Add;break}}}}]),a}(Ar);Tt._baseColorProp=O.getPropertyByName("u_baseColor");Tt._baseTextureProp=O.getPropertyByName("u_baseTexture");Tt._baseTextureMacro=O.getMacroByName("BASETEXTURE");Tt._tilingOffsetProp=O.getPropertyByName("u_tilingOffset");Tt._normalTextureProp=O.getPropertyByName("u_normalTexture");Tt._normalIntensityProp=O.getPropertyByName("u_normalIntensity");Tt._normalTextureMacro=O.getMacroByName("NORMALTEXTURE");Tt._emissiveColorProp=O.getPropertyByName("u_emissiveColor");Tt._emissiveTextureProp=O.getPropertyByName("u_emissiveTexture");Tt._emissiveTextureMacro=O.getMacroByName("EMISSIVETEXTURE");Tt._alphaCutoffProp=O.getPropertyByName("u_alphaCutoff");Tt._alphaCutoffMacro=O.getMacroByName("ALPHA_CUTOFF");var Pa=function(t){q(a,t);function a(r){var e;e=t.call(this,r,O.find("blinn-phong"))||this;var n=e.shaderData;return n.enableMacro("O3_NEED_WORLDPOS"),n.enableMacro("O3_NEED_TILINGOFFSET"),n.setColor(a._baseColorProp,new ne(1,1,1,1)),n.setColor(a._specularColorProp,new ne(1,1,1,1)),n.setColor(a._emissiveColorProp,new ne(0,0,0,1)),n.setVector4(a._tilingOffsetProp,new Ee(1,1,0,0)),n.setFloat(a._shininessProp,16),n.setFloat(a._normalIntensityProp,1),e}var i=a.prototype;return i.clone=function(){var e=new a(this._engine);return this.cloneTo(e),e},Y(a,[{key:"baseColor",get:function(){return this.shaderData.getColor(a._baseColorProp)},set:function(e){var n=this.shaderData.getColor(a._baseColorProp);e!==n&&n.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(a._baseTextureProp)},set:function(e){this.shaderData.setTexture(a._baseTextureProp,e),e?this.shaderData.enableMacro(a._baseTextureMacro):this.shaderData.disableMacro(a._baseTextureMacro)}},{key:"specularColor",get:function(){return this.shaderData.getColor(a._specularColorProp)},set:function(e){var n=this.shaderData.getColor(a._specularColorProp);e!==n&&n.copyFrom(e)}},{key:"specularTexture",get:function(){return this.shaderData.getTexture(a._specularTextureProp)},set:function(e){this.shaderData.setTexture(a._specularTextureProp,e),e?this.shaderData.enableMacro("O3_SPECULAR_TEXTURE"):this.shaderData.disableMacro("O3_SPECULAR_TEXTURE")}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(a._emissiveColorProp)},set:function(e){var n=this.shaderData.getColor(a._emissiveColorProp);e!==n&&n.copyFrom(e)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(a._emissiveTextureProp)},set:function(e){this.shaderData.setTexture(a._emissiveTextureProp,e),e?this.shaderData.enableMacro(a._emissiveTextureMacro):this.shaderData.disableMacro(a._emissiveTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(a._normalTextureProp)},set:function(e){this.shaderData.setTexture(a._normalTextureProp,e),e?this.shaderData.enableMacro(a._normalTextureMacro):this.shaderData.disableMacro(a._normalTextureMacro)}},{key:"normalIntensity",get:function(){return this.shaderData.getFloat(a._normalIntensityProp)},set:function(e){this.shaderData.setFloat(a._normalIntensityProp,e)}},{key:"shininess",get:function(){return this.shaderData.getFloat(a._shininessProp)},set:function(e){this.shaderData.setFloat(a._shininessProp,Math.max(e,1e-4))}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(a._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(a._tilingOffsetProp);e!==n&&n.copyFrom(e)}}]),a}(Tt);Pa._specularColorProp=O.getPropertyByName("u_specularColor");Pa._shininessProp=O.getPropertyByName("u_shininess");Pa._specularTextureProp=O.getPropertyByName("u_specularTexture");var Mr=function(t){q(a,t);function a(i,r){var e;e=t.call(this,i,r)||this;var n=e.shaderData;return n.enableMacro("O3_NEED_WORLDPOS"),n.enableMacro("O3_NEED_TILINGOFFSET"),n.setColor(a._baseColorProp,new ne(1,1,1,1)),n.setColor(a._emissiveColorProp,new ne(0,0,0,1)),n.setVector4(a._tilingOffsetProp,new Ee(1,1,0,0)),n.setFloat(a._normalIntensityProp,1),n.setFloat(a._occlusionTextureIntensityProp,1),n.setFloat(a._occlusionTextureCoordProp,Dn.UV0),n.setFloat(a._clearCoatProp,0),n.setFloat(a._clearCoatRoughnessProp,0),e}return Y(a,[{key:"baseColor",get:function(){return this.shaderData.getColor(a._baseColorProp)},set:function(r){var e=this.shaderData.getColor(a._baseColorProp);r!==e&&e.copyFrom(r)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(a._baseTextureProp)},set:function(r){this.shaderData.setTexture(a._baseTextureProp,r),r?this.shaderData.enableMacro(a._baseTextureMacro):this.shaderData.disableMacro(a._baseTextureMacro)}},{key:"normalTexture",get:function(){return this.shaderData.getTexture(a._normalTextureProp)},set:function(r){this.shaderData.setTexture(a._normalTextureProp,r),r?this.shaderData.enableMacro(a._normalTextureMacro):this.shaderData.disableMacro(a._normalTextureMacro)}},{key:"normalTextureIntensity",get:function(){return this.shaderData.getFloat(a._normalIntensityProp)},set:function(r){this.shaderData.setFloat(a._normalIntensityProp,r)}},{key:"emissiveColor",get:function(){return this.shaderData.getColor(a._emissiveColorProp)},set:function(r){var e=this.shaderData.getColor(a._emissiveColorProp);r!==e&&e.copyFrom(r)}},{key:"emissiveTexture",get:function(){return this.shaderData.getTexture(a._emissiveTextureProp)},set:function(r){this.shaderData.setTexture(a._emissiveTextureProp,r),r?this.shaderData.enableMacro(a._emissiveTextureMacro):this.shaderData.disableMacro(a._emissiveTextureMacro)}},{key:"occlusionTexture",get:function(){return this.shaderData.getTexture(a._occlusionTextureProp)},set:function(r){this.shaderData.setTexture(a._occlusionTextureProp,r),r?this.shaderData.enableMacro("OCCLUSIONTEXTURE"):this.shaderData.disableMacro("OCCLUSIONTEXTURE")}},{key:"occlusionTextureIntensity",get:function(){return this.shaderData.getFloat(a._occlusionTextureIntensityProp)},set:function(r){this.shaderData.setFloat(a._occlusionTextureIntensityProp,r)}},{key:"occlusionTextureCoord",get:function(){return this.shaderData.getFloat(a._occlusionTextureCoordProp)},set:function(r){r>Dn.UV1&&de.warn("Occlusion texture uv coordinate must be UV0 or UV1."),this.shaderData.setFloat(a._occlusionTextureCoordProp,r)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(a._tilingOffsetProp)},set:function(r){var e=this.shaderData.getVector4(a._tilingOffsetProp);r!==e&&e.copyFrom(r)}},{key:"clearCoat",get:function(){return this.shaderData.getFloat(a._clearCoatProp)},set:function(r){!!this.shaderData.getFloat(a._clearCoatProp)!=!!r&&(r===0?this.shaderData.disableMacro("CLEARCOAT"):this.shaderData.enableMacro("CLEARCOAT")),this.shaderData.setFloat(a._clearCoatProp,r)}},{key:"clearCoatTexture",get:function(){return this.shaderData.getTexture(a._clearCoatTextureProp)},set:function(r){this.shaderData.setTexture(a._clearCoatTextureProp,r),r?this.shaderData.enableMacro("HAS_CLEARCOATTEXTURE"):this.shaderData.disableMacro("HAS_CLEARCOATTEXTURE")}},{key:"clearCoatRoughness",get:function(){return this.shaderData.getFloat(a._clearCoatRoughnessProp)},set:function(r){this.shaderData.setFloat(a._clearCoatRoughnessProp,r)}},{key:"clearCoatRoughnessTexture",get:function(){return this.shaderData.getTexture(a._clearCoatRoughnessTextureProp)},set:function(r){this.shaderData.setTexture(a._clearCoatRoughnessTextureProp,r),r?this.shaderData.enableMacro("HAS_CLEARCOATROUGHNESSTEXTURE"):this.shaderData.disableMacro("HAS_CLEARCOATROUGHNESSTEXTURE")}},{key:"clearCoatNormalTexture",get:function(){return this.shaderData.getTexture(a._clearCoatNormalTextureProp)},set:function(r){this.shaderData.setTexture(a._clearCoatNormalTextureProp,r),r?this.shaderData.enableMacro("HAS_CLEARCOATNORMALTEXTURE"):this.shaderData.disableMacro("HAS_CLEARCOATNORMALTEXTURE")}}]),a}(Tt);Mr._occlusionTextureIntensityProp=O.getPropertyByName("u_occlusionIntensity");Mr._occlusionTextureCoordProp=O.getPropertyByName("u_occlusionTextureCoord");Mr._occlusionTextureProp=O.getPropertyByName("u_occlusionTexture");Mr._clearCoatProp=O.getPropertyByName("u_clearCoat");Mr._clearCoatTextureProp=O.getPropertyByName("u_clearCoatTexture");Mr._clearCoatRoughnessProp=O.getPropertyByName("u_clearCoatRoughness");Mr._clearCoatRoughnessTextureProp=O.getPropertyByName("u_clearCoatRoughnessTexture");Mr._clearCoatNormalTextureProp=O.getPropertyByName("u_clearCoatNormalTexture");var Aa=function(t){q(a,t);function a(r){var e;return e=t.call(this,r,O.find("pbr"))||this,e.shaderData.setFloat(a._metallicProp,1),e.shaderData.setFloat(a._roughnessProp,1),e}var i=a.prototype;return i.clone=function(){var e=new a(this._engine);return this.cloneTo(e),e},Y(a,[{key:"metallic",get:function(){return this.shaderData.getFloat(a._metallicProp)},set:function(e){this.shaderData.setFloat(a._metallicProp,e)}},{key:"roughness",get:function(){return this.shaderData.getFloat(a._roughnessProp)},set:function(e){this.shaderData.setFloat(a._roughnessProp,e)}},{key:"roughnessMetallicTexture",get:function(){return this.shaderData.getTexture(a._roughnessMetallicTextureProp)},set:function(e){this.shaderData.setTexture(a._roughnessMetallicTextureProp,e),e?this.shaderData.enableMacro("ROUGHNESSMETALLICTEXTURE"):this.shaderData.disableMacro("ROUGHNESSMETALLICTEXTURE")}}]),a}(Mr);Aa._metallicProp=O.getPropertyByName("u_metal");Aa._roughnessProp=O.getPropertyByName("u_roughness");Aa._roughnessMetallicTextureProp=O.getPropertyByName("u_roughnessMetallicTexture");var Ti=function(t){q(a,t);function a(r){var e;return e=t.call(this,r,O.find("pbr-specular"))||this,e.shaderData.setColor(a._specularColorProp,new ne(1,1,1,1)),e.shaderData.setFloat(a._glossinessProp,1),e}var i=a.prototype;return i.clone=function(){var e=new a(this._engine);return this.cloneTo(e),e},Y(a,[{key:"specularColor",get:function(){return this.shaderData.getColor(a._specularColorProp)},set:function(e){var n=this.shaderData.getColor(a._specularColorProp);e!==n&&n.copyFrom(e)}},{key:"glossiness",get:function(){return this.shaderData.getFloat(a._glossinessProp)},set:function(e){this.shaderData.setFloat(a._glossinessProp,e)}},{key:"specularGlossinessTexture",get:function(){return this.shaderData.getTexture(a._specularGlossinessTextureProp)},set:function(e){this.shaderData.setTexture(a._specularGlossinessTextureProp,e),e?this.shaderData.enableMacro(a._specularGlossinessTextureMacro):this.shaderData.disableMacro(a._specularGlossinessTextureMacro)}}]),a}(Mr);Ti._specularColorProp=O.getPropertyByName("u_PBRSpecularColor");Ti._glossinessProp=O.getPropertyByName("u_glossiness");Ti._specularGlossinessTextureProp=O.getPropertyByName("u_specularGlossinessTexture");Ti._specularGlossinessTextureMacro=O.getMacroByName("SPECULARGLOSSINESSTEXTURE");var hf=function(t){q(a,t);function a(r){var e;e=t.call(this,r,O.find("unlit"))||this;var n=e.shaderData;return n.enableMacro("OMIT_NORMAL"),n.enableMacro("O3_NEED_TILINGOFFSET"),n.setColor(a._baseColorProp,new ne(1,1,1,1)),n.setVector4(a._tilingOffsetProp,new Ee(1,1,0,0)),e}var i=a.prototype;return i.clone=function(){var e=new a(this._engine);return this.cloneTo(e),e},Y(a,[{key:"baseColor",get:function(){return this.shaderData.getColor(a._baseColorProp)},set:function(e){var n=this.shaderData.getColor(a._baseColorProp);e!==n&&n.copyFrom(e)}},{key:"baseTexture",get:function(){return this.shaderData.getTexture(a._baseTextureProp)},set:function(e){this.shaderData.setTexture(a._baseTextureProp,e),e?this.shaderData.enableMacro(a._baseTextureMacro):this.shaderData.disableMacro(a._baseTextureMacro)}},{key:"tilingOffset",get:function(){return this.shaderData.getVector4(a._tilingOffsetProp)},set:function(e){var n=this.shaderData.getVector4(a._tilingOffsetProp);e!==n&&n.copyFrom(e)}}]),a}(Tt),hi;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(hi||(hi={}));var di;(function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Bottom=2]="Bottom"})(di||(di={}));var wi;(function(t){t[t.Overflow=0]="Overflow",t[t.Truncate=1]="Truncate"})(wi||(wi={}));var An;(function(t){t[t.None=0]="None",t[t.Bold=1]="Bold",t[t.Italic=2]="Italic"})(An||(An={}));var im=function(t){q(i,t);var a=i.prototype;a.getSprite=function(e){var n=this._sprites[this._spriteNamesToIndex[e]];return n||console.warn("There is no sprite named "+e+" in the atlas."),n},a.getSprites=function(e,n){n.length=0;var o=this._spriteNamesToIndex[e];if(o!==void 0)for(var s=this._sprites;o>=0;o--){var l=s[o];l.name===e&&n.push(l)}else console.warn("The name of the sprite you want to find is not exit in SpriteAtlas.");return n};function i(r){var e;return e=t.call(this,r)||this,e._sprites=new Array,e._spriteNamesToIndex={},e}return a._addSprite=function(e){this._spriteNamesToIndex[e.name]=this._sprites.push(e)-1},a._onDestroy=function(){this._sprites=null,this._spriteNamesToIndex=null},Y(i,[{key:"sprites",get:function(){return this._sprites}}]),i}(un),xn;(function(t){t[t.Simple=0]="Simple",t[t.Sliced=1]="Sliced"})(xn||(xn={}));var df=function(t){q(a,t);function a(r,e,n,o,s,l){var u;return e===void 0&&(e=null),n===void 0&&(n=null),o===void 0&&(o=null),s===void 0&&(s=null),l===void 0&&(l=null),u=t.call(this,r)||this,u.name=void 0,u._assetID=void 0,u._width=void 0,u._height=void 0,u._positions=[new $,new $,new $,new $],u._uvs=[new $,new $,new $,new $],u._bounds=new Gr,u._texture=null,u._atlasRotated=!1,u._atlasRegion=new $u(0,0,1,1),u._atlasRegionOffset=new Ee(0,0,0,0),u._region=new $u(0,0,1,1),u._pivot=new $(.5,.5),u._border=new Ee(0,0,0,0),u._dirtyFlag=Fr.all,u._updateFlagManager=new fa,u._texture=e,n&&u._region.copyFrom(n),o&&u._pivot.copyFrom(o),s&&u._border.copyFrom(s),u.name=l,u}var i=a.prototype;return i.clone=function(){var e=new a(this._engine,this._texture,this._region,this._pivot,this._border,this.name);return e._assetID=this._assetID,e._atlasRotated=this._atlasRotated,e._atlasRegion.copyFrom(this._atlasRegion),e._atlasRegionOffset.copyFrom(this._atlasRegionOffset),e},i._registerUpdateFlag=function(){return this._updateFlagManager.createFlag(vl)},i._getPositions=function(){return this._dirtyFlag&Fr.positions&&this._updatePositions(),this._positions},i._getUVs=function(){return this._dirtyFlag&Fr.uvs&&this._updateUVs(),this._uvs},i._getBounds=function(){return this._dirtyFlag&Fr.positions&&this._updatePositions(),this._bounds},i._onDestroy=function(){this._texture&&(this._texture=null)},i._calDefaultSize=function(){if(this._texture){var e=this._texture,n=this._atlasRegion,o=this._atlasRegionOffset,s=this._region,l=1/Er._pixelsPerUnit;this.width=e.width*n.width/(1-o.x-o.z)*s.width*l,this.height=e.height*n.height/(1-o.y-o.w)*s.height*l}},i._updatePositions=function(){var e=this._atlasRegionOffset,n=this._region,o=n.x,s=n.y,l=n.width,u=n.height,c=1-o-l,f=1-s-u,h=Math.max(e.x-o,0)/l,d=Math.max(e.w-s,0)/u,_=1-Math.max(e.z-c,0)/l,m=1-Math.max(e.y-f,0)/u,p=this._positions;p[0].set(h,d),p[1].set(_,d),p[2].set(h,m),p[3].set(_,m);var v=this._bounds,g=v.min,y=v.max;g.set(h,d,0),y.set(_,m,0),this._dirtyFlag&=~Fr.positions},i._updateUVs=function(){var e=this._uvs,n=this._atlasRegionOffset,o=this._region,s=o.x,l=o.y,u=o.width,c=o.height,f=1-s-u,h=1-l-c,d=this._atlasRegion,_=d.x,m=d.y,p=d.width,v=d.height,g=n.x,y=n.y,x=n.z,P=n.w,S=p/(1-g-x),w=v/(1-y-P),b=Math.max(s-g,0)*S+_,E=Math.max(h-y,0)*w+m,M=p+_-Math.max(f-x,0)*S,F=v+m-Math.max(l-P,0)*w,A=this._border,T=A.x,R=A.y,z=A.z,L=A.w;e[0].set(b,F),e[1].set((s-g+T*u)*S+_,v+m-(l-P+R*c)*w),e[2].set(p+_-(f-x+z*u)*S,(h-y+L*c)*w+m),e[3].set(M,E),this._dirtyFlag&=~Fr.uvs},i._dispatchSpriteChange=function(e){switch(e){case ze.atlasRegionOffset:case ze.region:this._dirtyFlag|=Fr.all;break;case ze.atlasRegion:case ze.border:this._dirtyFlag|=Fr.uvs;break}this._updateFlagManager.dispatch(e)},Y(a,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._dispatchSpriteChange(ze.texture))}},{key:"width",get:function(){return this._width===void 0&&this._calDefaultSize(),this._width},set:function(e){this._width!==e&&(this._width=e,this._dispatchSpriteChange(ze.size))}},{key:"height",get:function(){return this._height===void 0&&this._calDefaultSize(),this._height},set:function(e){this._height!==e&&(this._height=e,this._dispatchSpriteChange(ze.size))}},{key:"atlasRotated",get:function(){return this._atlasRotated},set:function(e){this._atlasRotated!=e&&(this._atlasRotated=e)}},{key:"atlasRegion",get:function(){return this._atlasRegion},set:function(e){var n=W.clamp(e.x,0,1),o=W.clamp(e.y,0,1);this._atlasRegion.set(n,o,W.clamp(e.width,0,1-n),W.clamp(e.height,0,1-o)),this._dispatchSpriteChange(ze.atlasRegion)}},{key:"atlasRegionOffset",get:function(){return this._atlasRegionOffset},set:function(e){var n=W.clamp(e.x,0,1),o=W.clamp(e.y,0,1);this._atlasRegionOffset.set(n,o,W.clamp(e.z,0,1-n),W.clamp(e.w,0,1-o)),this._dispatchSpriteChange(ze.atlasRegionOffset)}},{key:"region",get:function(){return this._region},set:function(e){var n=this._region,o=W.clamp(e.x,0,1),s=W.clamp(e.y,0,1);n.set(o,s,W.clamp(e.width,0,1-o),W.clamp(e.height,0,1-s)),this._dispatchSpriteChange(ze.region)}},{key:"pivot",get:function(){return this._pivot},set:function(e){var n=this._pivot;if(n===e)this._dispatchSpriteChange(ze.pivot);else{var o=e.x,s=e.y;(n.x!==o||n.y!==s)&&(n.set(o,s),this._dispatchSpriteChange(ze.pivot))}}},{key:"border",get:function(){return this._border},set:function(e){var n=this._border,o=W.clamp(e.x,0,1),s=W.clamp(e.y,0,1);n.set(o,s,W.clamp(e.z,0,1-o),W.clamp(e.w,0,1-s)),this._dispatchSpriteChange(ze.border)}}]),a}(un),Fr;(function(t){t[t.positions=1]="positions",t[t.uvs=2]="uvs",t[t.all=3]="all"})(Fr||(Fr={}));var b_,E_,eu,eS=(b_=Y0(),b_(E_=(eu=function(){function t(){}return t.resetData=function(i){var r=i._renderData,e=r.positions,n=r.uvs;if(e.length<16)for(var o=e.length;o<16;o++)e.push(new C),n.push(new $);r.triangles=[]},t.updatePositions=function(i){var r=i.width,e=i.height,n=i.sprite,o=i._renderData,s=o.positions,l=o.uvs,u=o.triangles,c=n.border,f=n._getUVs(),h=n._getPositions(),d=h[0],_=d.x,m=d.y,p=h[3],v=p.x,g=p.y,y=n.width,x=n.height,P=y*c.x,S=x*c.y,w=x*c.z,b=y*c.w,E,M;if(P+w>r){var F=r/(P+w);E=[y*_*F,P*F,P*F,r-y*(1-v)*F]}else E=[y*_,P,r-w,r-y*(1-v)];if(b+S>e){var A=e/(b+S);M=[x*m*A,S*A,S*A,e-x*(1-g)*A]}else M=[x*m,S,e-b,e-x*(1-g)];var T=i.sprite.pivot,R=T.x,z=T.y,L=i.width*R,N=i.height*z,V=t._worldMatrix,D=V.elements,j=i.entity.transform.worldMatrix.elements,I=i.flipX?-1:1,H=i.flipY?-1:1;D[0]=j[0]*I,D[1]=j[1]*I,D[2]=j[2]*I,D[4]=j[4]*H,D[5]=j[5]*H,D[6]=j[6]*H,D[8]=j[8],D[9]=j[9],D[10]=j[10],D[12]=j[12]-L*D[0]-N*D[4],D[13]=j[13]-L*D[1]-N*D[5],D[14]=j[14]-L*D[2]-N*D[6];for(var G=0,te=0,ie=0;ie<4;ie++){for(var fe=E[ie],ce=f[ie].x,me=0;me<4;me++){var Me=M[me];s[G].set(D[0]*fe+D[4]*Me+D[12],D[1]*fe+D[5]*Me+D[13],D[2]*fe+D[6]*Me+D[14]),l[G].set(ce,f[me].y),++G}++te}for(var Ae=G/te,Oe=0,$e=0;$e<te-1;++$e)for(var Je=0;Je<Ae-1;++Je){var Te=$e*Ae+Je;u[Oe++]=Te,u[Oe++]=Te+1,u[Oe++]=Te+Ae,u[Oe++]=Te+1,u[Oe++]=Te+Ae+1,u[Oe++]=Te+Ae}i._renderData.vertexCount=te*Ae,u.length=(te-1)*(Ae-1)*6;var Ze=i._bounds,et=Ze.min,qe=Ze.max;et.set(E[0],M[0],0),qe.set(E[3],M[3],0),i._bounds.transform(V)},t.updateUVs=function(i){},t}(),eu._worldMatrix=new re,eu))||E_),Mt,M_,R_,F_,z_,L_,B_,D_,O_,I_,N_,k_,U_,V_,tu,tS=(Mt=(tu=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,k(e,"_renderData",M_,B(e)),k(e,"_drawMode",R_,B(e)),k(e,"_assembler",F_,B(e)),k(e,"_color",z_,B(e)),k(e,"_sprite",L_,B(e)),k(e,"_width",B_,B(e)),k(e,"_height",D_,B(e)),k(e,"_flipX",O_,B(e)),k(e,"_flipY",I_,B(e)),k(e,"_maskLayer",N_,B(e)),k(e,"_maskInteraction",k_,B(e)),k(e,"_dirtyFlag",U_,B(e)),k(e,"_spriteChangeFlag",V_,B(e)),e._renderData=new of(4,[],[],null,e._color),e.drawMode=xn.Simple,e.setMaterial(e._engine._spriteDefaultMaterial),e._onSpriteChange=e._onSpriteChange.bind(B(e)),e}var i=a.prototype;return i._render=function(e){var n;if(!(!((n=this.sprite)!==null&&n!==void 0&&n.texture)||!this.width||!this.height)){(this._transformChangeFlag.flag||this._dirtyFlag&rt.Position)&&(this._assembler.updatePositions(this),this._dirtyFlag&=~rt.Position,this._transformChangeFlag.flag=!1),this._dirtyFlag&rt.UV&&(this._assembler.updateUVs(this),this._dirtyFlag&=~rt.UV);var o=this._engine._spriteElementPool.getFromPool();o.setValue(this,this._renderData,this.getMaterial(),this.sprite.texture),e._renderPipeline.pushPrimitive(o)}},i._cloneTo=function(e){e.sprite=this._sprite},i._onDestroy=function(){this._color=null,this._sprite=null,this._assembler=null,this._renderData=null,this._spriteChangeFlag&&(this._spriteChangeFlag.destroy(),this._spriteChangeFlag=null),t.prototype._onDestroy.call(this)},i._updateStencilState=function(){var e=this.getInstanceMaterial(),n=e.renderState.stencilState,o=this._maskInteraction;if(o===ar.None)n.enabled=!1,n.writeMask=255,n.referenceValue=0,n.compareFunctionFront=n.compareFunctionBack=Pe.Always;else{n.enabled=!0,n.writeMask=0,n.referenceValue=1;var s=o===ar.VisibleInsideMask?Pe.LessEqual:Pe.Greater;n.compareFunctionFront=s,n.compareFunctionBack=s}},i._onSpriteChange=function(e){switch(e){case ze.texture:this.shaderData.setTexture(a._textureProperty,this.sprite.texture);break;case ze.size:this._drawMode===xn.Sliced&&(this._dirtyFlag|=rt.Position);break;case ze.border:this._drawMode===xn.Sliced&&(this._dirtyFlag|=rt.All);break;case ze.region:case ze.atlasRegionOffset:this._dirtyFlag|=rt.All;break;case ze.atlasRegion:this._dirtyFlag|=rt.UV;break;case ze.pivot:this._dirtyFlag|=rt.Position;break}},Y(a,[{key:"drawMode",get:function(){return this._drawMode},set:function(e){if(this._drawMode!==e){switch(this._drawMode=e,e){case xn.Simple:this._assembler=ja;break;case xn.Sliced:this._assembler=eS;break}this._assembler.resetData(this),this._dirtyFlag|=rt.All}}},{key:"sprite",get:function(){return this._sprite},set:function(e){this._sprite!==e&&(this._sprite=e,this._spriteChangeFlag&&this._spriteChangeFlag.destroy(),e?(this._spriteChangeFlag=e._registerUpdateFlag(),this._spriteChangeFlag.listener=this._onSpriteChange,this._dirtyFlag|=rt.All,this.shaderData.setTexture(a._textureProperty,e.texture)):(this._spriteChangeFlag=null,this.shaderData.setTexture(a._textureProperty,null)))}},{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"width",get:function(){return this._width===void 0&&this._sprite&&(this.width=this._sprite.width),this._width},set:function(e){this._width!==e&&(this._width=e,this._dirtyFlag|=rt.Position)}},{key:"height",get:function(){return this._height===void 0&&this._sprite&&(this.height=this._sprite.height),this._height},set:function(e){this._height!==e&&(this._height=e,this._dirtyFlag|=rt.Position)}},{key:"flipX",get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._dirtyFlag|=rt.Position)}},{key:"flipY",get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._dirtyFlag|=rt.Position)}},{key:"bounds",get:function(){var e;return!((e=this.sprite)!==null&&e!==void 0&&e.texture)||!this.width||!this.height?Er._defaultBoundingBox:((this._transformChangeFlag.flag||this._dirtyFlag&rt.Position)&&(this._assembler.updatePositions(this),this._dirtyFlag&=~rt.Position,this._transformChangeFlag.flag=!1),this._bounds)}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._updateStencilState())}}]),a}(Go),tu._textureProperty=O.getPropertyByName("u_spriteTexture"),tu),M_=U(Mt.prototype,"_renderData",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=U(Mt.prototype,"_drawMode",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_=U(Mt.prototype,"_assembler",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z_=U(Mt.prototype,"_color",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ne(1,1,1,1)}}),L_=U(Mt.prototype,"_sprite",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B_=U(Mt.prototype,"_width",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),D_=U(Mt.prototype,"_height",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),O_=U(Mt.prototype,"_flipX",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),I_=U(Mt.prototype,"_flipY",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),N_=U(Mt.prototype,"_maskLayer",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return da.Layer0}}),k_=U(Mt.prototype,"_maskInteraction",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ar.None}}),U_=U(Mt.prototype,"_dirtyFlag",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),V_=U(Mt.prototype,"_spriteChangeFlag",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mt),rt;(function(t){t[t.Position=1]="Position",t[t.UV=2]="UV",t[t.All=3]="All"})(rt||(rt={}));var rS=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,e._charInfoMap={},e._texture=void 0,e._space=1,e._curX=1,e._curY=1,e._nextY=1,e}var i=a.prototype;return i._onDestroy=function(){this._texture.destroy(),this._texture=null,this._charInfoMap={}},i.uploadCharTexture=function(e){var n=e.w,o=e.h,s=e.data,l=this._space,u=this.texture,c=u.width,f=n+l,h=o+l;if(1+f>=c||1+h>=c)throw Error("The char fontSize is too large.");var d=this._curX+f;d>=c&&(this._curX=l,this._curY=this._nextY+l);var _=this._curY+h;if(_>this._nextY&&(this._nextY=_),_>=c)return!1;n>0&&o>0&&s&&(u.setPixelBuffer(s,0,this._curX,this._curY,n,o),u.generateMipmaps());var m=1/c,p=this._curX,v=this._curY,g=n,y=o,x=p*m,P=(p+g)*m,S=v*m,w=(v+y)*m;e.x=p,e.y=v;var b=e.uvs;return b[0].set(x,S),b[1].set(P,S),b[2].set(P,w),b[3].set(x,w),this._curX+=f+l,!0},i.addCharInfo=function(e,n){this._charInfoMap[e.charCodeAt(0)]=n},i.getCharInfo=function(e){return this._charInfoMap[e.charCodeAt(0)]},Y(a,[{key:"texture",get:function(){return this._texture},set:function(e){this._texture=e}}]),a}(un),Qs=function(t){q(a,t),a.createFromOS=function(e,n){n===void 0&&(n="");var o=a._fontMap,s=o[n];return s||(s=new a(e,n),o[n]=s,s)};function a(r,e){var n;return e===void 0&&(e=""),n=t.call(this,r)||this,n._name="",n._fontAtlases=[],n._lastIndex=-1,n._name=e,n}var i=a.prototype;return i._uploadCharTexture=function(e){var n=this._fontAtlases,o=this._lastIndex;o===-1&&(this._createFontAtlas(),o++);var s=n[o];s.uploadCharTexture(e)||(s=this._createFontAtlas(),s.uploadCharTexture(e),o++),this._lastIndex=o,e.data=null},i._addCharInfo=function(e,n){var o=this._lastIndex;n.index=o,this._fontAtlases[o].addCharInfo(e,n)},i._getCharInfo=function(e){for(var n=this._fontAtlases,o=0,s=n.length;o<s;++o){var l=n[o],u=l.getCharInfo(e);if(u)return u}return null},i._getTextureByIndex=function(e){var n=this._fontAtlases[e];return n?n.texture:null},i._getLastIndex=function(){return this._lastIndex},i._onDestroy=function(){for(var e=this._fontAtlases,n=0,o=e.length;n<o;++n)e[n].destroy(!0);e.length=0,delete a._fontMap[this._name]},i._createFontAtlas=function(){var e=this.engine,n=new rS(e),o=new cr(e,256,256);return n.texture=o,this._fontAtlases.push(n),n},Y(a,[{key:"name",get:function(){return this._name}}]),a}(un);Qs._fontMap={};var am=function t(){this.texture=void 0,this.localPositions=new Ee,this.renderData=void 0;var a=[new C,new C,new C,new C];this.renderData=new of(4,a,null,t.triangles,null)};am.triangles=[0,2,1,2,0,3];var nS=function(){function t(i,r){this._elements=[],this._type=void 0,this._type=i;for(var e=this._elements,n=0;n<r;++n)e[n]=new i}var a=t.prototype;return a.get=function(){return this._elements.length>0?this._elements.pop():new this._type},a.put=function(r){this._elements.push(r)},t}(),Vr=function(){function t(){}return t.textContext=function(){var i=t._textContext;if(!i){var r;try{r=new OffscreenCanvas(0,0)}catch{r=document.createElement("canvas")}var e=r.getContext("2d");i={canvas:r,context:e},t._textContext=i}return i},t.measureFont=function(i){var r=t._fontSizeInfoCache,e=r[i];return e||(e=t._measureFontOrChar(i),r[i]=e,e)},t.getNativeFontString=function(i,r,e){var n=e&An.Bold?"bold ":"";return e&An.Italic&&(n+="italic "),!/([\"\'])[^\'\"]+\1/.test(i)&&t._genericFontFamilies.indexOf(i)==-1&&(i='"'+i+'"'),n+=r+"px "+i,n},t.measureChar=function(i,r){return t._measureFontOrChar(r,i)},t.measureTextWithWrap=function(i){for(var r=i.fontSize,e=i.fontStyle,n=i.font.name,o=t.getNativeFontString(n,r,e),s=i._styleFont,l=t.measureFont(o),u=i.text.split(/(?:\r\n|\r|\n)/),c=new Array,f=new Array,h=new Array,d=Er._pixelsPerUnit,_=l.size+i.lineSpacing*d,m=i.width*d,p=0,v=0,g=u.length;v<g;++v){for(var y=u[v],x="",P=0,S=-1,w=-1,b=0,E=y.length;b<E;++b){var M=y[b],F=t._getCharInfo(M,o,s),A=F.w,T=F.offsetY,R=F.h*.5,z=R+T,L=R-T;P+A>m?P===0?(c.push(M),f.push(A),h.push({ascent:z,descent:L,size:z+L})):(c.push(x),f.push(P),h.push({ascent:S,descent:w,size:S+w}),x=M,P=F.xAdvance,S=z,w=L):(x+=M,P+=F.xAdvance,S<z&&(S=z),w<L&&(w=L))}P>0&&(c.push(x),f.push(P),h.push({ascent:S,descent:w,size:S+w}))}var N=i.height*d;return i.overflowMode===wi.Overflow&&(N=_*c.length),{width:p,height:N,lines:c,lineWidths:f,lineHeight:_,lineMaxSizes:h}},t.measureTextWithoutWrap=function(i){var r=i.fontSize,e=i.fontStyle,n=i.font.name,o=t.getNativeFontString(n,r,e),s=i._styleFont,l=t.measureFont(o),u=i.text.split(/(?:\r\n|\r|\n)/),c=u.length,f=new Array,h=new Array,d=Er._pixelsPerUnit,_=l.size+i.lineSpacing*d,m=0,p=i.height*d;i.overflowMode===wi.Overflow&&(p=_*c);for(var v=0;v<c;++v){for(var g=u[v],y=0,x=-1,P=-1,S=0,w=g.length;S<w;++S){var b=t._getCharInfo(g[S],o,s);y+=b.xAdvance;var E=b.offsetY,M=b.h*.5,F=M+E,A=M-E;x<F&&(x=F),P<A&&(P=A)}f[v]=y,h[v]={ascent:x,descent:P,size:x+P},y>m&&(m=y)}return{width:m,height:p,lines:u,lineWidths:f,lineHeight:_,lineMaxSizes:h}},t.getNativeFontHash=function(i,r,e){var n=e&An.Bold?"bold":"";return e&An.Italic&&(n+="italic"),!/([\"\'])[^\'\"]+\1/.test(i)&&t._genericFontFamilies.indexOf(i)==-1&&(i=""+i),n+=r+"px"+i,n},t._measureFontOrChar=function(i,r){r===void 0&&(r="");var e=t.textContext(),n=e.canvas,o=e.context;o.font=i;var s=r||t._measureString,l=Math.round(o.measureText(s).width),u=Math.ceil(o.measureText(t._measureBaseline).width),c=u*t._heightMultiplier;u=t._baselineMultiplier*u|0,n.width=l,n.height=c,o.font=i,o.fillStyle="#000",o.clearRect(0,0,l,c),o.textBaseline="middle",o.fillStyle="#fff",o.fillText(s,0,u);for(var f=o.getImageData(0,0,l,c).data,h=f.length,d=-1,_=-1,m,p=0,v=0,g=0,y=n.width,x=1/y,P=0;P<h;P+=4)if(f[P+3]!==0){var S=P*.25;m=~~(S*x),d===-1&&(d=m),m>_&&(_=m)}d!==-1&&_!==-1&&(p=u-d,v=_-u+1,g=p+v);var w={ascent:p,descent:v,size:g};if(r){var b=null;if(g>0){var E=y*4;b=new Uint8Array(f.buffer,d*E,g*E)}return{x:0,y:0,w:l,h:g,offsetX:0,offsetY:(p-v)*.5,xAdvance:l,uvs:[new $,new $,new $,new $],ascent:p,descent:v,index:0,data:b}}else return w},t._getCharInfo=function(i,r,e){var n=e._getCharInfo(i);return n||(n=t.measureChar(i,r),e._uploadCharTexture(n),e._addCharInfo(i,n)),n},t}();Vr._genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui","math","emoji","fangsong"];Vr._measureString="|\xC9q\xC5";Vr._measureBaseline="M";Vr._heightMultiplier=2;Vr._baselineMultiplier=1.4;Vr._fontSizeInfoCache={};Vr._textContext=null;var Ye,G_,H_,W_,j_,X_,$_,q_,Y_,Q_,J_,K_,Z_,ev,tv,rv,nv,iv,av,ov,ka,iS=(Ye=(ka=function(t){q(a,t);function a(r){var e;e=t.call(this,r)||this,k(e,"_styleFont",G_,B(e)),k(e,"_charRenderDatas",H_,B(e)),k(e,"_dirtyFlag",W_,B(e)),k(e,"_isWorldMatrixDirty",j_,B(e)),k(e,"_color",X_,B(e)),k(e,"_text",$_,B(e)),k(e,"_width",q_,B(e)),k(e,"_height",Y_,B(e)),k(e,"_localBounds",Q_,B(e)),k(e,"_font",J_,B(e)),k(e,"_fontSize",K_,B(e)),k(e,"_fontStyle",Z_,B(e)),k(e,"_lineSpacing",ev,B(e)),k(e,"_horizontalAlignment",tv,B(e)),k(e,"_verticalAlignment",rv,B(e)),k(e,"_enableWrapping",nv,B(e)),k(e,"_overflowMode",iv,B(e)),k(e,"_maskInteraction",av,B(e)),k(e,"_maskLayer",ov,B(e));var n=B(e),o=n.engine;return e._isWorldMatrixDirty=r.transform._registerWorldChangeListener(),e._isWorldMatrixDirty.listener=function(){e._setDirtyFlagTrue(be.WorldPosition|be.WorldBounds)},e.font=Qs.createFromOS(o),e.setMaterial(o._spriteDefaultMaterial),e}var i=a.prototype;return i._render=function(e){if(!(this._text===""||this.enableWrapping&&this.width<=0||this.overflowMode===wi.Truncate&&this.height<=0)){this._isContainDirtyFlag(be.MaskInteraction)&&(this._updateStencilState(),this._setDirtyFlagFalse(be.MaskInteraction)),this._isContainDirtyFlag(be.StyleFont)&&(this._resetStyleFont(),this._setDirtyFlagFalse(be.StyleFont)),this._isContainDirtyFlag(be.LocalPositionBounds)&&(this._updateLocalData(),this._setDirtyFlagFalse(be.LocalPositionBounds)),this._isContainDirtyFlag(be.WorldPosition)&&(this._updatePosition(),this._setDirtyFlagFalse(be.WorldPosition));var n=this._engine._spriteElementPool,o=this._engine._textElementPool.getFromPool(),s=o.charElements,l=this.getMaterial(),u=this._charRenderDatas,c=u.length;o.component=this,o.material=l,s.length=c;for(var f=0;f<c;++f){var h=u[f],d=n.getFromPool();d.setValue(this,h.renderData,l,h.texture),s[f]=d}e._renderPipeline.pushPrimitive(o)}},i._onDestroy=function(){for(var e=this._charRenderDatas,n=0,o=e.length;n<o;++n)a._charRenderDataPool.put(e[n]);e.length=0,this._isWorldMatrixDirty.destroy(),t.prototype._onDestroy.call(this)},i._cloneTo=function(e){e.font=this._font},i._isContainDirtyFlag=function(e){return(this._dirtyFlag&e)!=0},i._setDirtyFlagTrue=function(e){this._dirtyFlag|=e},i._setDirtyFlagFalse=function(e){this._dirtyFlag&=~e},i._updateBounds=function(e){Gr.transform(this._localBounds,this._entity.transform.worldMatrix,e)},i._updateStencilState=function(){var e=this.getInstanceMaterial(),n=e.renderState.stencilState,o=this._maskInteraction;if(o===ar.None)n.enabled=!1,n.writeMask=255,n.referenceValue=0,n.compareFunctionFront=n.compareFunctionBack=Pe.Always;else{n.enabled=!0,n.writeMask=0,n.referenceValue=1;var s=o===ar.VisibleInsideMask?Pe.LessEqual:Pe.Greater;n.compareFunctionFront=s,n.compareFunctionBack=s}},i._resetStyleFont=function(){var e=this._styleFont;e&&(e._addRefCount(-1),e.destroy()),this._styleFont=Qs.createFromOS(this.engine,Vr.getNativeFontHash(this.font.name,this.fontSize,this.fontStyle)),this._styleFont._addRefCount(1)},i._updatePosition=function(){for(var e=this.entity.transform,n=e.worldMatrix.elements,o=this._charRenderDatas,s=n[0],l=n[1],u=n[2],c=n[4],f=n[5],h=n[6],d=n[12],_=n[13],m=n[14],p=a._tempVec31.set(c,f,h),v=a._tempVec30.set(s,l,u),g=0,y=o.length;g<y;++g){var x=o[g],P=x.localPositions,S=x.renderData.positions,w=P.x,b=P.y,E=S[0];E.x=w*s+b*c+d,E.y=w*l+b*f+_,E.z=w*u+b*h+m;var M=S[1];C.scale(v,P.z-w,M),C.add(E,M,M);var F=S[2];C.scale(p,P.w-b,F),C.add(E,F,S[3]),C.add(M,F,F)}},i._updateLocalData=function(){var e=this.color,n=this.horizontalAlignment,o=this.verticalAlignment,s=this._charRenderDatas,l=this._localBounds,u=l.min,c=l.max;u.set(0,0,0),c.set(0,0,0);var f=Er._pixelsPerUnit,h=1/f,d=this._styleFont,_=this.width*f,m=_*.5,p=this.height*f,v=this.enableWrapping?Vr.measureTextWithWrap(this):Vr.measureTextWithoutWrap(this),g=v.height,y=v.lines,x=v.lineWidths,P=v.lineHeight,S=v.lineMaxSizes,w=a._charRenderDataPool,b=P*.5,E=y.length,M=0,F=P*.5-S[0].ascent,A=P*.5-S[E-1].descent-1;switch(o){case di.Top:M=p*.5-b+F;break;case di.Center:M=g*.5-b-(A-F)*.5;break;case di.Bottom:M=g-p*.5-b-A;break}for(var T=0,R=Number.MAX_SAFE_INTEGER,z=Number.MAX_SAFE_INTEGER,L=Number.MIN_SAFE_INTEGER,N=Number.MIN_SAFE_INTEGER,V=E-1,D=0;D<E;++D){var j=y[D],I=x[D],H=0;switch(n){case hi.Left:H=-m;break;case hi.Center:H=-I*.5;break;case hi.Right:H=m-I;break}for(var G=0,te=j.length-1;G<=te;++G){var ie=j[G],fe=d._getCharInfo(ie);if(fe.h>0){var ce=s[T]||w.get(),me=ce.renderData,Me=ce.localPositions;ce.texture=d._getTextureByIndex(fe.index),me.color=e,me.uvs=fe.uvs;var Ae=fe.w,Oe=fe.ascent,$e=fe.descent,Je=H*h,Te=(H+Ae)*h,Ze=(M+Oe)*h,et=(M-$e+1)*h;Me.set(Je,Ze,Te,et),s[T]=ce,T++,D===0&&(N=Math.max(N,Ze)),D===V&&(z=Math.min(z,et)),G===0&&(R=Math.min(R,Je)),G===te&&(L=Math.max(L,Te))}H+=fe.xAdvance}M-=P}u.set(R,z,0),c.set(L,N,0);var qe=s.length;if(qe>T){for(var tt=T;tt<qe;++tt)w.put(s[tt]);s.length=T}d._getLastIndex()>0&&s.sort(function(bt,Re){return bt.texture.instanceId-Re.texture.instanceId})},Y(a,[{key:"color",get:function(){return this._color},set:function(e){this._color!==e&&this._color.copyFrom(e)}},{key:"text",get:function(){return this._text},set:function(e){e=e||"",this._text!==e&&(this._text=e,this._setDirtyFlagTrue(be.Position))}},{key:"width",get:function(){return this._width},set:function(e){this._width!==e&&(this._width=e,this._setDirtyFlagTrue(be.Position))}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._height=e,this._setDirtyFlagTrue(be.Position))}},{key:"font",get:function(){return this._font},set:function(e){this._font!==e&&(this._font=e,this._setDirtyFlagTrue(be.Font))}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this._setDirtyFlagTrue(be.Font))}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(e){this.fontStyle!==e&&(this._fontStyle=e,this._setDirtyFlagTrue(be.Font))}},{key:"lineSpacing",get:function(){return this._lineSpacing},set:function(e){this._lineSpacing!==e&&(this._lineSpacing=e,this._setDirtyFlagTrue(be.Position))}},{key:"horizontalAlignment",get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._setDirtyFlagTrue(be.Position))}},{key:"verticalAlignment",get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._setDirtyFlagTrue(be.Position))}},{key:"enableWrapping",get:function(){return this._enableWrapping},set:function(e){this._enableWrapping!==e&&(this._enableWrapping=e,this._setDirtyFlagTrue(be.Position))}},{key:"overflowMode",get:function(){return this._overflowMode},set:function(e){this._overflowMode!==e&&(this._overflowMode=e,this._setDirtyFlagTrue(be.Position))}},{key:"maskInteraction",get:function(){return this._maskInteraction},set:function(e){this._maskInteraction!==e&&(this._maskInteraction=e,this._setDirtyFlagTrue(be.MaskInteraction))}},{key:"maskLayer",get:function(){return this._maskLayer},set:function(e){this._maskLayer=e}},{key:"bounds",get:function(){return this._isContainDirtyFlag(be.StyleFont)&&this._resetStyleFont(),this._isContainDirtyFlag(be.LocalPositionBounds)&&this._updateLocalData(),this._isContainDirtyFlag(be.WorldPosition)&&this._updatePosition(),this._isContainDirtyFlag(be.WorldBounds)&&this._updateBounds(this._bounds),this._setDirtyFlagFalse(be.Font),this._bounds}}]),a}(Go),ka._charRenderDataPool=new nS(am,50),ka._tempVec30=new C,ka._tempVec31=new C,ka),G_=U(Ye.prototype,"_styleFont",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H_=U(Ye.prototype,"_charRenderDatas",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),W_=U(Ye.prototype,"_dirtyFlag",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return be.Font}}),j_=U(Ye.prototype,"_isWorldMatrixDirty",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X_=U(Ye.prototype,"_color",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ne(1,1,1,1)}}),$_=U(Ye.prototype,"_text",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),q_=U(Ye.prototype,"_width",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Y_=U(Ye.prototype,"_height",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Q_=U(Ye.prototype,"_localBounds",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gr}}),J_=U(Ye.prototype,"_font",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K_=U(Ye.prototype,"_fontSize",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 24}}),Z_=U(Ye.prototype,"_fontStyle",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return An.None}}),ev=U(Ye.prototype,"_lineSpacing",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tv=U(Ye.prototype,"_horizontalAlignment",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hi.Center}}),rv=U(Ye.prototype,"_verticalAlignment",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return di.Center}}),nv=U(Ye.prototype,"_enableWrapping",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),iv=U(Ye.prototype,"_overflowMode",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wi.Overflow}}),av=U(Ye.prototype,"_maskInteraction",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ar.None}}),ov=U(Ye.prototype,"_maskLayer",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return da.Layer0}}),Ye),be;(function(t){t[t.StyleFont=1]="StyleFont",t[t.LocalPositionBounds=2]="LocalPositionBounds",t[t.WorldPosition=4]="WorldPosition",t[t.WorldBounds=8]="WorldBounds",t[t.MaskInteraction=16]="MaskInteraction",t[t.Position=14]="Position",t[t.Font=15]="Font"})(be||(be={}));var om=function(){this.relativePath=void 0,this.type=void 0,this.property=void 0,this.curve=void 0},sm=function(){this.time=void 0,this.functionName=void 0,this.parameter=void 0},he;(function(t){t[t.Position=0]="Position",t[t.Rotation=1]="Rotation",t[t.Scale=2]="Scale",t[t.BlendShapeWeights=3]="BlendShapeWeights"})(he||(he={}));var aS=function(){},lm=function(t){q(a,t);function a(r){var e;return e=t.call(this)||this,e.name=r,e._curveBindings=[],e._length=0,e._events=[],e}var i=a.prototype;return i.addEvent=function(e,n,o){if(typeof e=="string"){var s=new sm;s.functionName=e,s.time=n,s.parameter=o,this._events.push(s)}else this._events.push(e);this._events.sort(function(l,u){return l.time-u.time})},i.clearEvents=function(){this._events.length=0},i.addCurveBinding=function(e,n,o,s){var l;switch(o){case"position":l=he.Position;break;case"rotation":l=he.Rotation;break;case"scale":l=he.Scale;break;case"blendShapeWeights":l=he.BlendShapeWeights;break}var u=new om;u.relativePath=e,u.type=n,u.property=l,u.curve=s,s.length>this._length&&(this._length=s.length),this._curveBindings.push(u)},i.clearCurveBindings=function(){this._curveBindings.length=0,this._length=0},i._sampleAnimation=function(e,n){for(var o=this._curveBindings.length,s=o-1;s>=0;s--){var l=this._curveBindings[s],u=l.curve,c=l.property,f=l.relativePath,h=l.type,d=u.evaluate(n),_=e.findByName(f),m=_.transform;if(h===Yt)switch(c){case he.Position:m.position=d;break;case he.Rotation:m.rotationQuaternion=d;break;case he.Scale:m.scale=d;break}}},Y(a,[{key:"events",get:function(){return this._events}},{key:"curveBindings",get:function(){return this._curveBindings}},{key:"length",get:function(){return this._length}}]),a}(aS),pe;(function(t){t[t.Float=0]="Float",t[t.FloatArray=1]="FloatArray",t[t.Vector2=2]="Vector2",t[t.Vector3=3]="Vector3",t[t.Vector4=4]="Vector4",t[t.Quaternion=5]="Quaternion"})(pe||(pe={}));var Js=function(){function t(){}return t.scaleWeight=function(i,r,e){var n=i.x,o=i.y,s=i.z;e.x=n>0?Math.pow(Math.abs(n),r):-Math.pow(Math.abs(n),r),e.y=o>0?Math.pow(Math.abs(o),r):-Math.pow(Math.abs(o),r),e.z=s>0?Math.pow(Math.abs(s),r):-Math.pow(Math.abs(s),r)},t.scaleBlend=function(i,r,e,n){var o=t._tempVector30,s=t._tempVector31;t.scaleWeight(i,1-e,o),t.scaleWeight(r,e,s);var l=e>.5?r:i;n.x=l.x>0?Math.abs(o.x*s.x):-Math.abs(o.x*s.x),n.y=l.y>0?Math.abs(o.y*s.y):-Math.abs(o.y*s.y),n.z=l.z>0?Math.abs(o.z*s.z):-Math.abs(o.z*s.z)},t.quaternionWeight=function(i,r,e){e.x=i.x*r,e.y=i.y*r,e.z=i.z*r,e.w=i.w},t}();Js._tempVector30=new C;Js._tempVector31=new C;var Ro;(function(t){t[t.Override=0]="Override",t[t.Additive=1]="Additive"})(Ro||(Ro={}));var Lt;(function(t){t[t.UnStarted=0]="UnStarted",t[t.Playing=1]="Playing",t[t.Finished=2]="Finished"})(Lt||(Lt={}));var nt;(function(t){t[t.Standby=0]="Standby",t[t.Playing=1]="Playing",t[t.CrossFading=2]="CrossFading",t[t.FixedCrossFading=3]="FixedCrossFading"})(nt||(nt={}));var oS=function(){function t(i,r,e){switch(this.crossCurveMark=0,this.crossCurveIndex=void 0,this.target=void 0,this.type=void 0,this.property=void 0,this.component=void 0,this.defaultValue=void 0,this.fixedPoseValue=void 0,this._hasSavedDefaultValue=!1,this.target=i,this.type=r,this.property=e,e){case he.Position:this.defaultValue=new C,this.fixedPoseValue=new C,this.component=i.transform;break;case he.Rotation:this.defaultValue=new we,this.fixedPoseValue=new we,this.component=i.transform;break;case he.Scale:this.defaultValue=new C,this.fixedPoseValue=new C,this.component=i.transform;break;case he.BlendShapeWeights:this.component=i.getComponent(_a);var n=this.component.blendShapeWeights.length;this.defaultValue=new Float32Array(n),this.fixedPoseValue=new Float32Array(n);break}}var a=t.prototype;return a.saveDefaultValue=function(){switch(this.property){case he.Position:this.defaultValue.copyFrom(this.target.transform.position);break;case he.Rotation:this.defaultValue.copyFrom(this.target.transform.rotationQuaternion);break;case he.Scale:this.defaultValue.copyFrom(this.target.transform.scale);break;case he.BlendShapeWeights:for(var r=this.component,e=r.blendShapeWeights,n=0,o=e.length;n<o;++n)this.defaultValue[n]=e[n];break}this._hasSavedDefaultValue=!0},a.saveFixedPoseValue=function(){switch(this.property){case he.Position:this.fixedPoseValue.copyFrom(this.target.transform.position);break;case he.Rotation:this.fixedPoseValue.copyFrom(this.target.transform.rotationQuaternion);break;case he.Scale:this.fixedPoseValue.copyFrom(this.target.transform.scale);break;case he.BlendShapeWeights:for(var r=this.component,e=r.blendShapeWeights,n=0,o=e.length;n<o;++n)this.fixedPoseValue[n]=this.component.blendShapeWeights[n];break}},t}(),sS=function(){this.event=void 0,this.handlers=[]},_f=function(){this.duration=0,this.offset=0,this.exitTime=1,this.destinationState=void 0},Fo;(function(t){t[t.Once=0]="Once",t[t.Loop=1]="Loop"})(Fo||(Fo={}));var sv=function(){function t(){this.state=void 0,this.stateData=void 0,this.frameTime=void 0,this.playState=void 0,this.clipTime=void 0,this.currentEventIndex=void 0}var a=t.prototype;return a.reset=function(r,e,n){this.state=r,this.frameTime=n,this.stateData=e,this.playState=Lt.UnStarted,this.clipTime=r.clipStartTime*r.clip.length,this.currentEventIndex=0},a.update=function(r){var e=this.state,n=this.frameTime,o=e._getDuration();this.playState=Lt.Playing,e.wrapMode===Fo.Loop?n=o?n%o:0:Math.abs(n)>o&&(n=n<0?-o:o,this.playState=Lt.Finished),r&&n===0?this.clipTime=e.clipEndTime*e.clip.length:(n<0&&(n+=o),this.clipTime=n+e.clipStartTime*e.clip.length)},t}(),lS=function(){function t(){this.animatorStateDataMap={},this.srcPlayData=new sv,this.destPlayData=new sv,this.layerState=nt.Standby,this.crossCurveMark=0,this.manuallyTransition=new _f,this.crossFadeTransition=void 0}var a=t.prototype;return a.switchPlayData=function(){var r=this.destPlayData,e=this.srcPlayData;this.srcPlayData=r,this.destPlayData=e},t}(),uS=function(){this.curveOwners=[],this.eventHandlers=[]},cS=function(){this.layerIndex=void 0,this.state=void 0},fS=function(){this.curveOwner=void 0,this.srcCurveIndex=void 0,this.destCurveIndex=void 0},lv=function(){function t(){this.vector2=new $,this.vector3=new C,this.vector4=new Ee,this.quaternion=new we,this._floatArrayPool=[]}var a=t.prototype;return a.getFloatArray=function(r){var e=this._floatArrayPool[r];return e||(this._floatArrayPool[r]=e=new Float32Array(r)),e},t}(),gr,uv,cv,fv,hv,dv,_v,vv,pv,gv,ss,um=(gr=(ss=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,e._animatorController=void 0,k(e,"_speed",uv,B(e)),k(e,"_controllerUpdateFlag",cv,B(e)),k(e,"_animatorLayersData",fv,B(e)),k(e,"_crossCurveDataCollection",hv,B(e)),k(e,"_animationCurveOwners",dv,B(e)),k(e,"_crossCurveDataPool",_v,B(e)),k(e,"_animationEventHandlerPool",vv,B(e)),k(e,"_baseTempValue",pv,B(e)),k(e,"_crossTempValue",gv,B(e)),e}var i=a.prototype;return i.play=function(e,n,o){var s;n===void 0&&(n=-1),o===void 0&&(o=0),(s=this._controllerUpdateFlag)!==null&&s!==void 0&&s.flag&&this._clearPlayData();var l=this._getAnimatorStateInfo(e,n,a._animatorInfo),u=l.state;if(!!u){if(!u.clip){console.warn("The state named "+e+" has no AnimationClip data.");return}var c=this._getAnimatorLayerData(l.layerIndex),f=c.srcPlayData,h=f.state;h&&h!==u&&this._revertDefaultValue(f.state,f.stateData);var d=this._getAnimatorStateData(e,u,c);c.layerState=nt.Playing,f.reset(u,d,u._getDuration()*o),this._saveDefaultValues(d)}},i._reset=function(){var e=this._animatorController;if(e)for(var n=e.layers,o=0,s=n.length;o<s;++o)for(var l=n[o].stateMachine.states,u=this._getAnimatorLayerData(o),c=0,f=l.length;c<f;++c){var h=l[c],d=this._getAnimatorStateData(h.name,h,u);this._revertDefaultValue(h,d)}this._clearPlayData()},i.crossFade=function(e,n,o,s){var l;o===void 0&&(o=-1),s===void 0&&(s=0),(l=this._controllerUpdateFlag)!==null&&l!==void 0&&l.flag&&this._clearPlayData();var u=this._getAnimatorStateInfo(e,o,a._animatorInfo),c=u.state,f=this._getAnimatorLayerData(o),h=f.manuallyTransition;h.duration=n,h.offset=s,h.destinationState=c,this._crossFadeByTransition(h,o)},i.update=function(e){var n;if(this.speed!==0){var o=this._animatorController;if(!!o&&!((n=this._controllerUpdateFlag)!==null&&n!==void 0&&n.flag)){e*=this.speed;for(var s=0,l=o.layers.length;s<l;s++){var u=this._getAnimatorLayerData(s);u.layerState!==nt.Standby&&this._updateLayer(s,s===0,e/1e3)}}}},i.getCurrentAnimatorState=function(e){var n,o;return(n=this._animatorLayersData[e])===null||n===void 0||(o=n.srcPlayData)===null||o===void 0?void 0:o.state},i._onEnable=function(){this.engine._componentsManager.addOnUpdateAnimations(this)},i._onDisable=function(){this.engine._componentsManager.removeOnUpdateAnimations(this)},i._getAnimatorStateInfo=function(e,n,o){var s=null,l=this._animatorController;if(l){var u=l.layers;if(n===-1){for(var c=0,f=u.length;c<f;c++)if(s=u[c].stateMachine.findStateByName(e),s){n=c;break}}else s=u[n].stateMachine.findStateByName(e)}return o.layerIndex=n,o.state=s,o},i._saveDefaultValues=function(e){for(var n=e.curveOwners,o=n.length-1;o>=0;o--)n[o].saveDefaultValue()},i._getAnimatorStateData=function(e,n,o){var s=o.animatorStateDataMap,l=s[e];return l||(l=new uS,s[e]=l,this._saveAnimatorStateData(n,l),this._saveAnimatorEventHandlers(n,l)),l},i._saveAnimatorStateData=function(e,n){for(var o=this.entity,s=this._animationCurveOwners,l=n.curveOwners,u=e.clip._curveBindings,c=u.length-1;c>=0;c--){var f=u[c],h=f.relativePath===""?o:o.findByPath(f.relativePath),d=f.property,_=h,m=_.instanceId,p=s[m]||(s[m]=[]);l[c]=p[d]||(p[d]=new oS(h,f.type,d))}},i._saveAnimatorEventHandlers=function(e,n){var o=this._animationEventHandlerPool,s=this._entity._scripts,l=s.length,u=n.eventHandlers,c=e.clip.events;u.length=0;for(var f=0,h=c.length;f<h;f++){var d=c[f],_=o.getFromPool(),m=d.functionName,p=_.handlers;_.event=d,p.length=0;for(var v=l-1;v>=0;v--){var g=s.get(v)[m];g&&p.push(g)}u.push(_)}},i._clearCrossData=function(e){e.crossCurveMark++,this._crossCurveDataCollection.length=0,this._crossCurveDataPool.resetPool()},i._addCrossCurveData=function(e,n,o,s){var l=this._crossCurveDataPool.getFromPool();l.curveOwner=n,l.srcCurveIndex=o,l.destCurveIndex=s,e.push(l)},i._prepareCrossFading=function(e){var n=this._crossCurveDataCollection,o=e.crossCurveMark;this._prepareSrcCrossData(n,e.srcPlayData,o,!1),this._prepareDestCrossData(n,e.destPlayData,o,!1)},i._prepareStandbyCrossFading=function(e){var n=this._crossCurveDataCollection,o=e.srcPlayData,s=e.crossCurveMark;o.state&&this._prepareSrcCrossData(n,o,s,!0),this._prepareDestCrossData(n,e.destPlayData,s,!0)},i._prepareFixedPoseCrossFading=function(e){for(var n=this._crossCurveDataCollection,o=n.length-1;o>=0;o--){var s=n[o];s.curveOwner.saveFixedPoseValue(),s.destCurveIndex=-1}this._prepareDestCrossData(n,e.destPlayData,e.crossCurveMark,!0)},i._prepareSrcCrossData=function(e,n,o,s){for(var l=n.stateData.curveOwners,u=l.length-1;u>=0;u--){var c=l[u];c.crossCurveMark=o,c.crossCurveIndex=e.length,s&&c.saveFixedPoseValue(),this._addCrossCurveData(e,c,u,-1)}},i._prepareDestCrossData=function(e,n,o,s){for(var l=n.stateData.curveOwners,u=l.length-1;u>=0;u--){var c=l[u];c.crossCurveMark===o?e[c.crossCurveIndex].destCurveIndex=u:(c.saveDefaultValue(),s&&c.saveFixedPoseValue(),c.crossCurveMark=o,c.crossCurveIndex=e.length,this._addCrossCurveData(e,c,-1,u))}},i._evaluateCurve=function(e,n,o,s,l){var u;switch(s&&(u=n.keys[0].value),n._valueType){case pe.Float:{var c=n.evaluate(o);return s?c-u:c}case pe.FloatArray:{var f=l.getFloatArray(n._valueSize);if(n._evaluate(o,f),s)for(var h=0,d=f.length;h<d;h++)f[h]=f[h]-u[h];return f}case pe.Vector2:{var _=l.vector2;return n._evaluate(o,_),s&&(e===he.Scale?$.divide(_,u,_):$.subtract(_,u,_)),_}case pe.Vector3:{var m=l.vector3;return n._evaluate(o,m),s&&(e===he.Scale?C.divide(m,u,m):C.subtract(m,u,m)),m}case pe.Vector4:{var p=l.vector4;return n._evaluate(o,p),s&&Ee.subtract(p,u,p),p}case pe.Quaternion:{var v=l.quaternion;if(n._evaluate(o,v),s){var g=a._tempQuat;we.conjugate(u,g),we.multiply(g,v,v)}return v}}},i._getAnimatorLayerData=function(e){var n=this._animatorLayersData[e];return n||(this._animatorLayersData[e]=n=new lS),n},i._updateLayer=function(e,n,o){var s=this._animatorController.layers[e],l=s.blendingMode,u=s.weight,c=this._animatorLayersData[e],f=c.srcPlayData,h=c.destPlayData,d=c.crossFadeTransition,_=l===Ro.Additive,m=n?1:u;switch(c.layerState!==nt.FixedCrossFading&&this._checkTransition(f,d,e),c.layerState){case nt.Playing:this._updatePlayingState(f,c,e,m,o,_);break;case nt.FixedCrossFading:this._updateCrossFadeFromPose(h,c,e,m,o,_);break;case nt.CrossFading:this._updateCrossFade(f,h,c,e,m,o,_);break}},i._updatePlayingState=function(e,n,o,s,l,u){var c=e.stateData,f=c.curveOwners,h=c.eventHandlers,d=e.state,_=e.playState,m=e.clipTime,p=d.clip._curveBindings;e.update(this.speed<0);var v=e.clipTime,g=e.playState;h.length&&this._fireAnimationEvents(e,h,m,v);for(var y=p.length-1;y>=0;y--){var x=f[y],P=this._evaluateCurve(x.property,p[y].curve,v,u,this._baseTempValue);u?this._applyClipValueAdditive(x,P,s):this._applyClipValue(x,P,s)}e.frameTime+=d.speed*l,g===Lt.Finished&&(n.layerState=nt.Standby),_===Lt.UnStarted&&this._callAnimatorScriptOnEnter(d,o),g===Lt.Finished?this._callAnimatorScriptOnExit(d,o):this._callAnimatorScriptOnUpdate(d,o)},i._updateCrossFade=function(e,n,o,s,l,u,c){var f=this._crossCurveDataCollection,h=e.state.clip._curveBindings,d=e.state,_=e.stateData,m=e.playState,p=_.eventHandlers,v=n.state,g=n.stateData,y=n.playState,x=g.eventHandlers,P=v.clip._curveBindings,S=e.clipTime,w=n.clipTime,b=Math.abs(n.frameTime)/(v._getDuration()*o.crossFadeTransition.duration);b>=1&&(b=1),e.update(this.speed<0),n.update(this.speed<0);var E=e.playState,M=n.playState;this._updateCrossFadeData(o,b,u,!1);var F=e.clipTime,A=n.clipTime;p.length&&this._fireAnimationEvents(e,p,S,F),x.length&&this._fireAnimationEvents(n,x,w,A),m===Lt.UnStarted&&this._callAnimatorScriptOnEnter(d,s),b===1||E===Lt.Finished?this._callAnimatorScriptOnExit(d,s):this._callAnimatorScriptOnUpdate(d,s),y===Lt.UnStarted&&this._callAnimatorScriptOnEnter(v,s),M===Lt.Finished?this._callAnimatorScriptOnExit(v,s):this._callAnimatorScriptOnUpdate(v,s);for(var T=f.length-1;T>=0;T--){var R=f[T],z=R.curveOwner,L=R.srcCurveIndex,N=R.destCurveIndex,V=z.property,D=z.defaultValue,j=L>=0?this._evaluateCurve(V,h[L].curve,F,c,this._baseTempValue):D,I=N>=0?this._evaluateCurve(V,P[N].curve,A,c,this._crossTempValue):D;this._applyCrossClipValue(z,j,I,b,l,c)}},i._updateCrossFadeFromPose=function(e,n,o,s,l,u){var c=this._crossCurveDataCollection,f=e.state,h=e.stateData,d=e.playState,_=h.eventHandlers,m=f.clip._curveBindings,p=e.clipTime,v=Math.abs(e.frameTime)/(f._getDuration()*n.crossFadeTransition.duration);v>=1&&(v=1),e.update(this.speed<0);var g=e.playState;this._updateCrossFadeData(n,v,l,!0);var y=e.clipTime;_.length&&this._fireAnimationEvents(e,_,p,y),d===Lt.UnStarted&&this._callAnimatorScriptOnEnter(f,o),g===Lt.Finished?this._callAnimatorScriptOnExit(f,o):this._callAnimatorScriptOnUpdate(f,o);for(var x=c.length-1;x>=0;x--){var P=c[x],S=P.curveOwner,w=P.destCurveIndex,b=w>=0?this._evaluateCurve(S.property,m[w].curve,y,u,this._crossTempValue):S.defaultValue;this._applyCrossClipValue(S,S.fixedPoseValue,b,v,s,u)}},i._updateCrossFadeData=function(e,n,o,s){var l=e.destPlayData;l.frameTime+=l.state.speed*o,n===1?(l.playState===Lt.Finished?e.layerState=nt.Standby:e.layerState=nt.Playing,e.switchPlayData()):s||(e.srcPlayData.frameTime+=e.srcPlayData.state.speed*o)},i._applyCrossClipValue=function(e,n,o,s,l,u){var c;if(e.type===Yt)switch(e.property){case he.Position:c=this._baseTempValue.vector3,C.lerp(n,o,s,c);break;case he.Rotation:c=this._baseTempValue.quaternion,we.slerp(n,o,s,c);break;case he.Scale:{c=this._baseTempValue.vector3,C.lerp(n,o,s,c);break}}else if(e.type===_a)switch(e.property){case he.BlendShapeWeights:c=this._baseTempValue.getFloatArray(n.length);for(var f=0,h=c.length;f<h;++f)c[f]=n[f]+(o[f]-n[f])*s;break}u?this._applyClipValueAdditive(e,c,l):this._applyClipValue(e,c,l)},i._applyClipValue=function(e,n,o){if(e.type===Yt){var s=e.target.transform;switch(e.property){case he.Position:if(o===1)s.position=n;else{var l=s.position;C.lerp(l,n,o,l)}break;case he.Rotation:if(o===1)s.rotationQuaternion=n;else{var u=s.rotationQuaternion;we.slerp(u,n,o,u)}break;case he.Scale:if(o===1)s.scale=n;else{var c=s.scale;C.lerp(c,n,o,c)}break}}else if(e.type===_a)switch(e.property){case he.BlendShapeWeights:if(o===1)e.component.blendShapeWeights=n;else for(var f=e.component,h=f.blendShapeWeights,d=0,_=h.length;d<_;++d)h[d]+=(n[d]-h[d])*o;break}},i._applyClipValueAdditive=function(e,n,o){if(e.type===Yt){var s=e.target.transform;switch(e.property){case he.Position:var l=s.position;l.x+=n.x*o,l.y+=n.y*o,l.z+=n.z*o,s.position=l;break;case he.Rotation:var u=s.rotationQuaternion;Js.quaternionWeight(n,o,n),n.normalize(),u.multiply(n),s.rotationQuaternion=u;break;case he.Scale:var c=s.scale;Js.scaleWeight(c,o,c),C.multiply(c,n,c),s.scale=c;break;case he.BlendShapeWeights:for(var f=e.component,h=f.blendShapeWeights,d=0,_=h.length;d<_;++d)e.component.blendShapeWeights[d]+=n[d]*o;break}}},i._revertDefaultValue=function(e,n){var o=e.clip;if(o)for(var s=o._curveBindings,l=n.curveOwners,u=s.length-1;u>=0;u--){var c=l[u],f=c.target.transform;if(!!c._hasSavedDefaultValue)switch(c.property){case he.Position:f.position=c.defaultValue;break;case he.Rotation:f.rotationQuaternion=c.defaultValue;break;case he.Scale:f.scale=c.defaultValue;break;case he.BlendShapeWeights:for(var h=c.component,d=h.blendShapeWeights,_=0,m=d.length;_<m;++_)c.component.blendShapeWeights[_]=c.defaultValue[_];break}}},i._checkTransition=function(e,n,o){for(var s=e.state,l=e.clipTime,u=s._getDuration(),c=s.transitions,f=0,h=c.length;f<h;++f){var d=c[f];u*d.exitTime<=l&&n!==d&&this._crossFadeByTransition(d,o)}},i._crossFadeByTransition=function(e,n){var o=e.destinationState.name,s=this._getAnimatorStateInfo(o,n,a._animatorInfo),l=s.state;if(!!l){if(!l.clip){console.warn("The state named "+o+" has no AnimationClip data.");return}var u=this._getAnimatorLayerData(s.layerIndex),c=u.layerState,f=u.destPlayData,h=this._getAnimatorStateData(o,l,u),d=l._getDuration(),_=d*e.offset;switch(f.reset(l,h,_),c){case nt.Standby:u.layerState=nt.FixedCrossFading,this._clearCrossData(u),this._prepareStandbyCrossFading(u);break;case nt.Playing:u.layerState=nt.CrossFading,this._clearCrossData(u),this._prepareCrossFading(u);break;case nt.CrossFading:u.layerState=nt.FixedCrossFading,this._prepareFixedPoseCrossFading(u);break;case nt.FixedCrossFading:this._prepareFixedPoseCrossFading(u);break}u.crossFadeTransition=e}},i._fireAnimationEvents=function(e,n,o,s){var l=e.state,u=l.clip.length;this.speed>=0?s<o?(this._fireSubAnimationEvents(e,n,o,l.clipEndTime*u),e.currentEventIndex=0,this._fireSubAnimationEvents(e,n,l.clipStartTime*u,s)):this._fireSubAnimationEvents(e,n,o,s):s>o?(this._fireBackwardSubAnimationEvents(e,n,o,l.clipStartTime*u),e.currentEventIndex=n.length-1,this._fireBackwardSubAnimationEvents(e,n,l.clipEndTime*u,s)):this._fireBackwardSubAnimationEvents(e,n,o,s)},i._fireSubAnimationEvents=function(e,n,o,s){for(var l=e.currentEventIndex,u=n.length;l<u;l++){var c=n[l],f=c.event,h=f.time,d=f.parameter;if(h>s)break;var _=c,m=_.handlers;if(h>=o){for(var p=m.length-1;p>=0;p--)m[p](d);e.currentEventIndex=Math.min(l+1,u-1)}}},i._fireBackwardSubAnimationEvents=function(e,n,o,s){for(var l=e.currentEventIndex;l>=0;l--){var u=n[l],c=u.event,f=c.time,h=c.parameter;if(f<s)break;var d=u,_=d.handlers;if(f<=o){for(var m=_.length-1;m>=0;m--)_[m](h);e.currentEventIndex=Math.max(l-1,0)}}},i._callAnimatorScriptOnEnter=function(e,n){for(var o=e._onStateEnterScripts,s=0,l=o.length;s<l;s++)o[s].onStateEnter(this,e,n)},i._callAnimatorScriptOnUpdate=function(e,n){for(var o=e._onStateUpdateScripts,s=0,l=o.length;s<l;s++)o[s].onStateUpdate(this,e,n)},i._callAnimatorScriptOnExit=function(e,n){for(var o=e._onStateExitScripts,s=0,l=o.length;s<l;s++)o[s].onStateExit(this,e,n)},i._clearPlayData=function(){this._animatorLayersData.length=0,this._crossCurveDataCollection.length=0,this._animationCurveOwners.length=0,this._animationEventHandlerPool.resetPool(),this._controllerUpdateFlag&&(this._controllerUpdateFlag.flag=!1)},Y(a,[{key:"speed",get:function(){return this._speed},set:function(e){this._speed=e}},{key:"animatorController",get:function(){return this._animatorController},set:function(e){e!==this._animatorController&&(this._controllerUpdateFlag&&this._controllerUpdateFlag.destroy(),this._controllerUpdateFlag=e&&e._registerChangeFlag(),this._animatorController=e)}}]),a}(hr),ss._tempQuat=new we,ss._animatorInfo=new cS,ss),uv=U(gr.prototype,"_speed",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),cv=U(gr.prototype,"_controllerUpdateFlag",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fv=U(gr.prototype,"_animatorLayersData",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hv=U(gr.prototype,"_crossCurveDataCollection",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dv=U(gr.prototype,"_animationCurveOwners",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_v=U(gr.prototype,"_crossCurveDataPool",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ui(fS)}}),vv=U(gr.prototype,"_animationEventHandlerPool",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ui(sS)}}),pv=U(gr.prototype,"_baseTempValue",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lv}}),gv=U(gr.prototype,"_crossTempValue",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lv}}),gr),vf=function(){function t(){this._updateFlagManager=new fa,this._layers=[],this._layersMap={}}var a=t.prototype;return a.findLayerByName=function(r){return this._layersMap[r]},a.addLayer=function(r){this._layers.push(r),this._layersMap[r.name]=r,this._distributeUpdateFlag()},a.removeLayer=function(r){var e=this.layers[r];this._layers.splice(r,1),delete this._layersMap[e.name],this._distributeUpdateFlag()},a.clearLayers=function(){this._layers.length=0;for(var r in this._layersMap)delete this._layersMap[r];this._distributeUpdateFlag()},a._registerChangeFlag=function(){return this._updateFlagManager.createFlag(Uo)},a._distributeUpdateFlag=function(){this._updateFlagManager.dispatch()},Y(t,[{key:"layers",get:function(){return this._layers}}]),t}(),pf=function(a){this.name=a,this.weight=1,this.blendingMode=Ro.Override,this.stateMachine=void 0},tc=function(){function t(){this._destroyed=!1,this._state=void 0}var a=t.prototype;return a.onStateEnter=function(r,e,n){},a.onStateUpdate=function(r,e,n){},a.onStateExit=function(r,e,n){},a.destroy=function(){this._destroyed||(this._state._removeStateMachineScript(this),this._destroyed=!0)},t}(),cm=function(){function t(i){this.name=i,this.speed=1,this.wrapMode=Fo.Loop,this._onStateEnterScripts=[],this._onStateUpdateScripts=[],this._onStateExitScripts=[],this._clipStartTime=0,this._clipEndTime=1,this._clip=void 0,this._transitions=[]}var a=t.prototype;return a.addTransition=function(r){this._transitions.push(r)},a.removeTransition=function(r){var e=this._transitions.indexOf(r);e!==-1&&this._transitions.splice(e,1)},a.addStateMachineScript=function(r){var e=new r;e._state=this;var n=tc.prototype;return e.onStateEnter!==n.onStateEnter&&this._onStateEnterScripts.push(e),e.onStateUpdate!==n.onStateUpdate&&this._onStateUpdateScripts.push(e),e.onStateExit!==n.onStateExit&&this._onStateExitScripts.push(e),e},a.clearTransitions=function(){this._transitions.length=0},a._getDuration=function(){return this.clip?(this._clipEndTime-this._clipStartTime)*this.clip.length:null},a._removeStateMachineScript=function(r){var e=tc.prototype;if(r.onStateEnter!==e.onStateEnter){var n=this._onStateEnterScripts.indexOf(r);n!==-1&&this._onStateEnterScripts.splice(n,1)}if(r.onStateUpdate!==e.onStateUpdate){var o=this._onStateUpdateScripts.indexOf(r);o!==-1&&this._onStateUpdateScripts.splice(o,1)}if(r.onStateExit!==e.onStateExit){var s=this._onStateExitScripts.indexOf(r);s!==-1&&this._onStateExitScripts.splice(s,1)}},Y(t,[{key:"transitions",get:function(){return this._transitions}},{key:"clip",get:function(){return this._clip},set:function(r){this._clip=r,this._clipEndTime=Math.min(this._clipEndTime,1)}},{key:"clipStartTime",get:function(){return this._clipStartTime},set:function(r){this._clipStartTime=Math.max(r,0)}},{key:"clipEndTime",get:function(){return this._clipEndTime},set:function(r){this._clipEndTime=Math.min(r,1)}}]),t}(),gf=function(){function t(){this.states=[],this._statesMap={}}var a=t.prototype;return a.addState=function(r){var e=this.findStateByName(r);return e?console.warn("The state named "+r+" has existed."):(e=new cm(r),this.states.push(e),this._statesMap[r]=e),e},a.removeState=function(r){var e=r.name,n=this.states.indexOf(r);n>-1&&this.states.splice(n,1),delete this._statesMap[e]},a.findStateByName=function(r){return this._statesMap[r]},a.makeUniqueStateName=function(r){for(var e=this._statesMap,n=r,o=0;e[r];)r=n+" "+o,o++;return r},t}(),Ir;(function(t){t[t.Linear=0]="Linear",t[t.CubicSpine=1]="CubicSpine",t[t.Step=2]="Step",t[t.Hermite=3]="Hermite"})(Ir||(Ir={}));var fm=function(){function t(){this.keys=[],this.interpolation=void 0,this._valueSize=void 0,this._valueType=void 0,this._tempValue=void 0,this._length=0,this._currentIndex=0}var a=t.prototype;return a.addKey=function(r){var e=r.time;if(this.keys.push(r),e>this._length&&(this._length=e),!this._valueSize&&(typeof r.value=="number"&&(this._valueSize=1,this._valueType=pe.Float,this._tempValue=0),r.value instanceof $&&(this._valueSize=2,this._valueType=pe.Vector2,this._tempValue=new $),r.value instanceof C&&(this._valueSize=3,this._valueType=pe.Vector3,this._tempValue=new C),r.value instanceof Ee&&(this._valueSize=4,this._valueType=pe.Vector4,this._tempValue=new Ee),r.value instanceof we&&(this._valueSize=4,this._valueType=pe.Quaternion,this._tempValue=new we),r.value instanceof Float32Array)){var n=r.value.length;this._valueSize=n,this._valueType=pe.FloatArray,this._tempValue=new Float32Array(n)}this.keys.sort(function(o,s){return o.time-s.time})},a.evaluate=function(r){return this._evaluate(r,this._tempValue)},a.moveKey=function(r,e){this.keys[r]=e},a.removeKey=function(r){this.keys.splice(r,1);for(var e=this.keys,n=this.keys.length,o=0,s=n-1;s>=0;s--)e[s].time>length&&(o=e[s].time);this._length=o},a._evaluate=function(r,e){var n=this.keys,o=this.interpolation;this._valueType;var s=this.keys.length,l=this._currentIndex;l!==-1&&r<n[l].time&&(l=-1);for(var u=l+1;u<s&&!(r<n[u].time);)l++,u++;this._currentIndex=l;var c;if(l===-1)c=this._evaluateStep(0,e);else if(u===s)c=this._evaluateStep(l,e);else{var f=n[l].time,h=n[u].time-f,d=(r-f)/h,_=h;switch(o){case Ir.Linear:c=this._evaluateLinear(l,u,d,e);break;case Ir.Step:c=this._evaluateStep(l,e);break;case Ir.CubicSpine:case Ir.Hermite:c=this._evaluateHermite(l,u,d,_,e)}}return c},a._evaluateLinear=function(r,e,n,o){var s=this._valueType,l=this.keys;switch(s){case pe.Float:return l[r].value*(1-n)+l[e].value*n;case pe.FloatArray:for(var u=l[r].value,c=l[e].value,f=0,h=u.length;f<h;f++)o[f]=u[f]*(1-n)+c[f]*n;return o;case pe.Vector2:return $.lerp(l[r].value,l[e].value,n,o),o;case pe.Vector3:return C.lerp(l[r].value,l[e].value,n,o),o;case pe.Vector4:return Ee.lerp(l[r].value,l[e].value,n,o),o;case pe.Quaternion:return we.slerp(l[r].value,l[e].value,n,o),o}},a._evaluateStep=function(r,e){var n=this._valueType,o=this.keys;switch(n){case pe.Float:return o[r].value;case pe.FloatArray:for(var s=o[r].value,l=0,u=s.length;l<u;l++)e[l]=s[l];return e;case pe.Vector2:case pe.Vector3:case pe.Vector4:case pe.Quaternion:return e.copyFrom(o[r].value),e}},a._evaluateHermite=function(r,e,n,o,s){var l=this._valueSize,u=this.keys,c=u[r],f=u[e];switch(l){case 1:{var h=c.outTangent,d=f.inTangent,_=c.value,m=f.value;if(Number.isFinite(h)&&Number.isFinite(d)){var p=n*n,v=p*n,g=2*v-3*p+1,y=v-2*p+n,x=v-p,P=-2*v+3*p;return g*_+y*h*o+x*d*o+P*m}else return c.value}case 2:{var S=c.value,w=c.outTangent,b=f.value,E=f.inTangent,M=n*n,F=M*n,A=2*F-3*M+1,T=F-2*M+n,R=F-M,z=-2*F+3*M,L=w.x,N=E.x;return Number.isFinite(L)&&Number.isFinite(N)?s.x=A*S.x+T*L*o+R*N*o+z*b.x:s.x=S.x,L=w.y,N=E.y,Number.isFinite(L)&&Number.isFinite(N)?s.y=A*S.y+T*L*o+R*N*o+z*b.y:s.y=S.y,s}case 3:{var V=c.value,D=c.outTangent,j=f.value,I=f.inTangent,H=n*n,G=H*n,te=2*G-3*H+1,ie=G-2*H+n,fe=G-H,ce=-2*G+3*H,me=D.x,Me=I.x;return Number.isFinite(me)&&Number.isFinite(Me)?s.x=te*V.x+ie*me*o+fe*Me*o+ce*j.x:s.x=V.x,me=D.y,Me=I.y,Number.isFinite(me)&&Number.isFinite(Me)?s.y=te*V.y+ie*me*o+fe*Me*o+ce*j.y:s.y=V.y,me=D.z,Me=I.z,Number.isFinite(me)&&Number.isFinite(Me)?s.z=te*V.z+ie*me*o+fe*Me*o+ce*j.z:s.z=V.z,s}case 4:{var Ae=c.value,Oe=c.outTangent,$e=f.value,Je=f.inTangent,Te=n*n,Ze=Te*n,et=2*Ze-3*Te+1,qe=Ze-2*Te+n,tt=Ze-Te,bt=-2*Ze+3*Te,Re=Oe.x,Ke=Je.x;return Number.isFinite(Re)&&Number.isFinite(Ke)?s.x=et*Ae.x+qe*Re*o+tt*Ke*o+bt*$e.x:s.x=Ae.x,Re=Oe.y,Ke=Je.y,Number.isFinite(Re)&&Number.isFinite(Ke)?s.y=et*Ae.y+qe*Re*o+tt*Ke*o+bt*$e.y:s.y=Ae.y,Re=Oe.z,Ke=Je.z,Number.isFinite(Re)&&Number.isFinite(Ke)?s.z=et*Ae.z+qe*Re*o+tt*Ke*o+bt*$e.z:s.z=Ae.z,Re=Oe.w,Ke=Je.w,Number.isFinite(Re)&&Number.isFinite(Ke)?s.w=et*Ae.w+qe*Re*o+tt*Ke*o+bt*$e.w:s.w=Ae.w,s}}},Y(t,[{key:"length",get:function(){return this._length}}]),t}(),hm=function(){this.time=void 0,this.value=void 0},ti=function(t){q(a,t);function a(){for(var i,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return i=t.call.apply(t,[this].concat(e))||this,i.inTangent=void 0,i.outTangent=void 0,i}return a}(hm),rc;(function(t){t[t.If=0]="If",t[t.IfNot=1]="IfNot",t[t.Greater=2]="Greater",t[t.Less=3]="Less",t[t.Equals=4]="Equals",t[t.NotEquals=5]="NotEquals"})(rc||(rc={}));var dm=function(t){q(a,t);function a(i){var r;return r=t.call(this,i,O.find("skybox"))||this,r._decodeParam=new Ee(0,5,0,0),r.renderState.rasterState.cullMode=Qt.Off,r.renderState.depthState.compareFunction=Pe.LessEqual,r.shaderData.setVector4("u_cubeDecodeParam",r._decodeParam),r}return Y(a,[{key:"textureDecodeRGBM",get:function(){return Boolean(this._decodeParam.x)},set:function(r){this._decodeParam.x=Number(r)}},{key:"RGBMDecodeFactor",get:function(){return this._decodeParam.y},set:function(r){this._decodeParam.y=r}},{key:"textureCubeMap",get:function(){return this.shaderData.getTexture("u_cube")},set:function(r){this.shaderData.setTexture("u_cube",r)}}]),a}(Ar),_e;(function(t){t[t.Position=1]="Position",t[t.Velocity=2]="Velocity",t[t.Acceleration=4]="Acceleration",t[t.Color=8]="Color",t[t.Alpha=16]="Alpha",t[t.Size=32]="Size",t[t.StartAngle=64]="StartAngle",t[t.StartTime=128]="StartTime",t[t.LifeTime=256]="LifeTime",t[t.RotateVelocity=512]="RotateVelocity",t[t.Scale=1024]="Scale",t[t.Everything=4294967295]="Everything"})(_e||(_e={}));var aa;(function(t){t[t.Transparent=0]="Transparent",t[t.Additive=1]="Additive"})(aa||(aa={}));var _m=function(t){q(a,t),a._getRandom=function(){return Math.random()-.5};function a(r){var e;return e=t.call(this,r)||this,e._vertexStride=void 0,e._vertices=void 0,e._vertexBuffer=void 0,e._maxCount=1e3,e._position=new C,e._positionRandomness=new C,e._positionArray=void 0,e._velocity=new C,e._velocityRandomness=new C,e._acceleration=new C,e._accelerationRandomness=new C,e._color=new ne(1,1,1,1),e._colorRandomness=0,e._size=1,e._sizeRandomness=0,e._alpha=1,e._alphaRandomness=0,e._startAngle=0,e._startAngleRandomness=0,e._rotateVelocity=0,e._rotateVelocityRandomness=0,e._lifetime=5,e._startTimeRandomness=0,e._scale=1,e._isOnce=!1,e._onceTime=0,e._time=0,e._isInit=!1,e._isStart=!1,e._updateDirtyFlag=_e.Everything,e._isRotateToVelocity=!1,e._isUseOriginColor=!1,e._isScaleByLifetime=!1,e._is2d=!0,e._isFadeIn=!1,e._isFadeOut=!1,e._playOnEnable=!0,e._blendMode=aa.Transparent,e.spriteSheet=void 0,e.setMaterial(e._createMaterial()),e}var i=a.prototype;return i.update=function(e){if(!(!this._isInit||!this._isStart)){if(this._isOnce&&this._time>this._onceTime)return this.stop();this._updateDirtyFlag&&(this._updateBuffer(),this._updateDirtyFlag=0),this._time+=e/1e3,this.shaderData.setFloat("u_time",this._time)}},i._onEnable=function(){t.prototype._onEnable.call(this),this._playOnEnable&&this.start()},i.start=function(){this._isStart=!0,this._time=0},i.stop=function(){this._isStart=!1},i._createMaterial=function(){var e=new Ar(this.engine,O.find("particle-shader")),n=e.renderState,o=n.blendState.targetBlendState;return o.enabled=!0,o.sourceColorBlendFactor=ae.SourceAlpha,o.destinationColorBlendFactor=ae.OneMinusSourceAlpha,o.sourceAlphaBlendFactor=ae.One,o.destinationAlphaBlendFactor=ae.OneMinusSourceAlpha,n.depthState.writeEnabled=!1,e.renderQueueType=_t.Transparent,this.isUseOriginColor=!0,this.is2d=!0,this.isFadeOut=!0,e},i._createMesh=function(){var e=new xl(this._entity.engine,"particleMesh"),n=96,o=this._maxCount*4,s=o*n,l=new Float32Array(s),u=null,c=!1;if(o>a._uint16VertexLimit)if(this.engine._hardwareRenderer.canIUse(Z.elementIndexUint))c=!0,u=new Uint32Array(6*this._maxCount);else throw Error("The vertex count is over limit.");else u=new Uint16Array(6*this._maxCount);for(var f=0,h=0;f<this._maxCount;++f){var d=f*4;u[h++]=d,u[h++]=d+1,u[h++]=d+2,u[h++]=d,u[h++]=d+2,u[h++]=d+3}var _=[new xe("a_position",0,K.Vector3,0),new xe("a_velocity",12,K.Vector3,0),new xe("a_acceleration",24,K.Vector3,0),new xe("a_color",36,K.Vector4,0),new xe("a_lifeAndSize",52,K.Vector4,0),new xe("a_rotation",68,K.Vector2,0),new xe("a_uv",76,K.Vector3,0),new xe("a_normalizedUv",88,K.Vector2,0)],m=new nn(this.engine,br.VertexBuffer,s*4,Pt.Dynamic),p=new nn(this.engine,br.IndexBuffer,u,Pt.Dynamic);return e.setVertexBufferBinding(m,n),e.setIndexBufferBinding(p,c?ct.UInt32:ct.UInt16),e.setVertexElements(_),e.addSubMesh(0,u.length),this._vertexBuffer=m,this._vertexStride=n/4,this._vertices=l,e},i._updateBuffer=function(){for(var e=0;e<this._maxCount;e++)this._updateSingleBuffer(e);this._vertexBuffer.setData(this._vertices)},i._updateSingleBuffer=function(e){var n=this._updateDirtyFlag,o=this._vertices,s=this._vertexStride,l=a._getRandom,u=e*4,c=u*s,f=(u+1)*s,h=(u+2)*s,d=(u+3)*s;if(n&_e.Position){var _=this._position,m=_.x,p=_.y,v=_.z,g=this._positionArray,y=this._positionRandomness;if(g){if(g.length!==this._maxCount)throw Error("The length of positionArray must be equal to maxCount.");var x=g[e];m+=x.x,p+=x.y,v+=x.z}else m+=l()*y.x,p+=l()*y.y,v+=l()*y.z;o[c]=o[f]=o[h]=o[d]=m,o[c+1]=o[f+1]=o[h+1]=o[d+1]=p,o[c+2]=o[f+2]=o[h+2]=o[d+2]=v}if(n&_e.Velocity){var P=this._velocity,S=this._velocityRandomness;o[c+3]=o[f+3]=o[h+3]=o[d+3]=P.x+l()*S.x,o[c+4]=o[f+4]=o[h+4]=o[d+4]=P.y+l()*S.y,o[c+5]=o[f+5]=o[h+5]=o[d+5]=P.z+l()*S.z}if(n&_e.Acceleration){var w=this._acceleration,b=this._accelerationRandomness;o[c+6]=o[f+6]=o[h+6]=o[d+6]=w.x+l()*b.x,o[c+7]=o[f+7]=o[h+7]=o[d+7]=w.y+l()*b.y,o[c+8]=o[f+8]=o[h+8]=o[d+8]=w.z+l()*b.z}if(n&_e.Color){var E=this._color,M=this._colorRandomness;o[c+9]=o[f+9]=o[h+9]=o[d+9]=W.clamp(E.r+l()*M,0,1),o[c+10]=o[f+10]=o[h+10]=o[d+10]=W.clamp(E.g+l()*M,0,1),o[c+11]=o[f+11]=o[h+11]=o[d+11]=W.clamp(E.b+l()*M,0,1)}if(n&_e.Alpha&&(o[c+12]=o[f+12]=o[h+12]=o[d+12]=W.clamp(this._alpha+l()*this._alphaRandomness,0,1)),n&_e.StartTime&&(o[c+13]=o[f+13]=o[h+13]=o[d+13]=Math.random()*this._startTimeRandomness),n&_e.LifeTime){var F=this._lifetime;o[c+14]=o[f+14]=o[h+14]=o[d+14]=F+l()*F}if((n&_e.StartTime||n&_e.LifeTime)&&(this._onceTime=Math.max(this._onceTime,o[c+13]+o[c+14])),n&_e.Size){var A=this._size;o[c+15]=o[f+15]=o[h+15]=o[d+15]=Math.max(A+l()*this._sizeRandomness*A*2,0)}n&_e.Scale&&(o[c+16]=o[f+16]=o[h+16]=o[d+16]=this._scale),n&_e.StartAngle&&(o[c+17]=o[f+17]=o[h+17]=o[d+17]=this._startAngle+l()*Math.PI*this._startAngleRandomness*2),n&_e.RotateVelocity&&(o[c+18]=o[f+18]=o[h+18]=o[d+18]=this._rotateVelocity+l()*this._rotateVelocityRandomness),this._updateSingleUv(e,c,f,h,d)},i._updateSingleUv=function(e,n,o,s,l){var u=this.spriteSheet,c=this.getMaterial().shaderData.getTexture("u_texture"),f=this._vertices;if(c){var h=c.width,d=c.height;if(u){var _=u[e%u.length],m=_.x,p=_.y,v=_.w,g=_.h,y=m/h,x=p/d,P=y+v/h,S=x+g/d,w=g/v;f[n+19]=y,f[n+20]=S,f[n+21]=w,f[o+19]=P,f[o+20]=S,f[o+21]=w,f[s+19]=P,f[s+20]=x,f[s+21]=w,f[l+19]=y,f[l+20]=x,f[l+21]=w}else{var b=d/h;f[n+19]=0,f[n+20]=1,f[n+21]=b,f[o+19]=1,f[o+20]=1,f[o+21]=b,f[s+19]=1,f[s+20]=0,f[s+21]=b,f[l+19]=0,f[l+20]=0,f[l+21]=b}}else f[n+19]=0,f[n+20]=0,f[n+21]=1,f[o+19]=1,f[o+20]=0,f[o+21]=1,f[s+19]=1,f[s+20]=1,f[s+21]=1,f[l+19]=0,f[l+20]=1,f[l+21]=1;f[n+22]=-.5,f[n+23]=-.5,f[o+22]=.5,f[o+23]=-.5,f[s+22]=.5,f[s+23]=.5,f[l+22]=-.5,f[l+23]=.5},Y(a,[{key:"texture",get:function(){return this.getMaterial().shaderData.getTexture("u_texture")},set:function(e){e?(this.shaderData.enableMacro("particleTexture"),this.getMaterial().shaderData.setTexture("u_texture",e)):this.shaderData.disableMacro("particleTexture")}},{key:"position",get:function(){return this._position},set:function(e){this._updateDirtyFlag|=_e.Position,this._position=e}},{key:"positionRandomness",get:function(){return this._positionRandomness},set:function(e){this._updateDirtyFlag|=_e.Position,this._positionRandomness=e}},{key:"positionArray",get:function(){return this._positionArray},set:function(e){this._updateDirtyFlag|=_e.Position,this._positionArray=e}},{key:"velocity",get:function(){return this._velocity},set:function(e){this._updateDirtyFlag|=_e.Velocity,this._velocity=e}},{key:"velocityRandomness",get:function(){return this._velocityRandomness},set:function(e){this._updateDirtyFlag|=_e.Velocity,this._velocityRandomness=e}},{key:"acceleration",get:function(){return this._acceleration},set:function(e){this._updateDirtyFlag|=_e.Acceleration,this._acceleration=e}},{key:"accelerationRandomness",get:function(){return this._accelerationRandomness},set:function(e){this._updateDirtyFlag|=_e.Acceleration,this._accelerationRandomness=e}},{key:"color",get:function(){return this._color},set:function(e){this._updateDirtyFlag|=_e.Color,this._color=e}},{key:"colorRandomness",get:function(){return this._colorRandomness},set:function(e){this._updateDirtyFlag|=_e.Color,this._colorRandomness=e}},{key:"size",get:function(){return this._size},set:function(e){this._updateDirtyFlag|=_e.Size,this._size=e}},{key:"sizeRandomness",get:function(){return this._sizeRandomness},set:function(e){this._updateDirtyFlag|=_e.Size,this._sizeRandomness=e}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._updateDirtyFlag|=_e.Alpha,this._alpha=e}},{key:"alphaRandomness",get:function(){return this._alphaRandomness},set:function(e){this._updateDirtyFlag|=_e.Alpha,this._alphaRandomness=e}},{key:"angle",get:function(){return this._startAngle},set:function(e){this._updateDirtyFlag|=_e.StartAngle,this._startAngle=e}},{key:"angleRandomness",get:function(){return this._startAngleRandomness},set:function(e){this._updateDirtyFlag|=_e.StartAngle,this._startAngleRandomness=e}},{key:"rotateVelocity",get:function(){return this._rotateVelocity},set:function(e){this._updateDirtyFlag|=_e.RotateVelocity,this._rotateVelocity=e}},{key:"rotateVelocityRandomness",get:function(){return this._rotateVelocityRandomness},set:function(e){this._updateDirtyFlag|=_e.RotateVelocity,this._rotateVelocityRandomness=e}},{key:"lifetime",get:function(){return this._lifetime},set:function(e){this._updateDirtyFlag|=_e.LifeTime,this._lifetime=e,this._onceTime=0}},{key:"startTimeRandomness",get:function(){return this._startTimeRandomness},set:function(e){this._updateDirtyFlag|=_e.StartTime,this._startTimeRandomness=e,this._onceTime=0}},{key:"scale",get:function(){return this._scale},set:function(e){this._updateDirtyFlag|=_e.Scale,this._scale=e}},{key:"maxCount",get:function(){return this._maxCount},set:function(e){this._isStart=!1,this._isInit=!1,this._maxCount=e,this._updateDirtyFlag=_e.Everything,this.mesh=this._createMesh(),this._updateBuffer(),this._isInit=!0,this.shaderData.setFloat("u_time",0)}},{key:"isOnce",get:function(){return this._isOnce},set:function(e){this._time=0,this.shaderData.setInt("u_once",e?1:0),this._isOnce=e}},{key:"isRotateToVelocity",get:function(){return this._isRotateToVelocity},set:function(e){e?this.shaderData.enableMacro("rotateToVelocity"):this.shaderData.disableMacro("rotateToVelocity"),this._isRotateToVelocity=e}},{key:"isUseOriginColor",get:function(){return this._isUseOriginColor},set:function(e){e?this.shaderData.enableMacro("useOriginColor"):this.shaderData.disableMacro("useOriginColor"),this._isUseOriginColor=e}},{key:"isScaleByLifetime",get:function(){return this._isScaleByLifetime},set:function(e){e?this.shaderData.enableMacro("isScaleByLifetime"):this.shaderData.disableMacro("isScaleByLifetime"),this._isScaleByLifetime=e}},{key:"is2d",get:function(){return this._is2d},set:function(e){e?this.shaderData.enableMacro("is2d"):(this.shaderData.disableMacro("is2d"),this.getMaterial().renderState.rasterState.cullMode=Qt.Off),this._is2d=e}},{key:"isFadeIn",get:function(){return this._isFadeIn},set:function(e){e?this.shaderData.enableMacro("fadeIn"):this.shaderData.disableMacro("fadeIn"),this._isFadeIn=e}},{key:"isFadeOut",get:function(){return this._isFadeOut},set:function(e){e?this.shaderData.enableMacro("fadeOut"):this.shaderData.disableMacro("fadeOut"),this._isFadeOut=e}},{key:"playOnEnable",get:function(){return this._playOnEnable},set:function(e){this._playOnEnable=e,e?this.start():this.stop()}},{key:"blendMode",get:function(){return this._blendMode},set:function(e){var n=this.getMaterial().renderState.blendState,o=n.targetBlendState;e===aa.Transparent?(o.enabled=!0,o.sourceColorBlendFactor=ae.SourceAlpha,o.destinationColorBlendFactor=ae.OneMinusSourceAlpha,o.sourceAlphaBlendFactor=ae.One,o.destinationAlphaBlendFactor=ae.OneMinusSourceAlpha):e===aa.Additive&&(o.enabled=!0,o.sourceColorBlendFactor=ae.SourceAlpha,o.destinationColorBlendFactor=ae.One,o.sourceAlphaBlendFactor=ae.One,o.destinationAlphaBlendFactor=ae.OneMinusSourceAlpha),this._blendMode=e}}]),a}(Ho);_m._uint16VertexLimit=65535;var hS=`#define GLSLIFY 1
varying vec2 v_uv;uniform sampler2D u_texture;void main(void){gl_FragColor=texture2D(u_texture,v_uv);}`,dS=`#define GLSLIFY 1
attribute vec3 POSITION;attribute vec2 TEXCOORD_0;varying vec2 v_uv;uniform mat4 u_projMat;uniform mat4 u_viewMat;void main(){gl_Position=u_projMat*u_viewMat*vec4(POSITION,1.0);v_uv=TEXCOORD_0;}`;O.create("trail",dS,hS);var vm=function(t){q(a,t);function a(i){var r;r=t.call(this,i,O.find("trail"))||this;var e=r.renderState.blendState.targetBlendState;return e.enabled=!0,e.sourceColorBlendFactor=e.sourceAlphaBlendFactor=ae.SourceAlpha,e.destinationColorBlendFactor=e.destinationAlphaBlendFactor=ae.One,r.renderState.depthState.writeEnabled=!1,r}return a}(Ar),mv=new C,_S=function(t){q(a,t);function a(r,e){var n;n=t.call(this,r)||this,n._vertexStride=void 0,n._vertices=void 0,n._vertexBuffer=void 0,n._stroke=void 0,n._minSeg=void 0,n._lifetime=void 0,n._maxPointNum=void 0,n._points=void 0,n._pointStates=void 0,n._strapPoints=void 0,n._curPointNum=void 0,n._prePointsNum=void 0,n._stroke=e.stroke||.2,n._minSeg=e.minSeg||.02,n._lifetime=e.lifetime||1e3,n._maxPointNum=n._lifetime/1e3*r.engine.targetFrameRate,n._points=[],n._pointStates=[],n._strapPoints=[];for(var o=0;o<n._maxPointNum;o++)n._points.push(new C),n._pointStates.push(n._lifetime),n._strapPoints.push(new C),n._strapPoints.push(new C);n._curPointNum=0;var s=e.material||new vm(n.engine);return n.setMaterial(s),n.setTexture(e.texture),n._initGeometry(),n}var i=a.prototype;return i.update=function(e){for(var n=0,o=0,s=0;s<this._curPointNum;s++)this._pointStates[s]-=e,this._pointStates[s]<0?n++:n>0&&(o=s-n,this._pointStates[o]=this._pointStates[s],this._points[o].copyFrom(this._points[s]));this._curPointNum-=n;var l=!0;if(this._curPointNum===this._maxPointNum)l=!1;else if(this._curPointNum>0){var u=this._points[this._points.length-1];C.distance(this.entity.transform.worldPosition,u)<this._minSeg&&(l=!1)}l&&(this._pointStates[this._curPointNum]=this._lifetime,this._points[this._curPointNum].copyFrom(this.entity.transform.worldPosition),this._curPointNum++)},i._render=function(e){this._updateStrapVertices(e,this._points),this._updateStrapCoords(),this._vertexBuffer.setData(this._vertices),t.prototype._render.call(this,e)},i.setTexture=function(e){e&&this.getMaterial().shaderData.setTexture("u_texture",e)},i._initGeometry=function(){var e=new xl(this._entity.engine),n=20,o=this._maxPointNum*2,s=o*n,l=new Float32Array(s),u=[new xe("POSITION",0,K.Vector3,0),new xe("TEXCOORD_0",12,K.Vector2,0)],c=new nn(this.engine,s*4,Pt.Dynamic);e.setVertexBufferBinding(c,n),e.setVertexElements(u),e.addSubMesh(0,o,yi.TriangleStrip),this._vertexBuffer=c,this._vertexStride=n,this._vertices=l,this.mesh=e},i._updateStrapVertices=function(e,n){var o=e.viewMatrix,s=o.elements,l=new C(s[0],s[4],s[8]),u=new C(s[1],s[5],s[9]),c=new C(s[2],s[6],s[10]),f=this._stroke;u.scale(f);var h=new C,d=new C,_=new we;C.transformByQuat(l,_,l),C.transformByQuat(u,_,u);var m=new C,p=new C,v=new C;l.normalize();for(var g=this._vertices,y=0;y<this._maxPointNum;y++){if(y<this._curPointNum){var x=n[y];y===this._curPointNum-1&&y!==0?C.subtract(x,n[y-1],v):C.subtract(n[y+1],x,v),this._projectOnPlane(v,c,v),v.normalize();var P=Math.acos(C.dot(l,v));C.cross(l,v,p),C.dot(p,c)<=0&&(P=Math.PI*2-P),we.rotationAxisAngle(c,P,_),C.transformByQuat(u,_,m),C.add(x,m,h),C.subtract(x,m,d)}var S=y*2*this._vertexStride/4,w=(y*2+1)*this._vertexStride/4;g[S]=h.x,g[S+1]=h.y,g[S+2]=h.z,g[w]=d.x,g[w+1]=d.y,g[w+2]=d.z}},i._updateStrapCoords=function(){if(this._prePointsNum!==this._curPointNum){this._prePointsNum=this._curPointNum;for(var e=this._curPointNum,n=1/e,o=this._vertices,s=0;s<e;s++){var l=1-s*n,u=s*2*this._vertexStride/4,c=(s*2+1)*this._vertexStride/4;o[u]=0,o[u+1]=l,o[c]=1,o[c+1]=l}}},i._projectOnVector=function(e,n,o){var s=n.clone();C.normalize(s,s);var l=C.dot(e,s);o.x=s.x*l,o.y=s.y*l,o.z=s.z*l},i._projectOnPlane=function(e,n,o){this._projectOnVector(e,n,mv),C.subtract(e,mv,o)},a}(Ho),Pl=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,e._color=new ne(1,0,0,1),e.color=e._color,e}var i=a.prototype;return i._onEnable=function(){this.scene.shaderData.enableMacro("O3_HAS_FOG")},i._onDisable=function(){this.scene.shaderData.disableMacro("O3_HAS_FOG")},Y(a,[{key:"color",get:function(){return this._color},set:function(e){this._color=e,this.scene.shaderData.setColor(a._colorProperty,e)}}]),a}(hr);Pl._colorProperty=O.getPropertyByName("u_fogColor");var pm=function(t){q(a,t);function a(r){var e;return e=t.call(this,r)||this,e._density=.0025,e.density=e._density,e}var i=a.prototype;return i._onEnable=function(){this.scene.shaderData.enableMacro("O3_FOG_EXP2")},i._onDisable=function(){this.scene.shaderData.disableMacro("O3_FOG_EXP2")},Y(a,[{key:"density",get:function(){return this._density},set:function(e){this._density=e,this.scene.shaderData.setFloat(a._densityProperty,e)}}]),a}(Pl);pm._densityProperty=O.getPropertyByName("u_fogDensity");var mf=function(t){q(a,t);function a(i){var r;return r=t.call(this,i)||this,r._near=1,r._far=1e3,r.near=r._near,r.far=r._far,r}return Y(a,[{key:"near",get:function(){return this._near},set:function(r){this._near=r,this.scene.shaderData.setFloat(a._nearProperty,r)}},{key:"far",get:function(){return this._far},set:function(r){this._far=r,this.scene.shaderData.setFloat(a._farProperty,r)}}]),a}(Pl);mf._nearProperty=O.getPropertyByName("u_fogNear");mf._farProperty=O.getPropertyByName("u_fogFar");var gm=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.probeLayer=Ut.Everything,r.width=1024,r.height=1024,r.antiAliasing=1,r._isCube=!1,r._oriCameraRenderTarget=void 0,r._renderTarget=void 0,r._renderTargetSwap=void 0,r._activeRenderTarget=void 0,r._camera=void 0,r._oriCameraCullingMask=void 0,r}var i=a.prototype;return i.onTextureChange=function(e){},i.onBeginRender=function(e){!this.enabled||(this._camera=e,this._oriCameraCullingMask=e.cullingMask,e.cullingMask=this.probeLayer,(!this._activeRenderTarget||this._activeRenderTarget.width!==this.width||this._activeRenderTarget.height!==this.height||this._activeRenderTarget.antiAliasing!==this.antiAliasing)&&(this._renderTarget=new Ys(this.engine,this.width,this.height,this._isCube?new $t(this.engine,this.width):new cr(this.engine,this.width,this.height),lt.Depth,this.antiAliasing),this._renderTargetSwap=new Ys(this.engine,this.width,this.height,this._isCube?new $t(this.engine,this.width):new cr(this.engine,this.width,this.height),lt.Depth,this.antiAliasing),this._activeRenderTarget=this._renderTarget),this._oriCameraRenderTarget=e.renderTarget,e.renderTarget=this._activeRenderTarget)},i.onEndRender=function(e){!this.enabled||(this.onTextureChange&&this.onTextureChange(this._texture),this._activeRenderTarget=this._activeRenderTarget===this._renderTarget?this._renderTargetSwap:this._renderTarget)},i._reset=function(){!this.enabled||(this._camera.renderTarget=this._oriCameraRenderTarget,this._camera.cullingMask=this._oriCameraCullingMask)},Y(a,[{key:"_texture",get:function(){var e;return(e=this._activeRenderTarget)===null||e===void 0?void 0:e.getColorTexture()}}]),a}(Sl),yv=new C,Yn=new C,Qn=new C,vS=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.position=new C(0,0,0),r._isCube=!0,r.oriViewMatrix=new re,r._oriFieldOfView=void 0,r}var i=a.prototype;return i.onBeginRender=function(e){if(!!this.enabled){t.prototype.onBeginRender.call(this,e),this._storeCamera(e);for(var n=0;n<6;n++)this._setCamera(n,e),e.render(Vt.PositiveX+n);this._restoreCamera(e),t.prototype._reset.call(this)}},i._storeCamera=function(e){this.oriViewMatrix.copyFrom(e.viewMatrix),this._oriFieldOfView=e.fieldOfView},i._restoreCamera=function(e){e.viewMatrix.copyFrom(this.oriViewMatrix),e.fieldOfView=this._oriFieldOfView},i._setCamera=function(e,n){switch(e){case 0:Yn.set(0,-1,0),Qn.set(1,0,0);break;case 1:Yn.set(0,-1,0),Qn.set(-1,0,0);break;case 2:Yn.set(0,0,1),Qn.set(0,1,0);break;case 3:Yn.set(0,0,-1),Qn.set(0,-1,0);break;case 4:Yn.set(0,-1,0),Qn.set(0,0,1);break;case 5:Yn.set(0,-1,0),Qn.set(0,0,-1);break}C.add(this.position,Qn,yv),re.lookAt(this.position,yv,Yn,n.viewMatrix),n.fieldOfView=90},a}(gm),ut=function(){t._updateShaderData=function(r){var e=t._combinedData;r.setFloatArray(t._viewMatFromLightProperty,e.viewMatrix),r.setFloatArray(t._projMatFromLightProperty,e.projectionMatrix),r.setFloatArray(t._shadowBiasProperty,e.bias),r.setFloatArray(t._shadowIntensityProperty,e.intensity),r.setFloatArray(t._shadowRadiusProperty,e.radius),r.setFloatArray(t._shadowMapSizeProperty,e.mapSize),r.setTextureArray(t._shadowMapsProperty,e.map)},t.clearMap=function(){t._combinedData.map.length=0};function t(i,r){r===void 0&&(r={engine:null,width:512,height:512}),this._mapSize=void 0,this._renderTarget=void 0,this.light=void 0,this.bias=.005,this.intensity=.2,this.radius=1,this.projectionMatrix=new re,this.light=i;var e=r,n=e.engine,o=e.width,s=e.height;this._mapSize=new $(o,s),this._renderTarget=new Ys(n,o,s,new cr(n,o,s))}var a=t.prototype;return a.initShadowProjectionMatrix=function(r){if(r instanceof an&&re.ortho(-5,5,-5,5,.1,50,this.projectionMatrix),r instanceof on&&re.perspective(W.degreeToRadian(50),1,.5,50,this.projectionMatrix),r instanceof Kt){var e=Math.min(Math.PI/2,r.angle*2*Math.sqrt(2));re.perspective(e,1,.1,r.distance+5,this.projectionMatrix)}},a.appendData=function(r){var e=r*16,n=r*16,o=r,s=r,l=r,u=r*2,c=r,f=t._combinedData;f.viewMatrix.set(this.light.viewMatrix.elements,e),f.projectionMatrix.set(this.projectionMatrix.elements,n),f.bias[o]=this.bias,f.intensity[s]=this.intensity,f.radius[l]=this.radius,f.mapSize[u]=this.mapSize.x,f.mapSize[u+1]=this.mapSize.y,f.map[c]=this.map},Y(t,[{key:"renderTarget",get:function(){return this._renderTarget}},{key:"map",get:function(){return this._renderTarget.getColorTexture()}},{key:"mapSize",get:function(){return this._mapSize}}]),t}();ut._viewMatFromLightProperty=O.getPropertyByName("u_viewMatFromLight");ut._projMatFromLightProperty=O.getPropertyByName("u_projMatFromLight");ut._shadowBiasProperty=O.getPropertyByName("u_shadowBias");ut._shadowIntensityProperty=O.getPropertyByName("u_shadowIntensity");ut._shadowRadiusProperty=O.getPropertyByName("u_shadowRadius");ut._shadowMapSizeProperty=O.getPropertyByName("u_shadowMapSize");ut._shadowMapsProperty=O.getPropertyByName("u_shadowMaps");ut._maxLight=3;ut._combinedData={viewMatrix:new Float32Array(16*ut._maxLight),projectionMatrix:new Float32Array(16*ut._maxLight),bias:new Float32Array(ut._maxLight),intensity:new Float32Array(ut._maxLight),radius:new Float32Array(ut._maxLight),mapSize:new Float32Array(2*ut._maxLight),map:[]};Object.defineProperty(pt.prototype,"enableShadow",{get:function(){return this._enableShadow},set:function(a){if(this._enableShadow=a,this._enableShadow){if(this instanceof er){this._enableShadow=!1,de.warn("Has no shadow!");return}this.shadow=this.shadow||new ut(this,{engine:this.engine,width:512,height:512}),this.shadow.initShadowProjectionMatrix(this)}}});Object.defineProperty(hr.prototype,"receiveShadow",{get:function(){return this._receiveShadow},set:function(a){this._receiveShadow=a}});Object.defineProperty(hr.prototype,"castShadow",{get:function(){return this._castShadow},set:function(a){this._castShadow=a}});var pS=function(t){q(a,t);function a(i){var r;return r=t.call(this,i,O.find("shadow-map"))||this,r.shaderData.enableMacro("O3_GENERATE_SHADOW_MAP"),r}return a}(Ar),yf=function(t){q(a,t);function a(r,e,n,o,s,l){var u;return u=t.call(this,r,e,n,o,s)||this,u.light=void 0,u.light=l,u.clearColor=new ne(1,1,1,1),u}var i=a.prototype;return i.preRender=function(e,n){var o=this.replaceMaterial.shaderData;o.setMatrix(a._viewMatFromLightProperty,this.light.viewMatrix),o.setMatrix(a._projMatFromLightProperty,this.light.shadow.projectionMatrix)},a}(ci);yf._viewMatFromLightProperty=O.getPropertyByName("u_viewMatFromLight");yf._projMatFromLightProperty=O.getPropertyByName("u_projMatFromLight");var gS=function(t){q(a,t);function a(i){var r;r=t.call(this,i,O.find("shadow"))||this;var e=r.renderState.blendState.targetBlendState;return e.enabled=!0,e.sourceColorBlendFactor=e.sourceAlphaBlendFactor=ae.DestinationColor,e.destinationColorBlendFactor=e.destinationAlphaBlendFactor=ae.Zero,r.renderState.depthState.compareFunction=Pe.LessEqual,r.renderQueueType=_t.Transparent,r}return a}(Ar),mS=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.clearFlags=Tr.None,r}var i=a.prototype;return i.preRender=function(e,n){this.enabled=!1;var o=e.scene.findFeature(xi),s=o.visibleLights,l=this.replaceMaterial.shaderData,u=e._renderPipeline.defaultRenderPass;this.renderTarget=u.renderTarget;var c=0;ut.clearMap();for(var f=0,h=s.length;f<h;f++){var d=s[f];d.enableShadow&&d.shadow.appendData(c++)}c?(this.enabled=!0,ut._updateShaderData(l),l.enableMacro("O3_SHADOW_MAP_COUNT",c.toString())):l.disableMacro("O3_SHADOW_MAP_COUNT")},a}(ci),yS=function(t){q(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r._shadowPass=void 0,r._shadowMapMaterial=void 0,r}var i=a.prototype;return i.preRender=function(e,n){var o=e.findFeature(xi).visibleLights;if(o.length>0){this._shadowPass||this.addShadowPass(n);for(var s=n._renderPipeline,l=0,u=o.length;l<u;l++){var c=o[l];c.enableShadow&&!c.shadowMapPass?c.shadowMapPass=this.addShadowMapPass(n,c):!c.enableShadow&&c.shadowMapPass&&(s.removeRenderPass(c.shadowMapPass),c.shadowMapPass=null)}this.updatePassRenderFlag(s._opaqueQueue),this.updatePassRenderFlag(s._alphaTestQueue),this.updatePassRenderFlag(s._transparentQueue)}},i.addShadowPass=function(e){var n=new gS(e.engine);this._shadowPass=new mS("ShadowPass",1,null,n,Ut.Layer30);var o=e._renderPipeline;o.addRenderPass(this._shadowPass)},i.addShadowMapPass=function(e,n){this._shadowMapMaterial=this._shadowMapMaterial||new pS(e.engine);var o=new yf("ShadowMapPass",-1,n.shadow.renderTarget,this._shadowMapMaterial,Ut.Layer31,n),s=e._renderPipeline;return s.addRenderPass(o),o},i.updatePassRenderFlag=function(e){for(var n=e.items,o=0,s=n.length;o<s;o++){var l=n[o],u=l.component,c=u.receiveShadow,f=u.castShadow;c===!0?u.entity.layer|=Ut.Layer30:c===!1&&(u.entity.layer&=~Ut.Layer30),f===!0?u.entity.layer|=Ut.Layer31:f===!1&&(u.entity.layer&=~Ut.Layer31)}},a}(ff);tn.registerFeature(yS);tn.registerFeature(xi);tn.prototype.hasLight=Sw;var xv=Object.freeze(Object.defineProperty({__proto__:null,AmbientLight:er,AnimationClip:lm,AnimationClipCurveBinding:om,AnimationCurve:fm,AnimationEvent:sm,get AnimationProperty(){return he},Animator:um,get AnimatorConditionMode(){return rc},AnimatorController:vf,AnimatorControllerLayer:pf,get AnimatorLayerBlendingMode(){return Ro},AnimatorState:cm,AnimatorStateMachine:gf,AnimatorStateTransition:_f,AssetPromise:Xe,get AssetPromiseStatus(){return li},get AssetType(){return je},Background:em,get BackgroundMode(){return en},get BackgroundTextureFillMode(){return Pn},BaseMaterial:Tt,BasicRenderPipeline:nm,get BlendFactor(){return ae},get BlendMode(){return ia},get BlendOperation(){return Xt},BlendShape:cf,BlendShapeFrame:K0,BlinnPhongMaterial:Pa,BoolUpdateFlag:Uo,BoxColliderShape:ex,Buffer:nn,get BufferBindFlag(){return br},BufferMesh:xl,get BufferUsage(){return Pt},BufferUtil:Eo,Camera:Cl,get CameraClearFlags(){return Tr},CapsuleColliderShape:nx,CharacterController:Z1,CloneManager:ur,Collider:Hn,ColliderShape:Ca,get ColliderShapeUpAxis(){return bo},get CollisionDetectionMode(){return $s},get ColorSpace(){return Bn},get ColorWriteMask(){return Pr},get CompareFunction(){return Pe},Component:hr,get ControllerCollisionFlag(){return Ku},get ControllerNonWalkableMode(){return Xs},CubeProbe:vS,get CullMode(){return Qt},get DataType(){return Ue},get DiffuseMode(){return va},DirectLight:an,DynamicCollider:cx,get DynamicColliderConstraints(){return Zu},EXP2Fog:pm,Engine:Er,EngineFeature:Ww,EngineObject:ln,Entity:Qr,Event:Ju,EventDispatcher:I0,FixedJoint:ix,Fog:Pl,Font:Qs,get FontStyle(){return An},get GLCapabilityType(){return Z},HingeJoint:ax,HitResult:V0,IndexBufferBinding:qs,get IndexFormat(){return ct},InputManager:W0,InterpolableKeyframe:ti,get InterpolableValueType(){return pe},get InterpolationType(){return Ir},Joint:pl,JointLimits:sx,JointMotor:lx,Keyframe:hm,get Keys(){return tr},get Layer(){return Ut},Light:pt,LinearFog:mf,ListenerUpdateFlag:vl,Loader:ke,Logger:de,Material:Ar,Mesh:lf,MeshRenderElement:$0,MeshRenderer:Ho,get MeshTopology(){return yi},ModelMesh:wr,ObjectValues:Qu,get OverflowMode(){return wi},PBRBaseMaterial:Mr,PBRMaterial:Aa,PBRSpecularMaterial:Ti,ParticleRenderer:_m,get ParticleRendererBlendMode(){return aa},PhysicsManager:jt,PhysicsMaterial:G0,get PhysicsMaterialCombineMode(){return To},PlaneColliderShape:rx,PointLight:on,Pointer:H0,get PointerButton(){return Lr},get PointerPhase(){return xr},PrimitiveMesh:J0,Probe:gm,RefObject:un,get RenderBufferDepthFormat(){return lt},get RenderFace(){return Jr},RenderPass:ci,RenderQueue:ei,get RenderQueueType(){return _t},RenderTarget:Ys,Renderer:Go,ResourceManager:No,Scene:tn,SceneFeature:ff,SceneManager:tm,Script:Sl,get SetDataOptions(){return Mo},Shader:O,ShaderData:Vo,ShaderFactory:Zn,ShaderProperty:af,get ShaderPropertyType(){return zt},Skin:Q0,SkinnedMeshRenderer:_a,Sky:Z0,SkyBoxMaterial:dm,SphereColliderShape:tx,SpotLight:Kt,SpringJoint:ox,Sprite:df,SpriteAtlas:im,get SpriteDrawMode(){return xn},SpriteElement:q0,SpriteMask:ec,get SpriteMaskInteraction(){return ar},get SpriteMaskLayer(){return da},SpriteRenderer:tS,StateMachineScript:tc,StaticCollider:ux,get StencilOperation(){return it},SubMesh:sf,SystemInfo:Hw,get TextHorizontalAlignment(){return hi},TextRenderer:iS,get TextVerticalAlignment(){return di},Texture:Ur,Texture2D:cr,Texture2DArray:uf,get TextureCoordinate(){return Dn},TextureCube:$t,get TextureCubeFace(){return Vt},get TextureFilterMode(){return or},get TextureFormat(){return J},get TextureWrapMode(){return Gt},Time:N0,TrailMaterial:vm,TrailRenderer:_S,Transform:Yt,UnlitMaterial:hf,Util:ws,VertexBufferBinding:yl,VertexElement:xe,get VertexElementFormat(){return K},get WrapMode(){return Fo},assignmentClone:Be,deepClone:Ve,dependentComponents:ko,ignoreClone:Q,request:oo,resourceLoader:ht,shallowClone:O0},Symbol.toStringTag,{value:"Module"})),oe;(function(t){t[t.RGBA_ASTC_4X4_KHR=37808]="RGBA_ASTC_4X4_KHR",t[t.RGBA_ASTC_5X4_KHR=37809]="RGBA_ASTC_5X4_KHR",t[t.RGBA_ASTC_5X5_KHR=37810]="RGBA_ASTC_5X5_KHR",t[t.RGBA_ASTC_6X5_KHR=37811]="RGBA_ASTC_6X5_KHR",t[t.RGBA_ASTC_6X6_KHR=37812]="RGBA_ASTC_6X6_KHR",t[t.RGBA_ASTC_8X5_KHR=37813]="RGBA_ASTC_8X5_KHR",t[t.RGBA_ASTC_8X6_KHR=37814]="RGBA_ASTC_8X6_KHR",t[t.RGBA_ASTC_8X8_KHR=37815]="RGBA_ASTC_8X8_KHR",t[t.RGBA_ASTC_10X5_KHR=37816]="RGBA_ASTC_10X5_KHR",t[t.RGBA_ASTC_10X6_KHR=37817]="RGBA_ASTC_10X6_KHR",t[t.RGBA_ASTC_10X8_KHR=37818]="RGBA_ASTC_10X8_KHR",t[t.RGBA_ASTC_10X10_KHR=37819]="RGBA_ASTC_10X10_KHR",t[t.RGBA_ASTC_12X10_KHR=37820]="RGBA_ASTC_12X10_KHR",t[t.RGBA_ASTC_12X12_KHR=37821]="RGBA_ASTC_12X12_KHR",t[t.SRGB8_ALPHA8_ASTC_4X4_KHR=37840]="SRGB8_ALPHA8_ASTC_4X4_KHR",t[t.SRGB8_ALPHA8_ASTC_5X4_KHR=37841]="SRGB8_ALPHA8_ASTC_5X4_KHR",t[t.SRGB8_ALPHA8_ASTC_5X5_KHR=37842]="SRGB8_ALPHA8_ASTC_5X5_KHR",t[t.SRGB8_ALPHA8_ASTC_6X5_KHR=37843]="SRGB8_ALPHA8_ASTC_6X5_KHR",t[t.SRGB8_ALPHA8_ASTC_6X6_KHR=37844]="SRGB8_ALPHA8_ASTC_6X6_KHR",t[t.SRGB8_ALPHA8_ASTC_8X5_KHR=37845]="SRGB8_ALPHA8_ASTC_8X5_KHR",t[t.SRGB8_ALPHA8_ASTC_8X6_KHR=37846]="SRGB8_ALPHA8_ASTC_8X6_KHR",t[t.SRGB8_ALPHA8_ASTC_8X8_KHR=37847]="SRGB8_ALPHA8_ASTC_8X8_KHR",t[t.SRGB8_ALPHA8_ASTC_10X5_KHR=37848]="SRGB8_ALPHA8_ASTC_10X5_KHR",t[t.SRGB8_ALPHA8_ASTC_10X6_KHR=37849]="SRGB8_ALPHA8_ASTC_10X6_KHR",t[t.SRGB8_ALPHA8_ASTC_10X8_KHR=37850]="SRGB8_ALPHA8_ASTC_10X8_KHR",t[t.SRGB8_ALPHA8_ASTC_10X10_KHR=37851]="SRGB8_ALPHA8_ASTC_10X10_KHR",t[t.SRGB8_ALPHA8_ASTC_12X10_KHR=37852]="SRGB8_ALPHA8_ASTC_12X10_KHR",t[t.SRGB8_ALPHA8_ASTC_12X12_KHR=37853]="SRGB8_ALPHA8_ASTC_12X12_KHR",t[t.RGB_ETC1_WEBGL=36196]="RGB_ETC1_WEBGL",t[t.R11_EAC=37488]="R11_EAC",t[t.SIGNED_R11_EAC=37489]="SIGNED_R11_EAC",t[t.RG11_EAC=37490]="RG11_EAC",t[t.SIGNED_RG11_EAC=37491]="SIGNED_RG11_EAC",t[t.RGB8_ETC2=37492]="RGB8_ETC2",t[t.SRGB8_ETC2=37493]="SRGB8_ETC2",t[t.RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.RGBA8_ETC2_EAC=37496]="RGBA8_ETC2_EAC",t[t.SRGB8_ALPHA8_ETC2_EAC=37497]="SRGB8_ALPHA8_ETC2_EAC",t[t.RGB_PVRTC_4BPPV1_IMG=35840]="RGB_PVRTC_4BPPV1_IMG",t[t.RGB_PVRTC_2BPPV1_IMG=35841]="RGB_PVRTC_2BPPV1_IMG",t[t.RGBA_PVRTC_4BPPV1_IMG=35842]="RGBA_PVRTC_4BPPV1_IMG",t[t.RGBA_PVRTC_2BPPV1_IMG=35843]="RGBA_PVRTC_2BPPV1_IMG",t[t.RGB_S3TC_DXT1_EXT=33776]="RGB_S3TC_DXT1_EXT",t[t.RGBA_S3TC_DXT1_EXT=33777]="RGBA_S3TC_DXT1_EXT",t[t.RGBA_S3TC_DXT3_EXT=33778]="RGBA_S3TC_DXT3_EXT",t[t.RGBA_S3TC_DXT5_EXT=33779]="RGBA_S3TC_DXT5_EXT"})(oe||(oe={}));function wv(t,a){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)}return i}function xS(t){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?wv(Object(i),!0).forEach(function(r){wS(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):wv(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function Sv(t,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Wo(t,a,i){return a&&Sv(t.prototype,a),i&&Sv(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function wS(t,a,i){return a in t?Object.defineProperty(t,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[a]=i,t}function Al(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,nc(t,a)}function nc(t,a){return nc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},nc(t,a)}var SS=function(){var t=a.prototype;t.resizeByClientSize=function(r){r===void 0&&(r=window.devicePixelRatio);var e=this._webCanvas;(typeof OffscreenCanvas=="undefined"||!(e instanceof OffscreenCanvas))&&(this.width=e.clientWidth*r,this.height=e.clientHeight*r)};function a(i){this._webCanvas=void 0,this._width=void 0,this._height=void 0,this._scale=new $;var r=i.width,e=i.height;this._webCanvas=i,this._width=r,this._height=e}return t.setScale=function(r,e){this._scale.set(r,e),this.scale=this._scale},Wo(a,[{key:"width",get:function(){return this._width},set:function(r){this._width!==r&&(this._webCanvas.width=r,this._width=r)}},{key:"height",get:function(){return this._height},set:function(r){this._height!==r&&(this._webCanvas.height=r,this._height=r)}},{key:"scale",get:function(){var r=this._webCanvas;return(typeof OffscreenCanvas=="undefined"||!(r instanceof OffscreenCanvas))&&this._scale.set(r.clientWidth*devicePixelRatio/r.width,r.clientHeight*devicePixelRatio/r.height),this._scale},set:function(r){var e=this._webCanvas;(typeof OffscreenCanvas=="undefined"||!(e instanceof OffscreenCanvas))&&(e.style.transformOrigin="left top",e.style.transform="scale("+r.x+", "+r.y+")")}}]),a}(),CS=function(){function t(i){this._maxDrawBuffers=void 0,this._maxAnisoLevel=void 0,this._maxAntiAliasing=void 0,this._rhi=void 0,this.capabilityList=void 0,this._rhi=i,this.capabilityList=new Map,this._init(),this._compatibleAllInterface()}var a=t.prototype;return a.canIUse=function(r){return this.capabilityList.get(r)},a.canIUseCompressedTextureInternalFormat=function(r){var e=oe.RGBA_ASTC_4X4_KHR,n=oe.RGBA_ASTC_12X12_KHR,o=oe.SRGB8_ALPHA8_ASTC_4X4_KHR,s=oe.SRGB8_ALPHA8_ASTC_12X12_KHR,l=oe.RGB_ETC1_WEBGL,u=oe.R11_EAC,c=oe.SRGB8_ALPHA8_ETC2_EAC,f=oe.RGB_PVRTC_4BPPV1_IMG,h=oe.RGBA_PVRTC_2BPPV1_IMG,d=oe.RGB_S3TC_DXT1_EXT,_=oe.RGBA_S3TC_DXT5_EXT;return r>=e&&n<=n||r>=o&&r<=s?this.canIUse(Z.astc):r===l?this.canIUse(Z.etc1):r>=u&&r<=c?this.canIUse(Z.etc):r>=f&&r<=h?this.canIUse(Z.pvrtc):r>=d&&r<=_?this.canIUse(Z.s3tc):!1},a._init=function(){var r=this.capabilityList,e=this.rhi.isWebGL2,n=this.rhi.requireExtension.bind(this.rhi),o=Z.shaderVertexID,s=Z.standardDerivatives,l=Z.shaderTextureLod,u=Z.elementIndexUint,c=Z.depthTexture,f=Z.vertexArrayObject,h=Z.instancedArrays,d=Z.multipleSample,_=Z.drawBuffers,m=Z.astc,p=Z.astc_webkit,v=Z.etc,g=Z.etc_webkit,y=Z.etc1,x=Z.etc1_webkit,P=Z.pvrtc,S=Z.pvrtc_webkit,w=Z.s3tc,b=Z.s3tc_webkit,E=Z.textureFloat,M=Z.textureHalfFloat,F=Z.textureFloatLinear,A=Z.textureHalfFloatLinear,T=Z.WEBGL_colorBufferFloat,R=Z.colorBufferFloat,z=Z.colorBufferHalfFloat,L=Z.textureFilterAnisotropic;r.set(o,e),r.set(s,e||!!n(s)),r.set(l,e||!!n(l)),r.set(u,e||!!n(u)),r.set(c,e||!!n(c)),r.set(f,e||!!n(f)),r.set(h,e||!!n(h)),r.set(d,e),r.set(_,e||!!n(_)),r.set(E,e||!!n(E)),r.set(M,e||!!n(M)),r.set(F,!!n(F)),r.set(A,e||!!n(A)),r.set(R,e&&!!n(R)||!!n(T)),r.set(z,e&&!!n(R)||!!n(z)),r.set(L,!!n(L)),r.set(m,!!(n(m)||n(p))),r.set(v,!!(n(v)||n(g))),r.set(y,!!(n(y)||n(x))),r.set(P,!!(n(P)||n(S))),r.set(w,!!(n(w)||n(b)))},a._compatibleInterface=function(r,e){var n=this.rhi,o=n.gl,s=null;if(s=n.requireExtension(r))for(var l in e){var u=e[l],c=s[u];c!=null&&c.bind?o[l]=c.bind(s):o[l]=c}},a._compatibleAllInterface=function(){var r=Z.depthTexture,e=Z.vertexArrayObject,n=Z.instancedArrays,o=Z.drawBuffers,s=Z.textureFilterAnisotropic,l=Z.textureHalfFloat,u=Z.colorBufferHalfFloat,c=Z.WEBGL_colorBufferFloat,f=this.rhi.isWebGL2;if(!f){this._compatibleInterface(r,{UNSIGNED_INT_24_8:"UNSIGNED_INT_24_8_WEBGL"}),this._compatibleInterface(e,{createVertexArray:"createVertexArrayOES",deleteVertexArray:"deleteVertexArrayOES",isVertexArray:"isVertexArrayOES",bindVertexArray:"bindVertexArrayOES"}),this._compatibleInterface(n,{drawArraysInstanced:"drawArraysInstancedANGLE",drawElementsInstanced:"drawElementsInstancedANGLE",vertexAttribDivisor:"vertexAttribDivisorANGLE"}),this._compatibleInterface(o,{MAX_DRAW_BUFFERS:"MAX_DRAW_BUFFERS_WEBGL"});var h={};if(this.canIUse(Z.drawBuffers)){for(var d=this.maxDrawBuffers,_=0;_<d;_++)_!=0&&(h["COLOR_ATTACHMENT"+_]="COLOR_ATTACHMENT"+_+"_WEBGL"),h["DRAW_BUFFER"+_]="DRAW_BUFFER"+_+"_WEBGL";this._compatibleInterface(o,xS({drawBuffers:"drawBuffersWEBGL"},h))}this._compatibleInterface(l,{HAFL_FLOAT:"HALF_FLOAT_OES"}),this._compatibleInterface(u,{RGBA16F:"RBGA16F_EXT"}),this._compatibleInterface(c,{RGBA32F:"RBGA32F_EXT"})}this._compatibleInterface(s,{TEXTURE_MAX_ANISOTROPY_EXT:"TEXTURE_MAX_ANISOTROPY_EXT"})},Wo(t,[{key:"maxTextureSize",get:function(){return this.rhi.renderStates.getParameter(this.rhi.gl.MAX_TEXTURE_SIZE)}},{key:"canUseFloatTextureBlendShape",get:function(){return this.canIUse(Z.shaderVertexID)&&this.canIUse(Z.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"canIUseMoreJoints",get:function(){return this.canIUse(Z.textureFloat)&&this.rhi.renderStates.getParameter(this.rhi.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},{key:"maxDrawBuffers",get:function(){return this._maxDrawBuffers||(this.canIUse(Z.drawBuffers)?this._maxDrawBuffers=this._rhi.gl.getParameter(this._rhi.gl.MAX_DRAW_BUFFERS):this._maxDrawBuffers=1),this._maxDrawBuffers}},{key:"maxAnisoLevel",get:function(){if(!this._maxAnisoLevel){var r=this._rhi.requireExtension(Z.textureFilterAnisotropic);this._maxAnisoLevel=r?this._rhi.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}return this._maxAnisoLevel}},{key:"maxAntiAliasing",get:function(){if(!this._maxAntiAliasing){var r=this._rhi.gl,e=this.canIUse(Z.multipleSample);this._maxAntiAliasing=e?r.getParameter(r.MAX_SAMPLES):1}return this._maxAntiAliasing}},{key:"rhi",get:function(){return this._rhi}}]),t}(),PS=function(){function t(i){this.rhi=void 0,this._requireResult=void 0,this.rhi=i,this._requireResult={}}var a=t.prototype;return a.requireExtension=function(r){return this._requireResult[r]!==void 0?this._requireResult[r]:(this._requireResult[r]=this.rhi.gl.getExtension(r),this._requireResult[r])},t}(),AS=function(){function t(i,r){this.attribLocArray=[],this._primitive=void 0,this.canUseInstancedArrays=void 0,this.gl=void 0,this.vao=new Map,this._useVao=void 0,this._primitive=r,this.canUseInstancedArrays=i.canIUse(Z.instancedArrays),this._useVao=i.canIUse(Z.vertexArrayObject),this.gl=i.gl}var a=t.prototype;return a.draw=function(r,e){var n=this.gl,o=this._primitive,s=this._useVao&&o._enableVAO;if(s){this.vao.has(r.id)||this.registerVAO(r);var l=this.vao.get(r.id);n.bindVertexArray(l)}else this.bindBufferAndAttrib(r);var u=o._indexBufferBinding,c=o._instanceCount,f=o._glIndexType,h=o._glIndexByteCount,d=e.topology,_=e.start,m=e.count;if(c)if(this.canUseInstancedArrays)if(u)if(this._useVao)n.drawElementsInstanced(d,m,f,_*h,c);else{var v=u.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v),n.drawElementsInstanced(d,m,f,_*h,c),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArraysInstanced(d,_,m,c);else de.error("ANGLE_instanced_arrays extension is not supported");else if(u)if(s)n.drawElements(d,m,f,_*h);else{var p=u.buffer._nativeBuffer;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,p),n.drawElements(d,m,f,_*h),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}else n.drawArrays(d,_,m);this._useVao?n.bindVertexArray(null):this.disableAttrib()},a.destroy=function(){if(this._useVao){var r=this.gl;this.vao.forEach(function(e){r.deleteVertexArray(e)}),this.vao.clear()}},a.bindBufferAndAttrib=function(r){var e=this.gl,n=this._primitive,o=n._vertexBufferBindings;this.attribLocArray.length=0;var s=r.attributeLocation,l=n._vertexElementMap,u,c;for(var f in s){var h=s[f];if(h!==-1){var d=l[f];if(d){var _=o[d.bindingIndex],m=_.buffer,p=_.stride;u=m._nativeBuffer,c!==u&&(c=u,e.bindBuffer(e.ARRAY_BUFFER,u)),e.enableVertexAttribArray(h);var v=d._glElementInfo;e.vertexAttribPointer(h,v.size,v.type,v.normalized,p,d.offset),this.canUseInstancedArrays&&e.vertexAttribDivisor(h,d.instanceStepRate),this.attribLocArray.push(h)}else de.warn("vertex attribute not found: "+f)}}e.bindBuffer(e.ARRAY_BUFFER,null)},a.disableAttrib=function(){for(var r=this.gl,e=0,n=this.attribLocArray.length;e<n;e++)r.disableVertexAttribArray(this.attribLocArray[e])},a.registerVAO=function(r){var e=this.gl,n=e.createVertexArray();e.bindVertexArray(n);var o=this._primitive._indexBufferBinding;o&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.buffer._nativeBuffer),this.bindBufferAndAttrib(r),e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.disableAttrib(),this.vao.set(r.id,n)},t}(),TS=function(){function t(i){this._gl=void 0,this._parameters={},this._gl=i,this._parameters={},this._parameters[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS]=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._parameters[i.MAX_VERTEX_UNIFORM_VECTORS]=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),this._parameters[i.MAX_VERTEX_ATTRIBS]=i.getParameter(i.MAX_VERTEX_ATTRIBS),this._parameters[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS]=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._parameters[i.MAX_TEXTURE_SIZE]=i.getParameter(i.MAX_TEXTURE_SIZE),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.colorMask(!0,!0,!0,!0),i.blendColor(0,0,0,0),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.enable(i.DEPTH_TEST),i.depthFunc(i.LESS),i.depthMask(!0),i.disable(i.STENCIL_TEST),i.stencilFuncSeparate(i.FRONT,i.ALWAYS,0,255),i.stencilFuncSeparate(i.BACK,i.ALWAYS,0,255),i.stencilOpSeparate(i.FRONT,i.KEEP,i.KEEP,i.KEEP),i.stencilOpSeparate(i.BACK,i.KEEP,i.KEEP,i.KEEP),i.stencilMask(255),i.enable(i.CULL_FACE),i.cullFace(i.BACK),i.disable(i.POLYGON_OFFSET_FILL),i.polygonOffset(0,0)}var a=t.prototype;return a.getParameter=function(r){return this._parameters[r]},t}(),gt=function(){t._isPowerOf2=function(r){return(r&r-1)===0},t._getFormatDetail=function(r,e,n){switch(r){case J.R8G8B8:return{internalFormat:n?e.RGB8:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case J.R8G8B8A8:return{internalFormat:n?e.RGBA8:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case J.R4G4B4A4:return{internalFormat:n?e.RGBA4:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_4_4_4_4,isCompressed:!1};case J.R5G5B5A1:return{internalFormat:n?e.RGB5_A1:e.RGBA,baseFormat:e.RGBA,dataType:e.UNSIGNED_SHORT_5_5_5_1,isCompressed:!1};case J.R5G6B5:return{internalFormat:n?e.RGB565:e.RGB,baseFormat:e.RGB,dataType:e.UNSIGNED_SHORT_5_6_5,isCompressed:!1};case J.Alpha8:return{internalFormat:e.ALPHA,baseFormat:e.ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case J.LuminanceAlpha:return{internalFormat:e.LUMINANCE_ALPHA,baseFormat:e.LUMINANCE_ALPHA,dataType:e.UNSIGNED_BYTE,isCompressed:!1};case J.R16G16B16A16:return{internalFormat:e.RGBA16F,baseFormat:e.RGBA,dataType:e.HALF_FLOAT,isCompressed:!1};case J.R32G32B32A32:return{internalFormat:e.RGBA32F,baseFormat:e.RGBA,dataType:e.FLOAT,isCompressed:!1};case J.DXT1:return{internalFormat:oe.RGB_S3TC_DXT1_EXT,isCompressed:!0};case J.DXT5:return{internalFormat:oe.RGBA_S3TC_DXT5_EXT,isCompressed:!0};case J.ETC1_RGB:return{internalFormat:oe.RGB_ETC1_WEBGL,isCompressed:!0};case J.ETC2_RGB:return{internalFormat:oe.RGB8_ETC2,isCompressed:!0};case J.ETC2_RGBA5:return{internalFormat:oe.RGB8_PUNCHTHROUGH_ALPHA1_ETC2,isCompressed:!0};case J.ETC2_RGBA8:return{internalFormat:oe.RGBA8_ETC2_EAC,isCompressed:!0};case J.PVRTC_RGB2:return{internalFormat:oe.RGB_PVRTC_2BPPV1_IMG,isCompressed:!0};case J.PVRTC_RGBA2:return{internalFormat:oe.RGBA_PVRTC_2BPPV1_IMG,isCompressed:!0};case J.PVRTC_RGB4:return{internalFormat:oe.RGB_PVRTC_4BPPV1_IMG,isCompressed:!0};case J.PVRTC_RGBA4:return{internalFormat:oe.RGBA_PVRTC_4BPPV1_IMG,isCompressed:!0};case J.ASTC_4x4:return{internalFormat:oe.RGBA_ASTC_4X4_KHR,isCompressed:!0};case J.ASTC_5x5:return{internalFormat:oe.RGBA_ASTC_5X5_KHR,isCompressed:!0};case J.ASTC_6x6:return{internalFormat:oe.RGBA_ASTC_6X6_KHR,isCompressed:!0};case J.ASTC_8x8:return{internalFormat:oe.RGBA_ASTC_8X8_KHR,isCompressed:!0};case J.ASTC_10x10:return{internalFormat:oe.RGBA_ASTC_10X10_KHR,isCompressed:!0};case J.ASTC_12x12:return{internalFormat:oe.RGBA_ASTC_12X12_KHR,isCompressed:!0};default:throw new Error("this TextureFormat is not supported in Oasis Engine: "+r)}},t._getRenderBufferDepthFormatDetail=function(r,e,n){switch(r){case J.Depth:case lt.Depth:return{internalFormat:n?e.DEPTH_COMPONENT32F:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:n?e.FLOAT:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case J.DepthStencil:case lt.DepthStencil:return{internalFormat:n?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case J.Stencil:case lt.Stencil:return{internalFormat:e.STENCIL_INDEX8,baseFormat:e.STENCIL_ATTACHMENT,dataType:e.UNSIGNED_BYTE,isCompressed:!1,attachment:e.STENCIL_ATTACHMENT};case J.Depth16:case lt.Depth16:return{internalFormat:e.DEPTH_COMPONENT16,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case J.Depth24:case lt.Depth24:return{internalFormat:e.DEPTH_COMPONENT24,baseFormat:e.DEPTH_COMPONENT,dataType:e.UNSIGNED_INT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case J.Depth32:case lt.Depth32:return{internalFormat:e.DEPTH_COMPONENT32F,baseFormat:e.DEPTH_COMPONENT,dataType:e.FLOAT,isCompressed:!1,attachment:e.DEPTH_ATTACHMENT};case J.Depth24Stencil8:case lt.Depth24Stencil8:return{internalFormat:n?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,baseFormat:e.DEPTH_STENCIL,dataType:e.UNSIGNED_INT_24_8,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};case J.Depth32Stencil8:case lt.Depth32Stencil8:return{internalFormat:e.DEPTH32F_STENCIL8,baseFormat:e.DEPTH_STENCIL,dataType:e.FLOAT_32_UNSIGNED_INT_24_8_REV,isCompressed:!1,attachment:e.DEPTH_STENCIL_ATTACHMENT};default:throw new Error("this TextureFormat is not supported in Oasis Engine: "+r)}},t._supportTextureFormat=function(r,e){var n=!0;switch(r){case J.R16G16B16A16:e.canIUse(Z.textureHalfFloat)||(n=!1);break;case J.R32G32B32A32:e.canIUse(Z.textureFloat)||(n=!1);break}return n},t._supportRenderBufferColorFormat=function(r,e){var n=!0;switch(r){case J.R16G16B16A16:(!e.canIUse(Z.colorBufferHalfFloat)||!e.canIUse(Z.textureHalfFloat))&&(n=!1);break;case J.R32G32B32A32:(!e.canIUse(Z.colorBufferFloat)||!e.canIUse(Z.textureFloat))&&(n=!1);break}return n},t._supportRenderBufferDepthFormat=function(r,e,n){var o=e.isWebGL2,s=!0;if(n&&!e.canIUse(Z.depthTexture))return!1;switch(r){case lt.Stencil:case J.Stencil:s=!1;break;case J.Depth24:case J.Depth32:case J.Depth32Stencil8:case lt.Depth24:case lt.Depth32:case lt.Depth32Stencil8:o||(s=!1);break}return s};function t(i,r,e){this._texture=void 0,this._glTexture=void 0,this._rhi=void 0,this._gl=void 0,this._isWebGL2=void 0,this._target=void 0,this._formatDetail=void 0,this._texture=r,this._rhi=i,this._gl=i.gl,this._isWebGL2=i.isWebGL2,this._target=e,this._glTexture=this._gl.createTexture()}var a=t.prototype;return a.destroy=function(){this._gl.deleteTexture(this._glTexture),this._texture=null,this._glTexture=null,this._formatDetail=null},a.generateMipmaps=function(){this._bind(),this._gl.generateMipmap(this._target)},a._bind=function(){this._rhi.bindTexture(this)},a._initMipmap=function(r){var e=this._gl,n=this._isWebGL2,o=this._formatDetail,s=o.internalFormat,l=o.baseFormat,u=o.dataType,c=this._texture,f=c.mipmapCount,h=c.width,d=c.height;if(this._bind(),n&&!(l===e.LUMINANCE_ALPHA||l===e.ALPHA))e.texStorage2D(this._target,f,s,h,d);else if(l!==s&&(s=l),r)for(var v=0;v<f;v++)for(var g=Math.max(1,h>>v),y=0;y<6;y++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+y,v,s,g,g,0,l,u,null);else for(var _=0;_<f;_++){var m=Math.max(1,h>>_),p=Math.max(1,d>>_);e.texImage2D(this._target,_,s,m,p,0,l,u,null)}},a._getPixelBuffer=function(r,e,n,o,s,l,u){var c=this._gl,f=this._formatDetail,h=f.baseFormat,d=f.dataType;c.bindFramebuffer(c.FRAMEBUFFER,this._getReadFrameBuffer()),l>0&&!this._isWebGL2&&(l=0,de.error("mipLevel only take effect in WebGL2.0")),r!=null?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+r,this._glTexture,l):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this._glTexture,l),c.readPixels(e,n,o,s,h,d,u),c.bindFramebuffer(c.FRAMEBUFFER,null)},a._setWrapMode=function(r,e){var n=this._gl,o=this._isWebGL2,s=this._target,l=this._texture,u=l.width,c=l.height;switch(!o&&r!==Gt.Clamp&&(!t._isPowerOf2(u)||!t._isPowerOf2(c))&&(de.warn("non-power-2 texture is not supported for REPEAT or MIRRORED_REPEAT in WebGL1,and has automatically downgraded to CLAMP_TO_EDGE"),r=Gt.Clamp),r){case Gt.Clamp:n.texParameteri(s,e,n.CLAMP_TO_EDGE);break;case Gt.Repeat:n.texParameteri(s,e,n.REPEAT);break;case Gt.Mirror:n.texParameteri(s,e,n.MIRRORED_REPEAT);break}},a._getReadFrameBuffer=function(){var r=this._rhi._readFrameBuffer;return r||(this._rhi._readFrameBuffer=r=this._gl.createFramebuffer()),r},Wo(t,[{key:"wrapModeU",set:function(r){this._bind(),this._setWrapMode(r,this._gl.TEXTURE_WRAP_S)}},{key:"wrapModeV",set:function(r){this._bind(),this._setWrapMode(r,this._gl.TEXTURE_WRAP_T)}},{key:"filterMode",set:function(r){var e=this._gl,n=this._target,o=this._texture._mipmap;switch(this._bind(),r){case or.Point:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o?e.NEAREST_MIPMAP_NEAREST:e.NEAREST);break;case or.Bilinear:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_NEAREST:e.LINEAR);break;case or.Trilinear:e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o?e.LINEAR_MIPMAP_LINEAR:e.LINEAR);break}}},{key:"anisoLevel",set:function(r){var e=this._gl;this._bind(),e.texParameterf(this._target,e.TEXTURE_MAX_ANISOTROPY_EXT,r)}}]),t}(),bS=function(){function t(i,r){this._gl=void 0,this._isWebGL2=void 0,this._target=void 0,this._frameBuffer=void 0,this._MSAAFrameBuffer=void 0,this._depthRenderBuffer=void 0,this._MSAAColorRenderBuffers=[],this._MSAADepthRenderBuffer=void 0,this._oriDrawBuffers=void 0,this._blitDrawBuffers=void 0,this._curMipLevel=0,this._gl=i.gl,this._isWebGL2=i.isWebGL2,this._target=r;for(var e=r._colorTextures,n=r._depth,o=r.width,s=r.height,l=n instanceof Ur,u=0,c=e.length;u<c;u++){var f=e[u]._format;if(!gt._supportRenderBufferColorFormat(f,i))throw new Error("TextureFormat is not supported:"+J[f]+" in RenderTarget")}if(!gt._supportRenderBufferDepthFormat(l?n.format:n,i,l))throw new Error("TextureFormat is not supported:"+J[n]+" in RenderTarget");if(e.length>1&&!i.canIUse(Z.drawBuffers))throw new Error("MRT is not supported");if(e.some(function(d){return d.width!==o||d.height!==s}))throw new Error("ColorTexture's size must as same as RenderTarget");if(l&&(n.width!==o||n.height!==s))throw new Error("DepthTexture's size must as same as RenderTarget");if(e.length>1&&e.some(function(d){return d instanceof $t}))throw new Error("MRT+Cube+[,MSAA] is not supported");var h=i.capability.maxAntiAliasing;r.antiAliasing>h&&(de.warn("MSAA antiAliasing exceeds the limit and is automatically downgraded to:"+h),r._antiAliasing=h),this._frameBuffer=this._gl.createFramebuffer(),this._bindMainFBO(),r.antiAliasing>1&&(this._MSAAFrameBuffer=this._gl.createFramebuffer(),this._bindMSAAFBO())}var a=t.prototype;return a.setRenderTargetInfo=function(r,e){var n=this._gl,o=this._target,s=o.depthTexture,l=o.getColorTexture(0),u=e!==this._curMipLevel;if(n.bindFramebuffer(n.FRAMEBUFFER,this._frameBuffer),l){var c=l instanceof $t;(u||c)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,c?n.TEXTURE_CUBE_MAP_POSITIVE_X+r:n.TEXTURE_2D,l._platformTexture._glTexture,e)}if(s){var f=s instanceof $t;if(u||f){var h=s._platformTexture;n.framebufferTexture2D(n.FRAMEBUFFER,h._formatDetail.attachment,f?n.TEXTURE_CUBE_MAP_POSITIVE_X+r:n.TEXTURE_2D,h._glTexture,e)}}else if(u){var d=gt._getRenderBufferDepthFormatDetail(o._depth,n,this._isWebGL2),_=d.internalFormat;n.bindRenderbuffer(n.RENDERBUFFER,this._depthRenderBuffer),n.renderbufferStorage(n.RENDERBUFFER,_,o.width>>e,o.height>>e)}this._curMipLevel=e,this._activeRenderTarget()},a.blitRenderTarget=function(){if(!!this._MSAAFrameBuffer){var r=this._gl,e=r.COLOR_BUFFER_BIT|(this._target.depthTexture?r.DEPTH_BUFFER_BIT:0),n=this._target,o=n.colorTextureCount,s=n.width,l=n.height;r.bindFramebuffer(r.READ_FRAMEBUFFER,this._MSAAFrameBuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this._frameBuffer);for(var u=0;u<o;u++){var c=r.COLOR_ATTACHMENT0+u;this._blitDrawBuffers[u]=c,r.readBuffer(c),r.drawBuffers(this._blitDrawBuffers),r.blitFramebuffer(0,0,s,l,0,0,s,l,e,r.NEAREST),this._blitDrawBuffers[u]=r.NONE}r.bindFramebuffer(r.FRAMEBUFFER,null)}},a.destroy=function(){var r=this._gl;this._frameBuffer&&r.deleteFramebuffer(this._frameBuffer),this._depthRenderBuffer&&r.deleteRenderbuffer(this._depthRenderBuffer),this._MSAAFrameBuffer&&r.deleteFramebuffer(this._MSAAFrameBuffer),this._MSAADepthRenderBuffer&&r.deleteRenderbuffer(this._MSAADepthRenderBuffer);for(var e=0;e<this._MSAAColorRenderBuffers.length;e++)r.deleteRenderbuffer(this._MSAAColorRenderBuffers[e]);this._frameBuffer=null,this._depthRenderBuffer=null,this._MSAAFrameBuffer=null,this._MSAAColorRenderBuffers.length=0,this._MSAADepthRenderBuffer=null},a._activeRenderTarget=function(){var r=this._gl;this._MSAAFrameBuffer?r.bindFramebuffer(r.FRAMEBUFFER,this._MSAAFrameBuffer):r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer)},a._bindMainFBO=function(){var r=this._gl,e=this._isWebGL2,n=this._target,o=n._depth,s=n.colorTextureCount,l=n.width,u=n.height,c=new Array(s);r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer);for(var f=0;f<s;f++){var h=this._target.getColorTexture(f),d=r.COLOR_ATTACHMENT0+f;c[f]=d,h instanceof $t||r.framebufferTexture2D(r.FRAMEBUFFER,d,r.TEXTURE_2D,h._platformTexture._glTexture,0)}if(s>1&&r.drawBuffers(c),this._oriDrawBuffers=c,o!==null){if(o instanceof Ur)o instanceof $t||r.framebufferTexture2D(r.FRAMEBUFFER,o._platformTexture._formatDetail.attachment,r.TEXTURE_2D,o._platformTexture._glTexture,0);else if(this._target.antiAliasing<=1){var _=gt._getRenderBufferDepthFormatDetail(o,r,e),m=_.internalFormat,p=_.attachment,v=r.createRenderbuffer();this._depthRenderBuffer=v,r.bindRenderbuffer(r.RENDERBUFFER,v),r.renderbufferStorage(r.RENDERBUFFER,m,l,u),r.framebufferRenderbuffer(r.FRAMEBUFFER,p,r.RENDERBUFFER,v)}}r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindRenderbuffer(r.RENDERBUFFER,null)},a._bindMSAAFBO=function(){var r=this._gl,e=this._isWebGL2,n=r.createRenderbuffer(),o=this._target,s=o._depth,l=o.colorTextureCount,u=o.antiAliasing,c=o.width,f=o.height;this._blitDrawBuffers=new Array(l),this._MSAADepthRenderBuffer=n,r.bindFramebuffer(r.FRAMEBUFFER,this._MSAAFrameBuffer);for(var h=0;h<l;h++){var d=r.createRenderbuffer();this._MSAAColorRenderBuffers[h]=d,this._blitDrawBuffers[h]=r.NONE,r.bindRenderbuffer(r.RENDERBUFFER,d),r.renderbufferStorageMultisample(r.RENDERBUFFER,u,this._target.getColorTexture(h)._platformTexture._formatDetail.internalFormat,c,f),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,r.RENDERBUFFER,d)}if(r.drawBuffers(this._oriDrawBuffers),s!==null){var _=s instanceof Ur?s._platformTexture._formatDetail:gt._getRenderBufferDepthFormatDetail(s,r,e),m=_.internalFormat,p=_.attachment;r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorageMultisample(r.RENDERBUFFER,u,m,c,f),r.framebufferRenderbuffer(r.FRAMEBUFFER,p,r.RENDERBUFFER,n)}this._checkFrameBuffer(),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindRenderbuffer(r.RENDERBUFFER,null)},a._checkFrameBuffer=function(){var r=this._gl,e=this._isWebGL2,n=r.checkFramebufferStatus(r.FRAMEBUFFER);switch(n){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case r.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}if(e&&n===r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE)throw new Error("The values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures.")},t}(),ES=function(t){Al(a,t);function a(r,e){var n;n=t.call(this,r,e,r.gl.TEXTURE_2D)||this,n._compressedMipFilled=0;var o=e.format,s=e._mipmap,l=e.width,u=e.height,c=n._isWebGL2;if(!gt._supportTextureFormat(o,r))throw new Error("Texture format is not supported:"+J[o]);return s&&!c&&(!gt._isPowerOf2(l)||!gt._isPowerOf2(u))&&(de.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),n._formatDetail=gt._getFormatDetail(o,n._gl,c),n._formatDetail.isCompressed&&!c||n._initMipmap(!1),n}var i=a.prototype;return i.setPixelBuffer=function(e,n,o,s,l,u){n===void 0&&(n=0);var c=this._gl,f=this._isWebGL2,h=this._formatDetail,d=h.internalFormat,_=h.baseFormat,m=h.dataType,p=h.isCompressed,v=Math.max(1,this._texture.width>>n),g=Math.max(1,this._texture.height>>n);if(l=l||v-o,u=u||g-s,this._bind(),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,0),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),p){var y=1<<n;f||this._compressedMipFilled&y?c.compressedTexSubImage2D(this._target,n,o,s,l,u,d,e):(c.compressedTexImage2D(this._target,n,d,l,u,0,e),this._compressedMipFilled|=y)}else c.texSubImage2D(this._target,n,o,s,l,u,_,m,e)},i.setImageSource=function(e,n,o,s,l,u){var c=this._gl,f=this._formatDetail,h=f.baseFormat,d=f.dataType;this._bind(),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,+o),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+s),c.texSubImage2D(this._target,n,l||0,u||0,h,d,e)},i.getPixelBuffer=function(e,n,o,s,l,u){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");t.prototype._getPixelBuffer.call(this,null,e,n,o,s,l,u)},a}(gt),MS=function(t){Al(a,t);function a(r,e){var n;n=t.call(this,r,e,r.gl.TEXTURE_2D_ARRAY)||this;var o=e.format,s=e.width,l=e.height,u=e.length,c=e.mipmapCount;if(!n._isWebGL2)throw new Error("Texture2D Array is not supported in WebGL1.0");if(!gt._supportTextureFormat(o,r))throw new Error("Texture format is not supported:"+J[o]);return n._bind(),n._formatDetail=gt._getFormatDetail(o,n._gl,!0),n._gl.texStorage3D(n._target,c,n._formatDetail.internalFormat,s,l,u),n}var i=a.prototype;return i.setPixelBuffer=function(e,n,o,s,l,u,c,f){var h=this._target,d=this._gl,_=this._formatDetail,m=_.internalFormat,p=_.baseFormat,v=_.dataType,g=_.isCompressed;u=u||Math.max(1,this._texture.width>>o)-s,c=c||Math.max(1,this._texture.height>>o)-l,f=f||this._texture.length,this._bind(),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,0),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),g?d.compressedTexSubImage3D(h,o,s,l,e,u,c,f,m,n):d.texSubImage3D(h,o,s,l,e,u,c,f,p,v,n)},i.setImageSource=function(e,n,o,s,l,u,c){var f=this._gl,h=this._formatDetail,d=h.baseFormat,_=h.dataType;this._bind(),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,+s),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l),f.texSubImage3D(this._target,o,u,c,e,n.width,n.height,1,d,_,n)},i.getPixelBuffer=function(e,n,o,s,l,u,c){var f=this._gl,h=this._formatDetail;if(h.isCompressed)throw new Error("Unable to read compressed texture");f.bindFramebuffer(f.FRAMEBUFFER,this._getReadFrameBuffer()),f.framebufferTextureLayer(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,this._glTexture,u,e),f.readPixels(n,o,s,l,h.baseFormat,h.dataType,c),f.bindFramebuffer(f.FRAMEBUFFER,null)},a}(gt),RS=function(t){Al(a,t);function a(r,e){var n;n=t.call(this,r,e,r.gl.TEXTURE_CUBE_MAP)||this,n._compressedFaceFilled=[0,0,0,0,0,0];var o=e.format,s=e._mipmap,l=e.width,u=n._isWebGL2;if(!gt._supportTextureFormat(o,r))throw new Error("Texture format is not supported:"+J[o]);return s&&!u&&!gt._isPowerOf2(l)&&(de.warn("non-power-2 texture is not supported for mipmap in WebGL1,and has automatically downgraded to non-mipmap"),e._mipmap=!1,e._mipmapCount=e._getMipmapCount()),n._formatDetail=gt._getFormatDetail(o,n._gl,u),n._formatDetail.isCompressed&&!u||n._initMipmap(!0),n}var i=a.prototype;return i.setPixelBuffer=function(e,n,o,s,l,u,c){var f=this._gl,h=this._isWebGL2,d=this._formatDetail,_=d.internalFormat,m=d.baseFormat,p=d.dataType,v=d.isCompressed,g=Math.max(1,this._texture.width>>o);if(u=u||g-s,c=c||g-l,this._bind(),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,0),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),v){var y=1<<o;h||this._compressedFaceFilled[e]&y?f.compressedTexSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,u,c,_,n):(f.compressedTexImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,_,u,c,0,n),this._compressedFaceFilled[e]|=y)}else f.texSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,s,l,u,c,m,p,n)},i.setImageSource=function(e,n,o,s,l,u,c){var f=this._gl,h=this._formatDetail,d=h.baseFormat,_=h.dataType;this._bind(),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,+s),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,+l),f.texSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+e,o,u||0,c||0,d,_,n)},i.getPixelBuffer=function(e,n,o,s,l,u,c){if(this._formatDetail.isCompressed)throw new Error("Unable to read compressed texture");t.prototype._getPixelBuffer.call(this,e,n,o,s,l,u,c)},a}(gt),ri;(function(t){t[t.Auto=0]="Auto",t[t.WebGL2=1]="WebGL2",t[t.WebGL1=2]="WebGL1"})(ri||(ri={}));var FS=function(){function t(i){i===void 0&&(i={}),this._readFrameBuffer=void 0,this._currentBind=void 0,this._options=void 0,this._gl=void 0,this._renderStates=void 0,this._extensions=void 0,this._capability=void 0,this._isWebGL2=void 0,this._webCanvas=void 0,this._activeTextureID=void 0,this._activeTextures=new Array(32),this._lastViewport=new Ee(null,null,null,null),this._lastClearColor=new ne(null,null,null,null),this._scissorEnable=!1,this._options=i}var a=t.prototype;return a.init=function(r){var e=this._options;e.alpha===void 0&&(e.alpha=!1),e.stencil===void 0&&(e.stencil=!0);var n=this._webCanvas=r._webCanvas,o=e.webGLMode||ri.Auto,s;if((o==ri.Auto||o==ri.WebGL2)&&(s=n.getContext("webgl2",e),!s&&(typeof OffscreenCanvas=="undefined"||!(n instanceof OffscreenCanvas))&&(s=n.getContext("experimental-webgl2",e)),this._isWebGL2=!0,s&&!s.deleteQuery&&(this._isWebGL2=!1)),s||(o==ri.Auto||o==ri.WebGL1)&&(s=n.getContext("webgl",e),!s&&(typeof OffscreenCanvas=="undefined"||!(n instanceof OffscreenCanvas))&&(s=n.getContext("experimental-webgl",e)),this._isWebGL2=!1),!s)throw new Error("Get GL Context FAILED.");this._gl=s,this._activeTextureID=s.TEXTURE0,this._renderStates=new TS(s),this._extensions=new PS(this),this._capability=new CS(this),s.activeTexture(s.TEXTURE0),this._options=null},a.createPlatformPrimitive=function(r){return new AS(this,r)},a.createPlatformTexture2D=function(r){return new ES(this,r)},a.createPlatformTexture2DArray=function(r){return new MS(this,r)},a.createPlatformTextureCube=function(r){return new RS(this,r)},a.createPlatformRenderTarget=function(r){return new bS(this,r)},a.requireExtension=function(r){return this._extensions.requireExtension(r)},a.canIUse=function(r){return this.capability.canIUse(r)},a.canIUseCompressedTextureInternalFormat=function(r){return this.capability.canIUseCompressedTextureInternalFormat(r)},a.viewport=function(r,e,n,o){var s=this._gl,l=this._lastViewport;if(r!==l.x||e!==l.y||n!==l.z||o!==l.w){var u=this._webCanvas;r===0&&e===0&&n===u.width&&o===u.height?this._scissorEnable&&(s.disable(s.SCISSOR_TEST),this._scissorEnable=!1):(this._scissorEnable||(s.enable(s.SCISSOR_TEST),this._scissorEnable=!0),s.scissor(r,e,n,o)),s.viewport(r,e,n,o),l.set(r,e,n,o)}},a.colorMask=function(r,e,n,o){this._gl.colorMask(r,e,n,o)},a.clearRenderTarget=function(r,e,n){var o=this._gl,s=r._lastRenderState,l=s.blendState.targetBlendState,u=s.depthState,c=s.stencilState,f=0;if(e&Tr.Color){f|=o.COLOR_BUFFER_BIT;var h=this._lastClearColor,d=n.r,_=n.g,m=n.b,p=n.a;n&&(d!==h.r||_!==h.g||m!==h.b||p!==h.a)&&(o.clearColor(d,_,m,p),h.set(d,_,m,p)),l.colorWriteMask!==Pr.All&&(o.colorMask(!0,!0,!0,!0),l.colorWriteMask=Pr.All)}e&Tr.Depth&&(f|=o.DEPTH_BUFFER_BIT,u.writeEnabled!==!0&&(o.depthMask(!0),u.writeEnabled=!0)),e&Tr.Stencil&&(f|=o.STENCIL_BUFFER_BIT,c.writeMask!==255&&(o.stencilMask(255),c.writeMask=255)),o.clear(f)},a.drawPrimitive=function(r,e,n){r?r._draw(n,e):de.error("draw primitive failed.")},a.activeRenderTarget=function(r,e,n){var o=this._gl;if(r){var s;(s=r._platformRenderTarget)===null||s===void 0||s._activeRenderTarget();var l=r.width,u=r.height;this.viewport(0,0,l>>n,u>>n)}else{o.bindFramebuffer(o.FRAMEBUFFER,null);var c=e.viewport,f=o.drawingBufferWidth,h=o.drawingBufferHeight,d=f*c.z,_=h*c.w,m=c.x*f,p=h-c.y*h-_;this.viewport(m,p,d,_)}},a.destroy=function(){},a.activeTexture=function(r){this._activeTextureID!==r&&(this._gl.activeTexture(r),this._activeTextureID=r)},a.bindTexture=function(r){var e=this._activeTextureID-this._gl.TEXTURE0;this._activeTextures[e]!==r&&(this._gl.bindTexture(r._target,r._glTexture),this._activeTextures[e]=r)},Wo(t,[{key:"isWebGL2",get:function(){return this._isWebGL2}},{key:"gl",get:function(){return this._gl}},{key:"renderStates",get:function(){return this._renderStates}},{key:"capability",get:function(){return this._capability}},{key:"canIUseMoreJoints",get:function(){return this.capability.canIUseMoreJoints}}]),t}(),zS=function(t){Al(a,t);function a(i,r){var e=new SS(typeof i=="string"?document.getElementById(i):i),n=new FS(r);return t.call(this,e,n)||this}return Wo(a,[{key:"canvas",get:function(){return this._canvas}}]),a}(Er);function Cv(t,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function LS(t,a,i){return a&&Cv(t.prototype,a),i&&Cv(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var BS=function(){function t(i,r){var e=this;this._worker=void 0,this._costs={},this._currentLoad=0,this._callbacks={},this._worker=new Worker(i),this._worker.onmessage=function(n){var o=n.data;switch(o.type){case"decode":e._callbacks[o.id].resolve(o.geometry);break;case"error":e._callbacks[o.id].reject(o);break;default:de.error('DRACOWorker: Unexpected message, "'+o.type+'"')}},r?this._worker.postMessage({type:"init",decoderConfig:{wasmBinary:r}}):this._worker.postMessage({type:"init",decoderConfig:{}})}var a=t.prototype;return a.setCosts=function(r,e){this._costs[r]=e},a.addCurrentLoad=function(r){this._currentLoad+=r},a.setCallback=function(r,e,n){this._callbacks[r]={resolve:e,reject:n}},a.decode=function(r,e,n){this._worker.postMessage({type:"decode",id:r,taskConfig:e,buffer:n},[n])},a.releaseTask=function(r){this._currentLoad-=this._costs[r],delete this._callbacks[r],delete this._costs[r]},LS(t,[{key:"currentLoad",get:function(){return this._currentLoad}}]),t}(),Pv=`let decoderPending;
let decoderConfig;

onmessage = function(e) {
  const message = e.data;

  switch (message.type) {
    case "init":
      decoderConfig = message.decoderConfig;
      decoderPending = new Promise(function(resolve /*, reject*/) {
        decoderConfig.onModuleLoaded = function(draco) {
          // Module is Promise-like. Wrap before resolving to avoid loop.
          resolve({ draco: draco });
        };
        DracoDecoderModule(decoderConfig);
      });
      break;

    case "decode":
      const buffer = message.buffer;
      const taskConfig = message.taskConfig;
      decoderPending.then(module => {
        const draco = module.draco;
        const decoder = new draco.Decoder();
        const decoderBuffer = new draco.DecoderBuffer();
        decoderBuffer.Init(new Int8Array(buffer), buffer.byteLength);
        try {
          const geometry = decodeGeometry(draco, decoder, decoderBuffer, taskConfig);
          const buffers = geometry.attributes.map(attr => attr.array.buffer);
          if (geometry.index) buffers.push(geometry.index.array.buffer);
          self.postMessage({ type: "decode", id: message.id, geometry }, buffers);
        } catch (error) {
          console.error(error);
          self.postMessage({ type: "error", id: message.id, error: error.message });
        } finally {
          draco.destroy(decoderBuffer);
          draco.destroy(decoder);
        }
      });
      break;
  }
};

function decodeGeometry(draco, decoder, decoderBuffer, taskConfig) {
  const attributeIDs = taskConfig.attributeIDs;
  const attributeTypes = taskConfig.attributeTypes;

  let dracoGeometry;
  let decodingStatus;

  const geometryType = decoder.GetEncodedGeometryType(decoderBuffer);
  if (geometryType === draco.TRIANGULAR_MESH) {
    dracoGeometry = new draco.Mesh();
    decodingStatus = decoder.DecodeBufferToMesh(decoderBuffer, dracoGeometry);
  } else {
    throw new Error("DRACODecoder worker: Unexpected geometry type.");
  }

  if (!decodingStatus.ok() || dracoGeometry.ptr === 0) {
    throw new Error("DRACODecoder worker: Decoding failed: " + decodingStatus.error_msg());
  }

  const geometry = { index: null, attributes: [] };

  // Gather all vertex attributes.
  for (let attributeName in attributeIDs) {
    const attributeType = self[attributeTypes[attributeName]];

    let attribute;
    let attributeID;

    // A Draco file may be created with default vertex attributes, whose attribute IDs
    // are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
    // a Draco file may contain a custom set of attributes, identified by known unique
    // IDs. glTF files always do the latter, and .drc files typically do the former.
    if (taskConfig.useUniqueIDs) {
      attributeID = attributeIDs[attributeName];
      attribute = decoder.GetAttributeByUniqueId(dracoGeometry, attributeID);
    } else {
      attributeID = decoder.GetAttributeId(dracoGeometry, draco[attributeIDs[attributeName]]);
      if (attributeID === -1) continue;
      attribute = decoder.GetAttribute(dracoGeometry, attributeID);
    }
    geometry.attributes.push(decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute));
  }
  // Add index.
  if (geometryType === draco.TRIANGULAR_MESH) {
    // Generate mesh faces.
    const numFaces = dracoGeometry.num_faces();
    const numIndices = numFaces * 3;
    let dataSize;
    let ptr;
    let index;
    const indexType = self[taskConfig.indexType];

    switch (indexType) {
      case Uint16Array:
        dataSize = numIndices * 2;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt16Array(dracoGeometry, dataSize, ptr);
        index = new Uint16Array(draco.HEAPU16.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      case Uint32Array:
        dataSize = numIndices * 4;
        ptr = draco._malloc(dataSize);
        decoder.GetTrianglesUInt32Array(dracoGeometry, dataSize, ptr);
        index = new Uint32Array(draco.HEAPU32.buffer, ptr, numIndices).slice();
        draco._free(ptr);
        break;
      default:
        throw new Error("DRACODecoder: Unexpected index type.");
    }
    geometry.index = { array: index, itemSize: 1 };
  }
  draco.destroy(dracoGeometry);
  return geometry;
}

function decodeAttribute(draco, decoder, dracoGeometry, attributeName, attributeType, attribute) {
  const numComponents = attribute.num_components();
  const numPoints = dracoGeometry.num_points();
  const numValues = numPoints * numComponents;
  let ptr;
  let array;
  let dataSize;
  switch (attributeType) {
    case Float32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_FLOAT32, dataSize, ptr);
      array = new Float32Array(draco.HEAPF32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT8, numValues, ptr);
      array = new Int8Array(draco.HEAP8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT16, dataSize, ptr);
      array = new Int16Array(draco.HEAP16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Int32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_INT32, dataSize, ptr);
      array = new Int32Array(draco.HEAP32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint8Array:
      ptr = draco._malloc(numValues);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT8, numValues, ptr);
      array = new Uint8Array(draco.HEAPU8.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint16Array:
      dataSize = numValues * 2;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT16, dataSize, ptr);
      array = new Uint16Array(draco.HEAPU16.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    case Uint32Array:
      dataSize = numValues * 4;
      ptr = draco._malloc(dataSize);
      decoder.GetAttributeDataArrayForAllPoints(dracoGeometry, attribute, draco.DT_UINT32, dataSize, ptr);
      array = new Uint32Array(draco.HEAPU32.buffer, ptr, numValues).slice();
      draco._free(ptr);
      break;

    default:
      throw new Error("DRACODecoder: Unexpected attribute type.");
  }

  return {
    name: attributeName,
    array: array,
    itemSize: numComponents
  };
}
`,ru="https://gw.alipayobjects.com/os/lib/alipay/draco-javascript/1.3.6/lib/",DS="draco_decoder_gltf.js",OS="draco_decoder_gltf.r3bin",IS="draco_wasm_wrapper_gltf.js",NS=function(){function t(i){if(i===void 0&&(i={type:"wasm",workerLimit:4}),this.pool=[],this.workerLimit=Math.min(navigator.hardwareConcurrency||4,4),this.useJS=void 0,this.currentTaskId=1,this.taskCache=new WeakMap,this.loadLibPromise=void 0,i.workerLimit>this.workerLimit)de.warn("DRACOWorkerPool: Can not initialize worker pool with limit:"+i.workerLimit);else{var r;this.workerLimit=(r=i.workerLimit)!=null?r:4}this.useJS=typeof WebAssembly!="object"||i.type==="js",this.loadLibPromise=this.preloadLib()}var a=t.prototype;return a.preloadLib=function(){var r=this;return this.loadLibPromise?this.loadLibPromise:new Promise(function(e,n){r.useJS?oo(""+ru+DS,{type:"text"}).then(function(o){var s=[o,Pv].join(`
`),l=URL.createObjectURL(new Blob([s]));e({workerSourceURL:l,decoderWASMBinary:null})}).catch(function(o){n(o)}):Promise.all([oo(""+ru+IS,{type:"text"}),oo(""+ru+OS,{type:"arraybuffer"})]).then(function(o){var s=o[0],l=o[1],u=[s,Pv].join(`
`),c=URL.createObjectURL(new Blob([u]));e({workerSourceURL:c,decoderWASMBinary:l})}).catch(function(o){n(o)})})},a.getWorker=function(){var r=this;return this.preloadLib().then(function(e){if(r.pool.length<r.workerLimit){var n=new BS(e.workerSourceURL,e.decoderWASMBinary);r.pool.push(n)}else r.pool.sort(function(o,s){return o.currentLoad>s.currentLoad?-1:1});return r.pool[r.pool.length-1]})},a.decode=function(r,e){var n=this,o=JSON.stringify(e);if(this.taskCache.has(r)){var s=this.taskCache.get(r);if(s.key===o)return s.promise;if(r.byteLength===0)throw new Error("DRACODecoder: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var l=this.currentTaskId++,u=r.byteLength,c,f=new Promise(function(h,d){n.getWorker().then(function(_){c=_,_.setCosts(l,u),_.addCurrentLoad(u),_.setCallback(l,h,d),_.decode(l,e,r)}).catch(function(_){d(_)})});return f.finally(function(){c&&l&&c.releaseTask(l)}),this.taskCache.set(r,{key:o,promise:f}),f},t}();function Av(t,a){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)}return i}function Ie(t){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?Av(Object(i),!0).forEach(function(r){kS(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Av(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function Xa(){Xa=function(){return t};var t={},a=Object.prototype,i=a.hasOwnProperty,r=Object.defineProperty||function(A,T,R){A[T]=R.value},e=typeof Symbol=="function"?Symbol:{},n=e.iterator||"@@iterator",o=e.asyncIterator||"@@asyncIterator",s=e.toStringTag||"@@toStringTag";function l(A,T,R){return Object.defineProperty(A,T,{value:R,enumerable:!0,configurable:!0,writable:!0}),A[T]}try{l({},"")}catch{l=function(T,R,z){return T[R]=z}}function u(A,T,R,z){var L=T&&T.prototype instanceof h?T:h,N=Object.create(L.prototype),V=new E(z||[]);return r(N,"_invoke",{value:P(A,R,V)}),N}function c(A,T,R){try{return{type:"normal",arg:A.call(T,R)}}catch(z){return{type:"throw",arg:z}}}t.wrap=u;var f={};function h(){}function d(){}function _(){}var m={};l(m,n,function(){return this});var p=Object.getPrototypeOf,v=p&&p(p(M([])));v&&v!==a&&i.call(v,n)&&(m=v);var g=_.prototype=h.prototype=Object.create(m);function y(A){["next","throw","return"].forEach(function(T){l(A,T,function(R){return this._invoke(T,R)})})}function x(A,T){function R(L,N,V,D){var j=c(A[L],A,N);if(j.type!=="throw"){var I=j.arg,H=I.value;return H&&typeof H=="object"&&i.call(H,"__await")?T.resolve(H.__await).then(function(G){R("next",G,V,D)},function(G){R("throw",G,V,D)}):T.resolve(H).then(function(G){I.value=G,V(I)},function(G){return R("throw",G,V,D)})}D(j.arg)}var z;r(this,"_invoke",{value:function(L,N){function V(){return new T(function(D,j){R(L,N,D,j)})}return z=z?z.then(V,V):V()}})}function P(A,T,R){var z="suspendedStart";return function(L,N){if(z==="executing")throw new Error("Generator is already running");if(z==="completed"){if(L==="throw")throw N;return F()}for(R.method=L,R.arg=N;;){var V=R.delegate;if(V){var D=S(V,R);if(D){if(D===f)continue;return D}}if(R.method==="next")R.sent=R._sent=R.arg;else if(R.method==="throw"){if(z==="suspendedStart")throw z="completed",R.arg;R.dispatchException(R.arg)}else R.method==="return"&&R.abrupt("return",R.arg);z="executing";var j=c(A,T,R);if(j.type==="normal"){if(z=R.done?"completed":"suspendedYield",j.arg===f)continue;return{value:j.arg,done:R.done}}j.type==="throw"&&(z="completed",R.method="throw",R.arg=j.arg)}}}function S(A,T){var R=A.iterator[T.method];if(R===void 0){if(T.delegate=null,T.method==="throw"){if(A.iterator.return&&(T.method="return",T.arg=void 0,S(A,T),T.method==="throw"))return f;T.method="throw",T.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var z=c(R,A.iterator,T.arg);if(z.type==="throw")return T.method="throw",T.arg=z.arg,T.delegate=null,f;var L=z.arg;return L?L.done?(T[A.resultName]=L.value,T.next=A.nextLoc,T.method!=="return"&&(T.method="next",T.arg=void 0),T.delegate=null,f):L:(T.method="throw",T.arg=new TypeError("iterator result is not an object"),T.delegate=null,f)}function w(A){var T={tryLoc:A[0]};1 in A&&(T.catchLoc=A[1]),2 in A&&(T.finallyLoc=A[2],T.afterLoc=A[3]),this.tryEntries.push(T)}function b(A){var T=A.completion||{};T.type="normal",delete T.arg,A.completion=T}function E(A){this.tryEntries=[{tryLoc:"root"}],A.forEach(w,this),this.reset(!0)}function M(A){if(A){var T=A[n];if(T)return T.call(A);if(typeof A.next=="function")return A;if(!isNaN(A.length)){var R=-1,z=function L(){for(;++R<A.length;)if(i.call(A,R))return L.value=A[R],L.done=!1,L;return L.value=void 0,L.done=!0,L};return z.next=z}}return{next:F}}function F(){return{value:void 0,done:!0}}return d.prototype=_,r(g,"constructor",{value:_,configurable:!0}),r(_,"constructor",{value:d,configurable:!0}),d.displayName=l(_,s,"GeneratorFunction"),t.isGeneratorFunction=function(A){var T=typeof A=="function"&&A.constructor;return!!T&&(T===d||(T.displayName||T.name)==="GeneratorFunction")},t.mark=function(A){return Object.setPrototypeOf?Object.setPrototypeOf(A,_):(A.__proto__=_,l(A,s,"GeneratorFunction")),A.prototype=Object.create(g),A},t.awrap=function(A){return{__await:A}},y(x.prototype),l(x.prototype,o,function(){return this}),t.AsyncIterator=x,t.async=function(A,T,R,z,L){L===void 0&&(L=Promise);var N=new x(u(A,T,R,z),L);return t.isGeneratorFunction(T)?N:N.next().then(function(V){return V.done?V.value:N.next()})},y(g),l(g,s,"Generator"),l(g,n,function(){return this}),l(g,"toString",function(){return"[object Generator]"}),t.keys=function(A){var T=Object(A),R=[];for(var z in T)R.push(z);return R.reverse(),function L(){for(;R.length;){var N=R.pop();if(N in T)return L.value=N,L.done=!1,L}return L.done=!0,L}},t.values=M,E.prototype={constructor:E,reset:function(A){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!A)for(var T in this)T.charAt(0)==="t"&&i.call(this,T)&&!isNaN(+T.slice(1))&&(this[T]=void 0)},stop:function(){this.done=!0;var A=this.tryEntries[0].completion;if(A.type==="throw")throw A.arg;return this.rval},dispatchException:function(A){if(this.done)throw A;var T=this;function R(j,I){return N.type="throw",N.arg=A,T.next=j,I&&(T.method="next",T.arg=void 0),!!I}for(var z=this.tryEntries.length-1;z>=0;--z){var L=this.tryEntries[z],N=L.completion;if(L.tryLoc==="root")return R("end");if(L.tryLoc<=this.prev){var V=i.call(L,"catchLoc"),D=i.call(L,"finallyLoc");if(V&&D){if(this.prev<L.catchLoc)return R(L.catchLoc,!0);if(this.prev<L.finallyLoc)return R(L.finallyLoc)}else if(V){if(this.prev<L.catchLoc)return R(L.catchLoc,!0)}else{if(!D)throw new Error("try statement without catch or finally");if(this.prev<L.finallyLoc)return R(L.finallyLoc)}}}},abrupt:function(A,T){for(var R=this.tryEntries.length-1;R>=0;--R){var z=this.tryEntries[R];if(z.tryLoc<=this.prev&&i.call(z,"finallyLoc")&&this.prev<z.finallyLoc){var L=z;break}}L&&(A==="break"||A==="continue")&&L.tryLoc<=T&&T<=L.finallyLoc&&(L=null);var N=L?L.completion:{};return N.type=A,N.arg=T,L?(this.method="next",this.next=L.finallyLoc,f):this.complete(N)},complete:function(A,T){if(A.type==="throw")throw A.arg;return A.type==="break"||A.type==="continue"?this.next=A.arg:A.type==="return"?(this.rval=this.arg=A.arg,this.method="return",this.next="end"):A.type==="normal"&&T&&(this.next=T),f},finish:function(A){for(var T=this.tryEntries.length-1;T>=0;--T){var R=this.tryEntries[T];if(R.finallyLoc===A)return this.complete(R.completion,R.afterLoc),b(R),f}},catch:function(A){for(var T=this.tryEntries.length-1;T>=0;--T){var R=this.tryEntries[T];if(R.tryLoc===A){var z=R.completion;if(z.type==="throw"){var L=z.arg;b(R)}return L}}throw new Error("illegal catch attempt")},delegateYield:function(A,T,R){return this.delegate={iterator:M(A),resultName:T,nextLoc:R},this.method==="next"&&(this.arg=void 0),f}},t}function Tv(t,a,i,r,e,n,o){try{var s=t[n](o),l=s.value}catch(u){i(u);return}s.done?a(l):Promise.resolve(l).then(r,e)}function bv(t){return function(){var a=this,i=arguments;return new Promise(function(r,e){var n=t.apply(a,i);function o(l){Tv(n,r,e,o,s,"next",l)}function s(l){Tv(n,r,e,o,s,"throw",l)}o(void 0)})}}function Ev(t,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mm(t,a,i){return a&&Ev(t.prototype,a),i&&Ev(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function kS(t,a,i){return a in t?Object.defineProperty(t,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[a]=i,t}function ge(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,Ks(t,a)}function Ks(t,a){return Ks=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Ks(t,a)}function US(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ss(t,a,i){return US()?Ss=Reflect.construct.bind():Ss=function(e,n,o){var s=[null];s.push.apply(s,n);var l=Function.bind.apply(e,s),u=new l;return o&&Ks(u,o.prototype),u},Ss.apply(null,arguments)}function VS(t,a){if(!!t){if(typeof t=="string")return Mv(t,a);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Mv(t,a)}}function Mv(t,a){(a==null||a>t.length)&&(a=t.length);for(var i=0,r=new Array(a);i<a;i++)r[i]=t[i];return r}function ym(t,a){var i=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(i)return(i=i.call(t)).next.bind(i);if(Array.isArray(t)||(i=VS(t))||a&&t&&typeof t.length=="number"){i&&(t=i);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Rv,Fv;function GS(t){return/^data:(.+?);base64,/.test(t)}Rv=ht(je.Buffer,["bin","r3bin"],!1),Rv(Fv=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e){var n=e.url;return GS(n)?new Xe(function(o){var s=n.slice(13+RegExp.$1.length),l=Uint8Array.from(atob(s),function(u){return u.charCodeAt(0)});o(l.buffer)}):this.request(n,Ie(Ie({},e),{},{type:"arraybuffer"}))},a}(ke));var yt;(function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"})(yt||(yt={}));var zr;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(zr||(zr={}));var Xi;(function(t){t.TRANSLATION="translation",t.ROTATION="rotation",t.SCALE="scale",t.WEIGHTS="weights"})(Xi||(Xi={}));var $i;(function(t){t.Linear="LINEAR",t.Step="STEP",t.CubicSpine="CUBICSPLINE"})($i||($i={}));var Zs;(function(t){t.PERSPECTIVE="perspective",t.ORTHOGRAPHIC="orthographic"})(Zs||(Zs={}));var zv;(function(t){t.JPEG="image/jpeg",t.PNG="image/png"})(zv||(zv={}));var so;(function(t){t.OPAQUE="OPAQUE",t.MASK="MASK",t.BLEND="BLEND"})(so||(so={}));var Lv;(function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR"})(Lv||(Lv={}));var Bv;(function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(Bv||(Bv={}));var Dv;(function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.REPEAT=10497]="REPEAT"})(Dv||(Dv={}));var ye=function(){function t(){}return t.floatBufferToVector2Array=function(i){for(var r=i.length,e=new Array(r/2),n=0;n<r;n+=2)e[n/2]=new $(i[n],i[n+1]);return e},t.floatBufferToVector3Array=function(i){for(var r=i.length,e=new Array(r/3),n=0;n<r;n+=3)e[n/3]=new C(i[n],i[n+1],i[n+2]);return e},t.floatBufferToVector4Array=function(i){for(var r=i.length,e=new Array(r/4),n=0;n<r;n+=4)e[n/4]=new Ee(i[n],i[n+1],i[n+2],i[n+3]);return e},t.floatBufferToColorArray=function(i,r){var e=i.length,n=new Array(e/(r?3:4));if(r)for(var o=0;o<e;o+=3)n[o/3]=new ne(i[o],i[o+1],i[o+2],1);else for(var s=0;s<e;s+=4)n[s/4]=new ne(i[s],i[s+1],i[s+2],i[s+3]);return n},t.decodeText=function(i){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(i);for(var r="",e=0,n=i.length;e<n;e++)r+=String.fromCharCode(i[e]);return decodeURIComponent(encodeURIComponent(r))},t.getAccessorTypeSize=function(i){switch(i){case zr.SCALAR:return 1;case zr.VEC2:return 2;case zr.VEC3:return 3;case zr.VEC4:return 4;case zr.MAT2:return 4;case zr.MAT3:return 9;case zr.MAT4:return 16}},t.getComponentType=function(i){switch(i){case yt.BYTE:return Int8Array;case yt.UNSIGNED_BYTE:return Uint8Array;case yt.SHORT:return Int16Array;case yt.UNSIGNED_SHORT:return Uint16Array;case yt.UNSIGNED_INT:return Uint32Array;case yt.FLOAT:return Float32Array}},t.getAccessorData=function(i,r,e){var n,o=i.bufferViews,s=o[r.bufferView],l=e[s.buffer],u=r.hasOwnProperty("byteOffset")?r.byteOffset:0,c=s.hasOwnProperty("byteOffset")?s.byteOffset:0,f=u+c,h=t.getAccessorTypeSize(r.type),d=h*r.count,_=(n=s.byteStride)!=null?n:0,m=t.getComponentType(r.componentType),p;if(_){var v=h*m.BYTES_PER_ELEMENT;p=new Uint8Array(r.count*v);for(var g=new Uint8Array(l,c,s.byteLength),y=0;y<r.count;y++)for(var x=0;x<v;x++)p[y*v+x]=g[y*_+u+x]}else p=new Uint8Array(l.slice(f,f+d*m.BYTES_PER_ELEMENT));var P=new m(p.buffer);if(r.sparse)for(var S,w,b,E,M=r.sparse,F=M.count,A=M.indices,T=M.values,R=o[A.bufferView],z=o[T.bufferView],L=e[R.buffer],N=e[z.buffer],V=((S=A.byteOffset)!=null?S:0)+((w=R.byteOffset)!=null?w:0),D=R.byteLength,j=((b=T.byteOffset)!=null?b:0)+((E=z.byteOffset)!=null?E:0),I=z.byteLength,H=t.getComponentType(A.componentType),G=new H(L,V,D/H.BYTES_PER_ELEMENT),te=new m(N,j,I/m.BYTES_PER_ELEMENT),ie=0;ie<F;ie++)for(var fe=G[ie],ce=0;ce<h;ce++)P[fe*h+ce]=te[ie*h+ce];return P},t.getBufferViewData=function(i,r){var e=i.buffer,n=i.byteOffset,o=n===void 0?0:n,s=i.byteLength,l=r[e];return l.slice(o,o+s)},t.getVertexStride=function(i,r){var e,n=i.bufferViews[(e=r.bufferView)!=null?e:0].byteStride;if(n)return n;var o=t.getAccessorTypeSize(r.type),s=t.getComponentType(r.componentType);return o*s.BYTES_PER_ELEMENT},t.createVertexElement=function(i,r,e){var n=t.getAccessorTypeSize(r.type);return new xe(i,0,t.getElementFormat(r.componentType,n,r.normalized),e)},t.getIndexFormat=function(i){switch(i){case yt.UNSIGNED_BYTE:return ct.UInt8;case yt.UNSIGNED_SHORT:return ct.UInt16;case yt.UNSIGNED_INT:return ct.UInt32}},t.getElementFormat=function(i,r,e){if(e===void 0&&(e=!1),i==yt.FLOAT)switch(r){case 1:return K.Float;case 2:return K.Vector2;case 3:return K.Vector3;case 4:return K.Vector4}if(i==yt.SHORT)switch(r){case 2:return e?K.NormalizedShort2:K.Short2;case 3:case 4:return e?K.NormalizedShort4:K.Short4}if(i==yt.UNSIGNED_SHORT)switch(r){case 2:return e?K.NormalizedUShort2:K.UShort2;case 3:case 4:return e?K.NormalizedUShort4:K.UShort4}if(i==yt.BYTE)switch(r){case 2:case 3:case 4:return e?K.NormalizedByte4:K.Byte4}if(i==yt.UNSIGNED_BYTE)switch(r){case 2:case 3:case 4:return e?K.NormalizedUByte4:K.UByte4}},t.loadImageBuffer=function(i,r){return new Promise(function(e,n){var o=new window.Blob([i],{type:r}),s=new Image;s.onerror=function(){n(new Error("Failed to load image buffer"))},s.onload=function(){requestAnimationFrame(function(){e(s),s.onload=null,s.onerror=null,s.onabort=null})},s.crossOrigin="anonymous",s.src=URL.createObjectURL(o)})},t.isAbsoluteUrl=function(i){return/^(?:http|blob|data:|\/)/.test(i)},t.parseRelativeUrl=function(i,r){if(t.isAbsoluteUrl(r))return r;var e=r.charAt(0);return e==="."?t._formatRelativePath(r+r):i.substring(0,i.lastIndexOf("/")+1)+r},t.parseGLB=function(i){var r=4,e=1179937895,n=12,o={JSON:1313821514,BIN:5130562},s=new DataView(i),l={magic:s.getUint32(0,!0),version:s.getUint32(r,!0),length:s.getUint32(2*r,!0)};if(l.magic!==e)return console.error("Invalid glb magic number. Expected 0x46546C67, found 0x"+l.magic.toString(16)),null;var u=s.getUint32(n,!0),c=s.getUint32(n+r,!0);if(c!==o.JSON)return console.error("Invalid glb chunk type. Expected 0x4E4F534A, found 0x"+c.toString(16)),null;for(var f=new Uint8Array(i,n+2*r,u),h=JSON.parse(t.decodeText(f)),d=[],_=n+2*r+u;_<l.length;){if(u=s.getUint32(_,!0),c=s.getUint32(_+r,!0),c!==o.BIN)return console.error("Invalid glb chunk type. Expected 0x004E4942, found 0x"+c.toString(16)),null;var m=_+2*r,p=i.slice(m,m+u);d.push(p),_+=u+2*r}return{gltf:h,buffers:d}},t._formatRelativePath=function(i){for(var r=i.split("/"),e=0,n=r.length;e<n;e++)r[e]==".."&&(r.splice(e-1,2),e-=2);return r.join("/")},t}(),He=function(){function t(){}return t.parseEngineResource=function(i,r,e,n){var o=t._extensionParsers[i];if(o!=null&&o.length){for(var s=arguments.length,l=new Array(s>4?s-4:0),u=4;u<s;u++)l[u-4]=arguments[u];for(var c=0;c<o.length;c++){var f;(f=o[c]).parseEngineResource.apply(f,[r,e,n].concat(l))}}},t.createEngineResource=function(i,r,e){var n=t._extensionParsers[i];if(n!=null&&n.length){for(var o,s=arguments.length,l=new Array(s>3?s-3:0),u=3;u<s;u++)l[u-3]=arguments[u];return(o=n[0]).createEngineResource.apply(o,[r,e].concat(l))}},t.hasExtensionParser=function(i){var r=t._extensionParsers[i];return!!(r!=null&&r.length)},t.initialize=function(i){var r=t._extensionParsers[i];if(r!=null&&r.length)for(var e=0;e<r.length;e++)r[e].initialize()},t._addExtensionParser=function(i,r){t._extensionParsers[i]||(t._extensionParsers[i]=[]),t._extensionParsers[i].push(r)},t}();He._extensionParsers={};function cn(t){return function(a){var i=new a;He._addExtensionParser(t,i)}}var HS=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parse=function(e){var n=e.gltf,o=e.buffers,s=e.entities,l=n.animations,u=n.accessors;if(!!l){for(var c=l.length,f=new Array(c),h=new Array(c),d=0;d<c;d++){for(var _=l[d],m=_.channels,p=_.samplers,v=_.name,g=v===void 0?"AnimationClip"+d:v,y=new lm(g),x=new Array,P=0;P<p.length;P++){var S,w=p[P],b=u[w.input],E=u[w.output],M=ye.getAccessorData(n,b,o),F=ye.getAccessorData(n,E,o),A=F.length/M.length,T=(S=w.interpolation)!=null?S:$i.Linear,R=void 0;switch(T){case $i.CubicSpine:R=Ir.CubicSpine;break;case $i.Step:R=Ir.Step;break;case $i.Linear:R=Ir.Linear;break}M[M.length-1],x.push({type:E.type,interpolation:R,input:M,output:F,outputSize:A})}for(var z=0;z<m.length;z++){for(var L=m[z],N=L.target,V=s[N.node],D="",j=V;j.parent;)D=D===""?""+j.name:j.name+"/"+D,j=j.parent;var I=void 0,H=void 0,G=void 0;switch(N.path){case Xi.TRANSLATION:I=Yt,H="position",G=pe.Vector3;break;case Xi.ROTATION:I=Yt,H="rotation",G=pe.Quaternion;break;case Xi.SCALE:I=Yt,H="scale",G=pe.Vector3;break;case Xi.WEIGHTS:I=_a,H="blendShapeWeights",G=pe.FloatArray;break}var te=this._addCurve(G,L,x);y.addCurveBinding(D,I,H,te)}f[d]=y,h[d]={name:g,index:d}}e.animations=f,e._animationsIndices=h}},i._addCurve=function(e,n,o){var s=new fm,l=o[n.sampler],u=l.input,c=l.output,f=l.outputSize;s.interpolation=l.interpolation;for(var h=0,d=u.length;h<d;h++){var _=h*f;if(e===pe.Float){var m=new ti;m.time=u[h],m.inTangent=0,m.outTangent=0,m.value=c[_],s.addKey(m)}else if(e===pe.FloatArray){var p=new ti;p.time=u[h],p.inTangent=new Float32Array(f),p.outTangent=new Float32Array(f),p.value=c.subarray(_,_+f),s.addKey(p)}else if(e===pe.Vector2){var v=new ti;v.time=u[h],v.value=new $(c[_],c[_+1]),v.inTangent=new $,v.outTangent=new $,s.addKey(v)}else if(e===pe.Vector3){var g=new ti;g.time=u[h],g.value=new C(c[_],c[_+1],c[_+2]),g.inTangent=new C,g.outTangent=new C,s.addKey(g)}else if(e===pe.Vector4){var y=new ti;y.time=u[h],y.value=new Ee(c[_],c[_+1],c[_+2],c[_+3]),y.inTangent=new Ee,y.outTangent=new Ee,s.addKey(y)}else if(e===pe.Quaternion){var x=new ti;x.time=u[h],x.value=new we(c[_],c[_+1],c[_+2],c[_+3]),x.inTangent=new Ee,x.outTangent=new Ee,s.addKey(x)}}return s},a}(He),WS=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parse=function(e){var n=e.url,o=e.engine;return this._isGLB(n)?o.resourceManager.load({url:n,type:je.Buffer}).then(ye.parseGLB).then(function(s){var l=s.gltf,u=s.buffers;e.gltf=l,e.buffers=u}):o.resourceManager.load({url:n,type:je.JSON}).then(function(s){return e.gltf=s,Promise.all(s.buffers.map(function(l){return o.resourceManager.load({type:je.Buffer,url:ye.parseRelativeUrl(n,l.uri)})})).then(function(l){e.buffers=l})})},i._isGLB=function(e){return e.substring(e.lastIndexOf(".")+1)==="glb"},a}(He),xm=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parse=function(e){var n=e.engine,o=e.gltf.nodes;if(!!o){for(var s=[],l=0;l<o.length;l++){var u=o[l],c=u.matrix,f=u.translation,h=u.rotation,d=u.scale,_=new Qr(n,u.name||""+a._defaultName+l),m=_,p=m.transform;if(c){var v=p.localMatrix;v.copyFromArray(c),p.localMatrix=v}else f&&p.setPosition(f[0],f[1],f[2]),h&&p.setRotationQuaternion(h[0],h[1],h[2],h[3]),d&&p.setScale(d[0],d[1],d[2]);s[l]=_}e.entities=s,this._buildEntityTree(e),this._createSceneRoots(e)}},i._buildEntityTree=function(e){for(var n=e.gltf.nodes,o=e.entities,s=0;s<n.length;s++){var l=n[s].children,u=o[s];if(l)for(var c=0;c<l.length;c++){var f=o[l[c]];u.addChild(f)}}},i._createSceneRoots=function(e){var n=e.engine,o=e.gltf,s=o.scene,l=s===void 0?0:s,u=o.scenes,c=e.entities;if(!!u){for(var f=[],h=0;h<u.length;h++){var d=u[h].nodes;if(!!d)if(d.length===1)f[h]=c[d[0]];else{for(var _=new Qr(n,"GLTF_ROOT"),m=0;m<d.length;m++)_.addChild(c[d[m]]);f[h]=_}}e.sceneRoots=f,e.defaultSceneRoot=f[l]}},a}(He);xm._defaultName="_GLTF_ENTITY_";var oa=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}a._parseTextureTransform=function(e,n,o){n===void 0&&(n={});var s=n.KHR_texture_transform;s&&He.parseEngineResource("KHR_texture_transform",s,e,o)};var i=a.prototype;return i.parse=function(e){var n=e.gltf,o=e.engine,s=e.textures;if(!!n.materials){for(var l=[],u=0;u<n.materials.length;u++){var c=n.materials[u],f=c.extensions,h=f===void 0?{}:f,d=c.pbrMetallicRoughness,_=c.normalTexture,m=c.occlusionTexture,p=c.emissiveTexture,v=c.emissiveFactor,g=c.alphaMode,y=c.alphaCutoff,x=c.doubleSided,P=c.name,S=P===void 0?"":P,w=h.KHR_materials_unlit,b=h.KHR_materials_pbrSpecularGlossiness,E=h.KHR_materials_clearcoat,M=h.OASIS_materials_remap,F=null;if(w?F=He.createEngineResource("KHR_materials_unlit",w,e):b?F=He.createEngineResource("KHR_materials_pbrSpecularGlossiness",b,e):F=new Aa(o),F.name=S,E&&He.parseEngineResource("KHR_materials_clearcoat",E,F,e),d){var A=d.baseColorFactor,T=d.baseColorTexture,R=d.metallicFactor,z=d.roughnessFactor,L=d.metallicRoughnessTexture;if(A&&(F.baseColor=new ne(ne.linearToGammaSpace(A[0]),ne.linearToGammaSpace(A[1]),ne.linearToGammaSpace(A[2]),A[3])),T&&(F.baseTexture=s[T.index],a._parseTextureTransform(F,T.extensions,e)),!w&&!b){var N=F;N.metallic=R!=null?R:1,N.roughness=z!=null?z:1,L&&(N.roughnessMetallicTexture=s[L.index],a._parseTextureTransform(F,L.extensions,e))}}if(!w){var V=F;if(p&&(V.emissiveTexture=s[p.index],a._parseTextureTransform(F,p.extensions,e)),v&&(V.emissiveColor=new ne(ne.linearToGammaSpace(v[0]),ne.linearToGammaSpace(v[1]),ne.linearToGammaSpace(v[2]))),_){var D=_.index,j=_.scale;V.normalTexture=s[D],a._parseTextureTransform(F,_.extensions,e),j!==void 0&&(V.normalTextureIntensity=j)}if(m){var I=m.index,H=m.strength,G=m.texCoord;V.occlusionTexture=s[I],a._parseTextureTransform(F,m.extensions,e),H!==void 0&&(V.occlusionTextureIntensity=H),G===Dn.UV1?V.occlusionTextureCoord=Dn.UV1:G>Dn.UV1&&de.warn("Occlusion texture uv coordinate must be UV0 or UV1.")}}if(M){var te,ie;e.gltf.extensions=(te=e.gltf.extensions)!=null?te:{},e.gltf.extensions.OASIS_materials_remap=(ie=e.gltf.extensions.OASIS_materials_remap)!=null?ie:{},e.gltf.extensions.OASIS_materials_remap[u]=He.createEngineResource("OASIS_materials_remap",M,e)}switch(x?F.renderFace=Jr.Double:F.renderFace=Jr.Front,g){case so.OPAQUE:F.isTransparent=!1;break;case so.BLEND:F.isTransparent=!0;break;case so.MASK:F.alphaCutoff=y!=null?y:.5;break}l[u]=F}e.materials=l}},a}(He),wm=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parse=function(e){var n=this,o=e.engine,s=e.gltf,l=e.buffers;if(!!s.meshes){for(var u=[],c=function(d){for(var _=s.meshes[d],m=[],p=function(y){var x=_.primitives[y],P=x.extensions,S=P===void 0?{}:P,w=S.KHR_draco_mesh_compression;m.push(new Promise(function(b){var E=new wr(o,_.name||y+"");w?He.createEngineResource("KHR_draco_mesh_compression",w,e,x).then(function(M){return n._parseMeshFromGLTFPrimitive(E,_,x,s,function(F){for(var A=0;A<M.attributes.length;A++)if(M.attributes[A].name===F)return M.attributes[A].array;return null},function(F,A){throw"BlendShape animation is not supported when using draco."},function(){return M.index.array},o)}).then(b):n._parseMeshFromGLTFPrimitive(E,_,x,s,function(M){var F=x.attributes[M],A=s.accessors[F];return ye.getAccessorData(s,A,l)},function(M,F){var A=x.targets[F],T=A[M];if(T){var R=s.accessors[T];return ye.getAccessorData(s,R,l)}else return null},function(){var M=s.accessors[x.indices];return ye.getAccessorData(s,M,l)},o).then(b)}))},v=0;v<_.primitives.length;v++)p(v);u.push(Promise.all(m))},f=0;f<s.meshes.length;f++)c(f);return Promise.all(u).then(function(h){e.meshes=h})}},i._parseMeshFromGLTFPrimitive=function(e,n,o,s,l,u,c,f){var h=o.attributes,d=o.targets,_=o.indices,m=o.mode,p,v=s.accessors,g=v[h.POSITION],y=l("POSITION"),x=ye.floatBufferToVector3Array(y);e.setPositions(x);var P=e.bounds;if(p=g.count,g.min&&g.max)P.min.copyFromArray(g.min),P.max.copyFromArray(g.max);else{var S=a._tempVector3,w=P.min,b=P.max;w.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var E=y.length/p,M=0;M<p;M++){var F=M*E;S.copyFromArray(y,F),C.min(w,S,w),C.max(b,S,b)}}for(var A in h)if(A!=="POSITION"){var T=l(A);switch(A){case"NORMAL":var R=ye.floatBufferToVector3Array(T);e.setNormals(R);break;case"TEXCOORD_0":var z=ye.floatBufferToVector2Array(T);e.setUVs(z,0);break;case"TEXCOORD_1":var L=ye.floatBufferToVector2Array(T);e.setUVs(L,1);break;case"TEXCOORD_2":var N=ye.floatBufferToVector2Array(T);e.setUVs(N,2);break;case"TEXCOORD_3":var V=ye.floatBufferToVector2Array(T);e.setUVs(V,3);break;case"TEXCOORD_4":var D=ye.floatBufferToVector2Array(T);e.setUVs(D,4);break;case"TEXCOORD_5":var j=ye.floatBufferToVector2Array(T);e.setUVs(j,5);break;case"TEXCOORD_6":var I=ye.floatBufferToVector2Array(T);e.setUVs(I,6);break;case"TEXCOORD_7":var H=ye.floatBufferToVector2Array(T);e.setUVs(H,7);break;case"COLOR_0":var G=ye.floatBufferToColorArray(T,v[h.COLOR_0].type===zr.VEC3);e.setColors(G);break;case"TANGENT":var te=ye.floatBufferToVector4Array(T);e.setTangents(te);break;case"JOINTS_0":var ie=ye.floatBufferToVector4Array(T);e.setBoneIndices(ie);break;case"WEIGHTS_0":var fe=ye.floatBufferToVector4Array(T);e.setBoneWeights(fe);break}}if(_!==void 0){var ce=s.accessors[_],me=c();e.setIndices(me),e.addSubMesh(0,ce.count,m)}else e.addSubMesh(0,p,m);return d&&this._createBlendShape(e,n,d,u),e.uploadData(!0),Promise.resolve(e)},i._createBlendShape=function(e,n,o,s){for(var l=n.extras?n.extras.targetNames:null,u=0,c=o.length;u<c;u++){var f=l?l[u]:"blendShape"+u,h=s("POSITION",u),d=s("NORMAL",u),_=s("TANGENT",u),m=h?ye.floatBufferToVector3Array(h):null,p=d?ye.floatBufferToVector3Array(d):null,v=_?ye.floatBufferToVector3Array(_):null,g=new cf(f);g.addFrame(1,m,p,v),e.addBlendShape(g)}},a}(He);wm._tempVector3=new C;var Sm=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}a._getDefaultMaterial=function(e){return a._defaultMaterial||(a._defaultMaterial=new Pa(e)),a._defaultMaterial};var i=a.prototype;return i.parse=function(e){var n=e.gltf,o=n.nodes,s=n.cameras,l=e.entities;if(!!o){for(var u=[],c=0;c<o.length;c++){var f=o[c],h=f.camera,d=f.mesh,_=f.extensions,m=_===void 0?{}:_,p=m.KHR_lights_punctual,v=l[c];if(h!==void 0&&this._createCamera(e,s[h],v),d!==void 0&&u.push(this._createRenderer(e,f,v)),p){var g=p.light,y=e.gltf.extensions.KHR_lights_punctual.lights;He.parseEngineResource("KHR_lights_punctual",y[g],v,e)}}return e.defaultSceneRoot&&this._createAnimator(e),e.gltf.extensions&&delete e.gltf.extensions.OASIS_materials_remap,Promise.all(u)}},i._createCamera=function(e,n,o){var s=n.orthographic,l=n.perspective,u=n.type,c=o.addComponent(Cl);if(u===Zs.ORTHOGRAPHIC){var f=s.xmag,h=s.ymag,d=s.zfar,_=s.znear;c.isOrthographic=!0,_!==void 0&&(c.nearClipPlane=_),d!==void 0&&(c.farClipPlane=d),c.orthographicSize=Math.max(h!=null?h:0,f!=null?f:0)/2}else if(u===Zs.PERSPECTIVE){var m=l.aspectRatio,p=l.yfov,v=l.zfar,g=l.znear;m!==void 0&&(c.aspectRatio=m),p!==void 0&&(c.fieldOfView=p*180/Math.PI),v!==void 0&&(c.farClipPlane=v),g!==void 0&&(c.nearClipPlane=g)}e.cameras||(e.cameras=[]),e.cameras.push(c),c.enabled=!1},i._createRenderer=function(e,n,o){for(var s=e.engine,l=e.gltf.meshes,u=e.meshes,c=e.materials,f=e.skins,h=n.mesh,d=n.skin,_=l[h],m=_.primitives,p=n.weights||_.weights,v=[],g=function(P){var S=u[h][P],w=void 0;if(d!==void 0||p){var b=o.addComponent(_a);b.mesh=S,d!==void 0&&(b.skin=f[d]),p&&(b.blendShapeWeights=new Float32Array(p)),w=b}else w=o.addComponent(Ho),w.mesh=S;var E=m[P].material,M=e.gltf.extensions&&e.gltf.extensions.OASIS_materials_remap;if(M&&M[E])v.push(M[E].then(function(z){w.setMaterial(z)}));else{var F=(c==null?void 0:c[E])||a._getDefaultMaterial(s);w.setMaterial(F)}var A=m[P].extensions,T=A===void 0?{}:A,R=T.KHR_materials_variants;R&&He.parseEngineResource("KHR_materials_variants",R,w,e)},y=0;y<m.length;y++)g(y);return Promise.all(v)},i._createAnimator=function(e){var n=e.defaultSceneRoot,o=e.animations;if(!!o){var s=n.addComponent(um),l=new vf,u=new pf("layer"),c=new gf;if(l.addLayer(u),s.animatorController=l,u.stateMachine=c,o)for(var f=0;f<o.length;f++){var h=o[f],d=h.name,_=c.makeUniqueStateName(d);_!==d&&console.warn("AnimatorState name is existed, name: "+d+" reset to "+_);var m=c.addState(_);m.clip=h}}},a}(He);Sm._defaultMaterial=void 0;var jS=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parse=function(e){var n=e.gltf,o=e.buffers,s=e.entities,l=e.defaultSceneRoot,u=n.skins;if(!!u){for(var c=[],f=0;f<u.length;f++){var h=u[f],d=h.inverseBindMatrices,_=h.skeleton,m=h.joints,p=h.name,v=p===void 0?"SKIN_"+f:p,g=m.length,y=new Q0(v);y.inverseBindMatrices.length=g;for(var x=n.accessors[d],P=ye.getAccessorData(n,x,o),S=0;S<g;S++){var w=new re;w.copyFromArray(P,S*16),y.inverseBindMatrices[S]=w}for(var b=0;b<g;b++)y.joints[b]=s[m[b]].name;_!==void 0?y.skeleton=s[_].name:y.skeleton=l.name,c[f]=y}e.skins=c}},a}(He),Cm=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parse=function(e){var n=this,o=e.gltf,s=e.buffers,l=e.engine,u=e.url;if(o.textures)return Promise.all(o.textures.map(function(c,f){var h=c.sampler,d=c.source,_=d===void 0?0:d,m=c.name,p=o.images[_],v=p.uri,g=p.bufferView,y=p.mimeType,x=p.name;if(v)return l.resourceManager.load({url:ye.parseRelativeUrl(u,v),type:je.Texture2D}).then(function(w){return w.name||(w.name=m||x||"texture_"+f),h!==void 0&&n._parseSampler(w,o.samplers[h]),w});var P=o.bufferViews[g],S=ye.getBufferViewData(P,s);return ye.loadImageBuffer(S,y).then(function(w){var b=new cr(l,w.width,w.height);return b.setImageSource(w),b.generateMipmaps(),b.name=m||x||"texture_"+f,h!==void 0&&n._parseSampler(b,o.samplers[h]),b})})).then(function(c){e.textures=c})},i._parseSampler=function(e,n){var o=n.magFilter,s=n.minFilter,l=n.wrapS,u=n.wrapT;(o||s)&&de.warn("texture use filterMode in engine"),l&&(e.wrapModeU=a._wrapMap[l]),u&&(e.wrapModeV=a._wrapMap[u])},a}(He);Cm._wrapMap={33071:Gt.Clamp,33648:Gt.Mirror,10497:Gt.Repeat};var XS=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parse=function(e){var n=e.gltf,o=n.asset.version,s=n.extensionsUsed,l=n.extensionsRequired,u=Number(o);if(!(u>=2&&u<3))throw"Only support gltf 2.x.";if(s){de.info("extensionsUsed: ",s);for(var c=0;c<s.length;c++)He.hasExtensionParser(s[c])||de.warn("Extension "+s[c]+" is not implemented, you can customize this extension in gltf.")}if(l){de.info("extensionsRequired: "+l);for(var f=0;f<l.length;f++){var h=l[f];He.hasExtensionParser(h)?He.initialize(h):de.error("GLTF parser has not supported required extension "+h+".")}}},a}(He),ic=function(){function t(i){var r=this;this._pipes=[],i.forEach(function(e,n){r._pipes[n]=new e})}var a=t.prototype;return a.parse=function(r){var e=this,n;return new Promise(function(o,s){e._pipes.forEach(function(l){n?n=n.then(function(){return l.parse(r)}):n=l.parse(r)}),n?n.then(function(){o(r)}).catch(s):o(r)})},t}();ic.instance=new ic([WS,XS,Cm,oa,wm,xm,jS,HS,Sm]);var $S=function(t){ge(a,t);function a(){for(var i,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return i=t.call.apply(t,[this].concat(e))||this,i.url=void 0,i.gltf=void 0,i.buffers=void 0,i.textures=void 0,i.materials=void 0,i.meshes=void 0,i.skins=void 0,i.animations=void 0,i.entities=void 0,i.cameras=void 0,i.lights=void 0,i.sceneRoots=void 0,i.defaultSceneRoot=void 0,i.variants=void 0,i}return a}(ln),Ov,Iv;Ov=ht(je.Prefab,["gltf","glb"]),Ov(Iv=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=e.url;return new Xe(function(s,l){var u=new $S(n.engine);u.url=o,ic.instance.parse(u).then(s).catch(function(c){console.error(c),l("Error loading glTF model from "+o+" .")})})},a}(ke));var Nv,kv;Nv=ht(je.JSON,["json"],!1),Nv(kv=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e){return this.request(e.url,Ie(Ie({},e),{},{type:"json"}))},a}(ke));var qS=12+13*4,YS=0;function QS(t,a){for(var i=[],r=qS+t.bytesOfKeyValueData,e=t.pixelWidth,n=t.pixelHeight,o=a?t.numberOfMipmapLevels:1,s=0;s<o;s++){var l=new Int32Array(t.buffer,r,1)[0];r+=4;for(var u=0;u<t.numberOfFaces;u++){var c=new Uint8Array(t.buffer,r,l);i.push({data:c,width:e,height:n}),r+=l,r+=3-(l+3)%4}e=Math.max(1,e*.5),n=Math.max(1,n*.5)}return i}function JS(t){if(t.byteLength>=12){var a=new Uint8Array(t,0,12);if(a[0]===171&&a[1]===75&&a[2]===84&&a[3]===88&&a[4]===32&&a[5]===49&&a[6]===49&&a[7]===187&&a[8]===13&&a[9]===10&&a[10]===26&&a[11]===10)return!0}return!1}function KS(t){switch(t){case oe.RGB_S3TC_DXT1_EXT:return J.DXT1;case oe.RGBA_S3TC_DXT5_EXT:return J.DXT5;case oe.RGB_ETC1_WEBGL:return J.ETC1_RGB;case oe.RGB8_ETC2:return J.ETC2_RGB;case oe.RGB8_PUNCHTHROUGH_ALPHA1_ETC2:return J.ETC2_RGBA5;case oe.RGBA8_ETC2_EAC:return J.ETC2_RGBA8;case oe.RGB_PVRTC_2BPPV1_IMG:return J.PVRTC_RGB2;case oe.RGBA_PVRTC_2BPPV1_IMG:return J.PVRTC_RGBA2;case oe.RGB_PVRTC_4BPPV1_IMG:return J.PVRTC_RGB4;case oe.RGBA_PVRTC_4BPPV1_IMG:return J.PVRTC_RGBA4;case oe.RGBA_ASTC_4X4_KHR:return J.ASTC_4x4;case oe.RGBA_ASTC_5X5_KHR:return J.ASTC_5x5;case oe.RGBA_ASTC_6X6_KHR:return J.ASTC_6x6;case oe.RGBA_ASTC_8X8_KHR:return J.ASTC_8x8;case oe.RGBA_ASTC_10X10_KHR:return J.ASTC_10x10;case oe.RGBA_ASTC_12X12_KHR:return J.ASTC_12x12;default:var a=oe[t];throw new Error("this format is not supported in Oasis Engine: "+a)}}var Pm={parse:function(a,i,r,e){if(e===void 0&&(e=!1),!JS(a))throw new Error("khronosTextureContainerParser: invalid KTX file, texture missing KTX identifier");var n=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(a,12,13*n),s=o.getUint32(0,!0),l=s===67305985,u={buffer:a,glType:o.getUint32(1*n,l),glTypeSize:o.getUint32(2*n,l),glFormat:o.getUint32(3*n,l),glInternalFormat:o.getUint32(4*n,l),glBaseInternalFormat:o.getUint32(5*n,l),pixelWidth:o.getUint32(6*n,l),pixelHeight:o.getUint32(7*n,l),pixelDepth:o.getUint32(8*n,l),numberOfArrayElements:o.getUint32(9*n,l),numberOfFaces:o.getUint32(10*n,l),numberOfMipmapLevels:o.getUint32(11*n,l),bytesOfKeyValueData:o.getUint32(12*n,l),loadType:YS};if(u.glType!==0)throw new Error("only compressed formats currently supported");if(u.numberOfMipmapLevels=Math.max(1,u.numberOfMipmapLevels),u.pixelHeight===0||u.pixelDepth!==0)throw new Error("only 2D textures currently supported");if(u.numberOfArrayElements!==0)throw new Error("texture arrays not currently supported");if(u.numberOfFaces!==i)throw new Error("number of faces expected"+i+", but found "+u.numberOfFaces);return r&&(u.mipmaps=QS(u,!0)),e&&(u.engineFormat=KS(u.glInternalFormat)),u}};function ZS(t){var a=Pm.parse(t,1,!0,!0);return{mipmaps:a.mipmaps,engineFormat:a.engineFormat,internalFormat:a.glInternalFormat,width:a.pixelWidth,height:a.pixelHeight}}function eC(t){for(var a=[],i,r,e,n,o=0;o<t.length;o++){var s=Pm.parse(t[o],1,!0,!0);a.push(s.mipmaps),o===0&&(e=s.pixelWidth,n=s.pixelHeight,i=s.glInternalFormat,r=s.engineFormat)}return{mipmapsFaces:a,engineFormat:r,internalFormat:i,width:e,height:n}}var Uv,Vv;Uv=ht(je.KTXCube,[]),Uv(Vv=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){Promise.all(e.urls.map(function(u){return o.request(u,Ie(Ie({},e),{},{type:"arraybuffer"}))})).then(function(u){for(var c=eC(u),f=c.width,h=c.mipmapsFaces,d=c.engineFormat,_=h[0].length>1,m=new $t(n.engine,f,d,_),p=0;p<6;p++)for(var v=h[p].length,g=0;g<v;g++){var y=h[p][g],x=y.data,P=y.width,S=y.height;m.setPixelBuffer(Vt.PositiveX+p,x,g,0,0,P,S)}s(m)}).catch(function(u){l(u)})})},a}(ke));var Gv,Hv;Gv=ht(je.KTX,["ktx"]),Gv(Hv=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){o.request(e.url,Ie(Ie({},e),{},{type:"arraybuffer"})).then(function(u){for(var c=ZS(u),f=c.width,h=c.height,d=c.mipmaps,_=c.engineFormat,m=d.length>1,p=new cr(n.engine,f,h,_,m),v=0;v<d.length;v++){var g=d[v],y=g.width,x=g.height,P=g.data;p.setPixelBuffer(P,v,0,0,y,x)}s(p)}).catch(function(u){l(u)})})},a}(ke));var Wv,jv;Wv=ht(je.Texture2D,["png","jpg","webp","jpeg"]),Wv(jv=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){o.request(e.url,Ie(Ie({},e),{},{type:"image"})).then(function(u){var c=new cr(n.engine,u.width,u.height);if(!!c._platformTexture){if(c.setImageSource(u),c.generateMipmaps(),e.url.indexOf("data:")!==0){var f=e.url.split("/");c.name=f[f.length-1]}s(c)}}).catch(function(u){l(u)})})},a}(ke));var Xv,$v;Xv=ht(je.TextureCube,[""]),Xv($v=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){Promise.all(e.urls.map(function(u){return o.request(u,Ie(Ie({},e),{},{type:"image"}))})).then(function(u){var c=u[0],f=c.width,h=c.height;if(f!==h){console.error("The cube texture must have the same width and height");return}var d=new $t(n.engine,f);if(!!d._platformTexture){for(var _=0;_<6;_++)d.setImageSource(Vt.PositiveX+_,u[_],0);d.generateMipmaps(),s(d)}}).catch(function(u){l(u)})})},a}(ke));var qv,Yv;qv=ht(je.Sprite,["sprite"],!1),qv(Yv=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){o.request(e.url,Ie(Ie({},e),{},{type:"json"})).then(function(u){n.getResourceByRef(u.texture).then(function(c){var f=new df(n.engine,c);f.region=u.region,f.pivot=u.pivot,s(f)})})})},a}(ke));var Qv,Jv;Qv=ht(je.SpriteAtlas,["atlas"],!1),Qv(Jv=function(t){ge(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r._tempRect=new $u,r._tempVec2=new $,r}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){o.request(e.url,Ie(Ie({},e),{},{type:"json"})).then(function(u){var c=u.atlasItems,f=u.format,h=c.length;Promise.all(c.map(function(d){var _=d.img;return o.request(ye.parseRelativeUrl(e.url,_),Ie(Ie({},e),{},{type:"image"}))})).then(function(d){for(var _=n.engine,m=o._tempRect,p=o._tempVec2,v=new im(_),g=0;g<h;g++){var y=d[g],x=y.width,P=y.height,S=new cr(_,x,P,f);S.setImageSource(y),S.generateMipmaps();for(var w=c[g],b=w.sprites,E=1/x,M=1/P,F=b.length-1;F>=0;F--){var A=b[F],T=A.region,R=A.atlasRegionOffset,z=A.atlasRegion,L=A.id,N=A.pivot,V=new df(_,S,T?m.set(T.x,T.y,T.w,T.h):void 0,N?p.set(N.x,N.y):void 0,void 0,A.name);if(V.atlasRegion.set(z.x*E,z.y*M,z.w*E,z.h*M),A.atlasRotated&&(V.atlasRotated=!0),R){var D=R.x,j=R.y,I=R.z,H=R.w;V.atlasRegionOffset.set(D*E,j*M,I*E,H*M)}L!==void 0&&(V._assetID=L),v._addSprite(V)}}s(v)})}).catch(function(u){l(u)})})},a}(ke));var Kv,Zv;Kv=ht(je.Env,["env"]),Kv(Zv=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(u){var c,f=new Float32Array(u,0,27),h=27*4,d=(c=new Uint16Array(u,h,1))===null||c===void 0?void 0:c[0],_=new $t(n.engine,d);_.filterMode=or.Trilinear;for(var m=_.mipmapCount,p=h+2,v=0;v<m;v++)for(var g=d>>v,y=0;y<6;y++){var x=g*g*4,P=new Uint8Array(u,p,x);p+=x,_.setPixelBuffer(Vt.PositiveX+y,P,v)}var S=new er,w=new O1;S.diffuseMode=va.SphericalHarmonics,w.copyFromArray(f),S.diffuseSphericalHarmonics=w,S.specularTexture=_,S.specularTextureDecodeRGBM=!0,s(S)}).catch(function(u){l(u)})})},a}(ke));var ep,tp,le,Oi=Math.PI;ep=ht(je.HDR,["hdr"]),ep(tp=(le=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}a._convertToCubemap=function(e,n,o,s){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=n*o*4)throw"ConvertPanoramaToCubemap: input size is wrong";var l=this._createCubemapData(s,this._faceRight,e,n,o),u=this._createCubemapData(s,this._faceLeft,e,n,o),c=this._createCubemapData(s,this._faceUp,e,n,o),f=this._createCubemapData(s,this._faceBottom,e,n,o),h=this._createCubemapData(s,this._faceFront,e,n,o),d=this._createCubemapData(s,this._faceBack,e,n,o);return[l,u,c,f,h,d]},a._createCubemapData=function(e,n,o,s,l){for(var u=new Uint8ClampedArray(e*e*4),c=this._tempVector3.set(0,0,0).add(n[1]).subtract(n[0]).scale(1/e),f=this._temp2Vector3.set(0,0,0).add(n[3]).subtract(n[2]).scale(1/e),h=1/e,d=0,_=0;_<e;_++){for(var m=this._temp3Vector3.set(0,0,0).add(n[0]),p=this._temp4Vector3.set(0,0,0).add(n[2]),v=0;v<e;v++){var g=this._temp5Vector3.set(0,0,0).add(p).subtract(m).scale(d).add(m);g.normalize();var y=this._calcProjectionSpherical(g,o,s,l);this._RGBEToLinear(y),this._linearToRGBM(y,5);var x=_*e*4+v*4;u[x]=y.r,u[x+1]=y.g,u[x+2]=y.b,u[x+3]=y.a,m.add(c),p.add(f)}d+=h}return u},a._calcProjectionSpherical=function(e,n,o,s){for(var l=Math.atan2(e.z,-e.x),u=Math.acos(e.y);l<-Oi;)l+=2*Oi;for(;l>Oi;)l-=2*Oi;var c=l/Oi,f=u/Oi;c=c*.5+.5;var h=Math.round(c*o);h<0?h=0:h>=o&&(h=o-1);var d=Math.round(f*s);d<0?d=0:d>=s&&(d=s-1);var _=s-d-1,m=_*o*4+h*4,p=n[m],v=n[m+1],g=n[m+2],y=n[m+3];return new ne(p,v,g,y)},a._readStringLine=function(e,n){for(var o="",s="",l=n;l<e.length-n&&(s=String.fromCharCode(e[l]),s!=`
`);l++)o+=s;return o},a._parseHeader=function(e){var n=0,o=0,s=this._readStringLine(e,0);if(s[0]!="#"||s[1]!="?")throw"Bad HDR Format.";var l=!1,u=!1,c=0;do c+=s.length+1,s=this._readStringLine(e,c),s=="FORMAT=32-bit_rle_rgbe"?u=!0:s.length==0&&(l=!0);while(!l);if(!u)throw"HDR Bad header format, unsupported FORMAT";c+=s.length+1,s=this._readStringLine(e,c);var f=/^\-Y (.*) \+X (.*)$/g,h=f.exec(s);if(!h||h.length<3)throw"HDR Bad header format, no size";if(o=parseInt(h[2]),n=parseInt(h[1]),o<8||o>32767)throw"HDR Bad header format, unsupported size";return c+=s.length+1,{height:n,width:o,dataPosition:c}},a._readPixels=function(e,n,o){for(var s=n,l=e.byteLength,u=new Uint8Array(4*n*o),c=0,f=0,h=4*s,d=new Uint8Array(4),_=new Uint8Array(h),m=o;m>0&&f<l;){if(d[0]=e[f++],d[1]=e[f++],d[2]=e[f++],d[3]=e[f++],d[0]!=2||d[1]!=2||(d[2]<<8|d[3])!=s)throw"HDR Bad header format, wrong scan line width";for(var p=0,v=void 0;p<h&&f<l;){v=e[f++];var g=v>128;if(g&&(v-=128),v===0||p+v>h)throw"HDR Bad Format, bad scanline data (run)";if(g)for(var y=e[f++],x=0;x<v;x++)_[p++]=y;else _.set(e.subarray(f,f+v),p),p+=v,f+=v}for(var P=s,S=0;S<P;S++){var w=0;u[c]=_[S+w],w+=s,u[c+1]=_[S+w],w+=s,u[c+2]=_[S+w],w+=s,u[c+3]=_[S+w],c+=4}m--}return u},a._RGBEToLinear=function(e){var n=Math.pow(2,e.a-128)/255;e.r*=n,e.g*=n,e.b*=n,e.a=1},a._linearToRGBM=function(e,n){var o=Math.max(e.r,Math.max(e.g,e.b)),s=Math.min(o/n,1);s=Math.ceil(s*255);var l=65025/(s*n);e.r*=l,e.g*=l,e.b*=l,e.a*=s};var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){var u=n.engine;o.request(e.url,{type:"arraybuffer"}).then(function(c){for(var f=new Uint8Array(c),h=a._parseHeader(f),d=h.width,_=h.height,m=h.dataPosition,p=a._readPixels(f.subarray(m),d,_),v=_>>1,g=a._convertToCubemap(p,d,_,v),y=new $t(u,v),x=0;x<6;x++)y.setPixelBuffer(Vt.PositiveX+x,g[x],0);y.generateMipmaps(),s(y)}).catch(l)})},a}(ke),le._rightBottomBack=new C(1,-1,-1),le._rightBottomFront=new C(1,-1,1),le._rightUpBack=new C(1,1,-1),le._rightUpFront=new C(1,1,1),le._leftBottomBack=new C(-1,-1,-1),le._leftBottomFront=new C(-1,-1,1),le._leftUpBack=new C(-1,1,-1),le._leftUpFront=new C(-1,1,1),le._faceRight=[le._rightBottomBack,le._rightBottomFront,le._rightUpBack,le._rightUpFront],le._faceLeft=[le._leftBottomFront,le._leftBottomBack,le._leftUpFront,le._leftUpBack],le._faceUp=[le._leftBottomFront,le._rightBottomFront,le._leftBottomBack,le._rightBottomBack],le._faceBottom=[le._leftUpBack,le._rightUpBack,le._leftUpFront,le._rightUpFront],le._faceFront=[le._leftBottomBack,le._rightBottomBack,le._leftUpBack,le._rightUpBack],le._faceBack=[le._rightBottomFront,le._leftBottomFront,le._rightUpFront,le._leftUpFront],le._tempVector3=new C,le._temp2Vector3=new C,le._temp3Vector3=new C,le._temp4Vector3=new C,le._temp5Vector3=new C,le));var fn=function(){function t(){}var a=t.prototype;return a.initialize=function(){},a.parseEngineResource=function(r,e,n){},a.createEngineResource=function(r,e){return null},t}(),rp,np,nu;rp=cn("KHR_draco_mesh_compression"),rp(np=(nu=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.initialize=function(){a._decoder||(a._decoder=new NS)},i.createEngineResource=function(e,n,o){var s=n.gltf,l=n.buffers,u=s.bufferViews,c=s.accessors,f=e.bufferView,h=e.attributes,d={},_={};for(var m in h)d[m]=h[m];for(var p in o.attributes)if(h[p]!==void 0){var v=c[o.attributes[p]];_[p]=ye.getComponentType(v.componentType).name}var g=c[o.indices],y=ye.getComponentType(g.componentType).name,x={attributeIDs:d,attributeTypes:_,useUniqueIDs:!0,indexType:y},P=ye.getBufferViewData(u[f],l);return a._decoder.decode(P,x).then(function(S){return S})},a}(fn),nu._decoder=void 0,nu));var ip,ap;ip=cn("KHR_lights_punctual"),ip(ap=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parseEngineResource=function(e,n,o){var s=e.color,l=e.intensity,u=l===void 0?1:l,c=e.type,f=e.range,h=e.spot,d;if(c==="directional"?d=n.addComponent(an):c==="point"?d=n.addComponent(on):c==="spot"&&(d=n.addComponent(Kt)),s&&d.color.set(s[0],s[1],s[2],1),d.intensity=u,f&&!(d instanceof an)&&(d.distance=f),h&&d instanceof Kt){var _=h.innerConeAngle,m=_===void 0?0:_,p=h.outerConeAngle,v=p===void 0?Math.PI/4:p;d.angle=m,d.penumbra=v-m}o.lights||(o.lights=[]),o.lights.push(d)},a}(fn));var op,sp;op=cn("KHR_materials_clearcoat"),op(sp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parseEngineResource=function(e,n,o){var s=o.textures,l=e.clearcoatFactor,u=l===void 0?0:l,c=e.clearcoatTexture,f=e.clearcoatRoughnessFactor,h=f===void 0?0:f,d=e.clearcoatRoughnessTexture,_=e.clearcoatNormalTexture;n.clearCoat=u,n.clearCoatRoughness=h,c&&(n.clearCoatTexture=s[c.index],oa._parseTextureTransform(n,c.extensions,o)),d&&(n.clearCoatRoughnessTexture=s[d.index],oa._parseTextureTransform(n,d.extensions,o)),_&&(n.clearCoatNormalTexture=s[_.index],oa._parseTextureTransform(n,_.extensions,o))},a}(fn));var lp,up;lp=cn("KHR_materials_pbrSpecularGlossiness"),lp(up=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.createEngineResource=function(e,n){var o=n.engine,s=n.textures,l=new Ti(o),u=e.diffuseFactor,c=e.diffuseTexture,f=e.specularFactor,h=e.glossinessFactor,d=e.specularGlossinessTexture;return u&&(l.baseColor=new ne(ne.linearToGammaSpace(u[0]),ne.linearToGammaSpace(u[1]),ne.linearToGammaSpace(u[2]),u[3])),c&&(l.baseTexture=s[c.index],oa._parseTextureTransform(l,c.extensions,n)),f&&(l.specularColor=new ne(ne.linearToGammaSpace(f[0]),ne.linearToGammaSpace(f[1]),ne.linearToGammaSpace(f[2]))),h!==void 0&&(l.glossiness=h),d&&(l.specularGlossinessTexture=s[d.index],oa._parseTextureTransform(l,d.extensions,n)),l},a}(fn));var cp,fp;cp=cn("KHR_materials_unlit"),cp(fp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.createEngineResource=function(e,n){var o=n.engine,s=new hf(o);return s},a}(fn));var hp,dp;hp=cn("KHR_materials_variants"),hp(dp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parseEngineResource=function(e,n,o){for(var s=o.gltf.extensions.KHR_materials_variants.variants,l=o.materials,u=e.mappings,c=0;c<u.length;c++){var f=u[c],h=f.material,d=f.variants;o.variants||(o.variants=[]),o.variants.push({renderer:n,material:l[h],variants:d.map(function(_){return s[_].name})})}},a}(fn));var _p,vp;_p=cn("KHR_mesh_quantization"),_p(vp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}return a}(fn));var pp,gp;pp=cn("KHR_texture_transform"),pp(gp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.parseEngineResource=function(e,n,o){var s=e.offset,l=e.rotation,u=e.scale,c=e.texCoord;s&&(n.tilingOffset.z=s[0],n.tilingOffset.w=s[1]),u&&(n.tilingOffset.x=u[0],n.tilingOffset.y=u[1]),l&&de.warn("rotation in KHR_texture_transform is not supported now"),c&&de.warn("texCoord in KHR_texture_transform is not supported now")},a}(fn));var mp,yp;mp=cn("OASIS_materials_remap"),mp(yp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.createEngineResource=function(e,n){var o=n.engine;return o.resourceManager.getResourceByRef(e)},a}(fn));var xp,wp;xp=ht(je.Material,["json"]),xp(wp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){o.request(e.url,Ie(Ie({},e),{},{type:"json"})).then(function(u){var c=n.engine,f=u.shader,h=u.shaderData,d=u.macros,_=u.renderState,m;switch(f){case"pbr":m=new Aa(c);break;case"pbr-specular":m=new Ti(c);break;case"unlit":m=new hf(c);break;case"blinn-phong":m=new Pa(c);break}var p=new Array,v=m.shaderData,g=function(F){var A=h[F],T=A.type,R=A.value;switch(T){case"Vector2":v.setVector2(F,new $(R.x,R.y));break;case"Vector3":v.setVector3(F,new C(R.x,R.y,R.z));break;case"Vector4":v.setVector4(F,new Ee(R.x,R.y,R.z,R.w));break;case"Color":v.setColor(F,new ne(R.r,R.g,R.b,R.a));break;case"Float":v.setFloat(F,R);break;case"Texture":p.push(n.getResourceByRef(R).then(function(z){v.setTexture(F,z)}));break}};for(var y in h)g(y);for(var x=0,P=d.length;x<P;x++){var S=d[x],w=S.name,b=S.value;b==null?v.enableMacro(w):v.enableMacro(w,b)}for(var E in _)m[E]=_[E];Promise.all(p).then(function(){s(m)})})})},a}(ke));var Am=function(){function t(i,r,e,n){r===void 0&&(r=0),n===void 0&&(n=!0),this.buffer=i,this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(i),this._littleEndian=n,this._offset=r}var a=t.prototype;return a.nextUint8=function(){var r=this._dataView.getUint8(this._offset);return this._offset+=1,r},a.nextUint16=function(){var r=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,r},a.nextUint32=function(){var r=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,r},a.nextInt32=function(){var r=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,r},a.nextInt32Array=function(r){var e=new Int32Array(this.buffer,this._offset,r);return this._offset+=4*r,e},a.nextFloat32=function(){var r=this._dataView.getFloat32(this._offset,this._littleEndian);return this._offset+=4,r},a.nextFloat32Array=function(r){var e=new Float32Array(this.buffer,this._offset,r);return this._offset+=4*r,e},a.nextUint32Array=function(r){var e=new Uint32Array(this.buffer,this._offset,r);return this._offset+=4*r,e},a.nextUint8Array=function(r){var e=new Uint8Array(this.buffer,this._offset,r);return this._offset+=r,e},a.nextUint64=function(){var r=this._dataView.getUint32(this._offset,this._littleEndian),e=this._dataView.getUint32(this._offset+4,this._littleEndian),n=r+Math.pow(2,32)*e;return this._offset+=8,n},a.nextStr=function(){var r=this.nextUint16(),e=new Uint8Array(this.buffer,this._offset,r);return this._offset+=r,ye.decodeText(e)},a.nextImageData=function(r){return this.buffer.slice(this._offset)},a.nextImagesData=function(r){for(var e=new Array(r),n=0;n<r;n++){var o=this._dataView.getUint32(this._offset,this._littleEndian);e[n]=o,this._offset+=4}for(var s=[],l=0;l<r;l++){var u=e[l],c=this.buffer.slice(this._offset,this._offset+u);this._offset+=u,s.push(c)}return s},a.skip=function(r){return this._offset+=r,this},a.scan=function(r,e){e===void 0&&(e=0);for(var n=this._offset,o=0;this._dataView.getUint8(this._offset)!==e&&o<r;)o++,this._offset++;return o<r&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,o)},mm(t,[{key:"offset",get:function(){return this._offset}}]),t}();Am.imageMapping={0:"image/png",1:"image/jpg",2:"image/webp",3:"ktx"};var Tm={};function bm(t){return function(a){Tm[t]=a}}var tC=function(){function t(){this.totalLength=0,this.version=0,this.type="",this.name="",this.headerLength=0}return t.decode=function(i){var r=new DataView(i),e=r.getUint32(0,!0),n=r.getUint8(4),o=r.getUint16(5,!0),s=new Uint8Array(i,7,o),l=r.getUint16(7+o,!0),u=new Uint8Array(i,9+o,l),c=ye.decodeText(u),f=ye.decodeText(s),h=new t;return h.totalLength=e,h.name=c,h.type=f,h.version=n,h.headerLength=u.byteLength+s.byteLength+9,h},mm(t,[{key:"dataLength",get:function(){return this.totalLength-this.headerLength}}]),t}(),Sp,Cp;Sp=bm("Mesh"),Sp(Cp=function(){function t(){}return t.decode=function(i,r){return new Promise(function(e){var n=new wr(i),o=r.nextStr(),s=JSON.parse(o),l=Math.ceil(r.offset/4)*4,u=new Float32Array(r.buffer,s.positions.start+l,(s.positions.end-s.positions.start)/4),c=u.length/3,f=ls(u,c);if(n.setPositions(f),s.normals){var h=new Float32Array(r.buffer,s.normals.start+l,(s.normals.end-s.normals.start)/4),d=ls(h,c);n.setNormals(d)}if(s.uvs){var _=new Float32Array(r.buffer,s.uvs.start+l,(s.uvs.end-s.uvs.start)/4);n.setUVs(pn(_,c))}if(s.uv1){var m=new Float32Array(r.buffer,s.uv1.start+l,(s.uv1.end-s.uv1.start)/4);n.setUVs(pn(m,c),1)}if(s.uv2){var p=new Float32Array(r.buffer,s.uv2.start+l,(s.uv2.end-s.uv2.start)/4);n.setUVs(pn(p,c),2)}if(s.uv3){var v=new Float32Array(r.buffer,s.uv3.start+l,(s.uv3.end-s.uv3.start)/4);n.setUVs(pn(v,c),3)}if(s.uv4){var g=new Float32Array(r.buffer,s.uv4.start+l,(s.uv4.end-s.uv4.start)/4);n.setUVs(pn(g,c),4)}if(s.uv5){var y=new Float32Array(r.buffer,s.uv5.start+l,(s.uv5.end-s.uv5.start)/4);n.setUVs(pn(y,c),5)}if(s.uv6){var x=new Float32Array(r.buffer,s.uv6.start+l,(s.uv6.end-s.uv6.start)/4);n.setUVs(pn(x,c),6)}if(s.uv7){var P=new Float32Array(r.buffer,s.uv7.start+l,(s.uv7.end-s.uv7.start)/4);n.setUVs(pn(P,c),7)}if(s.colors){var S=new Float32Array(r.buffer,s.colors.start+l,(s.colors.end-s.colors.start)/4);n.setColors(rC(S,c))}if(s.boneWeights){var w=new Float32Array(r.buffer,s.boneWeights.start+l,(s.boneWeights.end-s.boneWeights.start)/4);n.setBoneWeights(iu(w,c))}if(s.boneIndices){var b=new Float32Array(r.buffer,s.boneIndices.start+l,(s.boneIndices.end-s.boneIndices.start)/4);n.setBoneIndices(iu(b,c))}if(s.blendShapes&&s.blendShapes.forEach(function(M){var F=new cf(M.name);M.frames.forEach(function(A){var T=new Float32Array(r.buffer,A.deltaPosition.start+l,(A.deltaPosition.end-A.deltaPosition.start)/4),R=T.length/3,z=ls(T,R);if(A.deltaNormals){var L=new Float32Array(r.buffer,A.deltaNormals.start+l,(A.deltaNormals.end-A.deltaNormals.start)/4);ls(L,R)}if(A.deltaTangents){var N=new Float32Array(r.buffer,A.deltaTangents.start+l,(A.deltaTangents.end-A.deltaTangents.start)/4);iu(N,R)}F.addFrame(A.weight,z)}),n.addBlendShape(F)}),s.indices){var E=null;s.indices.type===0?E=new Uint16Array(r.buffer,s.indices.start+l,(s.indices.end-s.indices.start)/2):E=new Uint32Array(r.buffer,s.indices.start+l,(s.indices.end-s.indices.start)/4),n.setIndices(E)}s.subMeshes.forEach(function(M){n.addSubMesh(M)}),n.uploadData(!1),e(n)})},t}());function rC(t,a){for(var i=new Array(a),r=0;r<a;r++)i[r]=new ne(t[r*4],t[r*4+1],t[r*4+2],t[r*4+3]);return i}function iu(t,a){for(var i=new Array(a),r=0;r<a;r++)i[r]=new Ee(t[r*4],t[r*4+1],t[r*4+2],t[r*4+3]);return i}function ls(t,a){for(var i=new Array(a),r=0;r<a;r++)i[r]=new C(t[r*3],t[r*3+1],t[r*3+2]);return i}function pn(t,a){for(var i=new Array(a),r=0;r<a;r++)i[r]=new $(t[r*2],t[r*2+1]);return i}var Pp,Ap;Pp=bm("Texture2D"),Pp(Ap=function(){function t(){}return t.decode=function(i,r){return new Promise(function(e,n){var o=r.nextStr(),s=!!r.nextUint8(),l=r.nextUint8(),u=r.nextUint8(),c=r.nextUint8(),f=r.nextUint8(),h=r.nextUint8(),d=r.nextUint16(),_=r.nextUint16(),m=r.nextUint8(),p=r.nextUint8(),v=r.nextImagesData(p),g=new cr(i,d,_,h,s);if(g.filterMode=l,g.anisoLevel=u,g.wrapModeU=c,g.wrapModeV=f,m){var y=new Uint8Array(v[0]);if(g.setPixelBuffer(y),s){g.generateMipmaps();for(var x=1;x<p;x++){var P=new Uint8Array(v[x]);g.setPixelBuffer(P,x)}}i.resourceManager._objectPool[o]=g,e(g)}else{var S=new window.Blob([v[0]]),w=new Image;w.onload=function(){g.setImageSource(w);var b=0,E=function(){b++,b>=p&&e(g)};if(E(),s){g.generateMipmaps();for(var M=function(T){var R=new window.Blob([v[T]]),z=new Image;z.onload=function(){g.setImageSource(z,T),E()},z.src=URL.createObjectURL(R)},F=1;F<p;F++)M(F)}},w.src=URL.createObjectURL(S)}})},t}());var Em=function(){function t(){}return t.parseEntity=function(i,r){var e=this;return t.getEntityByConfig(i,r).then(function(n){var o;n.isActive=(o=i.isActive)!=null?o:!0;var s=i.position,l=i.rotation,u=i.scale;s&&n.transform.setPosition(s.x,s.y,s.z),l&&n.transform.setRotation(l.x,l.y,l.z),u&&n.transform.setScale(u.x,u.y,u.z);for(var c=[],f=0;f<i.components.length;f++){var h=i.components[f],d=h.refId?h.refId:h.class,_=void 0;d==="Animator"&&(_=n.getComponent(ke.getClass(d))),_=_||n.addComponent(ke.getClass(d));var m=e.parsePropsAndMethods(_,h,r);c.push(m)}return Promise.all(c).then(function(){return n})})},t.getEntityByConfig=function(i,r){var e=i.assetRefId;if(e)return r.resourceManager.getResourceByRef({refId:e,key:i.key});var n=new Qr(r,i.name);return Promise.resolve(n)},t.parseClassObject=function(i,r,e){var n;e===void 0&&(e=r.resourceManager);var o=ke.getClass(i.class),s=(n=i.constructParams)!=null?n:[],l=Ss(o,s);return this.parsePropsAndMethods(l,i,r,e)},t.parseBasicType=function(i,r,e){var n=this;return e===void 0&&(e=r.resourceManager),Array.isArray(i)?Promise.all(i.map(function(o){return n.parseBasicType(o,r,e)})):typeof i=="object"&&i!=null?this._isClass(i)?this.parseClassObject(i,r,e):this._isRef(i)?e.getResourceByRef(i):Promise.resolve(i):Promise.resolve(i)},t.parsePropsAndMethods=function(i,r,e,n){var o=this;n===void 0&&(n=e.resourceManager);var s=[];if(r.methods)for(var l in r.methods)for(var u=r.methods[l],c=0,f=u.length;c<f;c++){var h=u[c],d=this.parseMethod(i,l,h,e,n);s.push(d)}if(r.props){var _=function(v){var g=r.props[v],y=o.parseBasicType(g,e).then(function(x){return i[v]=x});s.push(y)};for(var m in r.props)_(m)}return Promise.all(s).then(function(){return i})},t.parseMethod=function(i,r,e,n,o){var s=this;return o===void 0&&(o=n.resourceManager),Promise.all(e.map(function(l){return s.parseBasicType(l,n,o)})).then(function(l){return i[r].apply(i,l)})},t._isClass=function(i){return i.class!=null},t._isRef=function(i){return i.refId!=null},t}(),nC=function(){function t(i){this._engine=i}var a=t.prototype;return a.parse=function(r){for(var e={},n={},o=[],s=r.entities,l=ym(s),u;!(u=l()).done;){var c=u.value;n[c.id]=c,o.push(Em.parseEntity(c,this._engine))}return Promise.all(o).then(function(f){var h=s[0].id;return f.forEach(function(d,_){e[s[_].id]=d}),t.parseChildren(n,e,h),e[h]})},t.parseChildren=function(r,e,n){var o=r[n].children;if(o&&o.length>0)for(var s=e[n],l=0;l<o.length;l++){var u=o[l],c=e[u];s.addChild(c),this.parseChildren(r,e,u)}},t}(),iC=function(){function t(){}return t.parse=function(i,r){for(var e=new tn(i),n={},o={},s=[],l=r.entities,u=ym(l),c;!(c=u()).done;){var f=c.value;o[f.id]=f,s.push(Em.parseEntity(f,i))}return Promise.all(s).then(function(h){var d=[];h.forEach(function(y,x){n[l[x].id]=y,l[x].parent||d.push(l[x].id)});for(var _=0,m=d;_<m.length;_++){var p=m[_];nC.parseChildren(o,n,p)}for(var v=d.map(function(y){return n[y]}),g=0;g<v.length;g++)e.addRootEntity(v[g]);return e})},t}(),Tp,bp;Tp=ht("Mesh",["prefab"],!0),Tp(bp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){o.request(e.url,{type:"arraybuffer"}).then(function(u){xf(u,n.engine).then(function(c){s(c)})})})},a}(ke));var Ep,Mp;Ep=ht("EditorTexture2D",["prefab"],!0),Ep(Mp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s){o.request(e.url,{type:"arraybuffer"}).then(function(l){xf(l,n.engine).then(function(u){s(u)})})})},a}(ke));function xf(t,a){var i=tC.decode(t),r=new Am(t,i.headerLength,i.dataLength);return Tm[i.type].decode(a,r).then(function(e){return e.name=i.name,e})}var Rp,Fp;Rp=ht(je.Mesh,["mesh"]),Rp(Fp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s){o.request(e.url,Ie(Ie({},e),{},{type:"arraybuffer"})).then(function(l){return xf(l,n.engine)}).then(function(l){s(l)})})},a}(ke));var zp,Lp;zp=ht(je.AnimatorController,["json"],!1),zp(Lp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this;return new Xe(function(s,l){o.request(e.url,Ie(Ie({},e),{},{type:"json"})).then(function(){var u=bv(Xa().mark(function c(f){var h,d,_;return Xa().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:h=new vf,d=f.layers,_=[],d.forEach(function(v,g){var y=v.name,x=v.blendingMode,P=v.weight,S=v.stateMachine,w=new pf(y);if(w.blendingMode=x,w.weight=P,S){var b=S.states,E=w.stateMachine=new gf;b.forEach(function(M,F){var A=M.name,T=M.speed,R=M.wrapMode,z=M.clipStartNormalizedTime,L=M.clipEndNormalizedTime;M.isDefaultState;var N=M.clip,V=E.addState(A);V.speed=T,V.wrapMode=R,V.clipStartTime=z,V.clipEndTime=L,N&&_.push(new Promise(function(){var D=bv(Xa().mark(function j(I){return Xa().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.t0=I,G.t1=g,G.t2=F,G.next=5,n.getResourceByRef(N);case 5:G.t3=G.sent,G.t4={layerIndex:G.t1,stateIndex:G.t2,clip:G.t3},(0,G.t0)(G.t4);case 8:case"end":return G.stop()}},j)}));return function(j){return D.apply(this,arguments)}}()))}),b.forEach(function(M){var F=M.name,A=M.transitions;A.forEach(function(T){var R=T.targetStateName,z=T.duration,L=T.offset,N=T.exitTime,V=E.findStateByName(F),D=E.findStateByName(R),j=new _f;j.destinationState=D,j.duration=z,j.exitTime=N,j.offset=L,V.addTransition(j)})})}h.addLayer(w)}),Promise.all(_).then(function(v){v.forEach(function(g){var y=g.layerIndex,x=g.stateIndex,P=g.clip;h.layers[y].stateMachine.states[x].clip=P}),s(h)});case 5:case"end":return p.stop()}},c)}));return function(c){return u.apply(this,arguments)}}())})},a}(ke));var Bp,Dp;Bp=ht(je.Scene,["prefab"],!0),Bp(Dp=function(t){ge(a,t);function a(){return t.apply(this,arguments)||this}var i=a.prototype;return i.load=function(e,n){var o=this,s=n.engine;return new Xe(function(l,u){return o.request(e.url,{type:"json"}).then(function(c){return s.resourceManager.initVirtualResources(c.files),iC.parse(s,c).then(function(f){var h=c.scene.ambient,d=Promise.resolve();h.ambientLight&&(d=n.getResourceByRef(c.scene.ambient.ambientLight).then(function(p){f.ambientLight=p,f.ambientLight.diffuseIntensity=h.diffuseIntensity,f.ambientLight.specularIntensity=h.specularIntensity}));var _=c.scene.background;f.background.mode=_.mode;var m=Promise.resolve();switch(f.background.mode){case en.SolidColor:f.background.solidColor.copyFrom(_.color);break;case en.Sky:_.sky&&(m=n.getResourceByRef(_.sky).then(function(p){var v=f.background.sky,g=new dm(s);g.textureCubeMap=p.specularTexture,g.textureDecodeRGBM=!0,v.material=g,v.mesh=J0.createCuboid(s,1,1,1)}));break;case en.Texture:_.texture&&(m=n.getResourceByRef(_.texture).then(function(p){f.background.texture=p}));break}return Promise.all([d,m]).then(function(){l(f)})})}).catch(u)})},a}(ke));var aC="0.8.3";console.log("oasis engine version: "+aC);for(var Op in xv)ke.registerClass(Op,xv[Op]);function Ip(t,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function oC(t,a,i){return a&&Ip(t.prototype,a),i&&Ip(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function sC(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,ac(t,a)}function ac(t,a){return ac=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},ac(t,a)}var Np=W.zeroTolerance,au=function(){function t(i,r,e){this.radius=i,this.phi=r,this.theta=e,this.radius=i!==void 0?i:1,this.phi=r!==void 0?r:0,this.theta=e!==void 0?e:0}var a=t.prototype;return a.set=function(r,e,n){return this.radius=r,this.phi=e,this.theta=n,this},a.makeSafe=function(){return this.phi=W.clamp(this.phi,Np,Math.PI-Np),this},a.setFromVec3=function(r){return this.radius=r.length(),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(r.x,r.z),this.phi=Math.acos(W.clamp(r.y/this.radius,-1,1))),this},a.setToVec3=function(r){var e=this.radius,n=this.phi,o=this.theta,s=Math.sin(n)*e;return r.set(s*Math.sin(o),e*Math.cos(n),s*Math.cos(o)),this},t}();W.zeroTolerance;var ve;(function(t){t[t.None=0]="None",t[t.ROTATE=1]="ROTATE",t[t.ZOOM=2]="ZOOM",t[t.PAN=4]="PAN",t[t.All=7]="All"})(ve||(ve={}));function wf(){return function(t){}}var kp,Up,ou=(kp=wf(),kp(Up=function(){function t(){}return t.onUpdateHandler=function(i){return i.isKeyHeldDown(tr.ArrowLeft)||i.isKeyHeldDown(tr.ArrowRight)||i.isKeyHeldDown(tr.ArrowUp)||i.isKeyHeldDown(tr.ArrowDown)?ve.PAN:ve.None},t.onUpdateDelta=function(i,r){var e=i.keyPanSpeed,n=i.input;r.x=r.y=0,n.isKeyHeldDown(tr.ArrowLeft)&&(r.x+=e),n.isKeyHeldDown(tr.ArrowRight)&&(r.x-=e),n.isKeyHeldDown(tr.ArrowUp)&&(r.y+=e),n.isKeyHeldDown(tr.ArrowDown)&&(r.y-=e)},t}())||Up),Vp,Gp,Jn,xt;(function(t){t[t.Moving=0]="Moving",t[t.Distance=1]="Distance"})(xt||(xt={}));var lC=(Vp=wf(),Vp(Gp=(Jn=function(){function t(){}return t.onUpdateHandler=function(i){++this._frameIndex;var r=i.pointers;switch(r.length){case 1:i.isPointerHeldDown(Lr.Secondary)?this._updateType(ve.PAN,xt.Moving):i.isPointerHeldDown(Lr.Auxiliary)?this._updateType(ve.ZOOM,xt.Moving):i.isPointerHeldDown(Lr.Primary)?this._updateType(ve.ROTATE,xt.Moving):i.pointerMovingDelta.x!==0&&i.pointerMovingDelta.y!==0?i.isPointerUp(Lr.Secondary)?this._updateType(ve.PAN,xt.Moving):i.isPointerUp(Lr.Auxiliary)?this._updateType(ve.ZOOM,xt.Moving):i.isPointerUp(Lr.Primary)?this._updateType(ve.ROTATE,xt.Moving):this._updateType(ve.None,xt.Moving):this._updateType(ve.None,xt.Moving);break;case 2:this._updateType(ve.ZOOM,xt.Distance);break;case 3:this._updateType(ve.PAN,xt.Moving);break;default:this._updateType(ve.None,xt.Moving);break}return this._handlerType},t.onUpdateDelta=function(i,r){var e=this._frameIndex;switch(this._deltaType){case xt.Moving:if(this._lastUsefulFrameIndex===e-1){var n=i.input.pointerMovingDelta;r.x=n.x,r.y=n.y}else r.x=0,r.y=0;break;case xt.Distance:var o=i.input.pointers,s=o[0],l=o[1],u=$.distance(s.position,l.position);this._lastUsefulFrameIndex===e-1?r.set(0,this._distanceOfPointers-u,0):r.set(0,0,0),this._distanceOfPointers=u;break}this._lastUsefulFrameIndex=e},t._updateType=function(i,r){(this._handlerType!==i||this._deltaType!==r)&&(this._handlerType=i,this._deltaType=r,this._lastUsefulFrameIndex=-1)},t}(),Jn._deltaType=xt.Moving,Jn._handlerType=ve.None,Jn._frameIndex=0,Jn._lastUsefulFrameIndex=-1,Jn._distanceOfPointers=0,Jn))||Gp),Hp,Wp,uC=(Hp=wf(),Hp(Wp=function(){function t(){}return t.onUpdateHandler=function(i){var r=i.wheelDelta;return r.x===0&&r.y===0&&r.z===0?ve.None:ve.ZOOM},t.onUpdateDelta=function(i,r){r.copyFrom(i.input.wheelDelta)},t}())||Wp),cC=function(t){sC(a,t);function a(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r=t.call.apply(t,[this].concat(n))||this,r.canvas=void 0,r.input=void 0,r.inputDevices=[ou,lC,uC],r.camera=void 0,r.cameraTransform=void 0,r.target=new C,r.up=new C(0,1,0),r.autoRotate=!1,r.autoRotateSpeed=Math.PI,r.enableDamping=!0,r.rotateSpeed=1,r.zoomSpeed=1,r.keyPanSpeed=7,r.dampingFactor=.1,r.zoomFactor=.2,r.minDistance=.1,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r._enableKeys=!0,r._spherical=new au,r._sphericalDelta=new au,r._sphericalDump=new au,r._zoomFrag=0,r._scale=1,r._panOffset=new C,r._tempVec3=new C,r._enableHandler=ve.All,r}var i=a.prototype;return i.onAwake=function(){var e=this.engine,n=this.entity;this.canvas=e.canvas,this.input=e.inputManager,this.camera=n.getComponent(Cl),this.cameraTransform=n.transform},i.onUpdate=function(e){this._updateInputDelta(e),this._updateTransform()},i._updateInputDelta=function(e){for(var n=ve.None,o=this._tempVec3,s=this._enableHandler,l=this.inputDevices,u=this.input,c=l.length-1;c>=0;c--){var f=l[c],h=f.onUpdateHandler(u);if(h&s)switch(n|=h,f.onUpdateDelta(this,o),h){case ve.ROTATE:this._rotate(o);break;case ve.ZOOM:this._zoom(o);break;case ve.PAN:this._pan(o);break}}var d=this._sphericalDump,_=this._sphericalDelta;if(this.enableDamping&&(s&ve.ZOOM&&n^ve.ZOOM&&(this._zoomFrag*=1-this.zoomFactor),s&ve.ROTATE&&n^ve.ROTATE&&(_.theta=d.theta*=1-this.dampingFactor,_.phi=d.phi*=1-this.dampingFactor)),n===ve.None&&this.autoRotate){var m=this.autoRotateSpeed/1e3*e;_.theta-=m}},i._rotate=function(e){var n=2*Math.PI*e.x/this.canvas.width*this.rotateSpeed;this._sphericalDelta.theta-=n;var o=2*Math.PI*e.y/this.canvas.height*this.rotateSpeed;this._sphericalDelta.phi-=o,this.enableDamping&&(this._sphericalDump.theta=-n,this._sphericalDump.phi=-o)},i._zoom=function(e){e.y>0?this._scale/=Math.pow(.95,this.zoomSpeed):e.y<0&&(this._scale*=Math.pow(.95,this.zoomSpeed))},i._pan=function(e){var n=this.cameraTransform,o=n.worldMatrix.elements,s=this.canvas.height,l=C.distance(n.position,this.target)*(this.camera.fieldOfView/2)*(Math.PI/180),u=-2*e.x*(l/s),c=2*e.y*(l/s);this._panOffset.x+=o[0]*u+o[4]*c,this._panOffset.y+=o[1]*u+o[5]*c,this._panOffset.z+=o[2]*u+o[6]*c},i._updateTransform=function(){var e=this.cameraTransform,n=this.target,o=this._tempVec3,s=this._spherical,l=this._sphericalDelta,u=this._panOffset;C.subtract(e.position,n,o),s.setFromVec3(o),s.theta+=l.theta,s.phi+=l.phi,s.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,s.theta)),s.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,s.phi)),s.makeSafe(),this._scale!==1&&(this._zoomFrag=s.radius*(this._scale-1)),s.radius+=this._zoomFrag,s.radius=Math.max(this.minDistance,Math.min(this.maxDistance,s.radius)),s.setToVec3(o),C.add(n.add(u),o,e.position),e.lookAt(n,this.up),this._zoomFrag=0,this._scale=1,l.set(0,0,0),u.set(0,0,0)},oC(a,[{key:"enableKeys",get:function(){return this._enableKeys},set:function(e){if(this._enableKeys!==e){this._enableKeys=e;var n=this.inputDevices;if(e)n.push(ou);else for(var o=n.length-1;o>=0;o--)if(n[o]===ou){n.splice(o,1);break}}}},{key:"enableRotate",get:function(){return(this._enableHandler&ve.ROTATE)!==0},set:function(e){e?this._enableHandler|=ve.ROTATE:this._enableHandler&=~ve.ROTATE}},{key:"enableZoom",get:function(){return(this._enableHandler&ve.ZOOM)!==0},set:function(e){e?this._enableHandler|=ve.ZOOM:this._enableHandler&=~ve.ZOOM}},{key:"enablePan",get:function(){return(this._enableHandler&ve.PAN)!==0},set:function(e){e?this._enableHandler|=ve.PAN:this._enableHandler&=~ve.PAN}}]),a}(Sl);function fC(){const t=new zS("canvas");t.canvas.resizeByClientSize();const a=t.sceneManager.activeScene,i=a.createRootEntity(),r=i.createChild("camera");r.addComponent(Cl),r.transform.setPosition(3,3,3),r.transform.lookAt(new C(0,0,0)),r.addComponent(cC),a.ambientLight.diffuseSolidColor.set(1,1,1,1),a.ambientLight.diffuseIntensity=1.2;class e extends Sl{constructor(){super(...arguments),this.roatate_y=new C(0,.8,0),this.roatate_z=new C(0,0,.6),this.roatate_x=new C(1,0,0)}onUpdate(){this.entity.transform.rotate(this.roatate_x),this.entity.transform.rotate(this.roatate_y),this.entity.transform.rotate(this.roatate_z)}}t.resourceManager.load("https://gw.alipayobjects.com/os/OasisHub/267000040/9994/%25E5%25BD%2592%25E6%25A1%25A3.gltf").then(n=>{const o=n.defaultSceneRoot;i.addChild(o),o.addComponent(e)}),t.run()}function hC(){return $a.useEffect(()=>{fC()},[]),$a.createElement("canvas",{id:"canvas",style:{width:"100vw",height:"100vh"}})}L1.render($a.createElement($a.StrictMode,null,$a.createElement(hC,null)),document.getElementById("root"));
